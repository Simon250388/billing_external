
#Область СлужебныйИнтерфейс

// Процедура - Начислить
//
// Параметры:
//  ПериодНачисления - 	 - 
//  Район			 - 	 - 
//  Дом				 - 	 - 
//  Абонент			 - 	 - 
//  Документ		 - 	 - 
//
Процедура Начислить(Организация, ПериодНачисления,Район,Строение,Помещение,Набор,НаборОбъемПомещений) Экспорт
		
	ГраницыПериода  						= энргРаботаСПериодомДействия.ГраницыРасчетногоПериода(Организация, ПериодНачисления,Ложь);
	
	НачалоПериодаРасчета					= ГраницыПериода.НачалоОП;
	КонецПериодаРасчета  					= ГраницыПериода.ЗавершениеОП;
	ДнейВПериоде  							= ГраницыПериода.ДнейВПериоде; 
	ПериодНовогоТарифа 						= Константы.энргДеньНачалаПримененияНовогоТарифа.Получить();
	результатЗапроса 						= РезультатЗапросаИндивидуальныеНачисления(Организация, ПериодНачисления,Район,Строение,Помещение,НачалоПериодаРасчета,КонецПериодаРасчета,ПериодНовогоТарифа,ДнейВПериоде); 	
	КонецПериода  							= КонецМесяца(ПериодНачисления);
		
	ЗаписыватьНаборыЗаписей 				= Набор = Неопределено;
	ОбработатьРезультатЗапросаНачислений(РезультатЗапроса, ГраницыПериода, Набор, НаборОбъемПомещений, ЗаписыватьНаборыЗаписей, Помещение);
		
КонецПроцедуры

// Процедура - Начисление на ОДН
//
// Параметры:
//  ПериодНачисления - 	 - 
//  Район			 - 	 - 
//  Дом				 - 	 - 
//  ДокументОбъект	 - 	 - 
//
Процедура НачислениеНаОДН(Организация,ПериодНачисления, Район,МКД, Набор)  Экспорт 
	
	ГраницыПериода  												= энргРаботаСПериодомДействия.ГраницыРасчетногоПериода(Организация, ПериодНачисления,Ложь);
	
	НачалоПериодаРасчета											= ГраницыПериода.НачалоОП;
	КонецПериодаРасчета  											= ГраницыПериода.ЗавершениеОП;
	ДнейВПериоде  													= ГраницыПериода.ДнейВПериоде; 
	результатЗапроса 												= РезультатЗапросаНачисленияНаОДН(Организация, ПериодНачисления,Район,МКД,НачалоПериодаРасчета,КонецПериодаРасчета,ДнейВПериоде); 	
	
	ОбработатьРезультатЗапросаНачисленийМКД(результатЗапроса, ГраницыПериода, МКД, Набор);
	
КонецПроцедуры

Процедура РаспредениеОбъемаМКД(Организация,ПериодНачисления, Район, Строение, Документ)  Экспорт 
	Перем ТекСтроение, ТекУслуга, НаборЗаписей, НаборЗаписейПомещений, НаборЗаписейНП, НаборЗаписейСверхНорма, ТекМКДАбонентов, ТекУслугаАбонентов,
	ДокументОбъект, ДанныеПоУслуге, НаборВыполненные, ПараметрыРасчетаНорматива, РассчитыватьНорматив, НачисленияПоУслугам;
	
	//СтруктураМКД_УК = Новый Соответствие;
	
	//РаспредениеОбъемаМКД_УК(Организация, ПериодНачисления, Район, Строение, Документ, МассивМКД_УК);
		
	ГраницыПериода  						= энргРаботаСПериодомДействия.ГраницыРасчетногоПериода(Организация, ПериодНачисления,Ложь);	
	МВТ 									= Новый МенеджерВременныхТаблиц;
	ПрочитатьНормативныеДанныеРаспределения(МВТ,Организация,ПериодНачисления,Район,ГраницыПериода);
	ПрочитатьДокументыДляРаспределения(МВТ,Организация,ПериодНачисления,Район,Строение,ГраницыПериода);
	ПрочитатьСозданныеДокументыИндивидуальныхНачислений(МВТ,Организация,ПериодНачисления,Район,Строение);
	ПрочитатьОбъемыНачисленийМКДДляРаспределения(МВТ,Организация,ПериодНачисления,Район,Строение,ГраницыПериода);
	ПрочитатьВспомогательныеДанныеРаспределениеМКД(МВТ,Организация,ПериодНачисления,Район,Строение);
	
	Запрос 									= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 			= МВТ;
	Запрос.Текст 							= ТекстЗапросаДанныеДляРаспределения(Строение);
	
	Результат  								= Запрос.ВыполнитьПакет();
	ВыборкаЗначенияТарифов 					= Результат[0].Выбрать();
	ВыборкаОбъемМКД							= Результат[1].Выбрать();
	ВыборкаАбоненты							= Результат[2].Выбрать();
	ВыборкаОбъемПоПриборуКорректировать		= Результат[3].Выбрать();
	ВыборкаРазделенныеЛицевыеСчета			= Результат[4].Выбрать();
	ВыборкаОбъемПоПриборуНПКорректировать	= Результат[5].Выбрать();

	РазделенныеЛицевыеСчета 				= Новый Соответствие;
	КлючРазделенныеЛицевыеСчета 			= "Абонент,ЗначениеПлощади,СпособРаспределенияОбъемаПомещения,ФиксированныйОбъемПотребления,
	|ДоляПотребленияЧислитель,ДоляПотребленияЗнаменатель,КоличествоПроживающих,ТарифнаяГруппа,Поставщик";
			
	Если ВыборкаОбъемМКД.Количество() = 0 Тогда
		Набор 								= РегистрыСведений.энргОтложенныеДвиженияДокументов.СоздатьНаборЗаписей();
		Набор.Отбор.Организация.Установить(Организация);
		Набор.Отбор.ПериодНачисления.Установить(ПериодНачисления);
		Набор.Отбор.Район.Установить(Район);
		Набор.Отбор.РазделЗаписи.Установить(Перечисления.энргРазделыЗаписи.РаспределениеМКД);
		Если Не Строение = Неопределено Тогда
			ЧастныйСектор 					= НЕ ЗначениеЗаполнено(Строение);
			Набор.Отбор.ЧастныйСектор.Установить(ЧастныйСектор);
			Если Не ЧастныйСектор Тогда
				Набор.Отбор.Строение.Установить(Строение);
			КонецЕсли; 			
		КонецЕсли;
		Набор.Записать();
		Возврат;
	КонецЕсли;
	
	ЗначенияТарифов 						= Новый Соответствие;
	Если ВыборкаЗначенияТарифов.Количество() > 0 Тогда
		Пока ВыборкаЗначенияТарифов.Следующий() Цикл
			ХэшСтроки 						= ХэшСтрокиТарифа(ВыборкаЗначенияТарифов.ГруппаПотребителей,ВыборкаЗначенияТарифов.Услуга,ВыборкаЗначенияТарифов.Поставщик,ВыборкаЗначенияТарифов.ТарифнаяЗона);
			ОписаниеЗначения 				= Новый Структура("Значение,ЗначениеТарифаРЭК,ЗначениеСверхНорматива,СтавкаНДС,НДСВнутри,ГруппаПотребителей,Услуга,Поставщик,ТарифнаяЗона");
			ЗаполнитьЗначенияСвойств(ОписаниеЗначения, ВыборкаЗначенияТарифов);			
			ЗначенияТарифов.Вставить(ХэшСтроки,ОписаниеЗначения); 			
		КонецЦикла;		
	КонецЕсли;
	
	ВыборкаАбоненты.следующий();
	ВыборкаОбъемПоПриборуНПКорректировать.Следующий();
	
	ЕстьРазделенныеЛицевыеСчета 				= ВыборкаРазделенныеЛицевыеСчета.Следующий();
	
	Отказ 										= Ложь;
	ТипыНачислений 								= энргНачисления.ТипыРасходовВФормулахРасчета();
	ТекстИсключения		 						= "";
	ИспользоватьТарифРек 						= Ложь;
	Если РегистрыСведений.энргИспользованиеТарифовРЭК.ПолучитьПоследнее(ГраницыПериода.ЗавершениеОП-1,Новый Структура("Организация,Район",Организация, Район)).ПрименятьТарифРЭК Тогда
		ИспользоватьТарифРек 					= Истина;
	КонецЕсли;  	
	
	РаспределениеОбъемаПоУслугам 				= Новый Соответствие;
	РаспределениеОбъемаПоУслугамПотребленный 	= Новый Соответствие;
	
	Пока ВыборкаОбъемМКД.Следующий() Цикл
		
		//Если СтруктураМКД_УК.Получить(ВыборкаОбъемМКД.Строение)<> Неопределено и СтруктураМКД_УК.Получить(ВыборкаОбъемМКД.Строение).Найти(ВыборкаОбъемМКД.Услуга) <>  Неопределено Тогда
		//	Продолжить;	
		//КонецЕсли;
		
		Если НЕ ТекСтроение = ВыборкаОбъемМКД.Строение 
			ИЛИ НЕ ТекУслуга = ВыборкаОбъемМКД.Услуга Тогда
												
			Если Не ТекУслуга  = Неопределено Тогда
				Если ПустаяСтрока(ДанныеПоУслуге.ФормулаРасчетаНорматива) Тогда
					РаспределитьОбъемПоУслугеМКД(ПериодНачисления, Организация, Район, ТекСтроение, ТекУслуга, ГраницыПериода, ЗначенияТарифов, ДанныеПоУслуге, ДокументОбъект, РаспределениеОбъемаПоУслугам, НаборЗаписей, НаборЗаписейПомещений, НаборЗаписейНП, НаборЗаписейСверхНорма,ИспользоватьТарифРек);
					РаспределитьОбъемПотребленныйПоУслугеМКД(ПериодНачисления, Организация, Район, ТекСтроение, ТекУслуга, ГраницыПериода, ЗначенияТарифов, ДанныеПоУслуге, ДокументОбъект, РаспределениеОбъемаПоУслугамПотребленный, НаборЗаписей, НаборЗаписейПомещений, НаборЗаписейНП, НаборЗаписейСверхНорма, ИспользоватьТарифРек);	
				КонецЕсли;
				ЗаполнитьПараметрыРасчетаНорматива(ДанныеПоУслуге, ПараметрыРасчетаНорматива, РассчитыватьНорматив, ТипыНачислений, ТекУслуга, НачисленияПоУслугам);
			КонецЕсли;
			
			Если НЕ ТекСтроение = ВыборкаОбъемМКД.Строение Тогда
				Если НЕ ТекСтроение = Неопределено Тогда
					// Рассчитываем норматив
					РассчитатьНормативПоФормуле(ПараметрыРасчетаНорматива, РассчитыватьНорматив,НачисленияПоУслугам,ЗначенияТарифов,ГраницыПериода,Отказ,НаборЗаписей, НаборЗаписейПомещений, НаборЗаписейНП);
					ЗаписатьНаборыЗаписейПриРаспределении(Отказ, ДокументОбъект, ТекстИсключения, НаборВыполненные, НаборЗаписей, НаборЗаписейНП, НаборЗаписейПомещений, НаборЗаписейСверхНорма);
				КонецЕсли;
				НачатьТранзакцию();
				// запоминаем свойства разделенных лицевых счетов по услугам
				РаспределениеОбъемаПоУслугам 	= Новый Соответствие;
				Отказ 							= Ложь;
				РассчитыватьНорматив 			= Новый Массив;
				ПараметрыРасчетаНорматива 		= Новый Соответствие;
				РазделенныеЛицевыеСчета 		= Новый Соответствие;
				НачисленияПоУслугам 			= Новый Соответствие;
				Если ЕстьРазделенныеЛицевыеСчета Тогда
					ЗаполнитьРазделенныеЛицевыеСчета(КлючРазделенныеЛицевыеСчета, РазделенныеЛицевыеСчета, ВыборкаРазделенныеЛицевыеСчета, ВыборкаОбъемМКД);					
				КонецЕсли; 				
			КонецЕсли;			
						
			ДанныеПоУслуге 					= ДанныеПоУслугиДляРаспределения(ВыборкаОбъемМКД, РазделенныеЛицевыеСчета);
			
			ЗаполнитьДанныеАбонентовДляРаспределения(ДанныеПоУслуге, ВыборкаАбоненты, ВыборкаОбъемМКД, ВыборкаОбъемПоПриборуКорректировать, ВыборкаОбъемПоПриборуНПКорректировать);
						
			Если НЕ ТекСтроение = ВыборкаОбъемМКД.Строение Тогда
				ПрочитатьНаборыДляЗаписиПриРаспределении(ВыборкаОбъемМКД, ДокументОбъект, НаборВыполненные, НаборЗаписей, НаборЗаписейПомещений, НаборЗаписейНП, НаборЗаписейСверхНорма, ГраницыПериода);
			КонецЕсли;		
		КонецЕсли;
		
		ЗаполнитьОбъемыМКДПриРаспределении(ВыборкаОбъемМКД, ДанныеПоУслуге);
		
		ТекСтроение							= ВыборкаОбъемМКД.Строение;
		ТекУслуга 							= ВыборкаОбъемМКД.Услуга;
	КонецЦикла; 	
	
	Если Не ТекСтроение = Неопределено Тогда		
		Если ПустаяСтрока(ДанныеПоУслуге.ФормулаРасчетаНорматива) Тогда
			РаспределитьОбъемПоУслугеМКД(ПериодНачисления, Организация, Район, ТекСтроение, ТекУслуга, ГраницыПериода, ЗначенияТарифов, ДанныеПоУслуге, ДокументОбъект, РаспределениеОбъемаПоУслугам, НаборЗаписей, НаборЗаписейПомещений, НаборЗаписейНП, НаборЗаписейСверхНорма, ИспользоватьТарифРек);
			РаспределитьОбъемПотребленныйПоУслугеМКД(ПериодНачисления, Организация, Район, ТекСтроение, ТекУслуга, ГраницыПериода, ЗначенияТарифов, ДанныеПоУслуге, ДокументОбъект, РаспределениеОбъемаПоУслугамПотребленный, НаборЗаписей, НаборЗаписейПомещений, НаборЗаписейНП, НаборЗаписейСверхНорма, ИспользоватьТарифРек);
		КонецЕсли;		
		ЗаполнитьПараметрыРасчетаНорматива(ДанныеПоУслуге, ПараметрыРасчетаНорматива, РассчитыватьНорматив, ТипыНачислений, ТекУслуга, НачисленияПоУслугам);
		РассчитатьНормативПоФормуле(ПараметрыРасчетаНорматива, РассчитыватьНорматив, НачисленияПоУслугам, ЗначенияТарифов, ГраницыПериода, Отказ, НаборЗаписей, НаборЗаписейПомещений, НаборЗаписейНП);
		ЗаписатьНаборыЗаписейПриРаспределении(Отказ, ДокументОбъект, ТекстИсключения, НаборВыполненные, НаборЗаписей, НаборЗаписейНП, НаборЗаписейПомещений, НаборЗаписейСверхНорма);
	КонецЕсли;
		
КонецПроцедуры

Процедура РаспредениеОбъемаМКД_УК(Организация,ПериодНачисления, Район,МКД, Документ,СтруктураМКД_УК)  Экспорт 
	
	ГраницыПериода  				= энргРаботаСПериодомДействия.ГраницыРасчетногоПериода(Организация, ПериодНачисления,Ложь);
	МВТ 							= Новый МенеджерВременныхТаблиц;
	Запрос  						= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Запрос.УстановитьПараметр("Организация",		Организация);
	Запрос.УстановитьПараметр("ПериодНачисления",	ПериодНачисления);  
	Запрос.УстановитьПараметр("Дата",				ГраницыПериода.ЗавершениеОП-1);
	Запрос.УстановитьПараметр("Район",				Район);
	Запрос.УстановитьПараметр("Строение",			МКД);
	Запрос.УстановитьПараметр("НачалоПериода",		ГраницыПериода.НачалоОП);
	Запрос.УстановитьПараметр("КонецПериода",		ГраницыПериода.ЗавершениеОП);
	Запрос.УстановитьПараметр("Поставщик",			Константы.энргПоставщикПоУмолчанию.Получить());
	Запрос.Текст = "ВЫБРАТЬ
	               |	энргФормыУправленияМКДСрезПоследних.МКД КАК МКД,
	               |	энргФормыУправленияМКДСрезПоследних.УК КАК УК
	               |ПОМЕСТИТЬ МКД_С_УТ
	               |ИЗ
	               |	РегистрСведений.энргФормыУправленияМКД.СрезПоследних(
	               |			&КонецПериода,
	               |			Организация = &Организация
	               |				И Район = &Район
	               |				И МКД = &Строение) КАК энргФормыУправленияМКДСрезПоследних
	               |ГДЕ
	               |	энргФормыУправленияМКДСрезПоследних.ФормаУправления = ЗНАЧЕНИЕ(Перечисление.энргФормыУправленияМКД.УК)
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	энргСостояниеМКДСрезПоследних.МКД КАК МКД
	               |ПОМЕСТИТЬ АктивныеМКД
	               |ИЗ
	               |	РегистрСведений.энргСостояниеМКД.СрезПоследних(
	               |			&КонецПериода,
	               |			Район = &Район
	               |				И Организация = &Организация
	               |				И МКД В
	               |					(ВЫБРАТЬ
	               |						МКД_С_УТ.МКД КАК МКД
	               |					ИЗ
	               |						МКД_С_УТ КАК МКД_С_УТ)) КАК энргСостояниеМКДСрезПоследних
	               |ГДЕ
	               |	энргСостояниеМКДСрезПоследних.Состояние
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	энргСостояниеМКДСрезПоследних.МКД
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	энргОтложенныеДвиженияДокументов.Организация КАК Организация,
	               |	энргОтложенныеДвиженияДокументов.ПериодНачисления КАК ПериодНачисления,
	               |	энргОтложенныеДвиженияДокументов.Район КАК Район,
	               |	энргОтложенныеДвиженияДокументов.Строение КАК Строение
	               |ПОМЕСТИТЬ ДокументыДляРаспределения
	               |ИЗ
	               |	РегистрСведений.энргОтложенныеДвиженияДокументов КАК энргОтложенныеДвиженияДокументов
	               |ГДЕ
	               |	энргОтложенныеДвиженияДокументов.Организация = &Организация
	               |	И энргОтложенныеДвиженияДокументов.ПериодНачисления = &ПериодНачисления
	               |	И энргОтложенныеДвиженияДокументов.Район = &Район
	               |	И энргОтложенныеДвиженияДокументов.РазделЗаписи = ЗНАЧЕНИЕ(Перечисление.энргРазделыЗаписи.РаспределениеМКД)
	               |	И НЕ энргОтложенныеДвиженияДокументов.ЧастныйСектор
	               |	И энргОтложенныеДвиженияДокументов.Строение = &Строение
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	энргСтабильныеПериодыМКД.Организация КАК Организация,
	               |	энргСтабильныеПериодыМКД.Район КАК Район,
	               |	энргСтабильныеПериодыМКД.МКД КАК МКД,
	               |	энргСтабильныеПериодыМКД.Услуга КАК Услуга,
	               |	энргСтабильныеПериодыМКД.ТочкаУчета КАК ТочкаУчета,
	               |	энргСтабильныеПериодыМКД.ЗначениеПлощади КАК ПлощадьМОП,
	               |	энргСтабильныеПериодыМКД.ТипСхемы КАК ТипСхемы,
	               |	энргСтабильныеПериодыМКД.ВидТепловогоПункта КАК ВидТепловогоПункта,
	               |	энргСтабильныеПериодыМКД.СоставнаяУслуга КАК СоставнаяУслуга,
	               |	энргСтабильныеПериодыМКД.КлючНорматива КАК КлючНорматива
	               |ПОМЕСТИТЬ УслугиМКДРаспределять
	               |ИЗ
	               |	ДокументыДляРаспределения КАК ДокументыДляРаспределения
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргСтабильныеПериодыМКД КАК энргСтабильныеПериодыМКД
	               |		ПО ДокументыДляРаспределения.Организация = энргСтабильныеПериодыМКД.Организация
	               |			И (энргСтабильныеПериодыМКД.ПериодНачисления = &ПериодНачисления)
	               |			И ДокументыДляРаспределения.Район = энргСтабильныеПериодыМКД.Район
	               |			И ДокументыДляРаспределения.Строение = энргСтабильныеПериодыМКД.МКД
	               |			И (энргСтабильныеПериодыМКД.НомерПозиции = 0)
	               |			И (энргСтабильныеПериодыМКД.НеРаспределятьНаАбонентов)
	               |			И (энргСтабильныеПериодыМКД.Организация = &Организация)
	               |			И (энргСтабильныеПериодыМКД.Район = &Район)
	               |			И (энргСтабильныеПериодыМКД.МКД = &Строение)
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	бестАктивностьТочекУчетаНПСрезПоследних.ТочкаУчета КАК ТочкаУчета,
	               |	бестАктивностьТочекУчетаНПСрезПоследних.ОбъектРасчета КАК ОбъектРасчета,
	               |	бестАктивностьТочекУчетаНПСрезПоследних.Договор КАК Договор,
	               |	бестАктивностьТочекУчетаНПСрезПоследних.Организация КАК Организация,
	               |	бестАктивностьТочекУчетаНПСрезПоследних.Район КАК Район
	               |ПОМЕСТИТЬ ОбъектыРасчетаТУ
	               |ИЗ
	               |	РегистрСведений.бестАктивностьТочекУчетаНП.СрезПоследних(
	               |			&КонецПериода,
	               |			Организация = &Организация
	               |				И Район = &Район
	               |				И Договор.Контрагент В
	               |					(ВЫБРАТЬ РАЗЛИЧНЫЕ
	               |						МКД_С_УТ.УК КАК УК
	               |					ИЗ
	               |						МКД_С_УТ КАК МКД_С_УТ)) КАК бестАктивностьТочекУчетаНПСрезПоследних
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.бестСостояниеДоговоров.СрезПоследних(
	               |				&КонецПериода,
	               |				Организация = &Организация
	               |					И Район = &Район) КАК бестСостояниеДоговоровСрезПоследних
	               |		ПО бестАктивностьТочекУчетаНПСрезПоследних.Организация = бестСостояниеДоговоровСрезПоследних.Организация
	               |			И бестАктивностьТочекУчетаНПСрезПоследних.Район = бестСостояниеДоговоровСрезПоследних.Район
	               |			И бестАктивностьТочекУчетаНПСрезПоследних.Договор = бестСостояниеДоговоровСрезПоследних.Договор
	               |ГДЕ
	               |	бестСостояниеДоговоровСрезПоследних.Состояние
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	бестАктивностьТочекУчетаНПСрезПоследних.ТочкаУчета,
	               |	бестАктивностьТочекУчетаНПСрезПоследних.ОбъектРасчета,
	               |	бестАктивностьТочекУчетаНПСрезПоследних.Договор,
	               |	бестАктивностьТочекУчетаНПСрезПоследних.Организация,
	               |	бестАктивностьТочекУчетаНПСрезПоследних.Район
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ОбъектыРасчетаТУ.ТочкаУчета КАК ТочкаУчета,
	               |	ОбъектыРасчетаТУ.ОбъектРасчета КАК ОбъектРасчета,
	               |	ОбъектыРасчетаТУ.Договор КАК Договор,
	               |	ОбъектыРасчетаТУ.Организация КАК Организация,
	               |	ОбъектыРасчетаТУ.Район КАК Район,
	               |	УслугиМКДРаспределять.Услуга КАК Услуга
	               |ПОМЕСТИТЬ ОбъектыРасчета
	               |ИЗ
	               |	ОбъектыРасчетаТУ КАК ОбъектыРасчетаТУ
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ УслугиМКДРаспределять КАК УслугиМКДРаспределять
	               |		ПО ОбъектыРасчетаТУ.Организация = УслугиМКДРаспределять.Организация
	               |			И ОбъектыРасчетаТУ.Район = УслугиМКДРаспределять.Район
	               |			И ОбъектыРасчетаТУ.ТочкаУчета = УслугиМКДРаспределять.ТочкаУчета
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ОбъектыРасчетаТУ.ОбъектРасчета,
	               |	ОбъектыРасчетаТУ.ТочкаУчета,
	               |	ОбъектыРасчетаТУ.Договор,
	               |	ОбъектыРасчетаТУ.Организация,
	               |	ОбъектыРасчетаТУ.Район,
	               |	УслугиМКДРаспределять.Услуга
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	энргОбъемНачисленийМКД.МКД КАК МКД,
	               |	энргОбъемНачисленийМКД.Услуга КАК Услуга,
	               |	СУММА(энргОбъемНачисленийМКД.ОбъемУслуги) КАК ОбъемУслуги,
	               |	МАКСИМУМ(ВЫБОР
	               |			КОГДА энргОбъемНачисленийМКД.СпособНачисления = ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.ПоНормативу)
	               |					ИЛИ энргОбъемНачисленийМКД.СпособНачисления = ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.СреднееПоНормативу)
	               |				ТОГДА ИСТИНА
	               |			ИНАЧЕ ЛОЖЬ
	               |		КОНЕЦ) КАК НачислятьПоНорме,
	               |	энргОбъемНачисленийМКД.ТочкаУчета КАК ТочкаУчета,
	               |	энргОбъемНачисленийМКД.СпособНачисления КАК СпособНачисления,
	               |	энргОбъемНачисленийМКД.РаспределятьНаТочку КАК РаспределятьНаТочку
	               |ПОМЕСТИТЬ ОбъемыМКД
	               |ИЗ
	               |	РегистрНакопления.энргОбъемНачисленийМКД КАК энргОбъемНачисленийМКД
	               |ГДЕ
	               |	энргОбъемНачисленийМКД.Период МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И энргОбъемНачисленийМКД.Организация = &Организация
	               |	И энргОбъемНачисленийМКД.Район = &Район
	               |	И энргОбъемНачисленийМКД.СпособНачисления = ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.ПоПриборам)
	               |	И энргОбъемНачисленийМКД.МКД В
	               |			(ВЫБРАТЬ
	               |				АктивныеМКД.МКД КАК МКД
	               |			ИЗ
	               |				АктивныеМКД КАК АктивныеМКД)
	               |	И энргОбъемНачисленийМКД.ОбъемУслуги > 0
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	энргОбъемНачисленийМКД.МКД,
	               |	энргОбъемНачисленийМКД.Услуга,
	               |	энргОбъемНачисленийМКД.ТочкаУчета,
	               |	энргОбъемНачисленийМКД.СпособНачисления,
	               |	энргОбъемНачисленийМКД.РаспределятьНаТочку
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ОбъемыМКД.МКД КАК МКД,
	               |	ОбъемыМКД.Услуга КАК Услуга,
	               |	СУММА(ВЫБОР
	               |			КОГДА ОбъемыМКД1.ОбъемУслуги ЕСТЬ NULL
	               |				ТОГДА ОбъемыМКД.ОбъемУслуги
	               |			ИНАЧЕ ОбъемыМКД1.ОбъемУслуги + ОбъемыМКД.ОбъемУслуги
	               |		КОНЕЦ) КАК ОбъемУслуги,
	               |	МАКСИМУМ(ОбъемыМКД.НачислятьПоНорме) КАК НачислятьПоНорме,
	               |	ВЫБОР
	               |		КОГДА ОбъемыМКД1.ТочкаУчета ЕСТЬ NULL
	               |			ТОГДА ОбъемыМКД.ТочкаУчета
	               |		ИНАЧЕ ОбъемыМКД1.ТочкаУчета
	               |	КОНЕЦ КАК ТочкаУчета,
	               |	МАКСИМУМ(ОбъемыМКД.СпособНачисления) КАК СпособНачисления
	               |ПОМЕСТИТЬ ОбъемМКД_РаспределениеТУ
	               |ИЗ
	               |	ОбъемыМКД КАК ОбъемыМКД
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ОбъемыМКД КАК ОбъемыМКД1
	               |		ПО ОбъемыМКД.МКД = ОбъемыМКД1.МКД
	               |			И ОбъемыМКД.Услуга = ОбъемыМКД1.Услуга
	               |			И (ОбъемыМКД1.РаспределятьНаТочку)
	               |ГДЕ
	               |	НЕ ОбъемыМКД.РаспределятьНаТочку
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ОбъемыМКД.МКД,
	               |	ОбъемыМКД.Услуга,
	               |	ВЫБОР
	               |		КОГДА ОбъемыМКД1.ТочкаУчета ЕСТЬ NULL
	               |			ТОГДА ОбъемыМКД.ТочкаУчета
	               |		ИНАЧЕ ОбъемыМКД1.ТочкаУчета
	               |	КОНЕЦ
	               |
	               |ОБЪЕДИНИТЬ ВСЕ
	               |
	               |ВЫБРАТЬ
	               |	ОбъемыМКД.МКД,
	               |	ОбъемыМКД.Услуга,
	               |	СУММА(ОбъемыМКД.ОбъемУслуги),
	               |	МАКСИМУМ(ОбъемыМКД.НачислятьПоНорме),
	               |	ОбъемыМКД.ТочкаУчета,
	               |	МАКСИМУМ(ОбъемыМКД.СпособНачисления)
	               |ИЗ
	               |	ОбъемыМКД КАК ОбъемыМКД
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ОбъемыМКД КАК ОбъемыМКД1
	               |		ПО ОбъемыМКД.МКД = ОбъемыМКД1.МКД
	               |			И ОбъемыМКД.Услуга = ОбъемыМКД1.Услуга
	               |			И (НЕ ОбъемыМКД1.РаспределятьНаТочку)
	               |ГДЕ
	               |	ОбъемыМКД.РаспределятьНаТочку
	               |	И ОбъемыМКД1.Услуга ЕСТЬ NULL
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ОбъемыМКД.МКД,
	               |	ОбъемыМКД.Услуга,
	               |	ОбъемыМКД.ТочкаУчета
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	энргОбъемНачисленийОбороты.Строение КАК МКД,
	               |	энргОбъемНачисленийОбороты.Услуга КАК Услуга,
	               |	энргОбъемНачисленийОбороты.ОбъемУслугиОборот КАК ОбъемУслуги,
	               |	ВЫБОР
	               |		КОГДА энргОбъемНачисленийОбороты.СпособНачисления = ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.ПоНормативу)
	               |			ТОГДА ИСТИНА
	               |		ИНАЧЕ ЛОЖЬ
	               |	КОНЕЦ КАК НачислятьПоНорме
	               |ПОМЕСТИТЬ ОбъемыПотребителей
	               |ИЗ
	               |	РегистрНакопления.энргОбъемНачислений.Обороты(
	               |			&НачалоПериода,
	               |			&КонецПериода,
	               |			,
	               |			Организация = &Организация
	               |				И Район = &Район
	               |				И Строение В
	               |					(ВЫБРАТЬ
	               |						АктивныеМКД.МКД КАК МКД
	               |					ИЗ
	               |						АктивныеМКД КАК АктивныеМКД)
	               |				И НЕ Распределение) КАК энргОбъемНачисленийОбороты
	               |
	               |ОБЪЕДИНИТЬ ВСЕ
	               |
	               |ВЫБРАТЬ
	               |	бестОбъемНачисленийНПОбороты.МКД,
	               |	бестОбъемНачисленийНПОбороты.Услуга,
	               |	бестОбъемНачисленийНПОбороты.ОбъемУслугиОборот,
	               |	ВЫБОР
	               |		КОГДА бестОбъемНачисленийНПОбороты.СпособНачисления = ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.ПоНормативу)
	               |			ТОГДА ИСТИНА
	               |		ИНАЧЕ ЛОЖЬ
	               |	КОНЕЦ
	               |ИЗ
	               |	РегистрНакопления.бестОбъемНачисленийНП.Обороты(
	               |			&НачалоПериода,
	               |			&КонецПериода,
	               |			,
	               |			Организация = &Организация
	               |				И Район = &Район
	               |				И МКД В
	               |					(ВЫБРАТЬ
	               |						АктивныеМКД.МКД КАК МКД
	               |					ИЗ
	               |						АктивныеМКД КАК АктивныеМКД)
	               |				И НЕ Распределение) КАК бестОбъемНачисленийНПОбороты
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ОбъемыПотребителей.МКД КАК МКД,
	               |	ОбъемыПотребителей.Услуга КАК Услуга,
	               |	СУММА(ОбъемыПотребителей.ОбъемУслуги) КАК ОбъемУслуги,
	               |	МАКСИМУМ(ОбъемыПотребителей.НачислятьПоНорме) КАК НачислятьПоНорме
	               |ПОМЕСТИТЬ ОбъемыПотребителейСгруппированные
	               |ИЗ
	               |	ОбъемыПотребителей КАК ОбъемыПотребителей
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ОбъемыПотребителей.МКД,
	               |	ОбъемыПотребителей.Услуга
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ОбъемМКД_РаспределениеТУ.МКД КАК МКД,
	               |	ОбъемМКД_РаспределениеТУ.Услуга КАК Услуга,
	               |	ОбъемМКД_РаспределениеТУ.НачислятьПоНорме КАК НачислятьПоНорме,
	               |	МАКСИМУМ(ОбъемМКД_РаспределениеТУ.ТочкаУчета) КАК ТочкаУчета,
	               |	МАКСИМУМ(ОбъектыРасчета.ОбъектРасчета) КАК ОбъектРасчета,
	               |	ОбъектыРасчета.Договор КАК Договор,
	               |	ОбъемМКД_РаспределениеТУ.СпособНачисления КАК СпособНачисления,
	               |	СУММА(ОбъемМКД_РаспределениеТУ.ОбъемУслуги) КАК ОбъемУслугиМКД,
	               |	МАКСИМУМ(ЕСТЬNULL(ОбъемыПотребителейСгруппированные.ОбъемУслуги, 0)) КАК ОбъемУслугиРаспределение,
	               |	МАКСИМУМ(бестНачислениеНП.Ссылка) КАК ДокументНачисления
	               |ПОМЕСТИТЬ ДанныеДляРаспределения
	               |ИЗ
	               |	ОбъектыРасчета КАК ОбъектыРасчета
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ОбъемМКД_РаспределениеТУ КАК ОбъемМКД_РаспределениеТУ
	               |			ЛЕВОЕ СОЕДИНЕНИЕ ОбъемыПотребителейСгруппированные КАК ОбъемыПотребителейСгруппированные
	               |			ПО ОбъемМКД_РаспределениеТУ.МКД = ОбъемыПотребителейСгруппированные.МКД
	               |				И ОбъемМКД_РаспределениеТУ.Услуга = ОбъемыПотребителейСгруппированные.Услуга
	               |		ПО ОбъектыРасчета.ТочкаУчета = ОбъемМКД_РаспределениеТУ.ТочкаУчета
	               |			И ОбъектыРасчета.Услуга = ОбъемМКД_РаспределениеТУ.Услуга
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.бестНачислениеНП КАК бестНачислениеНП
	               |		ПО ОбъектыРасчета.Договор = бестНачислениеНП.Договор
	               |			И (бестНачислениеНП.Организация = &Организация)
	               |			И (бестНачислениеНП.Район = &Район)
	               |			И (бестНачислениеНП.Дата = &Дата)
	               |			И (НЕ бестНачислениеНП.ПометкаУдаления)
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ОбъемМКД_РаспределениеТУ.НачислятьПоНорме,
	               |	ОбъектыРасчета.Договор,
	               |	ОбъемМКД_РаспределениеТУ.СпособНачисления,
	               |	ОбъемМКД_РаспределениеТУ.Услуга,
	               |	ОбъемМКД_РаспределениеТУ.МКД
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ДанныеДляРаспределения.МКД КАК МКД,
	               |	ДанныеДляРаспределения.Услуга КАК Услуга,
	               |	ДанныеДляРаспределения.НачислятьПоНорме КАК НачислятьПоНорме,
	               |	ДанныеДляРаспределения.ТочкаУчета КАК ТочкаУчета,
	               |	ДанныеДляРаспределения.ОбъектРасчета КАК ОбъектРасчета,
	               |	ДанныеДляРаспределения.Договор КАК Договор,
	               |	ДанныеДляРаспределения.СпособНачисления КАК СпособНачисления,
	               |	ВЫБОР
	               |		КОГДА ДанныеДляРаспределения.НачислятьПоНорме
	               |			ТОГДА ДанныеДляРаспределения.ОбъемУслугиМКД
	               |		ИНАЧЕ ДанныеДляРаспределения.ОбъемУслугиМКД - ДанныеДляРаспределения.ОбъемУслугиРаспределение
	               |	КОНЕЦ КАК ОбъемУслуги,
	               |	ДанныеДляРаспределения.ОбъемУслугиРаспределение КАК ОбъемУслугиРаспределение,
	               |	ДанныеДляРаспределения.ОбъемУслугиМКД КАК ОбъемУслугиМКД,
	               |	ДанныеДляРаспределения.ДокументНачисления КАК ДокументНачисления
	               |ИЗ
	               |	ДанныеДляРаспределения КАК ДанныеДляРаспределения
	               |
	               |ОБЪЕДИНИТЬ
	               |
	               |ВЫБРАТЬ РАЗЛИЧНЫЕ
	               |	ДанныеДляРаспределения.МКД,
	               |	энргОбъемНачисленийМКД.Услуга,
	               |	ДанныеДляРаспределения.НачислятьПоНорме,
	               |	ДанныеДляРаспределения.ТочкаУчета,
	               |	ДанныеДляРаспределения.ОбъектРасчета,
	               |	ДанныеДляРаспределения.Договор,
	               |	ДанныеДляРаспределения.СпособНачисления,
	               |	энргОбъемНачисленийМКД.НормаПотребления * (ДанныеДляРаспределения.ОбъемУслугиМКД - ДанныеДляРаспределения.ОбъемУслугиРаспределение),
	               |	ДанныеДляРаспределения.ОбъемУслугиРаспределение,
	               |	ДанныеДляРаспределения.ОбъемУслугиМКД,
	               |	ДанныеДляРаспределения.ДокументНачисления
	               |ИЗ
	               |	ДанныеДляРаспределения КАК ДанныеДляРаспределения
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.энргОбъемНачисленийМКД КАК энргОбъемНачисленийМКД
	               |		ПО ДанныеДляРаспределения.МКД = энргОбъемНачисленийМКД.МКД
	               |			И ДанныеДляРаспределения.Услуга = энргОбъемНачисленийМКД.Услуга.ЗависитОтУслуги
	               |			И ДанныеДляРаспределения.ТочкаУчета = энргОбъемНачисленийМКД.ТочкаУчета
	               |ГДЕ
	               |	энргОбъемНачисленийМКД.Организация = &Организация
	               |	И энргОбъемНачисленийМКД.Район = &Район
	               |	И энргОбъемНачисленийМКД.ПериодНачисления = &ПериодНачисления
	               |ИТОГИ
	               |	МАКСИМУМ(ДокументНачисления)
	               |ПО
	               |	Договор";
	
	Если НЕ ЗначениеЗаполнено(МКД) Тогда
		Запрос.Текст = СтрЗаменить(Запрос.Текст,"И (энргРаспределениеМКД.МКД = &Строение)","");
		Запрос.Текст = СтрЗаменить(Запрос.Текст,"И энргОтложенныеДвиженияДокументов.Строение = &Строение","");
		Запрос.Текст = СтрЗаменить(Запрос.Текст,"И (энргНомераСтрокСтабильногоПериода.Строение = &Строение)","");
		Запрос.Текст = СтрЗаменить(Запрос.Текст,"И (энргСтабильныеПериодыМКД.Строение = &Строение)","");
		Запрос.Текст = СтрЗаменить(Запрос.Текст,"И (энргСтабильныеПериоды.Строение = &Строение)","");		
		Запрос.Текст = СтрЗаменить(Запрос.Текст,"И Строение = &Строение","");
		Запрос.Текст = СтрЗаменить(Запрос.Текст,"И (бестОбъектыРасчета.МКД = &Строение)","");
		Запрос.Текст = СтрЗаменить(Запрос.Текст,"И МКД = &Строение","");
		Запрос.Текст = СтрЗаменить(Запрос.Текст,"И (энргСтабильныеПериоды.МКД = &Строение)","");
		Запрос.Текст = СтрЗаменить(Запрос.Текст,"И (энргНомераСтрокСтабильногоПериода.МКД = &Строение)","");
		Запрос.Текст = СтрЗаменить(Запрос.Текст,"И (энргСтабильныеПериодыМКД.МКД = &Строение)","");
		Запрос.Текст = СтрЗаменить(Запрос.Текст,"И (энргДокументыНачислений.МКД = &Строение)","");		
	КонецЕсли;
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДоговор = РезультатЗапроса.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	
	Пока ВыборкаДоговор.Следующий() Цикл
		// Вставить обработку выборки ВыборкаДоговор
	
		ВыборкаДетальныеЗаписи = ВыборкаДоговор.Выбрать();
		
		Если ВыборкаДетальныеЗаписи.Количество() = 0 Тогда
			Продолжить;
		КонецЕсли; 
		
		Если ЗначениеЗаполнено(ВыборкаДоговор.ДокументНачисления) Тогда
			ДокументОбъект = ВыборкаДоговор.ДокументНачисления.ПолучитьОбъект();
		Иначе
			ДокументОбъект = Документы.бестНачислениеНП.СоздатьДокумент();	
		КонецЕсли; 
		
		ДокументОбъект.Организация = Организация;
		ДокументОбъект.Договор = ВыборкаДоговор.Договор;
		ДокументОбъект.Район = Район;
		ДокументОбъект.Дата	= ГраницыПериода.ЗавершениеОП-1; 
		ДокументОбъект.Записать();
		
		ДокументОбъект.Движения.бестОбъемНачисленийНП.Прочитать();
		
		СтрокиМКД = Новый Массив;
		Для Каждого Строка Из ДокументОбъект.Движения.бестОбъемНачисленийНП Цикл
			Если Не Строка.Распределение И (Не ЗначениеЗаполнено(МКД) Или Строка.МКД <> МКД) Тогда
				Продолжить;	
			КонецЕсли; 
			СтрокиМКД.Добавить(Строка);	
		КонецЦикла;
		
		Для Каждого Строка Из СтрокиМКД Цикл
				ДокументОбъект.Движения.бестОбъемНачисленийНП.Удалить(Строка);
			КонецЦикла;
	
			Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
				
				Если  СтруктураМКД_УК.Получить(ВыборкаДетальныеЗаписи.МКД) = Неопределено Тогда
					МассивУслуг = Новый Массив;
					МассивУслуг.Добавить(ВыборкаДетальныеЗаписи.услуга);
					СтруктураМКД_УК.Вставить(ВыборкаДетальныеЗаписи.МКД, МассивУслуг);
				Иначеесли СтруктураМКД_УК.Получить(ВыборкаДетальныеЗаписи.МКД).Найти(ВыборкаДетальныеЗаписи.услуга) = Неопределено Тогда
					СтруктураМКД_УК.Получить(ВыборкаДетальныеЗаписи.МКД).Добавить(ВыборкаДетальныеЗаписи.услуга);
				КонецЕсли; 
				
			Запись = ДокументОбъект.Движения.бестОбъемНачисленийНП.Добавить();
			ЗаполнитьЗначенияСвойств(Запись,ВыборкаДетальныеЗаписи);
			Запись.Период			= ДокументОбъект.Дата;
			Запись.ВидНачисления	= Перечисления.энргВидыНачислений.Начисление;
			Запись.Распределение	= Истина;
			Запись.Организация		= Организация;;
			Запись.Район			= Район;
			Запись.НачалоПериода    = ГраницыПериода.НачалоОП;
			Запись.КонецПериода		= ГраницыПериода.ЗавершениеОП;
			Запись.ПериодНачисления = ПериодНачисления;
			Запись.ПериодРасчета	= ПериодНачисления;			
		КонецЦикла;
		
		ДокументОбъект.Движения.бестОбъемНачисленийНП.Записать();
		
	КонецЦикла;
		
КонецПроцедуры

// Процедура - Снять средние начисления
//
// Параметры:
//  ПериодНачисления - 	 - 
//  Район			 - 	 - 
//  Дом				 - 	 - 
//  Абонент			 - 	 - 
//  Документ		 - 	 - 
//
Процедура СнятьСредниеНачисления(Организация,ПериодНачисления,Район,Строение,Помещение,Документ) Экспорт
	перем ТекСтроение,ТекЧастныйСектор,ДокументОбъект; 
	
	Если не ЗначениеЗаполнено(ПериодНачисления) или не ЗначениеЗаполнено(Район)  тогда
		Возврат;
	КонецЕсли;
	
	ГраницыПериода  								= энргРаботаСПериодомДействия.ГраницыРасчетногоПериода(Организация, ПериодНачисления);
	
	НачалоПериодаРасчета							= ГраницыПериода.НачалоОП;
	КонецПериодаРасчета  							= ГраницыПериода.ЗавершениеОП;
	      	
	МВТ  											= Новый МенеджерВременныхТаблиц;
	ПрочитатьНеСписанныйСредний(МВТ,ПериодНачисления,Организация,Район,Строение,Помещение,НачалоПериодаРасчета);	
	результатЗапроса 								= РезультатЗапросаПерерасчетСреднего(МВТ,Организация, ПериодНачисления, КонецПериодаРасчета-1,Район,Строение,Помещение); 	
	
	Выборка  										= результатЗапроса.выбрать();
	ВидОперации 									= Перечисления.энргВидыОпераций.энргПерерасчет_СвязанныйПерерасчет;
	Сч 												= 0;
	
	Набор 											= Неопределено;
	НаборНачисленныйСредний 						= Неопределено;
	
	ВидНачисленияПерерасчет 						= Перечисления.энргВидыНачислений.Перерасчет;
	
	Если Выборка.Количество() = 0 Тогда				
		ВыборкаДокументыОтменить 					= РезультатОтменитьСнятьСредниеНачисления(ПериодНачисления,Организация,Район,Строение);
		Пока ВыборкаДокументыОтменить.Следующий() Цикл
			ДокументОбъектОтменить					= ВыборкаДокументыОтменить.Ссылка.ПолучитьОбъект();
			ДокументОбъектОтменить.УстановитьПометкуУдаления(Истина);
		КонецЦикла; 		
	КонецЕсли;
	
	СтрокиНабораДоЗаписи 							= Неопределено;
	СтрокиНаборНачисленныйСреднийДоЗаписи 			= Неопределено;
	Ошибки 											= "";
	
	Пока Выборка.следующий() цикл
		Если ТипЗнч(Документ) = Тип("Структура") И  Документ.Свойство("ОбъемНачислений") Тогда
			НаборНачисленныйСредний 				= Неопределено;    
			Набор 									= Документ.ОбъемНачислений;
		ИначеЕсли Документ = Неопределено тогда
			Если Не ТекЧастныйСектор = Выборка.ЧастныйСектор ИЛИ (НЕ ТекЧастныйСектор и Не ТекСтроение = Выборка.Строение) тогда 				
				Если Не ТекСтроение = Неопределено Тогда					
					Попытка
						Если ДокументОбъект<>Неопределено тогда
							ДокументОбъект.ДополнительныеСвойства.Вставить("НеПроверятьНаличиеПрисоединенныхФайлов", 	Истина);
							ДокументОбъект.ДополнительныеСвойства.Вставить("НеРегестрироватьВзаиморасчеты", 			Истина);
							ДокументОбъект.ДополнительныеСвойства.Вставить("ПроведениеРазрешено",						Истина);
							ДокументОбъект.ДополнительныеСвойства.Вставить("РегистрироватьПоказанияПУ", 				Ложь);
							ДокументОбъект.ДополнительныеСвойства.Вставить("РегистрироватьСтабильныеПериоды", 			Ложь);
							ДокументОбъект.записать(РежимЗаписиДокумента.Запись);										
						КонецЕсли;
						
						Набор.ДополнительныеСвойства.Вставить("Организация",		Организация);
						Набор.ДополнительныеСвойства.Вставить("Район",				Район);
						Набор.ДополнительныеСвойства.Вставить("ПериодНачисления",	ПериодНачисления);
						Набор.ДополнительныеСвойства.Вставить("Строение",			?(ТекЧастныйСектор, Справочники.энргСтроения.ПустаяСсылка(), ТекСтроение));
						Набор.ДополнительныеСвойства.Вставить("ДатаРегистратора",	КонецПериодаРасчета-1);
						Набор.ДополнительныеСвойства.Вставить("НаборНачисленныйСредний", НаборНачисленныйСредний);
						Набор.Записать(Ложь);
						ЗафиксироватьТранзакцию();
					Исключение
						ОтменитьТранзакцию();
						ИнформацияОбОшибке  		= ИнформацияОбОшибке();
						Ошибки 						= Ошибки +
						Символы.ПС + ПодробноеПредставлениеОшибки(ИнформацияОбОшибке);
					КонецПопытки;
				КонецЕсли;
				НачатьТранзакцию();
				ДокументСсылка 						= Выборка.ДокументПерерасчета;
				ПометкаУдаления 					= Выборка.ДокументПерерасчетаПометкаУдаления;
				ДокументОбъект  					= Неопределено;
				Если НЕ ЗначениеЗаполнено(ДокументСсылка)  Тогда
					ДокументСсылка 					= Документы.энргПерерасчет.ПолучитьСсылку(Новый УникальныйИдентификатор());
					ДокументОбъект  				= Документы.энргПерерасчет.СоздатьДокумент();
					ДокументОбъект.УстановитьСсылкуНового(ДокументСсылка);
					ДокументОбъект.район  			= Район;
					ДокументОбъект.Строение			= ?(Выборка.ЧастныйСектор, Справочники.энргСтроения.ПустаяСсылка(), Выборка.Строение);
					ДокументОбъект.Дата				= КонецПериодаРасчета-1;
					ДокументОбъект.Организация 		= Организация;
					ДокументОбъект.ВидОперации 		= Перечисления.энргВидыОпераций.энргПерерасчет_СвязанныйПерерасчет;
					ДокументОбъект.ПериодНачисления = ПериодНачисления;
				ИначеЕсли ПометкаУдаления Тогда
					ДокументОбъект  				= ДокументСсылка.ПолучитьОбъект();
					ДокументОбъект.ПометкаУдаления 	= Ложь;
				КонецЕсли;
				 							 
				НаборНачисленныйСредний 			= РегистрыНакопления.энргНачисленныйСреднийОбъем.СоздатьНаборЗаписей();
				НаборНачисленныйСредний.Отбор.Регистратор.Установить(ДокументСсылка);
				
				Если Не Помещение = Неопределено Тогда					
					НаборНачисленныйСредний.ДополнительныеСвойства.Вставить("Помещение",	Помещение);
					Если ДокументОбъект = Неопределено Тогда
						НаборНачисленныйСредний.Прочитать();
						СтрокиНаборНачисленныйСреднийДоЗаписи 			= НаборНачисленныйСредний.Выгрузить();
						СтрокиУдалить 									= СтрокиНаборНачисленныйСреднийДоЗаписи.НайтиСтроки(Новый Структура("Помещение", Помещение));
						Для Каждого СтрокаУдалить ИЗ СтрокиУдалить Цикл
							СтрокиНаборНачисленныйСреднийДоЗаписи.Удалить(СтрокаУдалить);
						КонецЦикла;
						НаборНачисленныйСредний.Очистить();
					КонецЕсли;					
				КонецЕсли;
								
				Если ДокументОбъект = Неопределено Тогда
					НаборНачисленныйСредний.Записать();
				КонецЕсли;
								
				Набор								= РегистрыНакопления.энргОбъемНачислений.СоздатьНаборЗаписей();
				Набор.Отбор.Регистратор.Установить(ДокументСсылка);
				
				Если Не Помещение = Неопределено Тогда					
					Набор.ДополнительныеСвойства.Вставить("Помещение",	Помещение);
					Если ДокументОбъект = Неопределено Тогда
						Набор.Прочитать();
						СтрокиНабораДоЗаписи 		= Набор.Выгрузить();
						СтрокиУдалить 				= СтрокиНабораДоЗаписи.НайтиСтроки(Новый Структура("Помещение", Помещение));
						Для Каждого СтрокаУдалить ИЗ СтрокиУдалить Цикл
							СтрокиНабораДоЗаписи.Удалить(СтрокаУдалить);
						КонецЦикла;
						Набор.Очистить();
					КонецЕсли;					
				КонецЕсли;
								
				Если ДокументОбъект = Неопределено Тогда
					Набор.Записать();
				КонецЕсли;				
			КонецЕсли;
		иначе
			Если ДокументОбъект = Неопределено Тогда
				НачатьТранзакцию();
				ДокументСсылка						= Документ.Ссылка;
				ДокументОбъект 						= ДокументСсылка.ПолучитьОбъект();
				
				НаборНачисленныйСредний 			= РегистрыНакопления.энргНачисленныйСреднийОбъем.СоздатьНаборЗаписей();
				НаборНачисленныйСредний.Отбор.Регистратор.Установить(ДокументСсылка);
				НаборНачисленныйСредний.Очистить();
				
				Набор								= РегистрыНакопления.энргОбъемНачислений.СоздатьНаборЗаписей();
				Набор.Отбор.Регистратор.Установить(ДокументСсылка);
				Набор.Очистить();
			КонецЕсли;
			
			//ДокументОбъект 							= Документ;
			//ОбъемНачислений 						= ДокументОбъект.СвязанныйПерерасчет;
		КонецЕсли;	
		
		Если НаборНачисленныйСредний <> Неопределено Тогда
			СтрокаНабора 							= НаборНачисленныйСредний.добавитьРасход();
			ЗаполнитьЗначенияСвойств(СтрокаНабора,Выборка);
			СтрокаНабора.Период 					= ГраницыПериода.ЗавершениеОП - 1;
			СтрокаНабора.Организация 				= Организация;
		КонецЕсли;
		
		// ЗначениеТарифа = ?(ЗначениеЗаполнено(Выборка.Сумма),Выборка.ОбъемУслугиНачислено/Выборка.СуммаНачислено,0);
		//ЗначениеТарифа 								= Выборка.ЗначениеТарифаНачислено;
		ЗначениеТарифа 								= Выборка.ЗначениеТарифа;
		
		СтрокаНабора 								= Набор.Добавить();
		ЗаполнитьЗначенияСвойств(СтрокаНабора,Выборка);
		СтрокаНабора.Период 						= ГраницыПериода.ЗавершениеОП - 1;
		СтрокаНабора.Организация 					= Организация;
		СтрокаНабора.ВидНачисления 					= ВидНачисленияПерерасчет;
		СтрокаНабора.ОбъемУслуги 					= -Выборка.ОбъемУслуги;
		СтрокаНабора.ОбъемУслугиПотребленный 		= -Выборка.ОбъемУслугиПотребленный;
		СтрокаНабора.Сумма		 					= -Выборка.ОбъемУслуги*ЗначениеТарифа;
		СтрокаНабора.ПериодРасчета					= ПериодНачисления;
		СтрокаНабора.ПериодНачисления				= Выборка.ПериодНачисления;
		
		ТекЧастныйСектор 							= Выборка.ЧастныйСектор;
		ТекСтроение									= Выборка.Строение;
		Сч 											= Сч + 1;
	КонецЦикла;	
		 
	Если Не ТекСтроение = Неопределено И ТипЗнч(Документ) <> Тип("Структура") Тогда					
		Попытка
			Если ДокументОбъект<>Неопределено тогда
				ДокументОбъект.ДополнительныеСвойства.Вставить("НеПроверятьНаличиеПрисоединенныхФайлов", 	Истина);
				ДокументОбъект.ДополнительныеСвойства.Вставить("НеРегестрироватьВзаиморасчеты", 			Истина);
				ДокументОбъект.ДополнительныеСвойства.Вставить("ПроведениеРазрешено",						Истина);
				ДокументОбъект.ДополнительныеСвойства.Вставить("РегистрироватьПоказанияПУ", 				Ложь);
				ДокументОбъект.ДополнительныеСвойства.Вставить("РегистрироватьСтабильныеПериоды", 			Ложь);
				ДокументОбъект.записать(РежимЗаписиДокумента.Запись);										
			КонецЕсли;
			
			Если Набор.Количество() > 0 Тогда
				Набор.ДополнительныеСвойства.Вставить("Организация",		Организация);
				Набор.ДополнительныеСвойства.Вставить("Район",				Район);
				Набор.ДополнительныеСвойства.Вставить("ПериодНачисления",	ПериодНачисления);
				Набор.ДополнительныеСвойства.Вставить("Строение",			?(ТекЧастныйСектор, Справочники.энргСтроения.ПустаяСсылка(), ТекСтроение));
				Набор.ДополнительныеСвойства.Вставить("ДатаРегистратора",	КонецПериодаРасчета-1);
				
				Если НЕ Помещение = Неопределено и НЕ СтрокиНабораДоЗаписи = Неопределено и СтрокиНабораДоЗаписи.Количество() > 0 Тогда
					Набор.ДополнительныеСвойства.Вставить("Помещение",	Помещение);
					Для Каждого СтрокаДобавить Из СтрокиНаборНачисленныйСреднийДоЗаписи Цикл
						ЗаполнитьЗначенияСвойств(НаборНачисленныйСредний.Добавить(), СтрокаДобавить);
					КонецЦикла;
					
					Для Каждого СтрокаДобавить Из СтрокиНабораДоЗаписи Цикл
						ЗаполнитьЗначенияСвойств(Набор.Добавить(), СтрокаДобавить);
					КонецЦикла;				
				КонецЕсли;
				
				Набор.ДополнительныеСвойства.Вставить("НаборНачисленныйСредний", НаборНачисленныйСредний);			
				Набор.Записать(Ложь);
			КонецЕсли;
			ЗафиксироватьТранзакцию();
		Исключение
			ОтменитьТранзакцию();
			ИнформацияОбОшибке  					= ИнформацияОбОшибке();
			Ошибки 									= Ошибки +
			Символы.ПС + ПодробноеПредставлениеОшибки(ИнформацияОбОшибке);
		КонецПопытки;
	КонецЕсли;  
	 	
	Если Не ПустаяСтрока(Ошибки) Тогда
		ВызватьИсключение Ошибки;
	КонецЕсли;
	
КонецПроцедуры

Процедура СнятьСредниеНачисленияМКД(Организация,ПериодНачисления,Район,МКД,Документ) Экспорт
	перем ТекМКД,ДокументОбъект; 
	
	Если не ЗначениеЗаполнено(ПериодНачисления) или не ЗначениеЗаполнено(Район)  тогда
		Возврат;
	КонецЕсли;
	
	ГраницыПериода  								= энргРаботаСПериодомДействия.ГраницыРасчетногоПериода(Организация, ПериодНачисления);
	
	НачалоПериодаРасчета							= ГраницыПериода.НачалоОП;
	КонецПериодаРасчета  							= ГраницыПериода.ЗавершениеОП;
	
	МВТ  											= Новый МенеджерВременныхТаблиц;
	ПрочитатьНеСписанныйСреднийМКД(МВТ,Организация,Район,МКД,НачалоПериодаРасчета);	
	результатЗапроса 								= РезультатЗапросаПерерасчетСреднегоМКД(МВТ,Организация, ПериодНачисления,Район,МКД); 	
	
	Выборка  										= результатЗапроса.выбрать();
	ВидОперации 									= Перечисления.энргВидыОпераций.энргПерерасчетМКД_СвязанныйПерерасчет;
	Набор 											= Неопределено;
	НаборНачисленныйСредний 						= Неопределено;
	ДокументСсылка 									= Неопределено;
	
	ВидНачисленияПерерасчет							= Перечисления.энргВидыНачислений.Перерасчет;
	
	Пока Выборка.следующий() цикл
		Если Документ = Неопределено тогда			
			Если  ДокументСсылка = Неопределено Тогда
				ДокументСсылка 						= Выборка.ДокументПерерасчета;
				ДокументОбъект 						= Неопределено;
				Если НЕ ЗначениеЗаполнено(ДокументСсылка) тогда					
					ДокументСсылка 					= Документы.энргПерерасчетМКД.ПолучитьСсылку(Новый УникальныйИдентификатор());
					ДокументОбъект  				= Документы.энргПерерасчетМКД.СоздатьДокумент();
					ДокументОбъект.УстановитьСсылкуНового(ДокументСсылка);
					ДокументОбъект.район  			= Район;
					ДокументОбъект.Дата				= КонецПериодаРасчета-1;
					ДокументОбъект.Организация 		= Организация;
					ДокументОбъект.ВидОперации 		= ВидОперации;
				КонецЕсли;
							 
				НаборНачисленныйСредний 			= РегистрыНакопления.энргНачисленныйСреднийОбъемМКД.СоздатьНаборЗаписей();
				НаборНачисленныйСредний.Отбор.Регистратор.Установить(ДокументСсылка);
				НаборНачисленныйСредний.Записать();
				
				Набор								= РегистрыНакопления.энргОбъемНачисленийМКД.СоздатьНаборЗаписей();
				Набор.Отбор.Регистратор.Установить(ДокументСсылка);
				Набор.Записать();				
			КонецЕсли;
		иначе
			Набор 									= Документ.Движения.энргНачисленныйСреднийОбъемМКД;
			Набор.Очистить(); 			
		КонецЕсли;		
		
		СтрокаНабора 								= НаборНачисленныйСредний.добавитьРасход();
		ЗаполнитьЗначенияСвойств(СтрокаНабора,Выборка);
		СтрокаНабора.Период 						= ГраницыПериода.ЗавершениеОП - 1;
		СтрокаНабора.Организация 					= Организация;
		
		СтрокаНабора 								= Набор.Добавить();
		ЗаполнитьЗначенияСвойств(СтрокаНабора,Выборка);
		СтрокаНабора.Период 						= ГраницыПериода.ЗавершениеОП - 1;
		СтрокаНабора.Организация 					= Организация;
		СтрокаНабора.ВидНачисления 					= ВидНачисленияПерерасчет;
		СтрокаНабора.ОбъемУслуги 					= - Выборка.ОбъемУслуги;
		СтрокаНабора.ПериодРасчета					= ГраницыПериода.ПериодНачисления;
	КонецЦикла;	
		
	Если Документ = Неопределено И Не Набор = Неопределено и Набор.Количество() > 0 тогда
		НачатьТранзакцию();
		Попытка
			Если Не ДокументОбъект = Неопределено Тогда
				ДокументОбъект.ДополнительныеСвойства.Вставить("ПроведениеРазрешено",Истина);
				ДокументОбъект.записать(РежимЗаписиДокумента.Проведение);
			КонецЕсли;
			Набор.ДополнительныеСвойства.Вставить("Организация",			Организация);
			Набор.ДополнительныеСвойства.Вставить("Район",					Район);
			Набор.ДополнительныеСвойства.Вставить("ПериодНачисления",		ПериодНачисления);
			Набор.ДополнительныеСвойства.Вставить("ДатаРегистратора",		КонецПериодаРасчета-1);
			Набор.ДополнительныеСвойства.Вставить("ИзменятьОбъемНачислений", Истина);
			Набор.ДополнительныеСвойства.Вставить("НаборНачисленныйСредний", НаборНачисленныйСредний);
			Набор.Записать(Ложь);						
			ЗафиксироватьТранзакцию();
		Исключение
			ОписаниеОшибки 							= ИнформацияОбОшибке();
			ОтменитьТранзакцию();
			ВызватьИсключение ПодробноеПредставлениеОшибки(ОписаниеОшибки);
		КонецПопытки;
	КонецЕсли; 
	
КонецПроцедуры

Процедура ОтменитьЗакрытьПериода(Организация,ПериодНачисления,Район,МКД) Экспорт 
	
	ГраницыПериода  								= энргРаботаСПериодомДействия.ГраницыРасчетногоПериода(Организация, ПериодНачисления);
	
	НачалоПериодаРасчета							= ГраницыПериода.НачалоОП;
	КонецПериодаРасчета  							= ГраницыПериода.ЗавершениеОП-1;
	ДнейВПериоде  									= ГраницыПериода.ДнейВПериоде; 
	
	Запрос  		= Новый Запрос;
	Запрос.УстановитьПараметр("Район",				Район);
	Запрос.УстановитьПараметр("НачалоПериода",		НачалоПериодаРасчета);
	Запрос.УстановитьПараметр("КонецПериода",		КонецПериодаРасчета);
	Запрос.УстановитьПараметр("Организация",		Организация);
	Запрос.УстановитьПараметр("ПериодНачисления",	ПериодНачисления);
	Текст 	=
	"ВЫБРАТЬ
	|	энргНачисление.Ссылка КАК Ссылка
	|ИЗ
	|	Документ.энргНачисление КАК энргНачисление
	|ГДЕ
	|	энргНачисление.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|	И энргНачисление.МКД = &МКД
	|	И энргНачисление.Район = &Район
	|	И энргНачисление.Проведен
	|	И энргНачисление.Организация = &Организация
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	энргНачислениеМКД.Ссылка
	|ИЗ
	|	Документ.энргНачислениеМКД КАК энргНачислениеМКД
	|ГДЕ
	|	энргНачислениеМКД.Организация = &Организация
	|	И энргНачислениеМКД.Район = &Район
	|	И энргНачислениеМКД.Проведен
	|	И энргНачислениеМКД.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	энргПерерасчет.Ссылка
	|ИЗ
	|	Документ.энргПерерасчет КАК энргПерерасчет
	|ГДЕ
	|	энргПерерасчет.Проведен
	|	И энргПерерасчет.Организация = &Организация
	|	И энргПерерасчет.Район = &Район
	|	И энргПерерасчет.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|	И энргПерерасчет.МКД = &МКД
	|	И энргПерерасчет.ВидОперации = ЗНАЧЕНИЕ(Перечисление.энргВидыОпераций.энргПерерасчет_КорректировкаПоказаний)
	|
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	энргЗакрытиеПериода.Ссылка
	|ИЗ
	|	Документ.энргЗакрытиеПериода КАК энргЗакрытиеПериода
	|ГДЕ
	|	энргЗакрытиеПериода.Проведен
	|	И энргЗакрытиеПериода.Район = &Район
	|	И энргЗакрытиеПериода.Организация = &Район
	|	И энргЗакрытиеПериода.ПериодНачисления = &ПериодНачисления";
	
	Если МКД = Неопределено тогда
		Текст 			= СтрЗаменить(Текст,"И энргНачисление.МКД = &МКД","");
		Текст			= СтрЗаменить(Текст,"И энргПерерасчет.МКД = &МКД","");
	иначе
		Запрос.УстановитьПараметр("МКД",МКД);
	КонецЕсли;
	
	Запрос.Текст 		= Текст;
	Результат  			= Запрос.Выполнить();
	Выборка 			= Результат.Выбрать();
	Пока Выборка.Следующий() цикл  		
		ДокОбъект  		= Выборка.ссылка.получитьОбъект();
		ДокОбъект.ДополнительныеСвойства.вставить("ПроведениеРазрешено",истина);
		ДокОбъект.УстановитьПометкуУдаления(Истина);		
	КонецЦикла; 
	
КонецПроцедуры

Процедура НачислениеПоРассрочке(Организация,ПериодНачисления,Район,МКД,Документ)  Экспорт 
	
	Если НЕ ПолучитьФункциональнуюОпцию("энргИспользоватьРассрочку") Тогда
		Возврат;
	КонецЕсли;
		
	ГраницыПериода  								= энргРаботаСПериодомДействия.ГраницыРасчетногоПериода(Организация, ПериодНачисления);
	
	НачалоПериодаРасчета							= ГраницыПериода.НачалоОП;
	КонецПериодаРасчета  							= ГраницыПериода.ЗавершениеОП-1;
	ДнейВПериоде  									= ГраницыПериода.ДнейВПериоде; 
	ДифференцированныйСпособРасчетаПроцентов(Организация, ПериодНачисления,Район,МКД,Документ,КонецПериодаРасчета);
	
	Если МКД = Неопределено тогда
		//Набор 							= РегистрыСведений.энргВыполненныеНачисления.СоздатьНаборЗаписей();
		//Набор.Отбор.ПериодНачисления.установить(ПериодНачисления);
		//Набор.Отбор.Район.установить(Район);
		//Набор.Отбор.ВидОперацииНачисления.установить(Перечисления.энргВидыОперацийНачисления.ПроцентыЗаРассрочку);		
		//Набор.ДополнительныеСвойства.Вставить("ЗаписьРазрешена");
		//Запись 							= Набор.Добавить();
		//Запись.ПериодНачисления 		= ПериодНачисления;
		//Запись.Район					= Район;
		//Запись.ВидОперацииНачисления	= Перечисления.энргВидыОперацийНачисления.ПроцентыЗаРассрочку;
		//Набор.Записать();
	КонецЕсли; 
	
КонецПроцедуры

Процедура НачислитьПеню(Организация,ПериодНачисления,Район,МКД,Абонент,Документ) Экспорт  
	
	НачислятьПеню = Константы.энргНачислятьПеню.Получить();
	                   
	Если не НачислятьПеню тогда		
		Если МКД = Неопределено тогда
			//Набор 							= РегистрыСведений.энргВыполненныеНачисления.СоздатьНаборЗаписей();
			//Набор.Отбор.ПериодНачисления.установить(ПериодНачисления);
			//Набор.Отбор.Район.установить(Район);
			//Набор.Отбор.ВидОперацииНачисления.установить(Перечисления.энргВидыОперацийНачисления.НачислениеПени);
			//Набор.ДополнительныеСвойства.Вставить("ЗаписьРазрешена");
			//Запись 							= Набор.Добавить();
			//Запись.ПериодНачисления 		= ПериодНачисления;
			//Запись.Район					= Район;
			//Запись.ВидОперацииНачисления	= Перечисления.энргВидыОперацийНачисления.НачислениеПени;
			//Набор.Записать();
		КонецЕсли;
		Возврат;
	КонецЕсли;
	
	Если МКД = Неопределено тогда
		МКД = Справочники.энргСтроения.ПустаяСсылка();
	КонецЕсли;
	
	// Ставки рефинансирования
	Запрос  								= Новый Запрос;
	Запрос.Текст 							=
	"ВЫБРАТЬ
	|	энргСтавкиРефинансированияСрезПоследних.Коэффициент КАК Коэффициент
	|ИЗ
	|	РегистрСведений.энргСтавкиРефинансирования.СрезПоследних(&Период, Организация = &Организация) КАК энргСтавкиРефинансированияСрезПоследних";
	Запрос.УстановитьПараметр("Период", ПериодНачисления);
	Запрос.УстановитьПараметр("Организация", Организация);	
	
	Результат  								= Запрос.Выполнить();
	Если Результат.Пустой() тогда
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю("Не заполнена информация по ставке рефинансирования,
		|	 Начисление пени не может быть выполнено");
		Возврат;
	КонецЕсли;
	Выборка  								= Результат.Выбрать();
	Выборка.Следующий();
	СтавкаРефинансирования  				= Выборка.Коэффициент; 
	
	// Настройки начисления пени.
	Запрос  								= Новый Запрос;
	Запрос.Текст 			=
	"ВЫБРАТЬ
	|	энргНастройкиНачисленияПениСрезПоследних.ГлубинаОтсрочки КАК ГлубинаОтсрочки,
	|	энргНастройкиНачисленияПениСрезПоследних.КрайнийСрокОплаты КАК КрайнийСрокОплаты,
	|	энргНастройкиНачисленияПениСрезПоследних.МаксимальнаяГлубинаЗадолженности КАК МаксимальнаяГлубинаЗадолженности
	|ИЗ
	|	РегистрСведений.энргНастройкиНачисленияПени.СрезПоследних(
	|			&Период,
	|			Организация = &Организация
	|				И Район = &Район) КАК энргНастройкиНачисленияПениСрезПоследних";
	Запрос.УстановитьПараметр("Период", ПериодНачисления);
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("Район", Район);
	
	Результат  								= Запрос.Выполнить();
	Если Результат.Пустой() тогда
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю("Не заполнены настройки начисления пени, Начисление пени не может быть выполнено");
		Возврат;
	КонецЕсли;
	Выборка  									= Результат.Выбрать();
	Выборка.Следующий();
	ГлубинаОтсрочки 							= Выборка.ГлубинаОтсрочки;
	КрайнийСрокОплаты 							= Выборка.КрайнийСрокОплаты;
	МаксимальнаяГлубинаЗадолженности 			= Выборка.МаксимальнаяГлубинаЗадолженности;
	
	// Настройка расчет пени
	Запрос  								= Новый Запрос;
	Запрос.Текст 			=
	"ВЫБРАТЬ
	|	энргНастройкаРасчетаПениСрезПоследних.НастройкаРасчета КАК НастройкаРасчета
	|ИЗ
	|	РегистрСведений.энргНастройкаРасчетаПени.СрезПоследних(&Период, ) КАК энргНастройкаРасчетаПениСрезПоследних";
	Запрос.УстановитьПараметр("Период", ПериодНачисления);
	
	Результат  								= Запрос.Выполнить();
	Если Результат.Пустой() тогда
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю("Не заполнены настройки расчет пени, Начисление пени не может быть выполнено");
		Возврат;
	КонецЕсли;
	Выборка  									= Результат.Выбрать();
	Выборка.Следующий();
	НастройкиРасчетаПени = Выборка.НастройкаРасчета.Получить();
	
	МаксЗначение = 0;
	Соответствие = Новый Соответствие;
	РангКоэффициента = 1;
	Для каждого Строка Из НастройкиРасчетаПени Цикл
		Если Строка.До = 0 Тогда
			НСтр = Новый Структура;
			НСтр.Вставить("Числитель", Строка.Числитель);
			НСтр.Вставить("Знаменатель", Строка.Знаменатель);
			НСтр.Вставить("РангКоэффициента", РангКоэффициента);
			
			Соответствие.Вставить(Строка.До, НСтр);
		Иначе
			Для Сч = Строка.От По Строка.До Цикл
				НСтр = Новый Структура;
				НСтр.Вставить("Числитель", Строка.Числитель);
				НСтр.Вставить("Знаменатель", Строка.Знаменатель);
				НСтр.Вставить("РангКоэффициента", РангКоэффициента);
				
				Соответствие.Вставить(Сч, НСтр);
				
				МаксЗначение = Макс(МаксЗначение, Сч);
			КонецЦикла;
		КонецЕсли;
		
		РангКоэффициента = РангКоэффициента + 1;
	КонецЦикла;
	
	// Настройки начисления пени.
	Выборка  									= Результат.Выбрать();
	Запрос  									= Новый Запрос;
	//Запрос.УстановитьПараметр("Район",			Район);
	//Запрос.УстановитьПараметр("Организация",	Организация);
	Запрос.Текст 								=
	"ВЫБРАТЬ
	|	энргВзаиморасчетыПоМесяцамОстаткиИОбороты.Район КАК Район,
	|	энргВзаиморасчетыПоМесяцамОстаткиИОбороты.МКД КАК МКД,
	|	энргВзаиморасчетыПоМесяцамОстаткиИОбороты.Абонент КАК Абонент,
	|	энргВзаиморасчетыПоМесяцамОстаткиИОбороты.Услуга КАК Услуга,
	|	энргВзаиморасчетыПоМесяцамОстаткиИОбороты.ПериодНачисления КАК ПериодНачисления,
	|	энргВзаиморасчетыПоМесяцамОстаткиИОбороты.Период КАК Период,
	|	энргВзаиморасчетыПоМесяцамОстаткиИОбороты.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
	|	энргВзаиморасчетыПоМесяцамОстаткиИОбороты.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток
	|ПОМЕСТИТЬ ДанныеЗадолженности
	|ИЗ
	|	РегистрНакопления.энргВзаиморасчетыПоМесяцам.ОстаткиИОбороты(
	|			,
	|			&КонецПериода,
	|			День,
	|			,
	|			Организация = &Организация
	|				И Район = &Район
	|				И МКД = &МКД) КАК энргВзаиморасчетыПоМесяцамОстаткиИОбороты
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеЗадолженности.Район КАК Район,
	|	ДанныеЗадолженности.МКД КАК МКД,
	|	ДанныеЗадолженности.Абонент КАК Абонент,
	|	ДанныеЗадолженности.Услуга КАК Услуга,
	|	ДанныеЗадолженности.ПериодНачисления КАК ПериодНачисления,
	|	МИНИМУМ(ДанныеЗадолженности.Период) КАК Период
	|ПОМЕСТИТЬ ДатаНачала
	|ИЗ
	|	ДанныеЗадолженности КАК ДанныеЗадолженности
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеЗадолженности.Абонент,
	|	ДанныеЗадолженности.Услуга,
	|	ДанныеЗадолженности.ПериодНачисления,
	|	ДанныеЗадолженности.Район,
	|	ДанныеЗадолженности.МКД
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеЗадолженности.Район КАК Район,
	|	ДанныеЗадолженности.МКД КАК МКД,
	|	ДанныеЗадолженности.Абонент КАК Абонент,
	|	ДанныеЗадолженности.Услуга КАК Услуга,
	|	ДанныеЗадолженности.ПериодНачисления КАК ПериодНачисления,
	|	ДанныеЗадолженности.Период КАК Период,
	|	ДанныеЗадолженности.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
	|	ДанныеЗадолженности.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток,
	|	ДатаНачала.Период КАК НачальныйПериод,
	|	ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(ДатаНачала.Период, МЕСЯЦ, &ГлубинаОтсрочки), ДЕНЬ, &КрайнийСрокОплаты), ДЕНЬ, &КоличествоДней) КАК ДатаНачалаНачисленияПени
	|ПОМЕСТИТЬ ДатаНачальногоПериода
	|ИЗ
	|	ДанныеЗадолженности КАК ДанныеЗадолженности
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДатаНачала КАК ДатаНачала
	|		ПО ДанныеЗадолженности.Район = ДатаНачала.Район
	|			И ДанныеЗадолженности.МКД = ДатаНачала.МКД
	|			И ДанныеЗадолженности.Абонент = ДатаНачала.Абонент
	|			И ДанныеЗадолженности.Услуга = ДатаНачала.Услуга
	|			И ДанныеЗадолженности.ПериодНачисления = ДатаНачала.ПериодНачисления
	|ГДЕ
	|	ДанныеЗадолженности.Период МЕЖДУ &НачалоПериода И &КонецПериода
	|	И ДанныеЗадолженности.СуммаКонечныйОстаток >= 0
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	МАКСИМУМ(энргНачислениеПени.Ссылка) КАК Ссылка,
	|	энргНачислениеПени.Район КАК Район,
	|	энргНачислениеПени.МКД КАК МКД
	|ПОМЕСТИТЬ ДокументыНачисления
	|ИЗ
	|	Документ.энргНачислениеПени КАК энргНачислениеПени
	|ГДЕ
	|	энргНачислениеПени.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	|	И энргНачислениеПени.Организация = &Организация
	|	И энргНачислениеПени.Район = &Район
	|	И энргНачислениеПени.МКД = &МКД
	|
	|СГРУППИРОВАТЬ ПО
	|	энргНачислениеПени.Район,
	|	энргНачислениеПени.МКД
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЕСТЬNULL(ДокументыНачисления.Ссылка, ЗНАЧЕНИЕ(Документ.энргНачислениеПени.ПустаяСсылка)) КАК ДокументНачисления,
	|	ДатаНачальногоПериода.Абонент КАК Абонент,
	|	ДатаНачальногоПериода.Услуга КАК Услуга,
	|	ДатаНачальногоПериода.ПериодНачисления КАК ПериодНачисления,
	|	ДатаНачальногоПериода.Период КАК Период,
	|	ДатаНачальногоПериода.СуммаНачальныйОстаток КАК СуммаНачальныйОстаток,
	|	ДатаНачальногоПериода.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток,
	|	ДатаНачальногоПериода.ДатаНачалаНачисленияПени КАК ДатаНачалаНачисленияПени,
	|	РАЗНОСТЬДАТ(ДатаНачальногоПериода.ДатаНачалаНачисленияПени, ВЫБОР
	|			КОГДА МЕСЯЦ(ДатаНачальногоПериода.ДатаНачалаНачисленияПени) = МЕСЯЦ(ДатаНачальногоПериода.Период)
	|				ТОГДА ДатаНачальногоПериода.ДатаНачалаНачисленияПени
	|			ИНАЧЕ &НачалоПериода
	|		КОНЕЦ, ДЕНЬ) + &КоличествоДней КАК ДнейНаДеньНачала,
	|	РАЗНОСТЬДАТ(ДатаНачальногоПериода.ДатаНачалаНачисленияПени, ДатаНачальногоПериода.Период, ДЕНЬ) + &КоличествоДней КАК ДнейПросрочкиСДатыНачалаНачисленийПени,
	|	ДЕНЬ(ДатаНачальногоПериода.Период) КАК ДеньПериода,
	|	ВЫБОР
	|		КОГДА МЕСЯЦ(ДатаНачальногоПериода.ДатаНачалаНачисленияПени) = МЕСЯЦ(ДатаНачальногоПериода.Период)
	|			ТОГДА ДЕНЬ(ДатаНачальногоПериода.ДатаНачалаНачисленияПени)
	|		ИНАЧЕ ДЕНЬ(&НачалоПериода)
	|	КОНЕЦ КАК ДеньНачала,
	|	ДатаНачальногоПериода.НачальныйПериод КАК НачальныйПериод
	|ИЗ
	|	ДатаНачальногоПериода КАК ДатаНачальногоПериода
	|		ЛЕВОЕ СОЕДИНЕНИЕ ДокументыНачисления КАК ДокументыНачисления
	|		ПО ДатаНачальногоПериода.Район = ДокументыНачисления.Район
	|			И ДатаНачальногоПериода.МКД = ДокументыНачисления.МКД
	|ГДЕ
	|	ДатаНачальногоПериода.ДатаНачалаНачисленияПени < &КонецПериода
	|	И ДатаНачальногоПериода.Период >= ДатаНачальногоПериода.ДатаНачалаНачисленияПени
	|
	|УПОРЯДОЧИТЬ ПО
	|	ПериодНачисления,
	|	Период
	|ИТОГИ
	|	МАКСИМУМ(ДнейНаДеньНачала),
	|	МАКСИМУМ(ДеньНачала)
	|ПО
	|	ДокументНачисления,
	|	ПериодНачисления,
	|	Услуга,
	|	Абонент";
	
	Запрос.УстановитьПараметр("ГлубинаОтсрочки", ГлубинаОтсрочки);
	Запрос.УстановитьПараметр("КоличествоДней", НастройкиРасчетаПени[0].От);
	Запрос.УстановитьПараметр("КонецПериода", КонецМесяца(ПериодНачисления));
	Запрос.УстановитьПараметр("КрайнийСрокОплаты", КрайнийСрокОплаты);
	Запрос.УстановитьПараметр("МКД", МКД);
	Запрос.УстановитьПараметр("НачалоПериода", ПериодНачисления);
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("Район", Район);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДокументНачисления = РезультатЗапроса.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	
	Пока ВыборкаДокументНачисления.Следующий() Цикл
		
		Если ЗначениеЗаполнено(ВыборкаДокументНачисления.ДокументНачисления) Тогда
			ДокументОбъект = ВыборкаДокументНачисления.ДокументНачисления.ПолучитьОбъект();
			ДокументОбъект.Дата = КонецМесяца(ПериодНачисления);
			ДокументОбъект.ПометкаУдаления  = Ложь;
			ДокументОбъект.ДанныеНачислений.Очистить();
		Иначе
			ДокументОбъект = Документы.энргНачислениеПени.СоздатьДокумент();
			ДокументОбъект.Дата = КонецМесяца(ПериодНачисления);
			ДокументОбъект.Район = Район;
			ДокументОбъект.МКД = МКД;
			ДокументОбъект.Организация = Организация;
			ДокументОбъект.ПериодНачисления = ПериодНачисления;
			ДокументОбъект.Ответственный = Пользователи.ТекущийПользователь();
		КонецЕсли;
		
		ДокументОбъект.ДополнительныеСвойства.Вставить("ПроведениеРазрешено",Истина);
		
		ПараметрыШапки = Новый Структура;
		ПараметрыШапки.Вставить("ПериодНачисления", ПериодНачисления);
		ПараметрыШапки.Вставить("Организация", ДокументОбъект.Организация);
		ПараметрыШапки.Вставить("Район", ДокументОбъект.Район);
		ПараметрыШапки.Вставить("МКД", ДокументОбъект.МКД);
		ПараметрыШапки.Вставить("ЭтоОплата", Ложь);
		ПараметрыШапки.Вставить("Кассир", ДокументОбъект.Ответственный);
		ПараметрыШапки.Вставить("ИсточникПоступления", Неопределено);
		
		ДокументОбъект.ДополнительныеСвойства.Вставить("ПараметрыПроведения", ПараметрыШапки);
	
		ВыборкаПериодНачисления = ВыборкаДокументНачисления.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);	
		Пока ВыборкаПериодНачисления.Следующий() Цикл
			ВыборкаУслуга = ВыборкаПериодНачисления.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);	
			Пока ВыборкаУслуга.Следующий() Цикл
				ВыборкаАбонент = ВыборкаУслуга.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);	
				Пока ВыборкаАбонент.Следующий() Цикл
					
					ДеньНачалаДляРасчета = ВыборкаАбонент.ДеньНачала;
					ДнейНаДеньНачалаДляРасчета = ВыборкаАбонент.ДнейНаДеньНачала;
					
					ВыборкаДетальныеЗаписи = ВыборкаАбонент.Выбрать();	
					Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
						
						ДнейПросрочки = 0;
						СуммаЗадолженности = ?(ВыборкаДетальныеЗаписи.СуммаНачальныйОстаток = 0, ВыборкаДетальныеЗаписи.СуммаКонечныйОстаток, ВыборкаДетальныеЗаписи.СуммаНачальныйОстаток);
						КоэффициентЧислитель = 1;
						КоэффициентЗнаменатель = 1;
						ПредКоэффициентЧислитель = 1;
						ПредКоэффициентЗнаменатель = 1;
						РангКоэффициента = 0;
						ПредыдущийРанг = Неопределено;
						
						Для Сч = ДеньНачалаДляРасчета По ВыборкаДетальныеЗаписи.ДеньПериода Цикл
							
							ДнейПросрочки = ДнейПросрочки + 1;
							
							СтруктураКоэффициента = Соответствие.Получить(?(ДнейНаДеньНачалаДляРасчета <= МаксЗначение, ДнейНаДеньНачалаДляРасчета, 0));
							Если СтруктураКоэффициента = Неопределено Тогда
								КоэффициентЧислитель = 1;
								КоэффициентЗнаменатель = 1;
								РангКоэффициента = 0;
							Иначе
								КоэффициентЧислитель = СтруктураКоэффициента.Числитель;
								КоэффициентЗнаменатель = СтруктураКоэффициента.Знаменатель;
								РангКоэффициента = СтруктураКоэффициента.РангКоэффициента;
							КонецЕсли;
							
							Если НЕ РангКоэффициента = ПредыдущийРанг И НЕ ПредыдущийРанг = Неопределено Тогда
								НСтр = ДокументОбъект.ДанныеНачислений.Добавить();
								ЗаполнитьЗначенияСвойств(НСтр, ВыборкаДетальныеЗаписи);
								НСтр.КоэффициентЧислитель = ПредКоэффициентЧислитель;
								НСтр.КоэффициентЗнаменатель = ПредКоэффициентЗнаменатель;
								НСтр.СуммаЗадолженности = СуммаЗадолженности;
								НСтр.ДнейПросрочки = ДнейПросрочки;
								НСтр.СтавкаРефинансирования = СтавкаРефинансирования;							
								НСтр.ДатаНачисления = ВыборкаДетальныеЗаписи.НачальныйПериод;
								НСтр.СуммаПени = НСтр.СуммаЗадолженности * (НСтр.КоэффициентЧислитель / НСтр.КоэффициентЗнаменатель) * НСтр.СтавкаРефинансирования * НСтр.ДнейПросрочки;
								
								ДнейПросрочки = 0;
							КонецЕсли;
							
							ПредыдущийРанг = РангКоэффициента;
							ПредКоэффициентЧислитель = КоэффициентЧислитель;
							ПредКоэффициентЗнаменатель = КоэффициентЗнаменатель;
							ДнейНаДеньНачалаДляРасчета = ДнейНаДеньНачалаДляРасчета + 1;
							
						КонецЦикла;
						
						НСтр = ДокументОбъект.ДанныеНачислений.Добавить();
						ЗаполнитьЗначенияСвойств(НСтр, ВыборкаДетальныеЗаписи);
						НСтр.КоэффициентЧислитель = КоэффициентЧислитель;
						НСтр.КоэффициентЗнаменатель = КоэффициентЗнаменатель;
						НСтр.СуммаЗадолженности = СуммаЗадолженности;
						НСтр.ДнейПросрочки = ДнейПросрочки;
						НСтр.СтавкаРефинансирования = СтавкаРефинансирования;							
						НСтр.ДатаНачисления = ВыборкаДетальныеЗаписи.НачальныйПериод;
						НСтр.СуммаПени = НСтр.СуммаЗадолженности * (НСтр.КоэффициентЧислитель / НСтр.КоэффициентЗнаменатель) * НСтр.СтавкаРефинансирования * НСтр.ДнейПросрочки;
						
						ДеньНачалаДляРасчета = ВыборкаДетальныеЗаписи.ДеньПериода + 1;
						
					КонецЦикла;				
				КонецЦикла;
			КонецЦикла;
		КонецЦикла;
		
		ДокументОбъект.Записать(РежимЗаписиДокумента.Проведение);
		
	КонецЦикла;
	
	//Результат = Запрос.Выполнить();
	//
	//Выборка  									= Результат.Выбрать();
	//ТекМКД  									= Неопределено; 
	//ДокументОбъект 							= Неопределено;
	//Пока Выборка.Следующий() цикл
	//	
	//	Если ТекМКД <> Выборка.МКД тогда
	//		Если ТекМКД<> Неопределено тогда
	//			ДокументОбъект.ДополнительныеСвойства.Вставить("ПроведениеРазрешено",Истина);
	//			ДокументОбъект.Записать(РежимЗаписиДокумента.Проведение);
	//		КонецЕсли;
	//		
	//		Если ЗначениеЗаполнено(Выборка.ДокументНачисления) тогда
	//			ДокументОбъект  				= Выборка.ДокументНачисления.ПолучитьОбъект();
	//			ДокументОбъект.ПометкаУдаления  = Ложь;
	//			ТабЧасть 						= ДокументОбъект.ДанныеНачислений;
	//		иначе
	//			ДокументОбъект  				= Документы.энргНачислениеПени.СоздатьДокумент();
	//			ТабЧасть 						= ДокументОбъект.ДанныеНачислений;
	//		КонецЕсли;		
	//		ТабЧасть.очистить();			
	//	КонецЕсли;	
	//	
	//	СтрокаНачислений  						= ТабЧасть.добавить();
	//	ЗаполнитьЗначенияСвойств(СтрокаНачислений,Выборка);
	//	
	//	ТекМКД 									= Выборка.МКД;		
	//КонецЦикла; 
	//
	//Если ТекМКД<> Неопределено тогда
	//	ДокументОбъект.ДополнительныеСвойства.Вставить("ПроведениеРазрешено",Истина);
	//	ДокументОбъект.Записать(РежимЗаписиДокумента.Проведение);
	//КонецЕсли;
	//
	//Если МКД = Неопределено тогда
	//	//Набор 									= РегистрыСведений.энргВыполненныеНачисления.СоздатьНаборЗаписей();
	//	//Набор.Отбор.ПериодНачисления.установить(ПериодНачисления);
	//	//Набор.Отбор.Район.установить(Район);
	//	//Набор.Отбор.ВидОперацииНачисления.установить(Перечисления.энргВидыОперацийНачисления.НачислениеПени);
	//	//Набор.ДополнительныеСвойства.Вставить("ЗаписьРазрешена");
	//	//Запись 								= Набор.Добавить();
	//	//Запись.ПериодНачисления 				= ПериодНачисления;
	//	//Запись.Район							= Район;
	//	//Запись.ВидОперацииНачисления			= Перечисления.энргВидыОперацийНачисления.НачислениеПени;
	//	//Набор.Записать();
	//КонецЕсли; 	 
	
КонецПроцедуры

Процедура ЗакрытьПериодДляРедактирования(Организация,ПериодНачисления,Район) Экспорт  
			
	ДокуметЗакрытия 				= ДокуметЗакрытияПериода(Организация, ПериодНачисления,Район);
	
	Если не ЗначениеЗаполнено(ДокуметЗакрытия) тогда
		ДокументОбъект 				= Документы.энргЗакрытиеПериода.СоздатьДокумент();
	иначе
		ДокументОбъект 				= ДокуметЗакрытия.ПолучитьОбъект();  
	КонецЕсли;
	
	ДокументОбъект.ДополнительныеСвойства.вставить("ПроведениеРазрешено",Истина);
	ДокументОбъект.Организация 		= Организация;
	ДокументОбъект.Район 			= Район;
	ДокументОбъект.ПериодНачисления = ПериодНачисления;	
	Попытка
		ДокументОбъект.записать(РежимЗаписиДокумента.Запись);
	Исключение
		ОписаниеОшибки 				= ОписаниеОшибки();
		ВызватьИсключение ОписаниеОшибки; 
	КонецПопытки;	
	
КонецПроцедуры
	
Функция ДанныеПерерасчета(Организация,Район,КлючиПомещения,Абоненты,ПериодНачисленияНачало,ПериодНачисленияКонец,Набор,НаборПомещений,КорректировкаПоказаний) Экспорт 
	
	МВТ  											= Новый МенеджерВременныхТаблиц;
	
	ДанныеПомещения  = Новый Структура("КлючПомещения,ДополнительныеСвойства",КлючиПомещения,Новый Структура);
	энргПроведениеСервер.ДанныеСтроенийВоВременную(МВТ, КлючиПомещения, "ДанныеСтроений");	
	
	ПериодНовогоТарифа 								= Константы.энргДеньНачалаПримененияНовогоТарифа.Получить();
	ДанныеПерерасчета  								= Новый Структура("ОбъемыНачислений,ПерерасчетСреднего,КорректировкаПоказаний");
		
	ГраницыПериода  								= энргРаботаСПериодомДействия.ГраницыРасчетногоПериода(Организация, ПериодНачисленияНачало);
	НачалоПериодаРасчета							= ГраницыПериода.НачалоОП;
	
	ГраницыПериода  								= энргРаботаСПериодомДействия.ГраницыРасчетногоПериода(Организация, ПериодНачисленияКонец);
	КонецПериодаРасчета								= ГраницыПериода.ЗавершениеОП;
		
	РезультатЗапроса  								= ПересчитатьИндивидуальныйОбъем(МВТ,Организация, ПериодНачисленияНачало,ПериодНачисленияКонец,НачалоПериодаРасчета,КонецПериодаРасчета,Район,КлючиПомещения,Абоненты,КорректировкаПоказаний,ПериодНовогоТарифа);	
	
	ОбработатьРезультатЗапросаНачислений(РезультатЗапроса, ГраницыПериода, Набор, НаборПомещений, Ложь);
				
КонецФункции

Функция ДанныеПерерасчетаМКД(Организация,Район,МКД,ПериодНачисленияНачало,ПериодНачисленияКонец,Набор,КорректировкаПоказаний) Экспорт 
	
	МВТ  					= Новый МенеджерВременныхТаблиц;
	
	ГраницыПериода  		= энргРаботаСПериодомДействия.ГраницыРасчетногоПериода(Организация, ПериодНачисленияНачало);
	НачалоПериодаРасчета	= ГраницыПериода.НачалоОП;
	
	ГраницыПериода  		= энргРаботаСПериодомДействия.ГраницыРасчетногоПериода(Организация, ПериодНачисленияКонец);
	КонецПериодаРасчета		= ГраницыПериода.ЗавершениеОП;
	
	РезультатЗапроса  		= ПересчитатьОбъемПотребленияМКД(МВТ,Организация,Район,МКД,ПериодНачисленияНачало,ПериодНачисленияКонец,НачалоПериодаРасчета,КонецПериодаРасчета,КорректировкаПоказаний);
	
	ОбработатьРезультатЗапросаНачисленийМКД(РезультатЗапроса, ГраницыПериода, МКД, Набор);
	
КонецФункции

Функция ЗаполнитьПоказанияДляПерерасчета(Организация,Район,Абонент,ПериодНачисленияКонец,Основания,Приемник,ИмяСвойства) Экспорт  
	
	Запрос  		= Новый Запрос;
	Запрос.УстановитьПараметр("Район",					Район);
	Запрос.УстановитьПараметр("Абонент",				Абонент);
	Запрос.УстановитьПараметр("ПериодНачисленияКонец",	ПериодНачисленияКонец);
	Запрос.УстановитьПараметр("ДокументыОснования",		Основания);
	Запрос.Текст 	="ВЫБРАТЬ
	|	ВложенныйЗапрос.ПриборУчета КАК ПриборУчетаДо,
	|	ВложенныйЗапрос.Период КАК ДатаПоказаний,
	|	ВложенныйЗапрос.Регистратор КАК РегистраторПоказаний,
	|	ВложенныйЗапрос.Показание КАК ПоказанияДо,
	|	ВложенныйЗапрос.СостояниеПоказаний КАК СостояниеПоказанийДо,
	|	ВложенныйЗапрос.Переворот КАК ПереворотДо,
	|	ВложенныйЗапрос.ПриборУчета КАК ПриборУчетаПосле,
	|	ВложенныйЗапрос.Показание КАК ПоказанияПосле,
	|	ВложенныйЗапрос.СостояниеПоказаний КАК СостояниеПоказанийПосле,
	|	ВложенныйЗапрос.Переворот КАК ПереворотПосле,
	|	ВложенныйЗапрос.ДатаРегистратора,
	|	ЕСТЬNULL(энргПредоставленныеПоказания.ВСрок, ЛОЖЬ) КАК ВСрокДо
	|ИЗ
	|	(ВЫБРАТЬ
	|		энргПоказанияПриборовУчета.ПриборУчета КАК ПриборУчета,
	|		энргПоказанияПриборовУчета.Период КАК Период,
	|		энргПоказанияПриборовУчета.Регистратор КАК Регистратор,
	|		энргПоказанияПриборовУчета.Разделитель КАК Разделитель,
	|		энргПоказанияПриборовУчета.Показание КАК Показание,
	|		энргПоказанияПриборовУчета.СостояниеПоказаний КАК СостояниеПоказаний,
	|		энргПоказанияПриборовУчета.КС КАК КС,
	|		энргПоказанияПриборовУчета.Переворот КАК Переворот,
	|		энргПоказанияПриборовУчета.ПериодРегистрации КАК ДатаРегистратора
	|	ИЗ
	|		РегистрСведений.энргПоказанияПриборовУчета КАК энргПоказанияПриборовУчета
	|	ГДЕ
	|		энргПоказанияПриборовУчета.Организация = &Организация
	|		И энргПоказанияПриборовУчета.Район = &Район
	|		И энргПоказанияПриборовУчета.Абонент = &Абонент
	|		И энргПоказанияПриборовУчета.ПериодНачисления <= &ПериодНачисленияКонец
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		энргПоказанияПриборовУчета.ПриборУчета,
	|		энргПоказанияПриборовУчета.Период,
	|		энргПоказанияПриборовУчета.Регистратор,
	|		энргПоказанияПриборовУчета.Разделитель,
	|		энргПоказанияПриборовУчета.Показание,
	|		энргПоказанияПриборовУчета.СостояниеПоказаний,
	|		энргПоказанияПриборовУчета.КС,
	|		энргПоказанияПриборовУчета.Переворот,
	|		энргПоказанияПриборовУчета.ПериодРегистрации
	|	ИЗ
	|		РегистрСведений.энргПоказанияПриборовУчета КАК энргПоказанияПриборовУчета
	|	ГДЕ
	|		энргПоказанияПриборовУчета.Организация = &Организация
	|		И энргПоказанияПриборовУчета.Район = &Район
	|		И энргПоказанияПриборовУчета.Абонент = &Абонент
	|		И энргПоказанияПриборовУчета.Регистратор В(&ДокументыОснования)) КАК ВложенныйЗапрос
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.энргОтклоненныеПерерасчетомПоказания КАК энргОтклоненныеПерерасчетомПоказания
	|		ПО ВложенныйЗапрос.Регистратор = энргОтклоненныеПерерасчетомПоказания.РегистраторПоказаний
	|			И ВложенныйЗапрос.ПриборУчета = энргОтклоненныеПерерасчетомПоказания.ПриборУчета
	|			И ВложенныйЗапрос.Разделитель = энргОтклоненныеПерерасчетомПоказания.Разделитель
	|			И (энргОтклоненныеПерерасчетомПоказания.ПериодНачисления <= &ПериодНачисленияКонец)
	|			И (энргОтклоненныеПерерасчетомПоказания.Район = &Район)
	|			И (энргОтклоненныеПерерасчетомПоказания.Абонент = &Абонент)
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.энргПредоставленныеПоказания КАК энргПредоставленныеПоказания
	|		ПО ВложенныйЗапрос.Регистратор = энргПредоставленныеПоказания.ДокРегистратор
	|			И ВложенныйЗапрос.ПриборУчета = энргПредоставленныеПоказания.ПриборУчета
	|			И ВложенныйЗапрос.Разделитель = энргПредоставленныеПоказания.Разделитель
	|			И (энргПредоставленныеПоказания.Организация = &Организация)
	|			И (энргПредоставленныеПоказания.ПериодНачисления <= &ПериодНачисленияКонец)
	|			И (энргПредоставленныеПоказания.Район = &Район)
	|			И (энргПредоставленныеПоказания.Абонент = &Абонент)
	|ГДЕ
	|	энргОтклоненныеПерерасчетомПоказания.Район ЕСТЬ NULL 
	|
	|УПОРЯДОЧИТЬ ПО
	|	ВложенныйЗапрос.ПриборУчета,
	|	ВложенныйЗапрос.Период,
	|	ВложенныйЗапрос.Регистратор";
	
	Результат  		= Запрос.Выполнить();
	Выборка 		= Результат.Выбрать();
	
	ТабличнаяЧасть 	= Приемник[ИмяСвойства];
	ТабличнаяЧасть.очистить();
	
	Пока Выборка.Следующий() цикл
		ЗаполнитьЗначенияСвойств(ТабличнаяЧасть.добавить(),Выборка);
	КонецЦикла;  
	
КонецФункции

// Процедура - НачислитьЛьготы
//
// Параметры:
//  ПериодНачисления - 	 - 
//  Район			 - 	 - 
//  Дом				 - 	 - 
//  Абонент			 - 	 - 
//  Документ		 - 	 - 
//
Процедура НачислитьЛьготы(Организация, ПериодНачисления,Район,Строение,Абонент,Документ) Экспорт
	// TODO FIX ME
	Возврат;
	ГраницыПериода  								= энргРаботаСПериодомДействия.ГраницыРасчетногоПериода(Организация, ПериодНачисления,Ложь);
	
	НачалоПериодаРасчета							= ГраницыПериода.НачалоОП;
	КонецПериодаРасчета  							= ГраницыПериода.ЗавершениеОП;
	//ДнейВПериоде  									= ГраницыПериода.ДнейВПериоде; 
	КолвоМесЗадолженности = 0;
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	энргКоличествоМесяцевЗадолженностиДляРасчетаЛьготыСрезПоследних.Количество КАК Количество
		|ИЗ
		|	РегистрСведений.энргКоличествоМесяцевЗадолженностиДляРасчетаЛьготы.СрезПоследних(
		|			&Конец,
		|			Организация = &Организация
		|				И Район = &Район) КАК энргКоличествоМесяцевЗадолженностиДляРасчетаЛьготыСрезПоследних";
	
	Запрос.УстановитьПараметр("Конец", КонецПериодаРасчета - 1);
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("Район", Район);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		КолвоМесЗадолженности =  ВыборкаДетальныеЗаписи.Количество;
	КонецЦикла;
	
	Запрос 											= новый Запрос;
	Запрос.Текст 									= ПолучитьТекстЗапросаДляЛьготников();
	Если Строение=Неопределено Тогда
		Запрос.Текст = СтрЗаменить(Запрос.Текст,"энргОбъемНачислений.Строение = &Строение", "Истина");
	Иначе
		Запрос.УстановитьПараметр("Строение", Строение);
	КонецЕсли;
	Запрос.УстановитьПараметр("НачалоПериода",		НачалоПериодаРасчета);
	Запрос.УстановитьПараметр("КонецПериода", 		КонецПериодаРасчета);	
	Запрос.УстановитьПараметр("Организация", 		Организация);
	Запрос.УстановитьПараметр("Район", 				Район);
	Запрос.УстановитьПараметр("МесяцЗадолженности", ДобавитьМесяц(КонецПериодаРасчета - 1, -КолвоМесЗадолженности));

	результатЗапроса 								= Запрос.Выполнить();								
	КонецПериода  									= КонецМесяца(ПериодНачисления);
	
	Выборка  										= результатЗапроса.выбрать();

	ТекЧастныйСектор 								= Ложь;
	ТекСтроение  									= Неопределено;
	ДокументОбъект 									= Неопределено;
	Набор 											= Неопределено;
	
	Пока Выборка.следующий() цикл
		
		Если Документ = Неопределено тогда			
			Если  ТекСтроение <> Выборка.Строение тогда
				Если ТекСтроение<>Неопределено тогда
					НачатьТранзакцию();
					Попытка
						Если НЕ ДокументОбъект = Неопределено Тогда
							ДокументОбъект.ДополнительныеСвойства.Вставить("ПроведениеРазрешено",Истина);
							ДокументОбъект.записать(РежимЗаписиДокумента.Запись);
						КонецЕсли;
						Набор.ДополнительныеСвойства.Вставить("Организация",		Организация);
						Набор.ДополнительныеСвойства.Вставить("Район",				Район);
						Набор.ДополнительныеСвойства.Вставить("ПериодНачисления",	ПериодНачисления);
						Набор.ДополнительныеСвойства.Вставить("ЧастныйСектор",		ТекЧастныйСектор);
						Набор.ДополнительныеСвойства.Вставить("Строение",			ТекСтроение);
						Набор.ДополнительныеСвойства.Вставить("ДатаРегистратора",	КонецПериодаРасчета-1);						
						Набор.Записать(Ложь);						
						ЗафиксироватьТранзакцию();
					Исключение
						ОтменитьТранзакцию();
					КонецПопытки;					
				КонецЕсли;
				
				ДокументСсылка 						= Выборка.СсылкаНаСущДок;
				ПометкаУдаления 					= Выборка.ПометкаУдаления;
				ДокументОбъект  					= Неопределено;
				Если НЕ ЗначениеЗаполнено(ДокументСсылка)  Тогда
					ДокументСсылка 					= Документы.энргНачислениеДляЛьготныхЛиц.ПолучитьСсылку(Новый УникальныйИдентификатор());
					ДокументОбъект  				= Документы.энргНачислениеДляЛьготныхЛиц.СоздатьДокумент();
					ДокументОбъект.УстановитьСсылкуНового(ДокументСсылка);
					ДокументОбъект.район  			= Район;
					ДокументОбъект.МКД 				= ?(Выборка.ЧастныйСектор, Справочники.энргСтроения.ПустаяСсылка(), Выборка.Строение);
					ДокументОбъект.Дата				= КонецПериодаРасчета-1;
					ДокументОбъект.Организация 		= Организация;
				ИначеЕсли ПометкаУдаления Тогда
					ДокументОбъект  				= ДокументСсылка.ПолучитьОбъект();
					ДокументОбъект.ПометкаУдаления 	= Ложь;
				КонецЕсли;
				
				Набор 								= РегистрыНакопления.энргОбъемНачисленийДляЛьготныхЛиц.СоздатьНаборЗаписей();
				Набор.Отбор.Регистратор.Установить(ДокументСсылка);
				
				Если Не Абонент = Неопределено Тогда					
					Набор.ДополнительныеСвойства.Вставить("Абонент",	Абонент);
					Если ДокументОбъект = Неопределено Тогда
						Набор.Прочитать();
						СтрокиНабораДоЗаписи 							= Набор.Выгрузить();
						СтрокиУдалить 									= СтрокиНабораДоЗаписи.НайтиСтроки(Новый Структура("Абонент", Абонент));
						Для Каждого СтрокаУдалить ИЗ СтрокиУдалить Цикл
							СтрокиНабораДоЗаписи.Удалить(СтрокаУдалить);
						КонецЦикла;
						Набор.Очистить();
					КонецЕсли;					
				КонецЕсли;
				
				Если ДокументОбъект = Неопределено Тогда
					Набор.Записать();
				КонецЕсли;				
			КонецЕсли;
		иначе
			Набор 									= Документ.Движения.энргОбъемНачисленийДляЛьготныхЛиц; 
		КонецЕсли;		
		
		Если ЗначениеЗаполнено(Выборка.Абонент) Тогда
			СтрокНабора 								= Набор.добавить();
			ЗаполнитьЗначенияСвойств(СтрокНабора,Выборка);
			СтрокНабора.Период							= КонецПериодаРасчета-1;
			СтрокНабора.Регистратор						= ДокументСсылка;
			СтрокНабора.ПериодРасчета 					= ПериодНачисления;
		КонецЕсли;
		
		ТекЧастныйСектор								= Выборка.ЧастныйСектор;
		ТекСтроение										= Выборка.Строение;
	КонецЦикла;	
	
	Если Документ = Неопределено и НЕ Набор = Неопределено и Набор.Количество() > 0 Тогда
		НачатьТранзакцию();
		Попытка 			
			Если НЕ ДокументОбъект = Неопределено Тогда
				ДокументОбъект.ДополнительныеСвойства.Вставить("ПроведениеРазрешено",Истина);
				ДокументОбъект.записать(РежимЗаписиДокумента.Запись);
			КонецЕсли;
			Набор.ДополнительныеСвойства.Вставить("Организация",		Организация);
			Набор.ДополнительныеСвойства.Вставить("Район",				Район);
			Набор.ДополнительныеСвойства.Вставить("ПериодНачисления",	ПериодНачисления);
			Набор.ДополнительныеСвойства.Вставить("ЧастныйСектор",		ТекЧастныйСектор);
			Набор.ДополнительныеСвойства.Вставить("Строение",			ТекСтроение);
			Набор.ДополнительныеСвойства.Вставить("ДатаРегистратора",	КонецПериодаРасчета-1);
			 			
			Если НЕ Абонент = Неопределено и НЕ СтрокиНабораДоЗаписи = Неопределено и СтрокиНабораДоЗаписи.Количество() > 0 Тогда
				Набор.ДополнительныеСвойства.Вставить("Абонент",	Абонент);
				Для Каждого СтрокаДобавить Из СтрокиНабораДоЗаписи Цикл
					ЗаполнитьЗначенияСвойств(Набор.Добавить(), СтрокаДобавить);
				КонецЦикла;				
			КонецЕсли; 			
			
			Набор.Записать(Ложь);
			ЗафиксироватьТранзакцию();
		Исключение
			ОтменитьТранзакцию();
			ИнформацияОбОшибке  						= ИнформацияОбОшибке();
			ВызватьИсключение (ПодробноеПредставлениеОшибки(ИнформацияОбОшибке)); 
		КонецПопытки;	
	КонецЕсли;	
	
КонецПроцедуры

Процедура СкорректироватьПотреблениеСезонныхУслуг(Организация, ПериодНачисления,Район,Строение,Помещение,Набор, НаборОбъемПомещений) Экспорт 
	Перем ДокументОбъект, НаборВыполненные, ТекЧастныйСектор, ТекМКД, ТекПериодНачисления, ЗамещатьНаборВыполненные;
	
	ГраницыПериода  						= энргРаботаСПериодомДействия.ГраницыРасчетногоПериода(Организация, ПериодНачисления,Ложь);
	МВТ  									= Новый МенеджерВременныхТаблиц;
	ЗаписыватьНаборыЗаписей 				= Набор = Неопределено;
	
	ПрочитатьВспомогательныеДанныеДляКорректировкиПотребленияСезонныхУслуг(МВТ,ГраницыПериода,Организация,ПериодНачисления,Район,Ложь,Строение,Помещение);
	
	Запрос 									= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 			= МВТ;
	Запрос.Текст 							= ТекстЗапросаДанныеДляКорректировкаПотребленияСезонныхУслуг();
	Результат  								= Запрос.Выполнить();
	
	Выборка  								= Результат.Выбрать();
	ТекЗавершениеОП 						= ГраницыПериода.ЗавершениеОП-1;
	
	Если Выборка.Количество() = 0 Тогда
		Возврат;
	КонецЕсли;
	
	Ошибки 									= "";
	Пока Выборка.Следующий() Цикл
		
		Если НЕ ТекМКД = Выборка.МКД Тогда
			
			Если НЕ ТекМКД = Неопределено Тогда
				Попытка 					
					ЗаписатьНаборыЗаписейНачисление(ДокументОбъект, Набор, НаборВыполненные, НаборОбъемПомещений, Ошибки);
				Исключение
					ИнформацияОбОшибке  	= ИнформацияОбОшибке();
					Ошибки 					= Ошибки + Символы.ПС + ПодробноеПредставлениеОшибки(ИнформацияОбОшибке);
				КонецПопытки;
			КонецЕсли;
			
			ПрочитатьНаборыЗаписейНачисление(Выборка,ДокументОбъект,Помещение,Набор,НаборОбъемПомещений,НаборВыполненные, Перечисления.энргВидыОперацийНачисления.КорректировкаПотребленияСезонныхУслуг);
		КонецЕсли;
		
		СтрокаНабора 						= Набор.Добавить();
		ЗаполнитьЗначенияСвойств(СтрокаНабора,Выборка);
		СтрокаНабора.Период 				= ТекЗавершениеОП;
		
		ТекПериодНачисления 				= Выборка.Организация;
		ТекЧастныйСектор					= Выборка.ЧастныйСектор;
		ТекМКД 								= Выборка.МКД;
	КонецЦикла;
	
	ЗаписатьНаборыЗаписейНачисление(ДокументОбъект, Набор, НаборВыполненные, НаборОбъемПомещений, Ошибки);
		
	Если Не ПустаяСтрока(Ошибки) Тогда
		ВызватьИсключение Ошибки;
	КонецЕсли;
	
КонецПроцедуры

Процедура СкорректироватьПотреблениеСезонныхУслугМКД(Организация, ПериодНачисления,Район,Строение,Набор) Экспорт 
	Перем ДокументОбъект, НаборВыполненные, ТекПериодНачисления;
	
	ГраницыПериода  						= энргРаботаСПериодомДействия.ГраницыРасчетногоПериода(Организация, ПериодНачисления,Ложь);
	МВТ  									= Новый МенеджерВременныхТаблиц;
	ЗаписыватьНаборыЗаписей 				= Набор = Неопределено;
	
	ПрочитатьВспомогательныеДанныеДляКорректировкиПотребленияСезонныхУслугМКД(МВТ,ГраницыПериода,Организация,ПериодНачисления,Район,Ложь,Строение);
	
	Запрос 									= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 			= МВТ;
	Запрос.Текст 							= ТекстЗапросаДанныеДляКорректировкаПотребленияСезонныхУслугМКД();
	Результат  								= Запрос.Выполнить();
	
	Выборка  								= Результат.Выбрать();
	ТекЗавершениеОП 						= ГраницыПериода.ЗавершениеОП-1;
	
	Если Выборка.Количество() = 0 Тогда
		Возврат;																																																																																				
	КонецЕсли;
	
	НачатьТранзакцию();	
	Ошибки 									= "";
	Пока Выборка.Следующий() Цикл 						
		Если ТекПериодНачисления = Неопределено Тогда
			ПрочитатьНаборыЗаписейДокументаНачисленияМКД(Выборка,Строение,ДокументОбъект,НаборВыполненные, Набор, Перечисления.энргВидыОперацийНачисления.КорректировкаПотребленияСезонныхУслугМКД); 
		КонецЕсли;		
		СтрокаНабора 						= Набор.Добавить();
		ЗаполнитьЗначенияСвойств(СтрокаНабора,Выборка);
		СтрокаНабора.Период 				= ТекЗавершениеОП;		
		ТекПериодНачисления 				= Выборка.ПериодНачисления;		
	КонецЦикла;
	
	ЗаписатьНаборыЗаписейНачислениеМКД(ДокументОбъект, Набор, НаборВыполненные,Ошибки);
		
	Если Не ПустаяСтрока(Ошибки) Тогда
		ВызватьИсключение Ошибки;
	КонецЕсли;
	
КонецПроцедуры

Процедура ПересчитатьРаспредениеОбъемаПотребленногоМКД(Организация,ПериодНачисления, Район, Строение, ПараметрыПерерасчета) Экспорт 
	Перем текПериодНачисления, ТекСтроение, ТекУслуга, НаборЗаписей, НаборЗаписейПомещений, НаборЗаписейНП, НаборЗаписейСверхНорма, ТекМКДАбонентов, ТекУслугаАбонентов,
	ДокументОбъект, ДанныеПоУслуге, НаборВыполненные, ПараметрыРасчетаНорматива, РассчитыватьНорматив, НачисленияПоУслугам;
	
	МВТ 											= Новый МенеджерВременныхТаблиц;
	ТекстГраницОтчетногоПериода 					= энргНачисления.ТекстГраницОтчетногоПериода(ПараметрыПерерасчета.Начало,ПараметрыПерерасчета.Окончание,Ложь);
	Запрос 	 										= Новый Запрос("ВЫБРАТЬ * ПОМЕСТИТЬ ГраницыОтчетногоПериода ИЗ (" +ТекстГраницОтчетногоПериода+ ") КАК ВложенныйЗапрос");
	Запрос.МенеджерВременныхТаблиц 					= МВТ;
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.Выполнить();
	
	ГраницыПериода  								= энргРаботаСПериодомДействия.ГраницыРасчетногоПериода(Организация, ПараметрыПерерасчета.Начало);
	НачалоПериодаРасчета							= ГраницыПериода.НачалоОП;
	
	ГраницыПериода  								= энргРаботаСПериодомДействия.ГраницыРасчетногоПериода(Организация, ПараметрыПерерасчета.Окончание);
	КонецПериодаРасчета								= ГраницыПериода.ЗавершениеОП;
	
	ПараметрыПерерасчета.Вставить("НачалоПериодаРасчета", 	НачалоПериодаРасчета);
	ПараметрыПерерасчета.Вставить("КонецПериодаРасчета", 	КонецПериодаРасчета);
	
	ПрочитатьНормативныеДанныеРаспределения_Перерасчет(МВТ,Организация,ПериодНачисления,Район,Строение);
	ПрочитатьДокументыДляРаспределения_Перерасчет(МВТ,Организация,ПериодНачисления,Район,Строение);
	ПрочитатьСозданныеДокументыИндивидуальныхНачислений_Перерасчет(МВТ,Организация,ПериодНачисления,Район,Строение);
	ПрочитатьОбъемыНачисленийМКДДляРаспределения_Перерасчет(МВТ,Организация,ПериодНачисления,Район,Строение,ПараметрыПерерасчета);
	ПрочитатьВспомогательныеДанныеРаспределениеМКД(МВТ,Организация,ПериодНачисления,Район,Строение);
	
	Запрос 									= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 			= МВТ;
	Запрос.Текст 							= ТекстЗапросаДанныеДляРаспределения(Строение);
	
	Результат  								= Запрос.ВыполнитьПакет();
	ВыборкаЗначенияТарифов 					= Результат[0].Выбрать();
	ВыборкаОбъемМКД							= Результат[1].Выбрать();
	ВыборкаАбоненты							= Результат[2].Выбрать();
	ВыборкаОбъемПоПриборуКорректировать		= Результат[3].Выбрать();
	ВыборкаРазделенныеЛицевыеСчета			= Результат[4].Выбрать();
	ВыборкаОбъемПоПриборуНПКорректировать	= Результат[5].Выбрать();

	РазделенныеЛицевыеСчета 				= Новый Соответствие;
	КлючРазделенныеЛицевыеСчета 			= "Абонент,ЗначениеПлощади,СпособРаспределенияОбъемаПомещения,ФиксированныйОбъемПотребления,
	|ДоляПотребленияЧислитель,ДоляПотребленияЗнаменатель,КоличествоПроживающих,ТарифнаяГруппа,Поставщик";
	
	НаборЗаписей 							= ПараметрыПерерасчета.ОбъемНачислений;
	НаборЗаписейНП 							= ПараметрыПерерасчета.ОбъемНачисленийНП;
	
	ЗначенияТарифов 						= Новый Соответствие;
	Если ВыборкаЗначенияТарифов.Количество() > 0 Тогда
		Пока ВыборкаЗначенияТарифов.Следующий() Цикл
			ХэшСтроки 						= ХэшСтрокиТарифа(ВыборкаЗначенияТарифов.ГруппаПотребителей,ВыборкаЗначенияТарифов.Услуга,ВыборкаЗначенияТарифов.Поставщик,ВыборкаЗначенияТарифов.ТарифнаяЗона);
			ОписаниеЗначения 				= Новый Структура("Значение,ЗначениеТарифаРЭК,ЗначениеСверхНорматива,СтавкаНДС,НДСВнутри,ГруппаПотребителей,Услуга,Поставщик,ТарифнаяЗона");
			ЗаполнитьЗначенияСвойств(ОписаниеЗначения, ВыборкаЗначенияТарифов);			
			ЗначенияТарифов.Вставить(ХэшСтроки,ОписаниеЗначения); 			
		КонецЦикла;		
	КонецЕсли;
	
	ВыборкаАбоненты.следующий();
	ВыборкаОбъемПоПриборуНПКорректировать.Следующий();
	
	ЕстьРазделенныеЛицевыеСчета 				= ВыборкаРазделенныеЛицевыеСчета.Следующий();
	
	Отказ 										= Ложь;
	ТипыНачислений 								= энргНачисления.ТипыРасходовВФормулахРасчета();
	ТекстИсключения		 						= "";
	ИспользоватьТарифРек 						= Ложь;
		
	РаспределениеОбъемаПоУслугам 				= Новый Соответствие;
	РаспределениеОбъемаПоУслугамПотребленный 	= Новый Соответствие;
	
	Пока ВыборкаОбъемМКД.Следующий() Цикл
		
		//Если МассивМКД_УК.Найти(ВыборкаОбъемМКД.Строение) <> Неопределено Тогда
		//	Продолжить;	
		//КонецЕсли;
		
		Если НЕ текПериодНачисления = ВыборкаОбъемМКД.ПериодНачисления 
			ИЛИ НЕ ТекСтроение = ВыборкаОбъемМКД.Строение 
			ИЛИ НЕ ТекУслуга = ВыборкаОбъемМКД.Услуга Тогда
												
			Если Не ТекУслуга  = Неопределено Тогда
				Если ПустаяСтрока(ДанныеПоУслуге.ФормулаРасчетаНорматива) Тогда					
					РаспределитьОбъемПотребленныйПоУслугеМКД(текПериодНачисления, Организация, Район, ТекСтроение, ТекУслуга, ГраницыПериода, ЗначенияТарифов, ДанныеПоУслуге, ДокументОбъект, РаспределениеОбъемаПоУслугамПотребленный, НаборЗаписей, НаборЗаписейПомещений, НаборЗаписейНП, НаборЗаписейСверхНорма, ИспользоватьТарифРек);	
				КонецЕсли;
				ЗаполнитьПараметрыРасчетаНорматива(ДанныеПоУслуге, ПараметрыРасчетаНорматива, РассчитыватьНорматив, ТипыНачислений, ТекУслуга, НачисленияПоУслугам);
			КонецЕсли;
			
			Если НЕ текПериодНачисления = ВыборкаОбъемМКД.ПериодНачисления
				ИЛИ НЕ ТекСтроение = ВыборкаОбъемМКД.Строение Тогда
				Если НЕ ТекСтроение = Неопределено Тогда
					// Рассчитываем норматив
					РассчитатьНормативПоФормуле(ПараметрыРасчетаНорматива, РассчитыватьНорматив,НачисленияПоУслугам,ЗначенияТарифов,ГраницыПериода,Отказ,НаборЗаписей, НаборЗаписейПомещений, НаборЗаписейНП);
				КонецЕсли;
				
				// запоминаем свойства разделенных лицевых счетов по услугам
				РаспределениеОбъемаПоУслугам 	= Новый Соответствие;
				Отказ 							= Ложь;
				РассчитыватьНорматив 			= Новый Массив;
				ПараметрыРасчетаНорматива 		= Новый Соответствие;
				РазделенныеЛицевыеСчета 		= Новый Соответствие;
				НачисленияПоУслугам 			= Новый Соответствие;
				Если ЕстьРазделенныеЛицевыеСчета Тогда
					ЗаполнитьРазделенныеЛицевыеСчета(КлючРазделенныеЛицевыеСчета, РазделенныеЛицевыеСчета, ВыборкаРазделенныеЛицевыеСчета, ВыборкаОбъемМКД);					
				КонецЕсли; 				
			КонецЕсли;			
						
			ДанныеПоУслуге 					= ДанныеПоУслугиДляРаспределения(ВыборкаОбъемМКД, РазделенныеЛицевыеСчета);
			
			ЗаполнитьДанныеАбонентовДляРаспределения(ДанныеПоУслуге, ВыборкаАбоненты, ВыборкаОбъемМКД, ВыборкаОбъемПоПриборуКорректировать, ВыборкаОбъемПоПриборуНПКорректировать);					
		КонецЕсли;
		
		ЗаполнитьОбъемыМКДПриРаспределении(ВыборкаОбъемМКД, ДанныеПоУслуге);
		
		текПериодНачисления 				= ВыборкаОбъемМКД.ПериодНачисления;
		ТекСтроение							= ВыборкаОбъемМКД.Строение;
		ТекУслуга 							= ВыборкаОбъемМКД.Услуга;
	КонецЦикла; 	
	
	Если Не ТекСтроение = Неопределено Тогда		
		Если ПустаяСтрока(ДанныеПоУслуге.ФормулаРасчетаНорматива) Тогда			
			РаспределитьОбъемПотребленныйПоУслугеМКД(текПериодНачисления, Организация, Район, ТекСтроение, ТекУслуга, ГраницыПериода, ЗначенияТарифов, ДанныеПоУслуге, ДокументОбъект, РаспределениеОбъемаПоУслугамПотребленный, НаборЗаписей, НаборЗаписейПомещений, НаборЗаписейНП, НаборЗаписейСверхНорма, ИспользоватьТарифРек);
		КонецЕсли;		
		ЗаполнитьПараметрыРасчетаНорматива(ДанныеПоУслуге, ПараметрыРасчетаНорматива, РассчитыватьНорматив, ТипыНачислений, ТекУслуга, НачисленияПоУслугам);
		РассчитатьНормативПоФормуле(ПараметрыРасчетаНорматива, РассчитыватьНорматив, НачисленияПоУслугам, ЗначенияТарифов, ГраницыПериода, Отказ, НаборЗаписей, НаборЗаписейПомещений, НаборЗаписейНП);
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область ОбщиеПроцедурыИФункции

Процедура ВспомогательныеДанныеНачисления(МВТ,Организация,ПериодНачисления,Район,Строение,Помещение,НачалоПериодаРасчета,КонецПериодаРасчета,ПериодНовогоТарифа,ДнейВПериоде)
	
	Запрос  						= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 	= МВТ;	
			
	Если Не Помещение = Неопределено тогда
		Запрос.УстановитьПараметр("ЧастныйСектор",	НЕ ЗначениеЗаполнено(Помещение));
		Запрос.УстановитьПараметр("Строение",		Строение);
		Запрос.УстановитьПараметр("Помещение",		Помещение);		
	ИначеЕсли Не Строение = Неопределено Тогда
		Запрос.УстановитьПараметр("ЧастныйСектор",	НЕ ЗначениеЗаполнено(Строение));
		Запрос.УстановитьПараметр("Строение",		Строение);
	КонецЕсли; 	
	Если ЗначениеЗаполнено(Строение) Тогда
		Запрос.УстановитьПараметр("МКД", 			Строение);
	КонецЕсли;
	
	Запрос.УстановитьПараметр("НачалоВеденияУчета",		Константы.энргДатаНачалаВеденияУчета.Получить());	 // Дата
	Запрос.УстановитьПараметр("НачалоПериодаРасчета",	НачалоПериодаРасчета);	 // Дата
	Запрос.УстановитьПараметр("КонецПериодаРасчета",	КонецПериодаРасчета);	 // Дата
	Запрос.УстановитьПараметр("ПериодНачисления",		ПериодНачисления);	 // Дата
	Запрос.УстановитьПараметр("Организация",			Организация);	 // Дата
	Запрос.УстановитьПараметр("Район",					Район);	 // Районы
	Запрос.УстановитьПараметр("ДнейВПериоде",			ДнейВПериоде );
	Запрос.УстановитьПараметр("ПериодНовогоТарифа",		ПериодНовогоТарифа); // Число;
	Запрос.Текст 					= ТекстЗапросаВспомогательныеДанныеНачисления(Строение,Помещение);
	Запрос.Выполнить();
	
КонецПроцедуры

Процедура ВспомогательныеДанныеПерерасчет(МВТ,Организация,ПериодНачисленияНачало,ПериодНачисленияКонец,НачалоПериодаРасчета,КонецПериодаРасчета,Район,Абонент,ПериодНовогоТарифа)
	
	Текст  							= 
	"ВЫБРАТЬ
	|	энргДокументыНачислений.Организация КАК Организация,
	|	энргДокументыНачислений.ПериодНачисления КАК ПериодНачисления,
	|	энргДокументыНачислений.Район КАК Район,
	|	энргДокументыНачислений.МКД КАК МКД,
	|	энргДокументыНачислений.ДокументНачисления КАК ДокументНачисления,
	|	энргДокументыНачислений.ПометкаУдаления КАК ПометкаУдаления
	|ПОМЕСТИТЬ ДокументыНачислений
	|ИЗ
	|	РегистрСведений.энргДокументыНачислений КАК энргДокументыНачислений
	|ГДЕ
	|	ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.Сезонность КАК Сезонность,
	|	ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(ДАТАВРЕМЯ(1, 1, 1), ГОД, ГОД(ВложенныйЗапрос.НачалоОП) - ВЫБОР
	|					КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(энргДлительностиПериодов.КонецПериода)
	|							И МЕСЯЦ(энргДлительностиПериодов.КонецПериода) < МЕСЯЦ(ВложенныйЗапрос.ПериодНачисления)
	|							И МЕСЯЦ(ВложенныйЗапрос.ПериодНачисления) <= МЕСЯЦ(энргДлительностиПериодов.НачалоПериода)
	|						ТОГДА 1
	|					КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(энргДлительностиПериодов.КонецПериода)
	|							И МЕСЯЦ(ВложенныйЗапрос.ПериодНачисления) <= МЕСЯЦ(энргДлительностиПериодов.КонецПериода)
	|						ТОГДА 2
	|					КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(энргДлительностиПериодов.КонецПериода)
	|							И МЕСЯЦ(ВложенныйЗапрос.ПериодНачисления) > МЕСЯЦ(энргДлительностиПериодов.НачалоПериода)
	|						ТОГДА 1
	|					КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(энргДлительностиПериодов.НачалоПериода)
	|						ТОГДА 2
	|					ИНАЧЕ 1
	|				КОНЕЦ), МЕСЯЦ, МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) - 1), ДЕНЬ, ДЕНЬ(энргДлительностиПериодов.НачалоПериода) - 1) КАК НачалоСезонности,
	|	ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(ДАТАВРЕМЯ(1, 1, 1), ГОД, ГОД(ВложенныйЗапрос.НачалоОП) - ВЫБОР
	|					КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(энргДлительностиПериодов.КонецПериода)
	|							И МЕСЯЦ(энргДлительностиПериодов.КонецПериода) < МЕСЯЦ(ВложенныйЗапрос.ПериодНачисления)
	|							И МЕСЯЦ(ВложенныйЗапрос.ПериодНачисления) <= МЕСЯЦ(энргДлительностиПериодов.НачалоПериода)
	|						ТОГДА 0
	|					КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(энргДлительностиПериодов.КонецПериода)
	|							И МЕСЯЦ(ВложенныйЗапрос.ПериодНачисления) <= МЕСЯЦ(энргДлительностиПериодов.КонецПериода)
	|						ТОГДА 1
	|					КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(энргДлительностиПериодов.КонецПериода)
	|							И МЕСЯЦ(ВложенныйЗапрос.ПериодНачисления) > МЕСЯЦ(энргДлительностиПериодов.НачалоПериода)
	|						ТОГДА 0
	|					КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(энргДлительностиПериодов.НачалоПериода)
	|						ТОГДА 1
	|					ИНАЧЕ 1
	|				КОНЕЦ), МЕСЯЦ, МЕСЯЦ(энргДлительностиПериодов.КонецПериода) - 1), ДЕНЬ, ДЕНЬ(энргДлительностиПериодов.КонецПериода)) КАК КонецСезонности
	|ПОМЕСТИТЬ ПериодыСезонности
	|ИЗ
	|	(ВЫБРАТЬ
	|		энргДлительностиПериодов.Организация КАК Организация,
	|		энргДлительностиПериодов.Район КАК Район,
	|		энргДлительностиПериодов.Сезонность КАК Сезонность,
	|		ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|		ГраницыОтчетногоПериода.НачалоОП КАК НачалоОП,
	|		МАКСИМУМ(энргДлительностиПериодов.Период) КАК Период
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргДлительностиПериодов КАК энргДлительностиПериодов
	|			ПО ГраницыОтчетногоПериода.Организация = энргДлительностиПериодов.Организация
	|				И ГраницыОтчетногоПериода.НачалоОП >= энргДлительностиПериодов.Период
	|				И (энргДлительностиПериодов.Организация = &Организация)
	|				И (энргДлительностиПериодов.Район = &Район)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		энргДлительностиПериодов.Организация,
	|		энргДлительностиПериодов.Район,
	|		энргДлительностиПериодов.Сезонность,
	|		ГраницыОтчетногоПериода.ПериодНачисления,
	|		ГраницыОтчетногоПериода.НачалоОП) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргДлительностиПериодов КАК энргДлительностиПериодов
	|		ПО ВложенныйЗапрос.Организация = энргДлительностиПериодов.Организация
	|			И ВложенныйЗапрос.Район = энргДлительностиПериодов.Район
	|			И ВложенныйЗапрос.Период = энргДлительностиПериодов.Период
	|			И ВложенныйЗапрос.Сезонность = энргДлительностиПериодов.Сезонность
	|			И (энргДлительностиПериодов.Организация = &Организация)
	|			И (энргДлительностиПериодов.Район = &Район)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПериодыСезонности.Организация КАК Организация,
	|	ПериодыСезонности.ПериодНачисления КАК ПериодНачисления,
	|	ПериодыСезонности.Район КАК Район,
	|	ПериодыСезонности.Сезонность КАК Сезонность,
	|	ПериодыСезонности.НачалоСезонности КАК Период,
	|	1 КАК КоэфициентСезонности
	|ПОМЕСТИТЬ ПериодыИзмененияСезонности
	|ИЗ
	|	ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПериодыСезонности КАК ПериодыСезонности
	|		ПО ГраницыОтчетногоПериода.Организация = ПериодыСезонности.Организация
	|			И ГраницыОтчетногоПериода.ПериодНачисления = ПериодыСезонности.ПериодНачисления
	|			И ГраницыОтчетногоПериода.НачалоОП < ПериодыСезонности.НачалоСезонности
	|			И (ПериодыСезонности.НачалоСезонности < ГраницыОтчетногоПериода.ЗавершениеОП)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ПериодыСезонности.Организация,
	|	ПериодыСезонности.ПериодНачисления,
	|	ПериодыСезонности.Район,
	|	ПериодыСезонности.Сезонность,
	|	ПериодыСезонности.КонецСезонности,
	|	0
	|ИЗ
	|	ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПериодыСезонности КАК ПериодыСезонности
	|		ПО ГраницыОтчетногоПериода.Организация = ПериодыСезонности.Организация
	|			И ГраницыОтчетногоПериода.ПериодНачисления = ПериодыСезонности.ПериодНачисления
	|			И ГраницыОтчетногоПериода.НачалоОП < ПериодыСезонности.КонецСезонности
	|			И (ПериодыСезонности.КонецСезонности < ГраницыОтчетногоПериода.ЗавершениеОП)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ГраницыОтчетногоПериода.Организация КАК Организация,
	|	ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|	энргЗначенияТарифов.Район КАК Район,
	|	энргЗначенияТарифов.ГруппаПотребителей КАК ГруппаПотребителей,
	|	энргЗначенияТарифов.Услуга КАК Услуга,
	|	энргЗначенияТарифов.Поставщик КАК Поставщик,
	|	энргЗначенияТарифов.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргЗначенияТарифов.Значение КАК ЗначениеТарифа,
	|	энргЗначенияТарифов.ЗначениеСверхНорматива КАК ЗначениеСверхНорматива,
	|	энргЗначенияТарифов.ЗначениеРЭК КАК ЗначениеТарифаРЭК,
	|	энргЗначенияТарифов.Регистратор КАК Регистратор,
	|	ДОБАВИТЬКДАТЕ(энргЗначенияТарифов.Период, ДЕНЬ, &ПериодНовогоТарифа - 1) КАК ДатаСменыТарифа
	|ПОМЕСТИТЬ ЗначенияТарифов
	|ИЗ
	|	ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначенияТарифов КАК энргЗначенияТарифов
	|		ПО ГраницыОтчетногоПериода.Организация = энргЗначенияТарифов.Организация
	|			И (энргЗначенияТарифов.Период МЕЖДУ ГраницыОтчетногоПериода.НачалоОП И ГраницыОтчетногоПериода.ЗавершениеОП)
	|			И (энргЗначенияТарифов.Организация = &Организация)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргСреднийОбъемПотребленияАбонентов.Организация КАК Организация,
	|	энргСреднийОбъемПотребленияАбонентов.ПериодНачисления КАК ПериодНачисления,
	|	энргСреднийОбъемПотребленияАбонентов.Район КАК Район,
	|	энргСреднийОбъемПотребленияАбонентов.ЧастныйСектор КАК ЧастныйСектор,
	|	энргСреднийОбъемПотребленияАбонентов.Строение КАК Строение,
	|	энргСреднийОбъемПотребленияАбонентов.Помещение КАК Помещение,
	|	энргСреднийОбъемПотребленияАбонентов.Услуга КАК Услуга,
	|	энргСреднийОбъемПотребленияАбонентов.ТочкаУчета КАК ТочкаУчета,
	|	энргСреднийОбъемПотребленияАбонентов.Шкала КАК Шкала,
	|	энргСреднийОбъемПотребленияАбонентов.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргСреднийОбъемПотребленияАбонентов.Объем КАК СреднийОбъем,
	|	энргСреднийОбъемПотребленияАбонентов.ОбъемПотребленный КАК СреднийОбъемПотребленный
	|ПОМЕСТИТЬ СреднееПотреблениеАбонентов
	|ИЗ
	|	РегистрСведений.энргСреднийОбъемПотребленияАбонентов КАК энргСреднийОбъемПотребленияАбонентов
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДанныеСтроений КАК ДанныеСтроений
	|		ПО энргСреднийОбъемПотребленияАбонентов.ЧастныйСектор = ДанныеСтроений.ЧастныйСектор
	|			И энргСреднийОбъемПотребленияАбонентов.Строение = ДанныеСтроений.Строение
	|			И энргСреднийОбъемПотребленияАбонентов.Помещение = ДанныеСтроений.Помещение
	|			И (энргСреднийОбъемПотребленияАбонентов.Организация = &Организация)
	|			И (энргСреднийОбъемПотребленияАбонентов.ПериодНачисления МЕЖДУ &ПериодНачисленияНачало И &ПериодНачисленияКонец)
	|			И (энргСреднийОбъемПотребленияАбонентов.Район = &Район)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргОбъемНачисленийОбороты.Период КАК Период,
	|	энргОбъемНачисленийОбороты.ЧастныйСектор КАК ЧастныйСектор,
	|	энргОбъемНачисленийОбороты.Строение КАК Строение,
	|	энргОбъемНачисленийОбороты.Помещение КАК Помещение,
	|	энргОбъемНачисленийОбороты.ВидНачисления КАК ВидНачисления,
	|	энргОбъемНачисленийОбороты.Услуга КАК Услуга,
	|	энргОбъемНачисленийОбороты.Поставщик КАК Поставщик,
	|	энргОбъемНачисленийОбороты.ТочкаУчета КАК ТочкаУчета,
	|	энргОбъемНачисленийОбороты.ПриборУчета КАК ПриборУчета,
	|	энргОбъемНачисленийОбороты.СпособНачисления КАК СпособНачисления,
	|	энргОбъемНачисленийОбороты.ЗначениеТарифа КАК ЗначениеТарифа,
	|	энргОбъемНачисленийОбороты.СуммаОборот КАК СуммаОборот,
	|	энргОбъемНачисленийОбороты.ОбъемУслугиОборот КАК ОбъемУслугиОборот
	|ПОМЕСТИТЬ НачисленныйОбъем
	|ИЗ
	|	РегистрНакопления.энргОбъемНачислений.Обороты(
	|			&НачалоПериода,
	|			&КонецПериода,
	|			Месяц,
	|			Организация = &Организация
	|				И Район = &Район
	|				И (ЧастныйСектор, Строение, Помещение) В
	|					(ВЫБРАТЬ
	|						ДанныеСтроений.ЧастныйСектор,
	|						ДанныеСтроений.Строение,
	|						ДанныеСтроений.Помещение
	|					ИЗ
	|						ДанныеСтроений КАК ДанныеСтроений)
	|				И ВидНачисления = ЗНАЧЕНИЕ(Перечисление.энргВидыНачислений.Начисление)
	|				И НЕ СпособНачисления = ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.НачислениеОДН)) КАК энргОбъемНачисленийОбороты
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргОбъемПерерасчетаОбороты.Организация КАК Организация,
	|	энргОбъемПерерасчетаОбороты.ПериодНачисления КАК ПериодНачисления,
	|	энргОбъемПерерасчетаОбороты.ЧастныйСектор КАК ЧастныйСектор,
	|	энргОбъемПерерасчетаОбороты.Строение КАК Строение,
	|	энргОбъемПерерасчетаОбороты.Помещение КАК Помещение,
	|	энргОбъемПерерасчетаОбороты.Услуга КАК Услуга,
	|	энргОбъемПерерасчетаОбороты.Поставщик КАК Поставщик,
	|	энргОбъемПерерасчетаОбороты.ТочкаУчета КАК ТочкаУчета,
	|	энргОбъемПерерасчетаОбороты.ПриборУчета КАК ПриборУчета,
	|	энргОбъемПерерасчетаОбороты.СпособНачисления КАК СпособНачисления,
	|	энргОбъемПерерасчетаОбороты.ЗначениеТарифа КАК ЗначениеТарифа,
	|	энргОбъемПерерасчетаОбороты.СуммаОборот КАК СуммаОборот,
	|	энргОбъемПерерасчетаОбороты.ОбъемУслугиОборот КАК ОбъемУслугиОборот
	|ПОМЕСТИТЬ ОбъемПерерасчет
	|ИЗ
	|	РегистрНакопления.энргОбъемПерерасчета.Обороты(
	|			&НачалоПериода,
	|			&КонецПериода,
	|			,
	|			Организация = &Организация
	|				И Район = &Район
	|				И (ЧастныйСектор, Строение, Помещение) В
	|					(ВЫБРАТЬ
	|						ДанныеСтроений.ЧастныйСектор,
	|						ДанныеСтроений.Строение,
	|						ДанныеСтроений.Помещение
	|					ИЗ
	|						ДанныеСтроений КАК ДанныеСтроений)) КАК энргОбъемПерерасчетаОбороты
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.ЧастныйСектор КАК ЧастныйСектор,
	|	ВложенныйЗапрос.Строение КАК Строение,
	|	ВложенныйЗапрос.Помещение КАК Помещение,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	ВложенныйЗапрос.Поставщик КАК Поставщик,
	|	ВложенныйЗапрос.ТочкаУчета КАК ТочкаУчета,
	|	ВложенныйЗапрос.ПриборУчета КАК ПриборУчета,
	|	ВложенныйЗапрос.СпособНачисления КАК СпособНачисления,
	|	ВложенныйЗапрос.ЗначениеТарифа КАК ЗначениеТарифа,
	|	СУММА(ВложенныйЗапрос.СуммаОборот) КАК Сумма,
	|	СУММА(ВложенныйЗапрос.ОбъемУслугиОборот) КАК ОбъемУслуги
	|ПОМЕСТИТЬ ОбъемДляКорректировки
	|ИЗ
	|	(ВЫБРАТЬ
	|		ГраницыОтчетногоПериода.Организация КАК Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|		НачисленныйОбъем.ЧастныйСектор КАК ЧастныйСектор,
	|		НачисленныйОбъем.Строение КАК Строение,
	|		НачисленныйОбъем.Помещение КАК Помещение,
	|		НачисленныйОбъем.Услуга КАК Услуга,
	|		НачисленныйОбъем.Поставщик КАК Поставщик,
	|		НачисленныйОбъем.ТочкаУчета КАК ТочкаУчета,
	|		НачисленныйОбъем.ПриборУчета КАК ПриборУчета,
	|		НачисленныйОбъем.СпособНачисления КАК СпособНачисления,
	|		НачисленныйОбъем.ЗначениеТарифа КАК ЗначениеТарифа,
	|		НачисленныйОбъем.СуммаОборот КАК СуммаОборот,
	|		НачисленныйОбъем.ОбъемУслугиОборот КАК ОбъемУслугиОборот
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ НачисленныйОбъем КАК НачисленныйОбъем
	|			ПО (НачисленныйОбъем.Период МЕЖДУ ГраницыОтчетногоПериода.НачалоОП И ГраницыОтчетногоПериода.ЗавершениеОП)
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ОбъемПерерасчет.Организация,
	|		ОбъемПерерасчет.ПериодНачисления,
	|		ОбъемПерерасчет.ЧастныйСектор,
	|		ОбъемПерерасчет.Строение,
	|		ОбъемПерерасчет.Помещение,
	|		ОбъемПерерасчет.Услуга,
	|		ОбъемПерерасчет.Поставщик,
	|		ОбъемПерерасчет.ТочкаУчета,
	|		ОбъемПерерасчет.ПриборУчета,
	|		ОбъемПерерасчет.СпособНачисления,
	|		ОбъемПерерасчет.ЗначениеТарифа,
	|		-ОбъемПерерасчет.СуммаОборот,
	|		-ОбъемПерерасчет.ОбъемУслугиОборот
	|	ИЗ
	|		ОбъемПерерасчет КАК ОбъемПерерасчет) КАК ВложенныйЗапрос
	|
	|СГРУППИРОВАТЬ ПО
	|	ВложенныйЗапрос.Организация,
	|	ВложенныйЗапрос.ПериодНачисления,
	|	ВложенныйЗапрос.ЧастныйСектор,
	|	ВложенныйЗапрос.Строение,
	|	ВложенныйЗапрос.Помещение,
	|	ВложенныйЗапрос.Услуга,
	|	ВложенныйЗапрос.Поставщик,
	|	ВложенныйЗапрос.ТочкаУчета,
	|	ВложенныйЗапрос.ПриборУчета,
	|	ВложенныйЗапрос.СпособНачисления,
	|	ВложенныйЗапрос.ЗначениеТарифа
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	&Район КАК Район,
	|	&МКД КАК МКД,
	|	энргВидыУслуг.Ссылка КАК Услуга,
	|	ВложенныйЗапрос.ПлощадьМОП КАК ПлощадьМОП
	|ПОМЕСТИТЬ ЗначениеПлощадейМКД
	|ИЗ
	|	(ВЫБРАТЬ
	|		ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|		ВложенныйЗапрос.ВидПлощади КАК ВидПлощади,
	|		энргЗначениеПлощадейМКД.Площадь КАК ПлощадьМОП
	|	ИЗ
	|		(ВЫБРАТЬ
	|			ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|			энргЗначениеПлощадейМКД.ВидПлощади КАК ВидПлощади,
	|			МАКСИМУМ(энргЗначениеПлощадейМКД.Период) КАК Период
	|		ИЗ
	|			ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначениеПлощадейМКД КАК энргЗначениеПлощадейМКД
	|				ПО ГраницыОтчетногоПериода.ЗавершениеОП > энргЗначениеПлощадейМКД.Период
	|					И (энргЗначениеПлощадейМКД.Организация = &Организация)
	|					И (энргЗначениеПлощадейМКД.Район = &Район)
	|					И (энргЗначениеПлощадейМКД.МКД = &МКД)
	|		
	|		СГРУППИРОВАТЬ ПО
	|			ГраницыОтчетногоПериода.ПериодНачисления,
	|			энргЗначениеПлощадейМКД.ВидПлощади) КАК ВложенныйЗапрос
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначениеПлощадейМКД КАК энргЗначениеПлощадейМКД
	|			ПО ВложенныйЗапрос.Период = энргЗначениеПлощадейМКД.Период
	|				И ВложенныйЗапрос.ВидПлощади = энргЗначениеПлощадейМКД.ВидПлощади
	|				И (энргЗначениеПлощадейМКД.Организация = &Организация)
	|				И (энргЗначениеПлощадейМКД.Район = &Район)
	|				И (энргЗначениеПлощадейМКД.МКД = &МКД)) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.энргВидыУслуг КАК энргВидыУслуг
	|		ПО ВложенныйЗапрос.ВидПлощади = энргВидыУслуг.ВидПлощадиМКД
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	&Район КАК Район,
	|	&МКД КАК Строение,
	|	энргВидыУслуг.Ссылка КАК Услуга,
	|	ВложенныйЗапрос.Площадь КАК ПлощадьАбонентов,
	|	0 КАК ПлощадьСобственнаяПоставка
	|ПОМЕСТИТЬ ЗначениеИндивидуальныхПлощадей
	|ИЗ
	|	(ВЫБРАТЬ
	|		ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|		СУММА(энргЗначенияПлощадей.Площадь) КАК Площадь
	|	ИЗ
	|		(ВЫБРАТЬ
	|			ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|			ВложенныйЗапрос.КлючПомещения КАК КлючПомещения,
	|			МАКСИМУМ(ВложенныйЗапрос.Период) КАК Период
	|		ИЗ
	|			ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	|					энргЗначенияПлощадей.Период КАК Период,
	|					энргЗначенияПлощадей.ВидПлощади КАК ВидПлощади,
	|					энргЗначенияПлощадей.КлючПомещения КАК КлючПомещения
	|				ИЗ
	|					РегистрСведений.энргЗначенияПлощадей КАК энргЗначенияПлощадей
	|						ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргКлючиПомещений КАК энргКлючиПомещений
	|						ПО энргЗначенияПлощадей.КлючПомещения = энргКлючиПомещений.КлючПомещения
	|							И (энргЗначенияПлощадей.Организация = &Организация)
	|							И (энргЗначенияПлощадей.Район = &Район)
	|							И (энргКлючиПомещений.Строение = &МКД)
	|							И (энргЗначенияПлощадей.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ОбщаяПлощадь))) КАК ВложенныйЗапрос
	|				ПО ГраницыОтчетногоПериода.ЗавершениеОП > ВложенныйЗапрос.Период
	|		
	|		СГРУППИРОВАТЬ ПО
	|			ГраницыОтчетногоПериода.ПериодНачисления,
	|			ВложенныйЗапрос.КлючПомещения) КАК ВложенныйЗапрос
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначенияПлощадей КАК энргЗначенияПлощадей
	|			ПО ВложенныйЗапрос.Период = энргЗначенияПлощадей.Период
	|				И ВложенныйЗапрос.КлючПомещения = энргЗначенияПлощадей.КлючПомещения
	|				И (энргЗначенияПлощадей.Организация = &Организация)
	|				И (энргЗначенияПлощадей.Район = &Район)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ВложенныйЗапрос.ПериодНачисления) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.энргВидыУслуг КАК энргВидыУслуг
	|		ПО (НЕ энргВидыУслуг.СоставнаяУслуга)
	|			И (энргВидыУслуг.ТипУслуги = ЗНАЧЕНИЕ(Перечисление.энргТипыУслуг.КоммунальныеУслуги))
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргСтабильныеПериоды.Организация КАК Организация,
	|	ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|	энргСтабильныеПериоды.Район КАК Район,
	|	энргСтабильныеПериоды.ЧастныйСектор КАК ЧастныйСектор,
	|	энргСтабильныеПериоды.Строение КАК Строение,
	|	энргСтабильныеПериоды.Помещение КАК Помещение,
	|	энргСтабильныеПериоды.Услуга КАК Услуга,
	|	энргСтабильныеПериоды.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	МАКСИМУМ(энргСтабильныеПериоды.ПриборВведен) КАК ПриборВведен
	|ПОМЕСТИТЬ НаличиеПриборовУчетаСНачалаГода
	|ИЗ
	|	ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ СтабильныеПериодыНачало КАК энргСтабильныеПериоды
	|		ПО (НАЧАЛОПЕРИОДА(ГраницыОтчетногоПериода.ПериодНачисления, ГОД) = НАЧАЛОПЕРИОДА(энргСтабильныеПериоды.ПериодНачисления, ГОД))
	|
	|СГРУППИРОВАТЬ ПО
	|	энргСтабильныеПериоды.Организация,
	|	ГраницыОтчетногоПериода.ПериодНачисления,
	|	энргСтабильныеПериоды.Район,
	|	энргСтабильныеПериоды.ЧастныйСектор,
	|	энргСтабильныеПериоды.Строение,
	|	энргСтабильныеПериоды.Помещение,
	|	энргСтабильныеПериоды.Услуга,
	|	энргСтабильныеПериоды.НаправлениеИспользованияТУ";
	
	Запрос  						= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Запрос.УстановитьПараметр("Организация",			Организация);
	Запрос.УстановитьПараметр("Район",					Район);
																															 
	Запрос.УстановитьПараметр("МКД",					Справочники.энргСтроения.ПустаяСсылка());
	Запрос.УстановитьПараметр("Абонент",				Абонент);
	Запрос.УстановитьПараметр("НачалоПериода",			НачалоПериодаРасчета);
	Запрос.УстановитьПараметр("КонецПериода",			КонецПериодаРасчета);
	Запрос.УстановитьПараметр("ПериодНачисленияНачало",	ПериодНачисленияНачало);
	Запрос.УстановитьПараметр("ПериодНачисленияКонец",	ПериодНачисленияКонец);
	Запрос.УстановитьПараметр("ПериодНовогоТарифа",		ПериодНовогоТарифа);
	Запрос.Текст 					= Текст;  	
	Запрос.Выполнить();	
	
КонецПроцедуры

Процедура ПоказанияПерерасчет(МВТ,Организация,ПериодНачисленияНачало,ПериодНачисленияКонец,Район,КорректировкаПоказаний)
		
	Запрос 							= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Запрос.Текст 					= "ВЫБРАТЬ * ИЗ ПериодыПриемаПоказаний";
	Результат 						= Запрос.Выполнить();
	Выборка  						= Результат.Выбрать();
	
	ПериодыПриемаПоказаний 			= Новый Соответствие;
	
	Пока Выборка.Следующий() Цикл
		ПериодыПриемаПоказаний.Вставить(Выборка.ПериодНачисления, Новый Структура("ДатаС,ДатаПо, НачалоПериодаРасчета", Выборка.ДатаС, Выборка.ДатаПо, Выборка.НачалоОП));
	КонецЦикла;
	
	Запрос 							= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Запрос.УстановитьПараметр("Организация",		Организация);
	Запрос.УстановитьПараметр("ПериодНачисления", 	НачалоМесяца(ПериодНачисленияНачало -1));
	Запрос.УстановитьПараметр("Район", 				Район);
																														 
																																		   
																															 
	Запрос.Текст 					=
	"ВЫБРАТЬ
	|	ДанныеСтроений.КлючПомещения,
	|	ДанныеСтроений.ЧастныйСектор,
	|	ДанныеСтроений.Строение,
	|	ДанныеСтроений.Помещение,
	|	энргМаксимальныеПоказанияСрез.ПриборУчета КАК ПриборУчета,
	|	энргМаксимальныеПоказанияСрез.Шкала КАК Шкала,
	|	энргМаксимальныеПоказанияСрез.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргМаксимальныеПоказанияСрез.Показания КАК Показания
	|ИЗ
	|	РегистрСведений.энргМаксимальныеПоказанияСрез КАК энргМаксимальныеПоказанияСрез
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДанныеСтроений КАК ДанныеСтроений
	|		ПО энргМаксимальныеПоказанияСрез.ЧастныйСектор = ДанныеСтроений.ЧастныйСектор
	|			И энргМаксимальныеПоказанияСрез.Строение = ДанныеСтроений.Строение
	|			И энргМаксимальныеПоказанияСрез.Помещение = ДанныеСтроений.Помещение
	|			И (энргМаксимальныеПоказанияСрез.Организация = &Организация)
	|			И (энргМаксимальныеПоказанияСрез.ПериодНачисления = &ПериодНачисления)
	|			И (энргМаксимальныеПоказанияСрез.Район = &Район)";
	
	Результат 						= Запрос.Выполнить();
	тзМаксимальныеСрез 				= Результат.Выгрузить();
	
	ПредоставленныеПоказания 		= Новый ТаблицаЗначений;
	ПредоставленныеПоказания.Колонки.Добавить("ЧастныйСектор",				Новый ОписаниеТипов("Булево"));
	ПредоставленныеПоказания.Колонки.Добавить("Строение",					Новый ОписаниеТипов("СправочникСсылка.энргСтроения"));
	ПредоставленныеПоказания.Колонки.Добавить("Помещение",					Новый ОписаниеТипов("СправочникСсылка.энргПомещения"));
	ПредоставленныеПоказания.Колонки.Добавить("ПериодНачисления",			Новый ОписаниеТипов("Дата"));
	ПредоставленныеПоказания.Колонки.Добавить("ПриборУчета",				Новый ОписаниеТипов("СправочникСсылка.энргПриборыУчетаАбонента"));
	ПредоставленныеПоказания.Колонки.Добавить("Шкала",						Новый ОписаниеТипов("СправочникСсылка.энргШкалыПриборовУчета"));
	ПредоставленныеПоказания.Колонки.Добавить("ТарифнаяЗона",				Новый ОписаниеТипов("СправочникСсылка.энргТарифныеЗоны"));
	ПредоставленныеПоказания.Колонки.Добавить("НомерПозиции",				Новый ОписаниеТипов("Число"));
	ПредоставленныеПоказания.Колонки.Добавить("Разделитель",				Новый ОписаниеТипов("Число"));
	ПредоставленныеПоказания.Колонки.Добавить("ДатаРегистратора",			Новый ОписаниеТипов("Дата"));
	ПредоставленныеПоказания.Колонки.Добавить("ДокРегистратор",				Новый ОписаниеТипов(Метаданные.РегистрыСведений.энргПредоставленныеПоказания.Измерения.ДокРегистратор.Тип.Типы()));
	ПредоставленныеПоказания.Колонки.Добавить("ВСрок",						Новый ОписаниеТипов("Булево"));
	ПредоставленныеПоказания.Колонки.Добавить("Показания",					Новый ОписаниеТипов("Число"));
	ПредоставленныеПоказания.Колонки.Добавить("ПоказанияТекущегоПериода",	Новый ОписаниеТипов("Булево"));
	ПредоставленныеПоказания.Колонки.Добавить("КлючПомещения",				Новый ОписаниеТипов("СправочникСсылка.энргКлючиПомещений"));
	  	
	КорректировкаПоказаний.Сортировать("КлючПомещения,ПериодНачисления,ПриборУчетаПосле,ШкалаПосле,ТарифнаяЗонаПосле,ДатаПоказаний,РегистраторПоказаний,Разделитель");
		
	ПредыдущиеПоказания 							= -1;
	
	текКлючПомещения								= Неопределено;
	текПериодНачисления								= Неопределено;
	текПриборУчета 									= Неопределено;
	текШкала	 									= Неопределено;
	текТарифнаяЗона									= Неопределено;
	ПоказанияПриняты 								= Перечисления.энргСостояниеПоказаний.Приняты;
	
	Для Каждого Строка Из КорректировкаПоказаний Цикл
		
		Если НЕ текКлючПомещения = Строка.КлючПомещения
			ИЛИ НЕ текПериодНачисления = Строка.ПериодНачисления
			ИЛИ НЕ текПриборУчета = Строка.ПриборУчетаПосле
			ИЛИ НЕ текШкала = Строка.ШкалаПосле
			ИЛИ НЕ текТарифнаяЗона = Строка.ТарифнаяЗонаПосле Тогда
			ТекНомерПозиции 						= 0;
		КонецЕсли;
		
		Если НЕ текПриборУчета = Строка.ПриборУчетаПосле
			ИЛИ НЕ текШкала = Строка.ШкалаПосле
			ИЛИ НЕ текТарифнаяЗона = Строка.ТарифнаяЗонаПосле Тогда
			
			СтрокиМаксимальныеСрез 					= тзМаксимальныеСрез.НайтиСтроки(Новый Структура("КлючПомещения,ПриборУчета,Шкала,ТарифнаяЗона",Строка.КлючПомещения,Строка.ПриборУчетаПосле, Строка.ШкалаПосле,Строка.ТарифнаяЗонаПосле));
			СтрокаСреза 							= Неопределено;
			Если СтрокиМаксимальныеСрез.Количество() = 0 Тогда
				МаксимальныеПоказания 				= 0; 
			Иначе
				СтрокаСреза 						= СтрокиМаксимальныеСрез[0];
				МаксимальныеПоказания 				= СтрокаСреза.Показания;
			КонецЕсли;
			
		КонецЕсли;
		
		Если ПериодыПриемаПоказаний[Строка.ПериодНачисления] = Неопределено Тогда
			ВСрок 									= Истина;
			ПоказанияТекущегоПериода 				= Истина;
		Иначе
			НачалоПериодаРасчета 					= ПериодыПриемаПоказаний[Строка.ПериодНачисления].НачалоПериодаРасчета;
			ПоказанияС 								= ПериодыПриемаПоказаний[Строка.ПериодНачисления].ДатаС;		
			ПоказанияПО 							= ПериодыПриемаПоказаний[Строка.ПериодНачисления].ДатаПо;
			ВСрок 									= Строка.ДатаПоказаний >= НачалоПериодаРасчета и День(Строка.ДатаПоказаний)>=ПоказанияС и День(Строка.ДатаПоказаний)<=ПоказанияПО;
			ПоказанияТекущегоПериода 				= Строка.ДатаПоказаний >= НачалоПериодаРасчета;
		КонецЕсли; 		
		
		Если Строка.СостояниеПоказанийПосле = ПоказанияПриняты Тогда
			МаксимальныеПоказания 					= Строка.ПоказанияПосле;
			Если СтрокаСреза = Неопределено Тогда
				СтрокаСреза  						= тзМаксимальныеСрез.Добавить();
				СтрокаСреза.ЧастныйСектор 			= Строка.ЧастныйСектор;
				СтрокаСреза.Строение	 			= Строка.Строение;
				СтрокаСреза.Помещение	 			= Строка.Помещение;
				СтрокаСреза.ПриборУчета 			= Строка.ПриборУчетаПосле;
				СтрокаСреза.Шкала					= Строка.ШкалаПосле;
				СтрокаСреза.ТарифнаяЗона			= Строка.ТарифнаяЗонаПосле;
				СтрокаСреза.Показания 				= МаксимальныеПоказания;	
			Иначе
				 СтрокаСреза.Показания 				= МаксимальныеПоказания;
			КонецЕсли; 			
		КонецЕсли;
				
		Если Строка.СостояниеПоказанийПосле = ПоказанияПриняты или ВСрок тогда
			// Записываем набор.
			СтрокаНабор  							= ПредоставленныеПоказания.Добавить();
			СтрокаНабор.КлючПомещения              	= Строка.КлючПомещения;
			СтрокаНабор.ПериодНачисления 			= Строка.ПериодНачисления;
			СтрокаНабор.ПриборУчета					= Строка.ПриборУчетаПосле;
			СтрокаНабор.Шкала						= Строка.ШкалаПосле;
			СтрокаНабор.ТарифнаяЗона				= Строка.ТарифнаяЗонаПосле;
			СтрокаНабор.НомерПозиции				= ТекНомерПозиции;
			СтрокаНабор.ДатаРегистратора  			= Строка.ДатаПоказаний;
			СтрокаНабор.ДокРегистратор  			= Строка.РегистраторПоказаний;
			СтрокаНабор.Разделитель		  			= Строка.Разделитель;
			СтрокаНабор.Показания  					= МаксимальныеПоказания;
			СтрокаНабор.ВСрок  						= ВСрок;
			СтрокаНабор.ПоказанияТекущегоПериода	= ПоказанияТекущегоПериода;
			ТекНомерПозиции 						= ТекНомерПозиции +1;			
		КонецЕсли;
		
		текКлючПомещения 							= Строка.КлючПомещения;
		текПериодНачисления 						= Строка.ПериодНачисления;
		текПриборУчета 								= Строка.ПриборУчетаПосле;
		текШкала	 								= Строка.ШкалаПосле;
		текТарифнаяЗона								= Строка.ТарифнаяЗонаПосле;			
	КонецЦикла;
	
	Запрос 											= Новый Запрос;
	Запрос.УстановитьПараметр("Организация",				Организация);
	Запрос.УстановитьПараметр("ПериодНачисления", 			НачалоМесяца(ПериодНачисленияНачало -1));
	Запрос.УстановитьПараметр("Организация", 				Организация);
	Запрос.УстановитьПараметр("Район", 						Район);
																																			 
																														   
																															   
	Запрос.УстановитьПараметр("ПредоставленныеПоказания", 	ПредоставленныеПоказания);
	Запрос.МенеджерВременныхТаблиц 					= МВТ;
	Запрос.Текст  									= 
	"ВЫБРАТЬ
	|	ПредоставленныеПоказания.ПериодНачисления КАК ПериодНачисления,
	|	&Организация КАК Организация,
	|	&Район КАК Район,
	|	ПредоставленныеПоказания.КлючПомещения КАК КлючПомещения,
	|	ПредоставленныеПоказания.ПриборУчета КАК ПриборУчета,
	|	ПредоставленныеПоказания.Шкала КАК Шкала,
	|	ПредоставленныеПоказания.ТарифнаяЗона КАК ТарифнаяЗона,
	|	ПредоставленныеПоказания.НомерПозиции КАК НомерПозиции,
	|	ПредоставленныеПоказания.Разделитель КАК Разделитель,
	|	ПредоставленныеПоказания.ДатаРегистратора КАК ДатаРегистратора,
	|	ПредоставленныеПоказания.ДокРегистратор КАК ДокРегистратор,
	|	ПредоставленныеПоказания.ВСрок КАК ВСрок,
	|	ПредоставленныеПоказания.Показания КАК Показания,
	|	ПредоставленныеПоказания.ПоказанияТекущегоПериода КАК ПоказанияТекущегоПериода
	|ПОМЕСТИТЬ яПредоставленныеПоказания
	|ИЗ
	|	&ПредоставленныеПоказания КАК ПредоставленныеПоказания
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	яПредоставленныеПоказания.ПериодНачисления КАК ПериодНачисления,
	|	яПредоставленныеПоказания.Организация КАК Организация,
	|	яПредоставленныеПоказания.Район КАК Район,
	|	ДанныеСтроений.ЧастныйСектор КАК ЧастныйСектор,
	|	ДанныеСтроений.Строение КАК Строение,
	|	ДанныеСтроений.Помещение КАК Помещение,
	|	яПредоставленныеПоказания.ПриборУчета КАК ПриборУчета,
	|	яПредоставленныеПоказания.Шкала КАК Шкала,
	|	яПредоставленныеПоказания.ТарифнаяЗона КАК ТарифнаяЗона,
	|	яПредоставленныеПоказания.НомерПозиции КАК НомерПозиции,
	|	яПредоставленныеПоказания.Разделитель КАК Разделитель,
	|	яПредоставленныеПоказания.ДатаРегистратора КАК ДатаРегистратора,
	|	яПредоставленныеПоказания.ДокРегистратор КАК ДокРегистратор,
	|	яПредоставленныеПоказания.ВСрок КАК ВСрок,
	|	яПредоставленныеПоказания.Показания КАК Показания,
	|	яПредоставленныеПоказания.ПоказанияТекущегоПериода КАК ПоказанияТекущегоПериода,
	|	ГраницыОтчетногоПериода.ЗавершениеОП КАК КонецПериодаРасчета
	|ПОМЕСТИТЬ ПредоставленныеПоказания
	|ИЗ
	|	яПредоставленныеПоказания КАК яПредоставленныеПоказания
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|		ПО яПредоставленныеПоказания.ПериодНачисления = ГраницыОтчетногоПериода.ПериодНачисления
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДанныеСтроений КАК ДанныеСтроений
	|		ПО яПредоставленныеПоказания.КлючПомещения = ДанныеСтроений.КлючПомещения
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	&Организация КАК Организация,
	|	&Район КАК Район,
	|	ПредоставленныеПоказания.ЧастныйСектор КАК ЧастныйСектор,
	|	ПредоставленныеПоказания.Строение КАК Строение,
	|	ПредоставленныеПоказания.Помещение КАК Помещение,
	|	ВложенныйЗапрос.ПриборУчета КАК ПриборУчета,
	|	ВложенныйЗапрос.Шкала КАК Шкала,
	|	ВложенныйЗапрос.ТарифнаяЗона КАК ТарифнаяЗона,
	|	ПредоставленныеПоказания.Показания КАК Показания,
	|	ПредоставленныеПоказания.ДатаРегистратора КАК ДатаРегистратора,
	|	ПредоставленныеПоказания.ДокРегистратор КАК ДокРегистратор
	|ПОМЕСТИТЬ МаксимальныеПоказания
	|ИЗ
	|	(ВЫБРАТЬ
	|		ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|		ВложенныйЗапрос.ПриборУчета КАК ПриборУчета,
	|		ВложенныйЗапрос.Шкала КАК Шкала,
	|		ВложенныйЗапрос.ТарифнаяЗона КАК ТарифнаяЗона,
	|		ВложенныйЗапрос.ПериодНачисленияПоказаний КАК ПериодНачисленияПоказаний,
	|		МАКСИМУМ(ПредоставленныеПоказания.НомерПозиции) КАК НомерПозиции
	|	ИЗ
	|		(ВЫБРАТЬ
	|			ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|			ПредоставленныеПоказания.ПриборУчета КАК ПриборУчета,
	|			ПредоставленныеПоказания.Шкала КАК Шкала,
	|			ПредоставленныеПоказания.ТарифнаяЗона КАК ТарифнаяЗона,
	|			МАКСИМУМ(ПредоставленныеПоказания.ПериодНачисления) КАК ПериодНачисленияПоказаний
	|		ИЗ
	|			ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПредоставленныеПоказания КАК ПредоставленныеПоказания
	|				ПО ГраницыОтчетногоПериода.ПериодНачисления >= ПредоставленныеПоказания.ПериодНачисления
	|		
	|		СГРУППИРОВАТЬ ПО
	|			ГраницыОтчетногоПериода.ПериодНачисления,
	|			ПредоставленныеПоказания.ПриборУчета,
	|			ПредоставленныеПоказания.Шкала,
	|			ПредоставленныеПоказания.ТарифнаяЗона) КАК ВложенныйЗапрос
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПредоставленныеПоказания КАК ПредоставленныеПоказания
	|			ПО ВложенныйЗапрос.ПериодНачисленияПоказаний = ПредоставленныеПоказания.ПериодНачисления
	|				И ВложенныйЗапрос.ПриборУчета = ПредоставленныеПоказания.ПриборУчета
	|				И ВложенныйЗапрос.Шкала = ПредоставленныеПоказания.Шкала
	|				И ВложенныйЗапрос.ТарифнаяЗона = ПредоставленныеПоказания.ТарифнаяЗона
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ВложенныйЗапрос.ПериодНачисления,
	|		ВложенныйЗапрос.ПриборУчета,
	|		ВложенныйЗапрос.Шкала,
	|		ВложенныйЗапрос.ТарифнаяЗона,
	|		ВложенныйЗапрос.ПериодНачисленияПоказаний) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПредоставленныеПоказания КАК ПредоставленныеПоказания
	|		ПО ВложенныйЗапрос.ПериодНачисленияПоказаний = ПредоставленныеПоказания.ПериодНачисления
	|			И ВложенныйЗапрос.ПриборУчета = ПредоставленныеПоказания.ПриборУчета
	|			И ВложенныйЗапрос.Шкала = ПредоставленныеПоказания.Шкала
	|			И ВложенныйЗапрос.ТарифнаяЗона = ПредоставленныеПоказания.ТарифнаяЗона
	|			И ВложенныйЗапрос.НомерПозиции = ПредоставленныеПоказания.НомерПозиции
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	&Организация КАК Организация,
	|	&Район КАК Район,
	|	ВложенныйЗапрос.ЧастныйСектор КАК ЧастныйСектор,
	|	ВложенныйЗапрос.Строение КАК Строение,
	|	ВложенныйЗапрос.Помещение КАК Помещение,
	|	ВложенныйЗапрос.ПриборУчета КАК ПриборУчета,
	|	ВложенныйЗапрос.Шкала КАК Шкала,
	|	ВложенныйЗапрос.ТарифнаяЗона КАК ТарифнаяЗона,
	|	ВложенныйЗапрос.НомерПозиции КАК НомерПозиции,
	|	ВложенныйЗапрос.Показания КАК Показания,
	|	ВложенныйЗапрос.ДатаРегистратора КАК ДатаРегистратора,
	|	ВложенныйЗапрос.ДокРегистратор КАК ДокРегистратор,
	|	ГраницыОтчетногоПериода.НачалоОП КАК Период,
	|	ГраницыОтчетногоПериода.ЗавершениеОП КАК КонецПериодаРасчета
	|ПОМЕСТИТЬ МаксимальныеПоказанияСрез
	|ИЗ
	|	(ВЫБРАТЬ
	|		ДОБАВИТЬКДАТЕ(КОНЕЦПЕРИОДА(МаксимальныеПоказания.ПериодНачисления, МЕСЯЦ), СЕКУНДА, 1) КАК ПериодНачисления,
	|		МаксимальныеПоказания.ЧастныйСектор КАК ЧастныйСектор,
	|		МаксимальныеПоказания.Строение КАК Строение,
	|		МаксимальныеПоказания.Помещение КАК Помещение,
	|		МаксимальныеПоказания.ПриборУчета КАК ПриборУчета,
	|		МаксимальныеПоказания.Шкала КАК Шкала,
	|		МаксимальныеПоказания.ТарифнаяЗона КАК ТарифнаяЗона,
	|		-1 КАК НомерПозиции,
	|		МаксимальныеПоказания.Показания КАК Показания,
	|		МаксимальныеПоказания.ДатаРегистратора КАК ДатаРегистратора,
	|		МаксимальныеПоказания.ДокРегистратор КАК ДокРегистратор
	|	ИЗ
	|		МаксимальныеПоказания КАК МаксимальныеПоказания
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ДОБАВИТЬКДАТЕ(КОНЕЦПЕРИОДА(&ПериодНачисления, МЕСЯЦ), СЕКУНДА, 1),
	|		ДанныеСтроений.ЧастныйСектор,
	|		ДанныеСтроений.Строение,
	|		ДанныеСтроений.Помещение,
	|		энргМаксимальныеПоказанияСрез.ПриборУчета,
	|		энргМаксимальныеПоказанияСрез.Шкала,
	|		энргМаксимальныеПоказанияСрез.ТарифнаяЗона,
	|		-1,
	|		энргМаксимальныеПоказанияСрез.Показания,
	|		энргМаксимальныеПоказанияСрез.ДатаРегистратора,
	|		энргМаксимальныеПоказанияСрез.ДокРегистратор
	|	ИЗ
	|		РегистрСведений.энргМаксимальныеПоказанияСрез КАК энргМаксимальныеПоказанияСрез
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДанныеСтроений КАК ДанныеСтроений
	|			ПО (энргМаксимальныеПоказанияСрез.ЧастныйСектор = энргМаксимальныеПоказанияСрез.ЧастныйСектор)
	|				И (энргМаксимальныеПоказанияСрез.Строение = энргМаксимальныеПоказанияСрез.Строение)
	|				И (энргМаксимальныеПоказанияСрез.Помещение = энргМаксимальныеПоказанияСрез.Помещение)
	|				И (энргМаксимальныеПоказанияСрез.Организация = &Организация)
	|				И (энргМаксимальныеПоказанияСрез.ПериодНачисления = &ПериодНачисления)
	|				И (энргМаксимальныеПоказанияСрез.Район = &Район)) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|		ПО ВложенныйЗапрос.ПериодНачисления = ГраницыОтчетногоПериода.ПериодНачисления"; 
		
	Запрос.Выполнить();
	
КонецПроцедуры

Процедура ПолучитьСтабильныеПериоды(МВТ,ЭтоПерерасчет)  
	
	Текст 							= ТекстПолучитьСтабильныеПериоды(ЭтоПерерасчет);
	Запрос  						= Новый Запрос(Текст);
	Запрос.УстановитьПараметр("НачалоВеденияУчета", Константы.энргДатаНачалаВеденияУчета.Получить());
	Запрос.УстановитьПараметр("КонецПериодаРасчета", Константы.энргДатаНачалаВеденияУчета.Получить());
	Запрос.МенеджерВременныхТаблиц	= МВТ;
	Запрос.Выполнить();
	
КонецПроцедуры

Процедура ПолучитьДанныеДляРасчета(МВТ,РасчетПоФормуле,ЭтоПерерасчет,ИмяДокумента)
	
	Текст 							= ТекстПолучитьДанныеДляРасчета();
	Запрос  						= Новый Запрос(Текст); 	
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Запрос.Выполнить();
	
КонецПроцедуры

Функция РассчитатьИндивидуальныйОбъемПотребления(МВТ); 
	
	Текст  							= ТекстРассчитатьИндивидуальныйОбъемПотребления();
	Запрос  						= Новый Запрос(Текст);
	Запрос.УстановитьПараметр("НеПрименятьЗависимостьЕслиБольшеОднойТочки", Константы.энргНеПрименятьЗависимостьЕслиБольшеОднойТочки.Получить());
	Запрос.МенеджерВременныхТаблиц 	= МВТ;	
	Возврат Запрос.Выполнить();
	
КонецФункции

#КонецОбласти 

#Область ТекстЗапросов

#Область ИндвидуальныеНачисления

Функция ТекстЗапросаВспомогательныеДанныеНачисления(Строение, Помещение)
	Текст  = 
	"ВЫБРАТЬ
	|	&ПериодНачисления КАК ПериодНачисления,
	|	СпособыРасчетаПоНаправлениям.Организация КАК Организация,
	|	СпособыРасчетаПоНаправлениям.Район КАК Район,
	|	СпособыРасчетаПоНаправлениям.Услуга КАК Услуга,
	|	СпособыРасчетаПоНаправлениям.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	СпособыРасчетаПоНаправлениям.ВидПлощади КАК ВидПлощади,
	|	СпособыРасчетаПоНаправлениям.Сезонность КАК Сезонность,
	|	СпособыРасчетаПоНаправлениям.НормативПоДням КАК НормативПоДням,
	|	СпособыРасчетаПоНаправлениям.СпособОпределенияСоциальнойНормы КАК СпособОпределенияСоциальнойНормы
	|ПОМЕСТИТЬ СпособыРасчетаПоНаправлениям
	|ИЗ
	|	РегистрСведений.энргСпособыРасчетаПоНаправлениям.СрезПоследних(
	|			&ПериодНачисления,
	|			Организация = &Организация
	|				И Район = &Район) КАК СпособыРасчетаПоНаправлениям
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&ПериодНачисления КАК ПериодНачисления,
	|	&Организация КАК Организация,
	|	&Район КАК Район,
	|	энргПоставщикиНеНачислятьСрезПоследних.Поставщик КАК Поставщик
	|ПОМЕСТИТЬ ПоставщикиНеНачислять
	|ИЗ
	|	РегистрСведений.энргПоставщикиНеНачислять.СрезПоследних(
	|			&КонецПериодаРасчета,
	|			Организация = &Организация
	|				И Район = &Район) КАК энргПоставщикиНеНачислятьСрезПоследних
	|ГДЕ
	|	энргПоставщикиНеНачислятьСрезПоследних.Использование
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&ПериодНачисления КАК ПериодНачисления,
	|	энгрЗначенияПовышающихКоэффициентовСрезПоследних.Организация КАК Организация,
	|	энгрЗначенияПовышающихКоэффициентовСрезПоследних.Район КАК Район,
	|	энгрЗначенияПовышающихКоэффициентовСрезПоследних.Услуга КАК Услуга,
	|	энгрЗначенияПовышающихКоэффициентовСрезПоследних.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	энгрЗначенияПовышающихКоэффициентовСрезПоследних.Коэффициент КАК Коэффициент
	|ПОМЕСТИТЬ ЗначенияПовышающихКоэффициентов
	|ИЗ
	|	РегистрСведений.энгрЗначенияПовышающихКоэффициентов.СрезПоследних(
	|			&КонецПериодаРасчета,
	|			Организация = &Организация
	|				И Район = &Район) КАК энгрЗначенияПовышающихКоэффициентовСрезПоследних
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&ПериодНачисления КАК ПериодНачисления,
	|	энргЗначенияНормативовПотребленияСрезПоследних.Организация КАК Организация,
	|	энргЗначенияНормативовПотребленияСрезПоследних.Район КАК Район,
	|	энргЗначенияНормативовПотребленияСрезПоследних.КлючНорматива КАК КлючНорматива,
	|	энргЗначенияНормативовПотребленияСрезПоследних.Услуга КАК Услуга,
	|	энргЗначенияНормативовПотребленияСрезПоследних.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	энргЗначенияНормативовПотребленияСрезПоследних.ЗначениеНорматива КАК ЗначениеНорматива
	|ПОМЕСТИТЬ ЗначенияТекущихНормПотребления
	|ИЗ
	|	РегистрСведений.энргЗначенияНормативовПотребления.СрезПоследних(
	|			&КонецПериодаРасчета,
	|			Организация = &Организация
	|				И Район = &Район
	|				И ТипНачисления = ЗНАЧЕНИЕ(Перечисление.энргТипыНачислений.ИндивидуальныеНачисления)) КАК энргЗначенияНормативовПотребленияСрезПоследних
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&ПериодНачисления КАК ПериодНачисления,
	|	энргЗначенияНормативовПотребленияСрезПоследних.Организация КАК Организация,
	|	энргЗначенияНормативовПотребленияСрезПоследних.Район КАК Район,
	|	энргЗначенияНормативовПотребленияСрезПоследних.КлючНорматива КАК КлючНорматива,
	|	энргЗначенияНормативовПотребленияСрезПоследних.Услуга КАК Услуга,
	|	энргЗначенияНормативовПотребленияСрезПоследних.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	энргЗначенияНормативовПотребленияСрезПоследних.ЗначениеНорматива КАК ЗначениеНорматива
	|ПОМЕСТИТЬ ЗначенияТекущихСоциальныхНормПотребления
	|ИЗ
	|	РегистрСведений.энргЗначенияСоциальныхНормативов.СрезПоследних(
	|			&КонецПериодаРасчета,
	|			Организация = &Организация
	|				И Район = &Район
	|				И ТипНачисления = ЗНАЧЕНИЕ(Перечисление.энргТипыНачислений.ИндивидуальныеНачисления)) КАК энргЗначенияНормативовПотребленияСрезПоследних
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&ПериодНачисления КАК ПериодНачисления,
	|	энргЗначенияТарифовСрезПоследних.Организация КАК Организация,
	|	энргЗначенияТарифовСрезПоследних.Район КАК Район,
	|	энргЗначенияТарифовСрезПоследних.ГруппаПотребителей КАК ГруппаПотребителей,
	|	энргЗначенияТарифовСрезПоследних.Услуга КАК Услуга,
	|	энргЗначенияТарифовСрезПоследних.Поставщик КАК Поставщик,
	|	энргЗначенияТарифовСрезПоследних.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргЗначенияТарифовСрезПоследних.Значение КАК Значение,
	|	энргЗначенияТарифовСрезПоследних.ЗначениеСверхНорматива КАК ЗначениеСверхНорматива,
	|	энргЗначенияТарифовСрезПоследних.ЗначениеРЭК КАК ЗначениеТарифаРЭК,
	|	энргЗначенияТарифовСрезПоследних.СтавкаНДС КАК СтавкаНДС,
	|	энргЗначенияТарифовСрезПоследних.НДСВнутри КАК НДСВнутри
	|ПОМЕСТИТЬ ЗначенияТекущихТарифов
	|ИЗ
	|	РегистрСведений.энргЗначенияТарифов.СрезПоследних(
	|			&ПериодНачисления,
	|			Организация = &Организация
	|				И Район = &Район) КАК энргЗначенияТарифовСрезПоследних
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргНастройкаНачисленияГВСМКДСрезПоследних.Организация КАК Организация,
	|	&ПериодНачисления КАК ПериодНачисления,
	|	энргНастройкаНачисленияГВСМКДСрезПоследних.Район КАК Район,
	|	энргНастройкаНачисленияГВСМКДСрезПоследних.МКД КАК Строение,
	|	энргНастройкаНачисленияГВСМКДСрезПоследних.Услуга КАК Услуга,
	|	энргНастройкаНачисленияГВСМКДСрезПоследних.ТипСхемы КАК ТипСхемы,
	|	энргНастройкаНачисленияГВСМКДСрезПоследних.ПринадлежностьКТепловомуПункту КАК ПринадлежностьКТепловомуПункту,
	|	энргНастройкаНачисленияГВСМКДСрезПоследних.НеНачислять КАК НеНачислять
	|ПОМЕСТИТЬ МКДНеНачислятьТЭ
	|ИЗ
	|	РегистрСведений.энргНастройкаНачисленияГВСМКД.СрезПоследних(
	|			&КонецПериодаРасчета,
	|			Организация = &Организация
	|				И Район = &Район
	|				И (МКД = &Строение
	|					ИЛИ МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка))) КАК энргНастройкаНачисленияГВСМКДСрезПоследних
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргТипСхемыГВССрезПоследних.Организация КАК Организация,
	|	&ПериодНачисления КАК ПериодНачисления,
	|	энргТипСхемыГВССрезПоследних.Район КАК Район,
	|	энргТипСхемыГВССрезПоследних.МКД КАК Строение,
	|	энргТипСхемыГВССрезПоследних.ТипСхемы КАК ТипСхемы
	|ПОМЕСТИТЬ ТипСхемыГВС
	|ИЗ
	|	РегистрСведений.энргТипСхемыГВС.СрезПоследних(
	|			&КонецПериодаРасчета,
	|			Организация = &Организация
	|				И Район = &Район
	|				И МКД = &Строение) КАК энргТипСхемыГВССрезПоследних
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргТипПринадлежностиМКДСрезПоследних.Организация КАК Организация,
	|	&ПериодНачисления КАК ПериодНачисления,
	|	энргТипПринадлежностиМКДСрезПоследних.Район КАК Район,
	|	энргТипПринадлежностиМКДСрезПоследних.МКД КАК Строение,
	|	энргТипПринадлежностиМКДСрезПоследних.ВидТепловогоПункта КАК ВидТепловогоПункта
	|ПОМЕСТИТЬ ВидыТепловыхПунктов
	|ИЗ
	|	РегистрСведений.энргТипПринадлежностиМКД.СрезПоследних(
	|			&КонецПериодаРасчета,
	|			Организация = &Организация
	|				И Район = &Район
	|				И МКД = &Строение) КАК энргТипПринадлежностиМКДСрезПоследних
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НастройкаСезонностиУслуг.Организация КАК Организация,
	|	&ПериодНачисления КАК ПериодНачисления,
	|	НастройкаСезонностиУслуг.Район КАК Район,
	|	НастройкаСезонностиУслуг.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	НастройкаСезонностиУслуг.МКД КАК МКД,
	|	НастройкаСезонностиУслуг.Услуга КАК Услуга,
	|	НастройкаСезонностиУслуг.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	НастройкаСезонностиУслуг.Коэффициент КАК КоэффициентНорматива,
	|	НастройкаСезонностиУслуг.КоэффициентНеПрименятьСезонность КАК КоэффициентНеПрименятьСезонность,
	|	НастройкаСезонностиУслуг.КорректироватьГодовойОбъем КАК КорректироватьГодовойОбъем,
	|	НастройкаСезонностиУслуг.ОбъемЗаПрошлыйГод КАК ОбъемЗаПрошлыйГод
	|ПОМЕСТИТЬ НастройкаСезонностиУслуг
	|ИЗ
	|	РегистрСведений.энргНастройкаСезонностиУслуг.СрезПоследних(
	|			&КонецПериодаРасчета,
	|			Организация = &Организация
	|				И Район = &Район
	|				И (МКД = &Строение
	|					ИЛИ МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка))) КАК НастройкаСезонностиУслуг
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргНормаСкоростиДвиженияВодыСрезПоследних.Организация КАК Организация,
	|	&ПериодНачисления КАК ПериодНачисления,
	|	энргНормаСкоростиДвиженияВодыСрезПоследних.СкоростьДвижения КАК СкоростьДвижения
	|ПОМЕСТИТЬ НормаСкоростиДвиженияВоды
	|ИЗ
	|	РегистрСведений.энргНормаСкоростиДвиженияВоды.СрезПоследних(&КонецПериодаРасчета, Организация = &Организация) КАК энргНормаСкоростиДвиженияВодыСрезПоследних
	|;
	|
	|//////////////////////////////////////////////////////////////////////////////// 	
	|ВЫБРАТЬ
	|	ВложенныйЗАпрос.Организация КАК Организация,
	|	&ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗАпрос.Сезонность КАК Сезонность,
	|	ВложенныйЗАпрос.Район КАК Район,
	|	ВложенныйЗАпрос.НачалоСезонности КАК НачалоСезонности,
	|	ВложенныйЗАпрос.КонецСезонности КАК КонецСезонности
	|ПОМЕСТИТЬ ПериодыСезонности	
	|ИЗ
	|	(ВЫБРАТЬ
	|		энргДлительностиПериодов.Организация КАК Организация,
	|		энргДлительностиПериодов.Сезонность КАК Сезонность,
	|		энргДлительностиПериодов.Район КАК Район,
	|		ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(ДАТАВРЕМЯ(1, 1, 1), ГОД, ГОД(&НачалоПериодаРасчета) - ВЫБОР
	|						КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(энргДлительностиПериодов.КонецПериода)
	|								И МЕСЯЦ(энргДлительностиПериодов.КонецПериода) < МЕСЯЦ(&ПериодНачисления)
	|								И МЕСЯЦ(&ПериодНачисления) <= МЕСЯЦ(энргДлительностиПериодов.НачалоПериода)
	|							ТОГДА 1
	|						КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(энргДлительностиПериодов.КонецПериода)
	|								И МЕСЯЦ(&ПериодНачисления) <= МЕСЯЦ(энргДлительностиПериодов.КонецПериода)
	|							ТОГДА 2
	|						КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(энргДлительностиПериодов.КонецПериода)
	|								И МЕСЯЦ(&ПериодНачисления) > МЕСЯЦ(энргДлительностиПериодов.НачалоПериода)
	|							ТОГДА 1
	|						КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(энргДлительностиПериодов.НачалоПериода)
	|							ТОГДА 2
	|						ИНАЧЕ 1
	|					КОНЕЦ), МЕСЯЦ, МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) - 1), ДЕНЬ, ДЕНЬ(энргДлительностиПериодов.НачалоПериода) - 1) КАК НачалоСезонности,
	|		ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(ДАТАВРЕМЯ(1, 1, 1), ГОД, ГОД(&НачалоПериодаРасчета) - ВЫБОР
	|						КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(энргДлительностиПериодов.КонецПериода)
	|								И МЕСЯЦ(энргДлительностиПериодов.КонецПериода) < МЕСЯЦ(&ПериодНачисления)
	|								И МЕСЯЦ(&ПериодНачисления) <= МЕСЯЦ(энргДлительностиПериодов.НачалоПериода)
	|							ТОГДА 0
	|						КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(энргДлительностиПериодов.КонецПериода)
	|								И МЕСЯЦ(&ПериодНачисления) <= МЕСЯЦ(энргДлительностиПериодов.КонецПериода)
	|							ТОГДА 1
	|						КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(энргДлительностиПериодов.КонецПериода)
	|								И МЕСЯЦ(&ПериодНачисления) > МЕСЯЦ(энргДлительностиПериодов.НачалоПериода)
	|							ТОГДА 0
	|						КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(энргДлительностиПериодов.НачалоПериода)
	|							ТОГДА 1
	|						ИНАЧЕ 1
	|					КОНЕЦ), МЕСЯЦ, МЕСЯЦ(энргДлительностиПериодов.КонецПериода) - 1), ДЕНЬ, ДЕНЬ(энргДлительностиПериодов.КонецПериода)) КАК КонецСезонности
	|	ИЗ
	|		РегистрСведений.энргДлительностиПериодов.СрезПоследних(
	|				&НачалоПериодаРасчета,
	|				Организация = &Организация
	|					И Район = &Район) КАК энргДлительностиПериодов) КАК ВложенныйЗапрос	
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПериодыСезонности.Организация КАК Организация,
	|	ПериодыСезонности.ПериодНачисления КАК ПериодНачисления,
	|	ПериодыСезонности.Район КАК Район,
	|	ПериодыСезонности.Сезонность КАК Сезонность,	
	|	ПериодыСезонности.НачалоСезонности КАК Период,
	|	1 КАК КоэфициентСезонности
	|ПОМЕСТИТЬ ПериодыИзмененияСезонности
	|ИЗ
	|	ПериодыСезонности КАК ПериодыСезонности
	|ГДЕ
	|	ПериодыСезонности.НачалоСезонности > &НачалоПериодаРасчета
	|	И ПериодыСезонности.НачалоСезонности < &КонецПериодаРасчета
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ПериодыСезонности.Организация,
	|	ПериодыСезонности.ПериодНачисления КАК ПериодНачисления,
	|	ПериодыСезонности.Район,
	|	ПериодыСезонности.Сезонность,	
	|	ПериодыСезонности.КонецСезонности,
	|	0
	|ИЗ
	|	ПериодыСезонности КАК ПериодыСезонности
	|ГДЕ
	|	ПериодыСезонности.КонецСезонности > &НачалоПериодаРасчета
	|	И ПериодыСезонности.КонецСезонности < &КонецПериодаРасчета
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргЗначенияТарифов.Организация КАК Организация,
	|	&ПериодНачисления КАК ПериодНачисления,
	|	энргЗначенияТарифов.Район КАК Район,
	|	энргЗначенияТарифов.ГруппаПотребителей КАК ГруппаПотребителей,
	|	энргЗначенияТарифов.Услуга КАК Услуга,
	|	энргЗначенияТарифов.Поставщик КАК Поставщик,
	|	энргЗначенияТарифов.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргЗначенияТарифовСрезПоследних.Значение КАК ЗначениеТарифа,
	|	энргЗначенияТарифовСрезПоследних.ЗначениеСверхНорматива КАК ЗначениеСверхНорматива,
	|	энргЗначенияТарифовСрезПоследних.ЗначениеРЭК КАК ЗначениеТарифаРЭК,
	|	энргЗначенияТарифов.Регистратор КАК Регистратор,
	|	ДОБАВИТЬКДАТЕ(энргЗначенияТарифов.Период, ДЕНЬ, &ПериодНовогоТарифа - 1) КАК ДатаСменыТарифа
	|ПОМЕСТИТЬ ЗначенияТарифов
	|ИЗ
	|	РегистрСведений.энргЗначенияТарифов КАК энргЗначенияТарифов
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначенияТарифов.СрезПоследних(
	|				&НачалоПериодаРасчета,
	|				Организация = &Организация
	|					И Район = &Район) КАК энргЗначенияТарифовСрезПоследних
	|		ПО энргЗначенияТарифов.ГруппаПотребителей = энргЗначенияТарифовСрезПоследних.ГруппаПотребителей
	|			И энргЗначенияТарифов.Услуга = энргЗначенияТарифовСрезПоследних.Услуга
	|			И энргЗначенияТарифов.Поставщик = энргЗначенияТарифовСрезПоследних.Поставщик
	|			И энргЗначенияТарифов.ТарифнаяЗона = энргЗначенияТарифовСрезПоследних.ТарифнаяЗона
	|			И (энргЗначенияТарифов.Период МЕЖДУ &НачалоПериодаРасчета И ДОБАВИТЬКДАТЕ(&КонецПериодаРасчета, ДЕНЬ, -1))
	|		И &ПериодНовогоТарифа > 0
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргДокументыНачислений.Организация КАК Организация,
	|	энргДокументыНачислений.ПериодНачисления КАК ПериодНачисления,
	|	энргДокументыНачислений.Район КАК Район,
	|	энргДокументыНачислений.МКД КАК МКД,
	|	энргДокументыНачислений.ДокументНачисления КАК ДокументНачисления,
	|	энргДокументыНачислений.ПометкаУдаления КАК ПометкаУдаления
	|ПОМЕСТИТЬ ДокументыНачислений
	|ИЗ
	|	РегистрСведений.энргДокументыНачислений КАК энргДокументыНачислений
	|ГДЕ
	|	энргДокументыНачислений.Организация = &Организация
	|	И энргДокументыНачислений.ПериодНачисления = &ПериодНачисления
	|	И энргДокументыНачислений.Район = &Район
	|	И энргДокументыНачислений.МКД = &Строение
	|	И энргДокументыНачислений.ВидОперацийНачисления = ЗНАЧЕНИЕ(Перечисление.энргВидыОперацийНачисления.Индивидуальные)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргСреднийОбъемПотребленияАбонентов.Организация КАК Организация,
	|	энргСреднийОбъемПотребленияАбонентов.ПериодНачисления КАК ПериодНачисления,
	|	энргСреднийОбъемПотребленияАбонентов.Район КАК Район,
	|	энргСреднийОбъемПотребленияАбонентов.ЧастныйСектор КАК ЧастныйСектор,
	|	энргСреднийОбъемПотребленияАбонентов.Строение КАК Строение,
	|	энргСреднийОбъемПотребленияАбонентов.Помещение КАК Помещение,
	|	энргСреднийОбъемПотребленияАбонентов.ТочкаУчета КАК ТочкаУчета,
	|	энргСреднийОбъемПотребленияАбонентов.Услуга КАК Услуга,
	|	энргСреднийОбъемПотребленияАбонентов.Шкала КАК Шкала,
	|	энргСреднийОбъемПотребленияАбонентов.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргСреднийОбъемПотребленияАбонентов.Объем КАК СреднийОбъем,
	|	энргСреднийОбъемПотребленияАбонентов.ОбъемПотребленный КАК СреднийОбъемПотребленный
	|ПОМЕСТИТЬ СреднееПотреблениеАбонентов
	|ИЗ
	|	РегистрСведений.энргСреднийОбъемПотребленияАбонентов КАК энргСреднийОбъемПотребленияАбонентов
	|ГДЕ
	|	энргСреднийОбъемПотребленияАбонентов.Организация = &Организация
	|	И энргСреднийОбъемПотребленияАбонентов.ПериодНачисления = &ПериодНачисления
	|	И энргСреднийОбъемПотребленияАбонентов.Район = &Район
	|	И энргСреднийОбъемПотребленияАбонентов.ЧастныйСектор = &ЧастныйСектор
	|	И энргСреднийОбъемПотребленияАбонентов.Строение = &Строение
	|	И энргСреднийОбъемПотребленияАбонентов.Помещение = &Помещение
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргСтабильныеПериодыШкалы.Организация КАК Организация,
	|	энргСтабильныеПериодыШкалы.ПериодНачисления КАК ПериодНачисления,
	|	энргСтабильныеПериодыШкалы.Район КАК Район,
	|	энргСтабильныеПериодыШкалы.ЧастныйСектор КАК ЧастныйСектор,
	|	энргСтабильныеПериодыШкалы.Строение КАК Строение,
	|	энргСтабильныеПериодыШкалы.Помещение КАК Помещение,
	|	энргСтабильныеПериодыШкалы.ТочкаУчета КАК ТочкаУчета,
	|	энргСтабильныеПериодыШкалы.Шкала КАК Шкала,
	|	энргСтабильныеПериодыШкалы.НомерПозиции КАК НомерПозиции,
	|	энргСтабильныеПериодыШкалы.ВидДифференцированности КАК ВидДифференцированности
	|ПОМЕСТИТЬ СтабильныеПериодыШкалы
	|ИЗ
	|	РегистрСведений.энргСтабильныеПериодыШкалы КАК энргСтабильныеПериодыШкалы
	|ГДЕ
	|	энргСтабильныеПериодыШкалы.Организация = &Организация
	|	И энргСтабильныеПериодыШкалы.ПериодНачисления = &ПериодНачисления
	|	И энргСтабильныеПериодыШкалы.Район = &Район
	|	И энргСтабильныеПериодыШкалы.ЧастныйСектор = &ЧастныйСектор
	|	И энргСтабильныеПериодыШкалы.Строение = &Строение
	|	И энргСтабильныеПериодыШкалы.Помещение = &Помещение
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргСтабильныеПериодыИзмерителиНаправлений.Организация КАК Организация,
	|	энргСтабильныеПериодыИзмерителиНаправлений.ПериодНачисления КАК ПериодНачисления,
	|	энргСтабильныеПериодыИзмерителиНаправлений.Район КАК Район,
	|	энргСтабильныеПериодыИзмерителиНаправлений.ЧастныйСектор КАК ЧастныйСектор,
	|	энргСтабильныеПериодыИзмерителиНаправлений.Строение КАК Строение,
	|	энргСтабильныеПериодыИзмерителиНаправлений.Помещение КАК Помещение,
	|	энргСтабильныеПериодыИзмерителиНаправлений.Услуга КАК Услуга,
	|	энргСтабильныеПериодыИзмерителиНаправлений.ТочкаУчета КАК ТочкаУчета,
	|	энргСтабильныеПериодыИзмерителиНаправлений.НомерПозиции КАК НомерПозиции,
	|	энргСтабильныеПериодыИзмерителиНаправлений.Измеритель КАК Измеритель,
	|	энргСтабильныеПериодыИзмерителиНаправлений.Количество КАК Количество,
	|	энргСтабильныеПериодыИзмерителиНаправлений.КлючНорматива КАК КлючНорматива
	|ПОМЕСТИТЬ СтабильныеПериодыИзмерителиНаправлений
	|ИЗ
	|	РегистрСведений.энргСтабильныеПериодыИзмерителиНаправлений КАК энргСтабильныеПериодыИзмерителиНаправлений
	|ГДЕ
	|	энргСтабильныеПериодыИзмерителиНаправлений.Организация = &Организация
	|	И энргСтабильныеПериодыИзмерителиНаправлений.ПериодНачисления = &ПериодНачисления
	|	И энргСтабильныеПериодыИзмерителиНаправлений.Район = &Район
	|	И энргСтабильныеПериодыИзмерителиНаправлений.ЧастныйСектор = &ЧастныйСектор
	|	И энргСтабильныеПериодыИзмерителиНаправлений.Строение = &Строение
	|	И энргСтабильныеПериодыИзмерителиНаправлений.Помещение = &Помещение
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.ЧастныйСектор КАК ЧастныйСектор,
	|	ВложенныйЗапрос.Строение КАК Строение,
	|	ВложенныйЗапрос.Помещение КАК Помещение,
	|	ВложенныйЗапрос.ПриборУчета КАК ПриборУчета,
	|	ВложенныйЗапрос.Шкала КАК Шкала,
	|	ВложенныйЗапрос.ТарифнаяЗона КАК ТарифнаяЗона,
	|	ВложенныйЗапрос.Показания КАК Показания,
	|	ВложенныйЗапрос.ДокРегистратор КАК ДокРегистратор,
	|	ВложенныйЗапрос.ДатаРегистратора КАК ДатаРегистратора,
	|	ВложенныйЗапрос.Период КАК Период,
	|	ВложенныйЗапрос.КонецПериодаРасчета КАК КонецПериодаРасчета,
	|	ВложенныйЗапрос.Приоритет КАК Приоритет
	|ПОМЕСТИТЬ МаксимальныеПоказанияСрезНабор
	|ИЗ
	|	(ВЫБРАТЬ
	|		энргМаксимальныеПоказанияСрез.Организация КАК Организация,
	|		&ПериодНачисления КАК ПериодНачисления,
	|		энргМаксимальныеПоказанияСрез.Район КАК Район,
	|		энргМаксимальныеПоказанияСрез.ЧастныйСектор КАК ЧастныйСектор,
	|		энргМаксимальныеПоказанияСрез.Строение КАК Строение,
	|		энргМаксимальныеПоказанияСрез.Помещение КАК Помещение,
	|		энргМаксимальныеПоказанияСрез.ПриборУчета КАК ПриборУчета,
	|		энргМаксимальныеПоказанияСрез.Шкала КАК Шкала,
	|		энргМаксимальныеПоказанияСрез.ТарифнаяЗона КАК ТарифнаяЗона,
	|		энргМаксимальныеПоказанияСрез.Показания КАК Показания,
	|		энргМаксимальныеПоказанияСрез.ДокРегистратор КАК ДокРегистратор,
	|		энргМаксимальныеПоказанияСрез.ДатаРегистратора КАК ДатаРегистратора,
	|		&НачалоПериодаРасчета КАК Период,
	|		&КонецПериодаРасчета КАК КонецПериодаРасчета,
	|		0 КАК Приоритет
	|	ИЗ
	|		РегистрСведений.энргМаксимальныеПоказанияСрез КАК энргМаксимальныеПоказанияСрез
	|	ГДЕ
	|		энргМаксимальныеПоказанияСрез.Организация = &Организация
	|		И энргМаксимальныеПоказанияСрез.ПериодНачисления = НАЧАЛОПЕРИОДА(ДОБАВИТЬКДАТЕ(&ПериодНачисления, СЕКУНДА, -1), МЕСЯЦ)
	|		И энргМаксимальныеПоказанияСрез.Район = &Район
	|		И энргМаксимальныеПоказанияСрез.ЧастныйСектор = &ЧастныйСектор
	|		И энргМаксимальныеПоказанияСрез.Строение = &Строение
	|		И энргМаксимальныеПоказанияСрез.Помещение = &Помещение
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		энргПредоставленныеПоказания.Организация,
	|		&ПериодНачисления,
	|		энргПредоставленныеПоказания.Район,
	|		энргПредоставленныеПоказания.ЧастныйСектор,
	|		энргПредоставленныеПоказания.Строение,
	|		энргПредоставленныеПоказания.Помещение,
	|		энргПредоставленныеПоказания.ПриборУчета,
	|		энргПредоставленныеПоказания.Шкала,
	|		энргПредоставленныеПоказания.ТарифнаяЗона,
	|		энргПредоставленныеПоказания.Показания,
	|		энргПредоставленныеПоказания.ДокРегистратор,
	|		энргПредоставленныеПоказания.ДатаРегистратора,
	|		&НачалоПериодаРасчета,
	|		&КонецПериодаРасчета,
	|		1
	|	ИЗ
	|		РегистрСведений.энргПредоставленныеПоказания КАК энргПредоставленныеПоказания
	|	ГДЕ
	|		энргПредоставленныеПоказания.Организация = &Организация
	|		И энргПредоставленныеПоказания.ПериодНачисления = &ПериодНачисления
	|		И энргПредоставленныеПоказания.Район = &Район
	|		И энргПредоставленныеПоказания.ЧастныйСектор = &ЧастныйСектор
	|		И энргПредоставленныеПоказания.Строение = &Строение
	|		И энргПредоставленныеПоказания.Помещение = &Помещение
	|		И энргПредоставленныеПоказания.НомерПозиции = -1) КАК ВложенныйЗапрос
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	МаксимальныеПоказанияСрезНабор.Организация КАК Организация,
	|	МаксимальныеПоказанияСрезНабор.ПериодНачисления КАК ПериодНачисления,
	|	МаксимальныеПоказанияСрезНабор.Район КАК Район,
	|	МаксимальныеПоказанияСрезНабор.ЧастныйСектор КАК ЧастныйСектор,
	|	МаксимальныеПоказанияСрезНабор.Строение КАК Строение,
	|	МаксимальныеПоказанияСрезНабор.Помещение КАК Помещение,
	|	МаксимальныеПоказанияСрезНабор.ПриборУчета КАК ПриборУчета,
	|	МаксимальныеПоказанияСрезНабор.Шкала КАК Шкала,
	|	МаксимальныеПоказанияСрезНабор.ТарифнаяЗона КАК ТарифнаяЗона,
	|	МаксимальныеПоказанияСрезНабор.Показания КАК Показания,
	|	МаксимальныеПоказанияСрезНабор.ДокРегистратор КАК ДокРегистратор,
	|	МаксимальныеПоказанияСрезНабор.ДатаРегистратора КАК ДатаРегистратора,
	|	МаксимальныеПоказанияСрезНабор.Период КАК Период,
	|	МаксимальныеПоказанияСрезНабор.КонецПериодаРасчета КАК КонецПериодаРасчета,
	|	МаксимальныеПоказанияСрезНабор.Приоритет КАК Приоритет
	|ПОМЕСТИТЬ МаксимальныеПоказанияСрез
	|ИЗ
	|	МаксимальныеПоказанияСрезНабор КАК МаксимальныеПоказанияСрезНабор
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	|			МаксимальныеПоказанияСрезНабор.Организация КАК Организация,
	|			МаксимальныеПоказанияСрезНабор.ПериодНачисления КАК ПериодНачисления,
	|			МаксимальныеПоказанияСрезНабор.Район КАК Район,
	|			МаксимальныеПоказанияСрезНабор.ЧастныйСектор КАК ЧастныйСектор,
	|			МаксимальныеПоказанияСрезНабор.Строение КАК Строение,
	|			МаксимальныеПоказанияСрезНабор.Помещение КАК Помещение,
	|			МаксимальныеПоказанияСрезНабор.ПриборУчета КАК ПриборУчета,
	|			МаксимальныеПоказанияСрезНабор.Шкала КАК Шкала,
	|			МаксимальныеПоказанияСрезНабор.ТарифнаяЗона КАК ТарифнаяЗона,
	|			МАКСИМУМ(МаксимальныеПоказанияСрезНабор.Приоритет) КАК Приоритет
	|		ИЗ
	|			МаксимальныеПоказанияСрезНабор КАК МаксимальныеПоказанияСрезНабор
	|		
	|		СГРУППИРОВАТЬ ПО
	|			МаксимальныеПоказанияСрезНабор.Организация,
	|			МаксимальныеПоказанияСрезНабор.ПериодНачисления,
	|			МаксимальныеПоказанияСрезНабор.Район,
	|			МаксимальныеПоказанияСрезНабор.ЧастныйСектор,
	|			МаксимальныеПоказанияСрезНабор.Строение,
	|			МаксимальныеПоказанияСрезНабор.Помещение,
	|			МаксимальныеПоказанияСрезНабор.ПриборУчета,
	|			МаксимальныеПоказанияСрезНабор.Шкала,
	|			МаксимальныеПоказанияСрезНабор.ТарифнаяЗона) КАК МаксимальныйПриоритетПоказаний
	|		ПО МаксимальныеПоказанияСрезНабор.Организация = МаксимальныйПриоритетПоказаний.Организация
	|			И МаксимальныеПоказанияСрезНабор.Организация = МаксимальныйПриоритетПоказаний.Организация
	|			И МаксимальныеПоказанияСрезНабор.ПериодНачисления = МаксимальныйПриоритетПоказаний.ПериодНачисления
	|			И МаксимальныеПоказанияСрезНабор.Район = МаксимальныйПриоритетПоказаний.Район
	|			И МаксимальныеПоказанияСрезНабор.ЧастныйСектор = МаксимальныйПриоритетПоказаний.ЧастныйСектор
	|			И МаксимальныеПоказанияСрезНабор.Строение = МаксимальныйПриоритетПоказаний.Строение
	|			И МаксимальныеПоказанияСрезНабор.Помещение = МаксимальныйПриоритетПоказаний.Помещение
	|			И МаксимальныеПоказанияСрезНабор.ПриборУчета = МаксимальныйПриоритетПоказаний.ПриборУчета
	|			И МаксимальныеПоказанияСрезНабор.Шкала = МаксимальныйПриоритетПоказаний.Шкала
	|			И МаксимальныеПоказанияСрезНабор.ТарифнаяЗона = МаксимальныйПриоритетПоказаний.ТарифнаяЗона
	|			И МаксимальныеПоказанияСрезНабор.Приоритет = МаксимальныйПриоритетПоказаний.Приоритет
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргМаксимальныеПоказанияСрез.Организация КАК Организация,
	|	энргМаксимальныеПоказанияСрез.ПериодНачисления КАК ПериодНачисления,
	|	энргМаксимальныеПоказанияСрез.Район КАК Район,
	|	энргМаксимальныеПоказанияСрез.ЧастныйСектор КАК ЧастныйСектор,
	|	энргМаксимальныеПоказанияСрез.Строение КАК Строение,
	|	энргМаксимальныеПоказанияСрез.Помещение КАК Помещение,
	|	энргМаксимальныеПоказанияСрез.ПриборУчета КАК ПриборУчета,
	|	энргМаксимальныеПоказанияСрез.Шкала КАК Шкала,
	|	энргМаксимальныеПоказанияСрез.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргМаксимальныеПоказанияСрез.Показания КАК Показания
	|ПОМЕСТИТЬ МаксимальныеПоказания
	|ИЗ
	|	РегистрСведений.энргМаксимальныеПоказанияСрез КАК энргМаксимальныеПоказанияСрез
	|ГДЕ
	|	энргМаксимальныеПоказанияСрез.Организация = &Организация
	|	И энргМаксимальныеПоказанияСрез.ПериодНачисления = &ПериодНачисления
	|	И энргМаксимальныеПоказанияСрез.Район = &Район
	|	И энргМаксимальныеПоказанияСрез.ЧастныйСектор = &ЧастныйСектор
	|	И энргМаксимальныеПоказанияСрез.Строение = &Строение
	|	И энргМаксимальныеПоказанияСрез.Помещение = &Помещение
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргПредоставленныеПоказания.Организация КАК Организация,
	|	энргПредоставленныеПоказания.ПериодНачисления КАК ПериодНачисления,
	|	энргПредоставленныеПоказания.Район КАК Район,
	|	энргПредоставленныеПоказания.ЧастныйСектор КАК ЧастныйСектор,
	|	энргПредоставленныеПоказания.Строение КАК Строение,
	|	энргПредоставленныеПоказания.Помещение КАК Помещение,
	|	энргПредоставленныеПоказания.ПриборУчета КАК ПриборУчета,
	|	энргПредоставленныеПоказания.Шкала КАК Шкала,
	|	энргПредоставленныеПоказания.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргПредоставленныеПоказания.НомерПозиции КАК НомерПозиции,
	|	энргПредоставленныеПоказания.ДатаРегистратора КАК ДатаРегистратора,
	|	энргПредоставленныеПоказания.ДокРегистратор КАК ДокРегистратор,
	|	энргПредоставленныеПоказания.Показания КАК Показания,
	|	энргПредоставленныеПоказания.ПоказанияТекущегоПериода КАК ПоказанияТекущегоПериода,
	|	энргПредоставленныеПоказания.ВСрок КАК ВСрок,
	|	&КонецПериодаРасчета КАК КонецПериодаРасчета
	|ПОМЕСТИТЬ ПредоставленныеПоказания
	|ИЗ
	|	РегистрСведений.энргПредоставленныеПоказания КАК энргПредоставленныеПоказания
	|ГДЕ
	|	энргПредоставленныеПоказания.Организация = &Организация
	|	И энргПредоставленныеПоказания.ПериодНачисления = &ПериодНачисления
	|	И энргПредоставленныеПоказания.Район = &Район
	|	И энргПредоставленныеПоказания.ЧастныйСектор = &ЧастныйСектор
	|	И энргПредоставленныеПоказания.Строение = &Строение
	|	И энргПредоставленныеПоказания.Помещение = &Помещение
	|	И энргПредоставленныеПоказания.НомерПозиции >= 0
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	энргВыводПриборовУчета.Организация КАК Организация,
	|	энргВыводПриборовУчета.ПериодНачисления КАК ПериодНачисления,
	|	энргВыводПриборовУчета.Район КАК Район,
	|	энргКлючиПомещений.ЧастныйСектор КАК ЧастныйСектор,
	|	энргКлючиПомещений.Строение КАК Строение,
	|	энргКлючиПомещений.Помещение КАК Помещение,
	|	энргВыводПриборовУчета.ТочкаУчета КАК ТочкаУчета,
	|	энргВыводПриборовУчета.ПриборУчета КАК ПриборУчета
	|ПОМЕСТИТЬ ДанныеВыводаПрибораУчета
	|ИЗ
	|	РегистрСведений.энргВыводПриборовУчета КАК энргВыводПриборовУчета
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргКлючиПомещений КАК энргКлючиПомещений
	|		ПО энргВыводПриборовУчета.КлючПомещения = энргКлючиПомещений.КлючПомещения
	|			И (энргВыводПриборовУчета.Организация = &Организация)
	|			И (энргВыводПриборовУчета.ПериодНачисления = &ПериодНачисления)
	|			И (энргВыводПриборовУчета.Район = &Район)
	|			И (энргКлючиПомещений.Строение = &Строение)
	|			И (энргКлючиПомещений.Помещение = &Помещение)
	|			И (энргКлючиПомещений.ЧастныйСектор = &ЧастныйСектор)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргСтабильныеПериодыМКД.Организация КАК Организация,
	|	энргСтабильныеПериодыМКД.ПериодНачисления КАК ПериодНачисления,
	|	энргСтабильныеПериодыМКД.Район КАК Район,
	|	энргСтабильныеПериодыМКД.МКД КАК МКД,
	|	энргСтабильныеПериодыМКД.Услуга КАК Услуга,
	|	МАКСИМУМ(энргСтабильныеПериодыМКД.ЗначениеПлощади) КАК ПлощадьМОП
	|ПОМЕСТИТЬ ЗначениеПлощадейМКД
	|ИЗ
	|	(ВЫБРАТЬ
	|		энргСтабильныеПериодыМКД.Организация КАК Организация,
	|		энргСтабильныеПериодыМКД.ПериодНачисления КАК ПериодНачисления,
	|		энргСтабильныеПериодыМКД.Район КАК Район,
	|		энргСтабильныеПериодыМКД.МКД КАК МКД,
	|		энргСтабильныеПериодыМКД.Услуга КАК Услуга,
	|		энргСтабильныеПериодыМКД.ТочкаУчета КАК ТочкаУчета,
	|		МАКСИМУМ(энргСтабильныеПериодыМКД.НомерПозиции) КАК НомерПозиции
	|	ИЗ
	|		РегистрСведений.энргСтабильныеПериодыМКД КАК энргСтабильныеПериодыМКД
	|	ГДЕ
	|		энргСтабильныеПериодыМКД.Организация = &Организация
	|		И энргСтабильныеПериодыМКД.ПериодНачисления = &ПериодНачисления
	|		И энргСтабильныеПериодыМКД.Район = &Район
	|		И энргСтабильныеПериодыМКД.МКД = &МКД
	|	
	|	СГРУППИРОВАТЬ ПО
	|		энргСтабильныеПериодыМКД.Организация,
	|		энргСтабильныеПериодыМКД.ПериодНачисления,
	|		энргСтабильныеПериодыМКД.Район,
	|		энргСтабильныеПериодыМКД.МКД,
	|		энргСтабильныеПериодыМКД.Услуга,
	|		энргСтабильныеПериодыМКД.ТочкаУчета) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргСтабильныеПериодыМКД КАК энргСтабильныеПериодыМКД
	|		ПО ВложенныйЗапрос.Организация = энргСтабильныеПериодыМКД.Организация
	|			И ВложенныйЗапрос.ПериодНачисления = энргСтабильныеПериодыМКД.ПериодНачисления
	|			И ВложенныйЗапрос.Район = энргСтабильныеПериодыМКД.Район
	|			И ВложенныйЗапрос.МКД = энргСтабильныеПериодыМКД.МКД
	|			И ВложенныйЗапрос.Услуга = энргСтабильныеПериодыМКД.Услуга
	|			И ВложенныйЗапрос.ТочкаУчета = энргСтабильныеПериодыМКД.ТочкаУчета
	|			И ВложенныйЗапрос.НомерПозиции = энргСтабильныеПериодыМКД.НомерПозиции
	|			И (энргСтабильныеПериодыМКД.Организация = &Организация)
	|			И (энргСтабильныеПериодыМКД.ПериодНачисления = &ПериодНачисления)
	|			И (энргСтабильныеПериодыМКД.Район = &Район)
	|			И (энргСтабильныеПериодыМКД.МКД = &МКД)
	|
	|СГРУППИРОВАТЬ ПО
	|	энргСтабильныеПериодыМКД.Организация,
	|	энргСтабильныеПериодыМКД.ПериодНачисления,
	|	энргСтабильныеПериодыМКД.Район,
	|	энргСтабильныеПериодыМКД.МКД,
	|	энргСтабильныеПериодыМКД.Услуга
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.ЧастныйСектор КАК ЧастныйСектор,
	|	ВложенныйЗапрос.Строение КАК Строение,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	СУММА(ВложенныйЗапрос.ПлощадьАбонента) КАК ПлощадьАбонентов,
	|	СУММА(ВложенныйЗапрос.ПлощадьСобственнаяПоставка) КАК ПлощадьСобственнаяПоставка
	|ПОМЕСТИТЬ ЗначениеИндивидуальныхПлощадей
	|ИЗ
	|	(ВЫБРАТЬ
	|		энргСтабильныеПериоды.Организация КАК Организация,
	|		энргСтабильныеПериоды.ПериодНачисления КАК ПериодНачисления,
	|		энргСтабильныеПериоды.Район КАК Район,
	|		энргСтабильныеПериоды.ЧастныйСектор КАК ЧастныйСектор,
	|		энргСтабильныеПериоды.Строение КАК Строение,
	|		энргСтабильныеПериоды.Помещение КАК Помещение,
	|		энргСтабильныеПериоды.Услуга КАК Услуга,
	|		МАКСИМУМ(энргСтабильныеПериоды.ЗначениеПлощади) КАК ПлощадьАбонента,
	|		МАКСИМУМ(ВЫБОР
	|				КОГДА энргСтабильныеПериоды.Поставщик = энргСтабильныеПериоды.Абонент.ФизЛицо
	|					ТОГДА энргСтабильныеПериоды.ЗначениеПлощади
	|				ИНАЧЕ 0
	|			КОНЕЦ) КАК ПлощадьСобственнаяПоставка
	|	ИЗ
	|		(ВЫБРАТЬ
	|			энргСтабильныеПериоды.Организация КАК Организация,
	|			энргСтабильныеПериоды.ПериодНачисления КАК ПериодНачисления,
	|			энргСтабильныеПериоды.Район КАК Район,
	|			энргСтабильныеПериоды.ЧастныйСектор КАК ЧастныйСектор,
	|			энргСтабильныеПериоды.Строение КАК Строение,
	|			энргСтабильныеПериоды.Помещение КАК Помещение,
	|			энргСтабильныеПериоды.Услуга КАК Услуга,
	|			энргСтабильныеПериоды.ТочкаУчета КАК ТочкаУчета,
	|			МАКСИМУМ(энргСтабильныеПериоды.НомерПозиции) КАК НомерПозиции
	|		ИЗ
	|			РегистрСведений.энргСтабильныеПериоды КАК энргСтабильныеПериоды
	|		ГДЕ
	|			энргСтабильныеПериоды.Организация = &Организация
	|			И энргСтабильныеПериоды.ПериодНачисления = &ПериодНачисления
	|			И энргСтабильныеПериоды.Район = &Район
	|			И НЕ энргСтабильныеПериоды.ЧастныйСектор
	|			И энргСтабильныеПериоды.Строение = &МКД
	|			И энргСтабильныеПериоды.Помещение.Родитель = ЗНАЧЕНИЕ(Справочник.энргПомещения.ПустаяСсылка)
	|		
	|		СГРУППИРОВАТЬ ПО
	|			энргСтабильныеПериоды.Организация,
	|			энргСтабильныеПериоды.ПериодНачисления,
	|			энргСтабильныеПериоды.Район,
	|			энргСтабильныеПериоды.ЧастныйСектор,
	|			энргСтабильныеПериоды.Строение,
	|			энргСтабильныеПериоды.Помещение,
	|			энргСтабильныеПериоды.Услуга,
	|			энргСтабильныеПериоды.ТочкаУчета) КАК ВложенныйЗапрос
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргСтабильныеПериоды КАК энргСтабильныеПериоды
	|			ПО ВложенныйЗапрос.Организация = энргСтабильныеПериоды.Организация
	|				И ВложенныйЗапрос.ПериодНачисления = энргСтабильныеПериоды.ПериодНачисления
	|				И ВложенныйЗапрос.Район = энргСтабильныеПериоды.Район
	|				И ВложенныйЗапрос.ЧастныйСектор = энргСтабильныеПериоды.ЧастныйСектор
	|				И ВложенныйЗапрос.Строение = энргСтабильныеПериоды.Строение
	|				И ВложенныйЗапрос.Помещение = энргСтабильныеПериоды.Помещение
	|				И ВложенныйЗапрос.Услуга = энргСтабильныеПериоды.Услуга
	|				И ВложенныйЗапрос.ТочкаУчета = энргСтабильныеПериоды.ТочкаУчета
	|				И ВложенныйЗапрос.НомерПозиции = энргСтабильныеПериоды.НомерПозиции
	|				И (энргСтабильныеПериоды.Организация = &Организация)
	|				И (энргСтабильныеПериоды.ПериодНачисления = &ПериодНачисления)
	|				И (энргСтабильныеПериоды.Район = &Район)
	|				И (НЕ энргСтабильныеПериоды.ЧастныйСектор)
	|				И (энргСтабильныеПериоды.Строение = &МКД)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		энргСтабильныеПериоды.Организация,
	|		энргСтабильныеПериоды.ПериодНачисления,
	|		энргСтабильныеПериоды.Район,
	|		энргСтабильныеПериоды.ЧастныйСектор,
	|		энргСтабильныеПериоды.Строение,
	|		энргСтабильныеПериоды.Помещение,
	|		энргСтабильныеПериоды.Услуга
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		бестСтабильныеПериодыНП.Организация,
	|		бестСтабильныеПериодыНП.ПериодНачисления,
	|		бестСтабильныеПериодыНП.Район,
	|		ЛОЖЬ,
	|		бестСтабильныеПериодыНП.МКД,
	|		бестСтабильныеПериодыНП.ОбъектРасчета.Помещение,
	|		бестСтабильныеПериодыНП.Услуга,
	|		МАКСИМУМ(бестСтабильныеПериодыНП.ЗначениеПлощади),
	|		СУММА(ВЫБОР
	|				КОГДА бестСтабильныеПериодыНП.Поставщик = бестСтабильныеПериодыНП.Договор.Контрагент
	|					ТОГДА бестСтабильныеПериодыНП.ЗначениеПлощади
	|				ИНАЧЕ 0
	|			КОНЕЦ)
	|	ИЗ
	|		(ВЫБРАТЬ
	|			бестСтабильныеПериодыНП.Организация КАК Организация,
	|			бестСтабильныеПериодыНП.ПериодНачисления КАК ПериодНачисления,
	|			бестСтабильныеПериодыНП.Район КАК Район,
	|			ЛОЖЬ КАК ЧастныйСектор,
	|			бестСтабильныеПериодыНП.МКД КАК Строение,
	|			бестСтабильныеПериодыНП.ОбъектРасчета.Помещение КАК Помещение,
	|			бестСтабильныеПериодыНП.Услуга КАК Услуга,
	|			бестСтабильныеПериодыНП.ТочкаУчета КАК ТочкаУчета,
	|			МАКСИМУМ(бестСтабильныеПериодыНП.НомерПозиции) КАК НомерПозиции,
	|			бестСтабильныеПериодыНП.ОбъектРасчета КАК ОбъектРасчета,
	|			бестСтабильныеПериодыНП.Договор КАК Договор
	|		ИЗ
	|			РегистрСведений.бестСтабильныеПериодыНП КАК бестСтабильныеПериодыНП
	|		ГДЕ
	|			бестСтабильныеПериодыНП.Организация = &Организация
	|			И бестСтабильныеПериодыНП.ПериодНачисления = &ПериодНачисления
	|			И бестСтабильныеПериодыНП.Район = &Район
	|			И бестСтабильныеПериодыНП.МКД = &МКД
	|			И бестСтабильныеПериодыНП.Договор.ТипДоговора <> ЗНАЧЕНИЕ(Перечисление.бестТипыДоговоров.УправляющаяКомпания)
	|		
	|		СГРУППИРОВАТЬ ПО
	|			бестСтабильныеПериодыНП.Организация,
	|			бестСтабильныеПериодыНП.ПериодНачисления,
	|			бестСтабильныеПериодыНП.Район,
	|			бестСтабильныеПериодыНП.Услуга,
	|			бестСтабильныеПериодыНП.ТочкаУчета,
	|			бестСтабильныеПериодыНП.ОбъектРасчета,
	|			бестСтабильныеПериодыНП.Договор,
	|			бестСтабильныеПериодыНП.МКД,
	|			бестСтабильныеПериодыНП.ОбъектРасчета.Помещение) КАК ВложенныйЗапрос
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.бестСтабильныеПериодыНП КАК бестСтабильныеПериодыНП
	|			ПО ВложенныйЗапрос.Организация = бестСтабильныеПериодыНП.Организация
	|				И ВложенныйЗапрос.ПериодНачисления = бестСтабильныеПериодыНП.ПериодНачисления
	|				И ВложенныйЗапрос.Район = бестСтабильныеПериодыНП.Район
	|				И ВложенныйЗапрос.Услуга = бестСтабильныеПериодыНП.Услуга
	|				И ВложенныйЗапрос.ТочкаУчета = бестСтабильныеПериодыНП.ТочкаУчета
	|				И ВложенныйЗапрос.НомерПозиции = бестСтабильныеПериодыНП.НомерПозиции
	|				И (бестСтабильныеПериодыНП.Организация = &Организация)
	|				И (бестСтабильныеПериодыНП.ПериодНачисления = &ПериодНачисления)
	|				И (бестСтабильныеПериодыНП.Район = &Район)
	|				И (бестСтабильныеПериодыНП.МКД = &МКД)
	|				И ВложенныйЗапрос.ОбъектРасчета = бестСтабильныеПериодыНП.ОбъектРасчета
	|				И ВложенныйЗапрос.Договор = бестСтабильныеПериодыНП.Договор
	|	
	|	СГРУППИРОВАТЬ ПО
	|		бестСтабильныеПериодыНП.Организация,
	|		бестСтабильныеПериодыНП.ПериодНачисления,
	|		бестСтабильныеПериодыНП.Район,
	|		бестСтабильныеПериодыНП.Услуга,
	|		бестСтабильныеПериодыНП.МКД,
	|		бестСтабильныеПериодыНП.ОбъектРасчета.Помещение) КАК ВложенныйЗапрос
	|
	|СГРУППИРОВАТЬ ПО
	|	ВложенныйЗапрос.Организация,
	|	ВложенныйЗапрос.ПериодНачисления,
	|	ВложенныйЗапрос.Район,
	|	ВложенныйЗапрос.ЧастныйСектор,
	|	ВложенныйЗапрос.Строение,
	|	ВложенныйЗапрос.Услуга
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргСтабильныеПериоды.Организация КАК Организация,
	|	&ПериодНачисления КАК ПериодНачисления,
	|	энргСтабильныеПериоды.Район КАК Район,
	|	энргСтабильныеПериоды.ЧастныйСектор КАК ЧастныйСектор,
	|	энргСтабильныеПериоды.Строение КАК Строение,
	|	энргСтабильныеПериоды.Помещение КАК Помещение,
	|	энргСтабильныеПериоды.Услуга КАК Услуга,
	|	энргСтабильныеПериоды.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	МАКСИМУМ(энргСтабильныеПериоды.ПриборВведен) КАК ПриборВведен
	|ПОМЕСТИТЬ НаличиеПриборовУчетаСНачалаГода
	|ИЗ
	|	РегистрСведений.энргСтабильныеПериоды КАК энргСтабильныеПериоды
	|ГДЕ
	|	энргСтабильныеПериоды.Организация = &Организация
	|	И энргСтабильныеПериоды.ПериодНачисления МЕЖДУ НАЧАЛОПЕРИОДА(&ПериодНачисления, ГОД) И &ПериодНачисления
	|	И энргСтабильныеПериоды.Район = &Район
	|	И энргСтабильныеПериоды.ЧастныйСектор = &ЧастныйСектор
	|	И энргСтабильныеПериоды.Строение = &Строение
	|	И энргСтабильныеПериоды.Помещение = &Помещение
	|
	|СГРУППИРОВАТЬ ПО
	|	энргСтабильныеПериоды.Организация,
	|	энргСтабильныеПериоды.Район,
	|	энргСтабильныеПериоды.ЧастныйСектор,
	|	энргСтабильныеПериоды.Строение,
	|	энргСтабильныеПериоды.Помещение,
	|	энргСтабильныеПериоды.Услуга,
	|	энргСтабильныеПериоды.НаправлениеИспользованияТУ	
	|;
	|	
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	" + энргНачисления.СформироватьСтрокуДляЗапроса("энргСтабильныеПериоды","энргСтабильныеПериоды","ПериодРегистрации",Истина,Ложь) + "
	|	ВЫБОР
	|		КОГДА энргСтабильныеПериоды.ПериодРегистрации < &НачалоПериодаРасчета
	|			ТОГДА &НачалоПериодаРасчета
	|		ИНАЧЕ энргСтабильныеПериоды.ПериодРегистрации
	|	КОНЕЦ КАК ПериодРегистрации,
	|	ВЫБОР
	|		КОГДА энргСтабильныеПериоды.ЧастныйСектор
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка)
	|		ИНАЧЕ энргСтабильныеПериоды.Строение
	|	КОНЕЦ КАК МКД,
	|	&НачалоПериодаРасчета КАК НачалоОП,
	|	&КонецПериодаРасчета КАК ЗавершениеОП,
	|	&ДнейВПериоде КАК ДнейВПериоде
	|ПОМЕСТИТЬ СтабильныеПериодыНачало
	|ИЗ
	|	РегистрСведений.энргСтабильныеПериоды КАК энргСтабильныеПериоды
	|ГДЕ
	|	энргСтабильныеПериоды.Организация = &Организация
	|	И энргСтабильныеПериоды.ПериодНачисления = &ПериодНачисления
	|	И энргСтабильныеПериоды.Район = &Район
	|	И энргСтабильныеПериоды.ЧастныйСектор = &ЧастныйСектор
	|	И энргСтабильныеПериоды.Строение = &Строение
	|	И энргСтабильныеПериоды.Помещение = &Помещение"; 		
	
	Если Строение = Неопределено Тогда
	    Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериоды.ЧастныйСектор = &ЧастныйСектор","");
		Текст 		= СтрЗаменить(Текст,"И (энргНомераСтрокСтабильногоПериода.ЧастныйСектор = &ЧастныйСектор)","");
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериодыШкалы.ЧастныйСектор = &ЧастныйСектор","");
		Текст 		= СтрЗаменить(Текст,"И (энргСтабильныеПериодыШкалы.ЧастныйСектор = &ЧастныйСектор)","");
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериодыИзмерителиНаправлений.ЧастныйСектор = &ЧастныйСектор","");
		Текст 		= СтрЗаменить(Текст,"И (энргСтабильныеПериодыИзмерителиНаправлений.ЧастныйСектор = &ЧастныйСектор)","");
		Текст 		= СтрЗаменить(Текст,"И энргСреднийОбъемПотребленияАбонентов.ЧастныйСектор = &ЧастныйСектор","");
		Текст 		= СтрЗаменить(Текст,"И энргМаксимальныеПоказанияСрез.ЧастныйСектор = &ЧастныйСектор","");
		Текст 		= СтрЗаменить(Текст,"И энргПредоставленныеПоказания.ЧастныйСектор = &ЧастныйСектор","");
		Текст 		= СтрЗаменить(Текст,"И (энргКлючиПомещений.ЧастныйСектор = &ЧастныйСектор)","");
		Текст 		= СтрЗаменить(Текст,"И ЧастныйСектор = &ЧастныйСектор","");
		
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериоды.Строение = &Строение","");
		Текст 		= СтрЗаменить(Текст,"И (энргНомераСтрокСтабильногоПериода.Строение = &Строение)","");
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериодыШкалы.Строение = &Строение","");
		Текст 		= СтрЗаменить(Текст,"И (энргСтабильныеПериодыШкалы.Строение = &Строение)",""); 		
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериодыИзмерителиНаправлений.Строение = &Строение","");
		Текст 		= СтрЗаменить(Текст,"И (энргСтабильныеПериодыИзмерителиНаправлений.Строение = &Строение)","");
		
		Текст 		= СтрЗаменить(Текст,"И энргСреднийОбъемПотребленияАбонентов.Строение = &Строение","");		
		Текст 		= СтрЗаменить(Текст,"И энргМаксимальныеПоказанияСрез.Строение = &Строение","");
		Текст 		= СтрЗаменить(Текст,"И энргПредоставленныеПоказания.Строение = &Строение","");
		Текст 		= СтрЗаменить(Текст,"И (энргКлючиПомещений.Строение = &Строение)","");
		Текст 		= СтрЗаменить(Текст,"И (МКД = &Строение","И (ИСТИНА");
		Текст 		= СтрЗаменить(Текст,"И МКД = &Строение","");
		Текст 		= СтрЗаменить(Текст,"И энргДокументыНачислений.МКД = &Строение","");
		Текст 		= СтрЗаменить(Текст,"И Строение = &Строение","");
			
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериоды.Помещение = &Помещение","");
		Текст 		= СтрЗаменить(Текст,"И (энргНомераСтрокСтабильногоПериода.Помещение = &Помещение)","");
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериодыШкалы.Помещение = &Помещение","");
		Текст 		= СтрЗаменить(Текст,"И (энргСтабильныеПериодыШкалы.Помещение = &Помещение)","");
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериодыИзмерителиНаправлений.Помещение = &Помещение","");
		Текст 		= СтрЗаменить(Текст,"И (энргСтабильныеПериодыИзмерителиНаправлений.Помещение = &Помещение)","");
		Текст 		= СтрЗаменить(Текст,"И энргСреднийОбъемПотребленияАбонентов.Помещение = &Помещение","");
		Текст 		= СтрЗаменить(Текст,"И энргМаксимальныеПоказанияСрез.Помещение = &Помещение","");
		Текст 		= СтрЗаменить(Текст,"И энргПредоставленныеПоказания.Помещение = &Помещение","");
		Текст 		= СтрЗаменить(Текст,"И (энргКлючиПомещений.Помещение = &Помещение)","");
		Текст 		= СтрЗаменить(Текст,"И Помещение = &Помещение","");
		
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериодыМКД.МКД = &Строение","");
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериоды.Строение = &МКД","");
		Текст 		= СтрЗаменить(Текст,"И (энргСтабильныеПериоды.Строение = &МКД)","");
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериодыМКД.МКД = &МКД","");	
		Текст 		= СтрЗаменить(Текст,"И (энргСтабильныеПериодыМКД.МКД = &МКД)","");
		Текст 		= СтрЗаменить(Текст,"И бестСтабильныеПериодыНП.МКД = &МКД","");
		Текст 		= СтрЗаменить(Текст,"И (бестСтабильныеПериодыНП.МКД = &МКД)","");

		
	ИначеЕсли НЕ ЗначениеЗаполнено(Строение) Тогда	
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериоды.Строение = &Строение","");
		Текст 		= СтрЗаменить(Текст,"И (энргНомераСтрокСтабильногоПериода.Строение = &Строение)","");
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериодыШкалы.Строение = &Строение","");
		Текст 		= СтрЗаменить(Текст,"И (энргСтабильныеПериодыШкалы.Строение = &Строение)","");
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериодыИзмерителиНаправлений.Строение = &Строение","");
		Текст 		= СтрЗаменить(Текст,"И (энргСтабильныеПериодыИзмерителиНаправлений.Строение = &Строение)","");
		Текст 		= СтрЗаменить(Текст,"И энргСреднийОбъемПотребленияАбонентов.Строение = &Строение","");
		Текст 		= СтрЗаменить(Текст,"И энргМаксимальныеПоказанияСрез.Строение = &Строение","");
		Текст 		= СтрЗаменить(Текст,"И энргПредоставленныеПоказания.Строение = &Строение","");
		Текст 		= СтрЗаменить(Текст,"И (энргКлючиПомещений.Строение = &Строение)","");
		Текст 		= СтрЗаменить(Текст,"И (МКД = &Строение","И (ИСТИНА");
		Текст 		= СтрЗаменить(Текст,"И МКД = &Строение","");
		Текст 		= СтрЗаменить(Текст,"И энргДокументыНачислений.МКД = &Строение","И энргДокументыНачислений.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка)");
		Текст 		= СтрЗаменить(Текст,"И Строение = &Строение","");
		
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериоды.Помещение = &Помещение","");
		Текст 		= СтрЗаменить(Текст,"И (энргНомераСтрокСтабильногоПериода.Помещение = &Помещение)","");
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериодыШкалы.Помещение = &Помещение","");
		Текст 		= СтрЗаменить(Текст,"И (энргСтабильныеПериодыШкалы.Помещение = &Помещение)","");
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериодыИзмерителиНаправлений.Помещение = &Помещение","");
		Текст 		= СтрЗаменить(Текст,"И (энргСтабильныеПериодыИзмерителиНаправлений.Помещение = &Помещение)","");
		Текст 		= СтрЗаменить(Текст,"И энргСреднийОбъемПотребленияАбонентов.Помещение = &Помещение","");
		Текст 		= СтрЗаменить(Текст,"И энргМаксимальныеПоказанияСрез.Помещение = &Помещение","");
		Текст 		= СтрЗаменить(Текст,"И энргПредоставленныеПоказания.Помещение = &Помещение","");
		Текст 		= СтрЗаменить(Текст,"И (энргКлючиПомещений.Помещение = &Помещение)",""); 
		Текст 		= СтрЗаменить(Текст,"И Помещение = &Помещение","");
		
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериодыМКД.МКД = &Строение","И ЛОЖЬ");
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериоды.Строение = &МКД","И ЛОЖЬ");
		Текст 		= СтрЗаменить(Текст,"И (энргСтабильныеПериоды.Строение = &МКД)","И ЛОЖЬ");
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериодыМКД.МКД = &МКД","И ЛОЖЬ");	
		Текст 		= СтрЗаменить(Текст,"И (энргСтабильныеПериодыМКД.МКД = &МКД)","И ЛОЖЬ");
		Текст 		= СтрЗаменить(Текст,"И бестСтабильныеПериодыНП.МКД = &МКД","");
		Текст 		= СтрЗаменить(Текст,"И (бестСтабильныеПериодыНП.МКД = &МКД)","");
		
	ИначеЕсли Помещение = Неопределено Тогда
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериоды.Помещение = &Помещение","");
		Текст 		= СтрЗаменить(Текст,"И (энргНомераСтрокСтабильногоПериода.Помещение = &Помещение)","");
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериодыШкалы.Помещение = &Помещение","");
		Текст 		= СтрЗаменить(Текст,"И (энргСтабильныеПериодыШкалы.Помещение = &Помещение)","");
		Текст 		= СтрЗаменить(Текст,"И энргСтабильныеПериодыИзмерителиНаправлений.Помещение = &Помещение","");
		Текст 		= СтрЗаменить(Текст,"И (энргСтабильныеПериодыИзмерителиНаправлений.Помещение = &Помещение)","");
		Текст 		= СтрЗаменить(Текст,"И энргСреднийОбъемПотребленияАбонентов.Помещение = &Помещение","");
		Текст 		= СтрЗаменить(Текст,"И энргМаксимальныеПоказанияСрез.Помещение = &Помещение","");
		Текст 		= СтрЗаменить(Текст,"И энргПредоставленныеПоказания.Помещение = &Помещение","");
		Текст 		= СтрЗаменить(Текст,"И (энргКлючиПомещений.Помещение = &Помещение)","");
		Текст 		= СтрЗаменить(Текст,"И Помещение = &Помещение","");
	КонецЕсли;	

	Возврат Текст;
	
КонецФункции

Функция ТекстПолучитьСтабильныеПериоды(ЭтоПерерасчет)
	Текст  =
	"ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.МКД КАК МКД,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	СУММА(ВложенныйЗапрос.ПлощадьМОП) КАК ПлощадьМОП,
	|	СУММА(ВложенныйЗапрос.ПлощадьАбонентов) КАК ПлощадьАбонентов,
	|	СУММА(ВложенныйЗапрос.ПлощадьСобственнаяПоставка) КАК ПлощадьСобственнаяПоставка
	|ПОМЕСТИТЬ ЗначенияПлощадейСтроений
	|ИЗ
	|	(ВЫБРАТЬ
	|		ЗначениеПлощадейМКД.Организация КАК Организация,
	|		ЗначениеПлощадейМКД.ПериодНачисления КАК ПериодНачисления,
	|		ЗначениеПлощадейМКД.Район КАК Район,
	|		ЗначениеПлощадейМКД.МКД КАК МКД,
	|		ЗначениеПлощадейМКД.Услуга КАК Услуга,
	|		ЗначениеПлощадейМКД.ПлощадьМОП КАК ПлощадьМОП,
	|		0 КАК ПлощадьАбонентов,
	|		0 КАК ПлощадьСобственнаяПоставка
	|	ИЗ
	|		ЗначениеПлощадейМКД КАК ЗначениеПлощадейМКД
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ЗначениеИндивидуальныхПлощадей.Организация,
	|		ЗначениеИндивидуальныхПлощадей.ПериодНачисления,
	|		ЗначениеИндивидуальныхПлощадей.Район,
	|		ЗначениеИндивидуальныхПлощадей.Строение,
	|		ЗначениеИндивидуальныхПлощадей.Услуга,
	|		0,
	|		ЗначениеИндивидуальныхПлощадей.ПлощадьАбонентов,
	|		ЗначениеИндивидуальныхПлощадей.ПлощадьСобственнаяПоставка
	|	ИЗ
	|		ЗначениеИндивидуальныхПлощадей КАК ЗначениеИндивидуальныхПлощадей) КАК ВложенныйЗапрос
	|
	|СГРУППИРОВАТЬ ПО
	|	ВложенныйЗапрос.Организация,
	|	ВложенныйЗапрос.ПериодНачисления,
	|	ВложенныйЗапрос.Район,
	|	ВложенныйЗапрос.МКД,
	|	ВложенныйЗапрос.Услуга
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	МаксимальныеПоказанияСрез.Организация КАК Организация,
	|	МаксимальныеПоказанияСрез.ПериодНачисления КАК ПериодНачисления,
	|	МаксимальныеПоказанияСрез.Район КАК Район,
	|	МаксимальныеПоказанияСрез.ЧастныйСектор КАК ЧастныйСектор,
	|	МаксимальныеПоказанияСрез.Строение КАК Строение,
	|	МаксимальныеПоказанияСрез.Помещение КАК Помещение,
	|	МаксимальныеПоказанияСрез.ПриборУчета КАК ПриборУчета,
	|	МаксимальныеПоказанияСрез.Шкала КАК Шкала,
	|	МаксимальныеПоказанияСрез.ТарифнаяЗона КАК ТарифнаяЗона,
	|	МаксимальныеПоказанияСрез.Показания КАК Показания,
	|	МаксимальныеПоказанияСрез.Период КАК Период,
	|	-1 КАК НомерПозиции,
	|	МаксимальныеПоказанияСрез.ДокРегистратор КАК ДокРегистратор,
	|	МаксимальныеПоказанияСрез.КонецПериодаРасчета КАК КонецПериодаРасчета
	|ПОМЕСТИТЬ НаборПоказаний
	|ИЗ
	|	МаксимальныеПоказанияСрез КАК МаксимальныеПоказанияСрез
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ПредоставленныеПоказания.Организация,
	|	ПредоставленныеПоказания.ПериодНачисления,
	|	ПредоставленныеПоказания.Район,
	|	ПредоставленныеПоказания.ЧастныйСектор,
	|	ПредоставленныеПоказания.Строение,
	|	ПредоставленныеПоказания.Помещение,
	|	ПредоставленныеПоказания.ПриборУчета,
	|	ПредоставленныеПоказания.Шкала,
	|	ПредоставленныеПоказания.ТарифнаяЗона,
	|	ПредоставленныеПоказания.Показания,
	|	ПредоставленныеПоказания.ДатаРегистратора,
	|	ПредоставленныеПоказания.НомерПозиции,
	|	ПредоставленныеПоказания.ДокРегистратор,
	|	ПредоставленныеПоказания.КонецПериодаРасчета
	|ИЗ
	|	ПредоставленныеПоказания КАК ПредоставленныеПоказания
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПоказанияНачало.Организация КАК Организация,
	|	ПоказанияНачало.ПериодНачисления КАК ПериодНачисления,
	|	ПоказанияНачало.Район КАК Район,
	|	ПоказанияНачало.ЧастныйСектор КАК ЧастныйСектор,
	|	ПоказанияНачало.Строение КАК Строение,
	|	ПоказанияНачало.Помещение КАК Помещение,
	|	ПоказанияНачало.ПриборУчета КАК ПриборУчета,
	|	ПоказанияНачало.Шкала КАК Шкала,
	|	ПоказанияНачало.ТарифнаяЗона КАК ТарифнаяЗона,
	|	ПоказанияНачало.Показания КАК Показания,
	|	ПоказанияНачало.Период КАК НачалоПериодДействия,
	|	ВЫБОР
	|		КОГДА ПоказанияКонец.Период ЕСТЬ NULL
	|			ТОГДА ПоказанияНачало.КонецПериодаРасчета
	|		ИНАЧЕ ДОБАВИТЬКДАТЕ(ПоказанияКонец.Период, СЕКУНДА, -1)
	|	КОНЕЦ КАК ОкончаниеПериодаДействия,
	|	ВЫБОР
	|		КОГДА ПоказанияНачало.НомерПозиции = -1
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ПризнакНачалаПериода,
	|	ПоказанияНачало.ДокРегистратор КАК ДокРегистратор
	|ПОМЕСТИТЬ ПериодыПоказаний
	|ИЗ
	|	НаборПоказаний КАК ПоказанияНачало
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборПоказаний КАК ПоказанияКонец
	|		ПО ПоказанияНачало.Организация = ПоказанияКонец.Организация
	|			И ПоказанияНачало.ПериодНачисления = ПоказанияКонец.ПериодНачисления
	|			И ПоказанияНачало.Район = ПоказанияКонец.Район
	|			И ПоказанияНачало.ЧастныйСектор = ПоказанияКонец.ЧастныйСектор
	|			И ПоказанияНачало.Строение = ПоказанияКонец.Строение
	|			И ПоказанияНачало.Помещение = ПоказанияКонец.Помещение
	|			И ПоказанияНачало.ПриборУчета = ПоказанияКонец.ПриборУчета
	|			И ПоказанияНачало.Шкала = ПоказанияКонец.Шкала
	|			И ПоказанияНачало.ТарифнаяЗона = ПоказанияКонец.ТарифнаяЗона
	|			И (ПоказанияНачало.НомерПозиции = ПоказанияКонец.НомерПозиции - 1)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПредоставленныеПоказания.Организация КАК Организация,
	|	ПредоставленныеПоказания.ПериодНачисления КАК ПериодНачисления,
	|	ПредоставленныеПоказания.Район КАК Район,
	|	ПредоставленныеПоказания.ЧастныйСектор КАК ЧастныйСектор,
	|	ПредоставленныеПоказания.Строение КАК Строение,
	|	ПредоставленныеПоказания.Помещение КАК Помещение,
	|	ПредоставленныеПоказания.ПриборУчета КАК ПриборУчета,
	|	МАКСИМУМ(ПредоставленныеПоказания.ПоказанияТекущегоПериода) КАК ПоказанияТекущегоПериода
	|ПОМЕСТИТЬ ПредоставленныеПоказанияПоАбоненту
	|ИЗ
	|	ПредоставленныеПоказания КАК ПредоставленныеПоказания
	|
	|СГРУППИРОВАТЬ ПО
	|	ПредоставленныеПоказания.Организация,
	|	ПредоставленныеПоказания.ПериодНачисления,
	|	ПредоставленныеПоказания.Район,
	|	ПредоставленныеПоказания.ЧастныйСектор,
	|	ПредоставленныеПоказания.Строение,
	|	ПредоставленныеПоказания.Помещение,
	|	ПредоставленныеПоказания.ПриборУчета
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПредоставленныеПоказания.Организация КАК Организация,
	|	ПредоставленныеПоказания.ПериодНачисления КАК ПериодНачисления,
	|	ПредоставленныеПоказания.Район КАК Район,
	|	ПредоставленныеПоказания.ЧастныйСектор КАК ЧастныйСектор,
	|	ПредоставленныеПоказания.Строение КАК Строение,
	|	ПредоставленныеПоказания.Помещение КАК Помещение,
	|	ПредоставленныеПоказания.ПриборУчета КАК ПриборУчета,
	|	ПредоставленныеПоказания.Шкала КАК Шкала,
	|	ПредоставленныеПоказания.ТарифнаяЗона КАК ТарифнаяЗона,
	|	МАКСИМУМ(ПредоставленныеПоказания.ВСрок) КАК ВСрок
	|ПОМЕСТИТЬ ПредоставленныеПоказанияВСрок
	|ИЗ
	|	ПредоставленныеПоказания КАК ПредоставленныеПоказания
	|
	|СГРУППИРОВАТЬ ПО
	|	ПредоставленныеПоказания.Организация,
	|	ПредоставленныеПоказания.ПериодНачисления,
	|	ПредоставленныеПоказания.Район,
	|	ПредоставленныеПоказания.ЧастныйСектор,
	|	ПредоставленныеПоказания.Строение,
	|	ПредоставленныеПоказания.Помещение,
	|	ПредоставленныеПоказания.ПриборУчета,
	|	ПредоставленныеПоказания.Шкала,
	|	ПредоставленныеПоказания.ТарифнаяЗона
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	СтабильныеПериоды.Организация КАК Организация,
	|	СтабильныеПериоды.ПериодНачисления КАК ПериодНачисления,
	|	СтабильныеПериоды.Район КАК Район,
	|	СтабильныеПериоды.ЧастныйСектор КАК ЧастныйСектор,
	|	СтабильныеПериоды.Строение КАК Строение,
	|	СтабильныеПериоды.Помещение КАК Помещение,
	|	СтабильныеПериоды.Абонент КАК Абонент
	|ПОМЕСТИТЬ ЗакрытиеЛицевыхСчетов
	|ИЗ
	|	СтабильныеПериодыНачало КАК СтабильныеПериоды
	|ГДЕ
	|	СтабильныеПериоды.НомерПозиции > 0
	|	И НЕ СтабильныеПериоды.ЛСОткрыт	
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////	
	|ВЫБРАТЬ
	|" + энргНачисления.СформироватьСтрокуДляЗапроса("энргСтабильныеПериоды","СтабильныеПериодыНачало","",Истина,Ложь) + "
	|	СтабильныеПериодыНачало.НачалоОП КАК НачалоОП,
	|	СтабильныеПериодыНачало.ЗавершениеОП КАК ЗавершениеОП,
	|	СтабильныеПериодыНачало.ДнейВПериоде КАК ДнейВПериоде,
	|	ВЫБОР
	|	  	КОГДА СтабильныеПериодыНачало.ЧастныйСектор
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка)
	|		ИНАЧЕ СтабильныеПериодыНачало.Строение
	|	КОНЕЦ КАК МКД,
	|	ЕСТЬNULL(НастройкаСезонностиУслугМКД.КоэффициентНорматива, ЕСТЬNULL(НастройкаСезонностиУслуг.КоэффициентНорматива, 1)) КАК КоэффициентНорматива,
	|	ЕСТЬNULL(НастройкаСезонностиУслугМКД.КоэффициентНеПрименятьСезонность, ЕСТЬNULL(НастройкаСезонностиУслуг.КоэффициентНеПрименятьСезонность, 1)) КАК КоэффициентНормативаНеПрименятьСезонность, 
	|	ЕСТЬNULL(НастройкаСезонностиУслугМКД.КорректироватьГодовойОбъем, ЕСТЬNULL(НастройкаСезонностиУслуг.КорректироватьГодовойОбъем, ЛОЖЬ)) КАК КорректироватьГодовойОбъем,
	|	ВЫБОР
	|		КОГДА НЕ ЕСТЬNULL(НастройкаСезонностиУслугМКД.КорректироватьГодовойОбъем, ЕСТЬNULL(НастройкаСезонностиУслуг.КорректироватьГодовойОбъем, ЛОЖЬ))
	|				И НЕ ЕСТЬNULL(СпособыРасчетаПоНаправлениям.Сезонность, ЗНАЧЕНИЕ(Справочник.энргВидыСезонности.ПустаяСсылка)) = ЗНАЧЕНИЕ(Справочник.энргВидыСезонности.ПустаяСсылка)
	|				И ЕСТЬNULL(НаличиеПриборовУчетаСНачалаГода.ПриборВведен, ЛОЖЬ)
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ ЕСТЬNULL(НастройкаСезонностиУслугМКД.НеПрименятьСезонность, ЕСТЬNULL(НастройкаСезонностиУслуг.НеПрименятьСезонность, ЛОЖЬ))
	|	КОНЕЦ КАК НеПрименятьСезонность,
	|	ЕСТЬNULL(НастройкаСезонностиУслугМКД.ОбъемЗаПрошлыйГод, ЕСТЬNULL(НастройкаСезонностиУслуг.ОбъемЗаПрошлыйГод, ЛОЖЬ)) КАК ОбъемЗаПрошлыйГод,
	|	ВЫБОР
	|		КОГДА НЕ ЕСТЬNULL(НастройкаСезонностиУслугМКД.КорректироватьГодовойОбъем, ЕСТЬNULL(НастройкаСезонностиУслуг.КорректироватьГодовойОбъем, ЛОЖЬ))
	|				И НЕ ЕСТЬNULL(СпособыРасчетаПоНаправлениям.Сезонность, ЗНАЧЕНИЕ(Справочник.энргВидыСезонности.ПустаяСсылка)) = ЗНАЧЕНИЕ(Справочник.энргВидыСезонности.ПустаяСсылка)
	|				И ЕСТЬNULL(НаличиеПриборовУчетаСНачалаГода.ПриборВведен, ЛОЖЬ)
	|			ТОГДА СпособыРасчетаПоНаправлениям.Сезонность
	|		ИНАЧЕ СпособыРасчетаПоНаправлениям.Сезонность
	|	КОНЕЦ КАК Сезонность,
	|	ЕСТЬNULL(СпособыРасчетаПоНаправлениям.ВидПлощади, энргВидыУслуг.ВидПлощади) КАК ВидПлощади,
	|	ЕСТЬNULL(СпособыРасчетаПоНаправлениям.НормативПоДням, ЛОЖЬ) КАК НормативПоДням,
	|	ЕСТЬNULL(СпособыРасчетаПоНаправлениям.СпособОпределенияСоциальнойНормы, ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.ПустаяСсылка)) КАК СпособОпределенияСоциальнойНормы,
	|	ЕСТЬNULL(ПредоставленныеПоказанияПоАбоненту.ПоказанияТекущегоПериода, ЛОЖЬ) КАК ЕстьПоказанияАбонента,
	|	ВЫБОР
	|		КОГДА НЕ энргВидыУслугЗависимыеУслуги.Ссылка ЕСТЬ NULL
	|			ТОГДА энргВидыУслугЗависимыеУслуги.УслугаЗависитОт
	|		ИНАЧЕ ЕСТЬNULL(энргВидыУслуг.ЗависитОтУслуги, ЗНАЧЕНИЕ(Справочник.энргВидыУслуг.ПустаяСсылка))
	|	КОНЕЦ КАК ЗависитОтУслуги,
	|	ВЫБОР
	|		КОГДА НЕ энргВидыУслугЗависимыеУслуги.Ссылка ЕСТЬ NULL
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ ИСТИНА
	|	КОНЕЦ КАК УмножатьНаНормуРодительскойУслуги,		
	|	энргПриборыУчетаАбонента.МаксимальноВозможныеПоказания КАК МаксимальноВозможныеПоказания,
	|	ЕСТЬNULL(энргПриборыУчетаАбонента.РегистрируетОбъем, ЛОЖЬ) КАК РегистрируетОбъем,	
	|	ЕСТЬNULL(энргАбоненты.ФизЛицо, ЗНАЧЕНИЕ(Справочник.энргКонтрагенты.ПустаяСсылка)) КАК ФизЛицо,	
	|	ЕСТЬNULL(ТипСхемыГВС.ТипСхемы, ЗНАЧЕНИЕ(Перечисление.энргТипыСхемТеплоснабжения.ПустаяСсылка)) КАК ТипСхемы,
	|	ЕСТЬNULL(ВидыТепловыхПунктов.ВидТепловогоПункта, ЗНАЧЕНИЕ(Перечисление.энргВидыТепловыхПунктов.ПустаяСсылка)) КАК ВидТепловогоПункта,	
	|	ВЫБОР
	|		КОГДА СтабильныеПериодыНачало.ЧастныйСектор
	|				И энргПомещения.Родитель ЕСТЬ NULL
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.энргПомещения.ПустаяСсылка)
	|		КОГДА СтабильныеПериодыНачало.ЧастныйСектор
	|				И энргПомещения.Родитель = ЗНАЧЕНИЕ(Справочник.энргПомещения.ПустаяСсылка)
	|			ТОГДА СтабильныеПериодыНачало.Помещение
	|		КОГДА энргПомещения.Родитель = ЗНАЧЕНИЕ(Справочник.энргПомещения.ПустаяСсылка)
	|			ТОГДА СтабильныеПериодыНачало.Помещение
	|		ИНАЧЕ энргПомещения.Родитель
	|	КОНЕЦ КАК ПомещениеРодитель,	
	|	энргВидыУслуг.ИспользоватьКоэффициентСдерживанияРостаПлаты КАК ИспользоватьКоэффициентСдерживанияРостаПлаты,
	|	ЕСТЬNULL(ЗначенияПлощадейСтроений.ПлощадьМОП, 0) КАК ПлощадьМОП,
	|	ЕСТЬNULL(ЗначенияПлощадейСтроений.ПлощадьАбонентов, 0) КАК ПлощадьАбонентов,
	|	ЕСТЬNULL(ЗначенияПлощадейСтроений.ПлощадьСобственнаяПоставка, 0) КАК ПлощадьСобственнаяПоставка,	
	|	ЕСТЬNULL(ДокументыНачислений.ДокументНачисления, ЗНАЧЕНИЕ(Документ.энргНачисление.ПустаяСсылка)) КАК ДокументНачисления,
	|	ЕСТЬNULL(ДокументыНачислений.ПометкаУдаления, ЛОЖЬ) КАК ДокументНачисленияПометкаУдаления,	
	|	ВЫБОР
	|		КОГДА ДанныеВыводаПрибораУчета.ПериодНачисления ЕСТЬ NULL
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ ИСТИНА
	|	КОНЕЦ КАК ВыводПрибораУчета,	
	|	ЕСТЬNULL(НаличиеПриборовУчетаСНачалаГода.ПриборВведен, ЛОЖЬ) КАК БылУстановленныйПриборВЭтомГоду,
	|	НЕ НаличиеПриборовУчетаСНачалаГода.ПриборВведен ЕСТЬ NULL КАК ЕстьЗаписьПриборВЭтомГоду,
	|	энргКлючиПомещений.КлючПомещения,
	|	ВЫБОР 
	|		КОГДА ЗакрытиеЛицевыхСчетов.Организация ЕСТЬ NULL 
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ ИСТИНА
	|	КОНЕЦ КАК АбонентЗакрытВТекущемПериоде
	|ПОМЕСТИТЬ СтабильныеПериодыСезонность
	|ИЗ
	|	СтабильныеПериодыНачало КАК СтабильныеПериодыНачало
	|		ЛЕВОЕ СОЕДИНЕНИЕ СпособыРасчетаПоНаправлениям КАК СпособыРасчетаПоНаправлениям
	|		ПО СтабильныеПериодыНачало.Организация = СпособыРасчетаПоНаправлениям.Организация
	|			И СтабильныеПериодыНачало.ПериодНачисления = СпособыРасчетаПоНаправлениям.ПериодНачисления
	|			И СтабильныеПериодыНачало.Район = СпособыРасчетаПоНаправлениям.Район
	|			И СтабильныеПериодыНачало.Услуга = СпособыРасчетаПоНаправлениям.Услуга
	|			И СтабильныеПериодыНачало.НаправлениеИспользованияТУ = СпособыРасчетаПоНаправлениям.НаправлениеИспользованияТУ
	|		ЛЕВОЕ СОЕДИНЕНИЕ НастройкаСезонностиУслуг КАК НастройкаСезонностиУслуг
	|		ПО СтабильныеПериодыНачало.Организация = НастройкаСезонностиУслуг.Организация
	|			И СтабильныеПериодыНачало.ПериодНачисления = НастройкаСезонностиУслуг.ПериодНачисления
	|			И СтабильныеПериодыНачало.Район = НастройкаСезонностиУслуг.Район
	|			И СтабильныеПериодыНачало.Услуга = НастройкаСезонностиУслуг.Услуга
	|			И СтабильныеПериодыНачало.НаправлениеИспользованияТУ = НастройкаСезонностиУслуг.НаправлениеИспользованияТУ
	|			И (НастройкаСезонностиУслуг.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка))
	|		ЛЕВОЕ СОЕДИНЕНИЕ НастройкаСезонностиУслуг КАК НастройкаСезонностиУслугМКД
	|		ПО СтабильныеПериодыНачало.Организация = НастройкаСезонностиУслугМКД.Организация
	|			И СтабильныеПериодыНачало.ПериодНачисления = НастройкаСезонностиУслугМКД.ПериодНачисления
	|			И СтабильныеПериодыНачало.Район = НастройкаСезонностиУслугМКД.Район
	|			И СтабильныеПериодыНачало.Услуга = НастройкаСезонностиУслугМКД.Услуга
	|			И СтабильныеПериодыНачало.НаправлениеИспользованияТУ = НастройкаСезонностиУслугМКД.НаправлениеИспользованияТУ
	|			И СтабильныеПериодыНачало.МКД = НастройкаСезонностиУслугМКД.МКД
	|			И (НЕ НастройкаСезонностиУслуг.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка))
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаличиеПриборовУчетаСНачалаГода КАК НаличиеПриборовУчетаСНачалаГода
	|		ПО СтабильныеПериодыНачало.Организация = НаличиеПриборовУчетаСНачалаГода.Организация
	|			И СтабильныеПериодыНачало.ПериодНачисления = НаличиеПриборовУчетаСНачалаГода.ПериодНачисления
	|			И СтабильныеПериодыНачало.Район = НаличиеПриборовУчетаСНачалаГода.Район
	|			И СтабильныеПериодыНачало.ЧастныйСектор = НаличиеПриборовУчетаСНачалаГода.ЧастныйСектор
	|			И СтабильныеПериодыНачало.Строение = НаличиеПриборовУчетаСНачалаГода.Строение
	|			И СтабильныеПериодыНачало.Помещение = НаличиеПриборовУчетаСНачалаГода.Помещение
	|			И СтабильныеПериодыНачало.Услуга = НаличиеПриборовУчетаСНачалаГода.Услуга
	|			И СтабильныеПериодыНачало.НаправлениеИспользованияТУ = НаличиеПриборовУчетаСНачалаГода.НаправлениеИспользованияТУ	
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПредоставленныеПоказанияПоАбоненту КАК ПредоставленныеПоказанияПоАбоненту
	|		ПО СтабильныеПериодыНачало.Организация = ПредоставленныеПоказанияПоАбоненту.Организация
	|			И СтабильныеПериодыНачало.ПериодНачисления = ПредоставленныеПоказанияПоАбоненту.ПериодНачисления
	|			И СтабильныеПериодыНачало.Район = ПредоставленныеПоказанияПоАбоненту.Район
	|			И СтабильныеПериодыНачало.ЧастныйСектор = ПредоставленныеПоказанияПоАбоненту.ЧастныйСектор
	|			И СтабильныеПериодыНачало.Строение = ПредоставленныеПоказанияПоАбоненту.Строение
	|			И СтабильныеПериодыНачало.Помещение = ПредоставленныеПоказанияПоАбоненту.Помещение
	|			И СтабильныеПериодыНачало.ПриборУчета = ПредоставленныеПоказанияПоАбоненту.ПриборУчета
	|		ЛЕВОЕ СОЕДИНЕНИЕ ЗакрытиеЛицевыхСчетов КАК ЗакрытиеЛицевыхСчетов
	|		ПО СтабильныеПериодыНачало.Организация = ЗакрытиеЛицевыхСчетов.Организация
	|			И СтабильныеПериодыНачало.ПериодНачисления = ЗакрытиеЛицевыхСчетов.ПериодНачисления
	|			И СтабильныеПериодыНачало.Район = ЗакрытиеЛицевыхСчетов.Район
	|			И СтабильныеПериодыНачало.ЧастныйСектор = ЗакрытиеЛицевыхСчетов.ЧастныйСектор
	|			И СтабильныеПериодыНачало.Строение = ЗакрытиеЛицевыхСчетов.Строение
	|			И СтабильныеПериодыНачало.Помещение = ЗакрытиеЛицевыхСчетов.Помещение
	|			И СтабильныеПериодыНачало.Абонент = ЗакрытиеЛицевыхСчетов.Абонент	
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.энргАбоненты КАК энргАбоненты
	|		ПО СтабильныеПериодыНачало.Абонент = энргАбоненты.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.энргВидыУслуг КАК энргВидыУслуг
	|		ПО СтабильныеПериодыНачало.Услуга = энргВидыУслуг.Ссылка	
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.энргВидыУслуг.ЗависимыеУслуги КАК энргВидыУслугЗависимыеУслуги
	|		ПО СтабильныеПериодыНачало.СоставнаяУслуга = энргВидыУслугЗависимыеУслуги.Ссылка
	|			И СтабильныеПериодыНачало.Услуга = энргВидыУслугЗависимыеУслуги.Услуга			
	|		ЛЕВОЕ СОЕДИНЕНИЕ ДанныеВыводаПрибораУчета КАК ДанныеВыводаПрибораУчета
	|		ПО СтабильныеПериодыНачало.Организация = ДанныеВыводаПрибораУчета.Организация
	|			И СтабильныеПериодыНачало.ПериодНачисления = ДанныеВыводаПрибораУчета.ПериодНачисления
	|			И СтабильныеПериодыНачало.Район = ДанныеВыводаПрибораУчета.Район
	|			И СтабильныеПериодыНачало.ЧастныйСектор = ДанныеВыводаПрибораУчета.ЧастныйСектор
	|			И СтабильныеПериодыНачало.Строение = ДанныеВыводаПрибораУчета.Строение
	|			И СтабильныеПериодыНачало.Помещение = ДанныеВыводаПрибораУчета.Помещение
	|			И СтабильныеПериодыНачало.ТочкаУчета = ДанныеВыводаПрибораУчета.ТочкаУчета
	|			И СтабильныеПериодыНачало.ПриборУчета = ДанныеВыводаПрибораУчета.ПриборУчета
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.энргПриборыУчетаАбонента КАК энргПриборыУчетаАбонента
	|		ПО СтабильныеПериодыНачало.ПриборУчета = энргПриборыУчетаАбонента.Ссылка	
	|		ЛЕВОЕ СОЕДИНЕНИЕ ТипСхемыГВС КАК ТипСхемыГВС
	|		ПО СтабильныеПериодыНачало.Организация = ТипСхемыГВС.Организация
	|			И СтабильныеПериодыНачало.ПериодНачисления = ТипСхемыГВС.ПериодНачисления
	|			И СтабильныеПериодыНачало.Район = ТипСхемыГВС.Район
	|			И СтабильныеПериодыНачало.Строение = ТипСхемыГВС.Строение
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВидыТепловыхПунктов КАК ВидыТепловыхПунктов
	|		ПО СтабильныеПериодыНачало.Организация = ВидыТепловыхПунктов.Организация
	|			И СтабильныеПериодыНачало.ПериодНачисления = ВидыТепловыхПунктов.ПериодНачисления
	|			И СтабильныеПериодыНачало.Район = ВидыТепловыхПунктов.Район
	|			И СтабильныеПериодыНачало.Строение = ВидыТепловыхПунктов.Строение	
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.энргПомещения КАК энргПомещения
	|		ПО СтабильныеПериодыНачало.Помещение = энргПомещения.Ссылка	
	|		ЛЕВОЕ СОЕДИНЕНИЕ ДокументыНачислений КАК ДокументыНачислений
	|		ПО СтабильныеПериодыНачало.Организация = ДокументыНачислений.Организация
	|			И СтабильныеПериодыНачало.ПериодНачисления = ДокументыНачислений.ПериодНачисления
	|			И СтабильныеПериодыНачало.Район = ДокументыНачислений.Район
	|			И СтабильныеПериодыНачало.МКД = ДокументыНачислений.МКД	
	|		ЛЕВОЕ СОЕДИНЕНИЕ ЗначенияПлощадейСтроений КАК ЗначенияПлощадейСтроений
	|		ПО СтабильныеПериодыНачало.Организация = ЗначенияПлощадейСтроений.Организация
	|			И СтабильныеПериодыНачало.ПериодНачисления = ЗначенияПлощадейСтроений.ПериодНачисления
	|			И СтабильныеПериодыНачало.Район = ЗначенияПлощадейСтроений.Район
	|			И СтабильныеПериодыНачало.Услуга = ЗначенияПлощадейСтроений.Услуга
	|			И (НЕ СтабильныеПериодыНачало.ЧастныйСектор)
	|			И СтабильныеПериодыНачало.Строение = ЗначенияПлощадейСтроений.МКД
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.энргКлючиПомещений КАК энргКлючиПомещений
	|		ПО СтабильныеПериодыНачало.Строение = энргКлючиПомещений.Строение
	|			И СтабильныеПериодыНачало.Помещение = энргКлючиПомещений.Помещение
	|;
	|////////////////////////////////////////////////////////////////////////////////	
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
    |	ВложенныйЗапрос.Организация КАК Организация,
    |	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
    |	ВложенныйЗапрос.Район КАК Район,
    |	ВложенныйЗапрос.ЧастныйСектор КАК ЧастныйСектор,
    |	ВложенныйЗапрос.Строение КАК Строение,
    |	ВложенныйЗапрос.Помещение КАК Помещение,
    |	ВложенныйЗапрос.ТочкаУчета КАК ТочкаУчета,
    |	ВложенныйЗапрос.ПериодРегистрации КАК ПериодРегистрации,
	|	ВложенныйЗапрос.ЭтоИзменениеТарифа КАК ЭтоИзменениеТарифа
    |ПОМЕСТИТЬ НомераСтрокИзмененияСезонности
    |ИЗ
    |	(ВЫБРАТЬ
    |		СтабильныеПериодыСезонность.Организация КАК Организация,
    |		СтабильныеПериодыСезонность.ПериодНачисления КАК ПериодНачисления,
    |		СтабильныеПериодыСезонность.Район КАК Район,
    |		СтабильныеПериодыСезонность.ЧастныйСектор КАК ЧастныйСектор,
    |		СтабильныеПериодыСезонность.Строение КАК Строение,
    |		СтабильныеПериодыСезонность.Помещение КАК Помещение,
    |		СтабильныеПериодыСезонность.ТочкаУчета КАК ТочкаУчета,
    |		ПериодыИзмененияСезонности.Период КАК ПериодРегистрации,
	|		ЛОЖЬ КАК ЭтоИзменениеТарифа
    |	ИЗ
    |		СтабильныеПериодыСезонность КАК СтабильныеПериодыСезонность
    |			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПериодыИзмененияСезонности КАК ПериодыИзмененияСезонности
    |			ПО СтабильныеПериодыСезонность.Организация = ПериодыИзмененияСезонности.Организация
    |				И СтабильныеПериодыСезонность.Район = ПериодыИзмененияСезонности.Район
	|				И СтабильныеПериодыСезонность.ПериодНачисления = ПериодыИзмененияСезонности.ПериодНачисления
    |				И СтабильныеПериодыСезонность.Сезонность = ПериодыИзмененияСезонности.Сезонность
    |	
    |	ОБЪЕДИНИТЬ ВСЕ
    |	
    |	ВЫБРАТЬ
    |		СтабильныеПериодыСезонность.Организация,
    |		СтабильныеПериодыСезонность.ПериодНачисления,
    |		СтабильныеПериодыСезонность.Район,
    |		СтабильныеПериодыСезонность.ЧастныйСектор,
    |		СтабильныеПериодыСезонность.Строение,
    |		СтабильныеПериодыСезонность.Помещение,
    |		СтабильныеПериодыСезонность.ТочкаУчета,
    |		ЗначенияТарифов.ДатаСменыТарифа,
	|		ИСТИНА КАК ЭтоИзменениеТарифа
    |	ИЗ
    |		СтабильныеПериодыСезонность КАК СтабильныеПериодыСезонность
    |			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ЗначенияТарифов КАК ЗначенияТарифов
    |			ПО СтабильныеПериодыСезонность.Организация = ЗначенияТарифов.Организация
    |				И СтабильныеПериодыСезонность.ПериодНачисления = ЗначенияТарифов.ПериодНачисления
    |				И СтабильныеПериодыСезонность.Услуга = ЗначенияТарифов.Услуга
    |				И СтабильныеПериодыСезонность.Поставщик = ЗначенияТарифов.Поставщик
    |				И (СтабильныеПериодыСезонность.ЕстьПоказанияАбонента)) КАК ВложенныйЗапрос
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.ЧастныйСектор КАК ЧастныйСектор,
	|	ВложенныйЗапрос.Строение КАК Строение,
	|	ВложенныйЗапрос.Помещение КАК Помещение,
	|	ВложенныйЗапрос.ТочкаУчета КАК ТочкаУчета,
	|	ВложенныйЗапрос.ПериодРегистрации КАК ПериодРегистрации,
	|	ВложенныйЗапрос.ЭтоИзменениеТарифа КАК ЭтоИзменениеТарифа
	|ПОМЕСТИТЬ НомераСтрокИзмененияСезонностиЗависимыхТочекТочки
	|ИЗ
	|	(ВЫБРАТЬ
	|		СтабильныеПериодыСезонность.Организация КАК Организация,
	|		СтабильныеПериодыСезонность.ПериодНачисления КАК ПериодНачисления,
	|		СтабильныеПериодыСезонность.Район КАК Район,
	|		СтабильныеПериодыСезонность.ЧастныйСектор КАК ЧастныйСектор,
	|		СтабильныеПериодыСезонность.Строение КАК Строение,
	|		СтабильныеПериодыСезонность.Помещение КАК Помещение,
	|		СтабильныеПериодыСезонность.ЗависимаяТочкаУчета КАК ТочкаУчета,
	|		НомераСтрокИзмененияСезонности.ПериодРегистрации КАК ПериодРегистрации,
	|		НомераСтрокИзмененияСезонности.ЭтоИзменениеТарифа
	|	ИЗ
	|		СтабильныеПериодыСезонность КАК СтабильныеПериодыСезонность
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ НомераСтрокИзмененияСезонности КАК НомераСтрокИзмененияСезонности
	|			ПО СтабильныеПериодыСезонность.Организация = НомераСтрокИзмененияСезонности.Организация
	|				И СтабильныеПериодыСезонность.ПериодНачисления = НомераСтрокИзмененияСезонности.ПериодНачисления
	|				И СтабильныеПериодыСезонность.Район = НомераСтрокИзмененияСезонности.Район
	|				И СтабильныеПериодыСезонность.ЧастныйСектор = НомераСтрокИзмененияСезонности.ЧастныйСектор
	|				И СтабильныеПериодыСезонность.Строение = НомераСтрокИзмененияСезонности.Строение
	|				И СтабильныеПериодыСезонность.Помещение = НомераСтрокИзмененияСезонности.Помещение
	|				И СтабильныеПериодыСезонность.ТочкаУчета = НомераСтрокИзмененияСезонности.ТочкаУчета
	|				И (НЕ СтабильныеПериодыСезонность.ЗависимаяТочкаУчета = ЗНАЧЕНИЕ(Справочник.энргТочкиУчета.ПустаяСсылка))
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		НомераСтрокИзмененияСезонности.Организация,
	|		НомераСтрокИзмененияСезонности.ПериодНачисления,
	|		НомераСтрокИзмененияСезонности.Район,
	|		НомераСтрокИзмененияСезонности.ЧастныйСектор,
	|		НомераСтрокИзмененияСезонности.Строение,
	|		НомераСтрокИзмененияСезонности.Помещение,
	|		НомераСтрокИзмененияСезонности.ТочкаУчета,
	|		НомераСтрокИзмененияСезонности.ПериодРегистрации,
	|		НомераСтрокИзмененияСезонности.ЭтоИзменениеТарифа
	|	ИЗ
	|		НомераСтрокИзмененияСезонности КАК НомераСтрокИзмененияСезонности) КАК ВложенныйЗапрос
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.ЧастныйСектор КАК ЧастныйСектор,
	|	ВложенныйЗапрос.Строение КАК Строение,
	|	ВложенныйЗапрос.Помещение КАК Помещение,
	|	ВложенныйЗапрос.ТочкаУчета КАК ТочкаУчета,
	|	ВложенныйЗапрос.ПериодРегистрации КАК ПериодРегистрации,
	|	ВложенныйЗапрос.ЭтоИзменениеТарифа КАК ЭтоИзменениеТарифа
	|ПОМЕСТИТЬ НомераСтрокИзмененияСезонностиПоЗависимымТочкам
	|ИЗ
	|	(ВЫБРАТЬ
	|		СтабильныеПериодыСезонность.Организация КАК Организация,
	|		СтабильныеПериодыСезонность.ПериодНачисления КАК ПериодНачисления,
	|		СтабильныеПериодыСезонность.Район КАК Район,
	|		СтабильныеПериодыСезонность.ЧастныйСектор КАК ЧастныйСектор,
	|		СтабильныеПериодыСезонность.Строение КАК Строение,
	|		СтабильныеПериодыСезонность.Помещение КАК Помещение,
	|		СтабильныеПериодыСезонность.ТочкаУчета КАК ТочкаУчета,
	|		НомераСтрокИзмененияСезонностиЗависимыхТочекТочки.ПериодРегистрации КАК ПериодРегистрации,
	|		НомераСтрокИзмененияСезонностиЗависимыхТочекТочки.ЭтоИзменениеТарифа КАК ЭтоИзменениеТарифа
	|	ИЗ
	|		СтабильныеПериодыСезонность КАК СтабильныеПериодыСезонность
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ НомераСтрокИзмененияСезонностиЗависимыхТочекТочки КАК НомераСтрокИзмененияСезонностиЗависимыхТочекТочки
	|			ПО СтабильныеПериодыСезонность.Организация = НомераСтрокИзмененияСезонностиЗависимыхТочекТочки.Организация
	|				И СтабильныеПериодыСезонность.ПериодНачисления = НомераСтрокИзмененияСезонностиЗависимыхТочекТочки.ПериодНачисления
	|				И СтабильныеПериодыСезонность.Район = НомераСтрокИзмененияСезонностиЗависимыхТочекТочки.Район
	|				И СтабильныеПериодыСезонность.ЧастныйСектор = НомераСтрокИзмененияСезонностиЗависимыхТочекТочки.ЧастныйСектор
	|				И СтабильныеПериодыСезонность.Строение = НомераСтрокИзмененияСезонностиЗависимыхТочекТочки.Строение
	|				И СтабильныеПериодыСезонность.Помещение = НомераСтрокИзмененияСезонностиЗависимыхТочекТочки.Помещение
	|				И СтабильныеПериодыСезонность.ЗависимаяТочкаУчета = НомераСтрокИзмененияСезонностиЗависимыхТочекТочки.ТочкаУчета
	|				И (НЕ СтабильныеПериодыСезонность.ЗависимаяТочкаУчета = ЗНАЧЕНИЕ(Справочник.энргТочкиУчета.ПустаяСсылка))
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		НомераСтрокИзмененияСезонностиЗависимыхТочекТочки.Организация,
	|		НомераСтрокИзмененияСезонностиЗависимыхТочекТочки.ПериодНачисления,
	|		НомераСтрокИзмененияСезонностиЗависимыхТочекТочки.Район,
	|		НомераСтрокИзмененияСезонностиЗависимыхТочекТочки.ЧастныйСектор,
	|		НомераСтрокИзмененияСезонностиЗависимыхТочекТочки.Строение,
	|		НомераСтрокИзмененияСезонностиЗависимыхТочекТочки.Помещение,
	|		НомераСтрокИзмененияСезонностиЗависимыхТочекТочки.ТочкаУчета,
	|		НомераСтрокИзмененияСезонностиЗависимыхТочекТочки.ПериодРегистрации,
	|		НомераСтрокИзмененияСезонностиЗависимыхТочекТочки.ЭтоИзменениеТарифа
	|	ИЗ
	|		НомераСтрокИзмененияСезонностиЗависимыхТочекТочки КАК НомераСтрокИзмененияСезонностиЗависимыхТочекТочки) КАК ВложенныйЗапрос
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.ЧастныйСектор КАК ЧастныйСектор,
	|	ВложенныйЗапрос.Строение КАК Строение,
	|	ВложенныйЗапрос.Помещение КАК Помещение,
	|	ВложенныйЗапрос.ТочкаУчета КАК ТочкаУчета,
	|	ВложенныйЗапрос.ПериодРегистрации КАК ПериодРегистрации,
	|	ВложенныйЗапрос.ЭтоИзменениеТарифа КАК ЭтоИзменениеТарифа
	|ПОМЕСТИТЬ ИзменениеНомеровСтрокРодитескихТочек
	|ИЗ
	|	(ВЫБРАТЬ
	|		СтабильныеПериодыСезонность.Организация КАК Организация,
	|		СтабильныеПериодыСезонность.ПериодНачисления КАК ПериодНачисления,
	|		СтабильныеПериодыСезонность.Район КАК Район,
	|		СтабильныеПериодыСезонность.ЧастныйСектор КАК ЧастныйСектор,
	|		СтабильныеПериодыСезонность.Строение КАК Строение,
	|		СтабильныеПериодыСезонность.Помещение КАК Помещение,
	|		СтабильныеПериодыСезонность.ТочкаУчетаРодитель КАК ТочкаУчета,
	|		НомераСтрокИзмененияСезонностиПоЗависимымТочкам.ПериодРегистрации КАК ПериодРегистрации,
	|		НомераСтрокИзмененияСезонностиПоЗависимымТочкам.ЭтоИзменениеТарифа
	|	ИЗ
	|		НомераСтрокИзмененияСезонностиПоЗависимымТочкам КАК НомераСтрокИзмененияСезонностиПоЗависимымТочкам
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ СтабильныеПериодыСезонность КАК СтабильныеПериодыСезонность
	|			ПО НомераСтрокИзмененияСезонностиПоЗависимымТочкам.Организация = СтабильныеПериодыСезонность.Организация
	|				И НомераСтрокИзмененияСезонностиПоЗависимымТочкам.ПериодНачисления = СтабильныеПериодыСезонность.ПериодНачисления
	|				И НомераСтрокИзмененияСезонностиПоЗависимымТочкам.Район = СтабильныеПериодыСезонность.Район
	|				И НомераСтрокИзмененияСезонностиПоЗависимымТочкам.ЧастныйСектор = СтабильныеПериодыСезонность.ЧастныйСектор
	|				И НомераСтрокИзмененияСезонностиПоЗависимымТочкам.Строение = СтабильныеПериодыСезонность.Строение
	|				И НомераСтрокИзмененияСезонностиПоЗависимымТочкам.Помещение = СтабильныеПериодыСезонность.Помещение
	|				И НомераСтрокИзмененияСезонностиПоЗависимымТочкам.ТочкаУчета = СтабильныеПериодыСезонность.ТочкаУчета
	|				И (НЕ СтабильныеПериодыСезонность.ТочкаУчетаРодитель = ЗНАЧЕНИЕ(Справочник.энргТочкиУчета.ПустаяСсылка))
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		НомераСтрокИзмененияСезонностиПоЗависимымТочкам.Организация,
	|		НомераСтрокИзмененияСезонностиПоЗависимымТочкам.ПериодНачисления,
	|		НомераСтрокИзмененияСезонностиПоЗависимымТочкам.Район,
	|		НомераСтрокИзмененияСезонностиПоЗависимымТочкам.ЧастныйСектор,
	|		НомераСтрокИзмененияСезонностиПоЗависимымТочкам.Строение,
	|		НомераСтрокИзмененияСезонностиПоЗависимымТочкам.Помещение,
	|		НомераСтрокИзмененияСезонностиПоЗависимымТочкам.ТочкаУчета,
	|		НомераСтрокИзмененияСезонностиПоЗависимымТочкам.ПериодРегистрации,
	|		НомераСтрокИзмененияСезонностиПоЗависимымТочкам.ЭтоИзменениеТарифа
	|	ИЗ
	|		НомераСтрокИзмененияСезонностиПоЗависимымТочкам КАК НомераСтрокИзмененияСезонностиПоЗависимымТочкам) КАК ВложенныйЗапрос
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.ЧастныйСектор КАК ЧастныйСектор,
	|	ВложенныйЗапрос.Строение КАК Строение,
	|	ВложенныйЗапрос.Помещение КАК Помещение,
	|	ВложенныйЗапрос.ТочкаУчета КАК ТочкаУчета,
	|	ВложенныйЗапрос.ПериодРегистрации КАК ПериодРегистрации,
	|	ВложенныйЗапрос.ЭтоИзменениеТарифа КАК ЭтоИзменениеТарифа
	|ПОМЕСТИТЬ ИзменениеНомеровСтрокТочекУчетаВПодчинении
	|ИЗ
	|	(ВЫБРАТЬ
	|		СтабильныеПериодыСезонность.Организация КАК Организация,
	|		СтабильныеПериодыСезонность.ПериодНачисления КАК ПериодНачисления,
	|		СтабильныеПериодыСезонность.Район КАК Район,
	|		СтабильныеПериодыСезонность.ЧастныйСектор КАК ЧастныйСектор,
	|		СтабильныеПериодыСезонность.Строение КАК Строение,
	|		СтабильныеПериодыСезонность.Помещение КАК Помещение,
	|		СтабильныеПериодыСезонность.ТочкаУчета КАК ТочкаУчета,
	|		ИзменениеНомеровСтрокРодитескихТочек.ПериодРегистрации КАК ПериодРегистрации,
	|		ИзменениеНомеровСтрокРодитескихТочек.ЭтоИзменениеТарифа
	|	ИЗ
	|		СтабильныеПериодыСезонность КАК СтабильныеПериодыСезонность 
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ИзменениеНомеровСтрокРодитескихТочек КАК ИзменениеНомеровСтрокРодитескихТочек
	|			ПО СтабильныеПериодыСезонность.Организация = ИзменениеНомеровСтрокРодитескихТочек.Организация
	|				И СтабильныеПериодыСезонность.ПериодНачисления = ИзменениеНомеровСтрокРодитескихТочек.ПериодНачисления
	|				И СтабильныеПериодыСезонность.Район = ИзменениеНомеровСтрокРодитескихТочек.Район
	|				И СтабильныеПериодыСезонность.ЧастныйСектор = ИзменениеНомеровСтрокРодитескихТочек.ЧастныйСектор
	|				И СтабильныеПериодыСезонность.Строение = ИзменениеНомеровСтрокРодитескихТочек.Строение
	|				И СтабильныеПериодыСезонность.Помещение = ИзменениеНомеровСтрокРодитескихТочек.Помещение
	|				И СтабильныеПериодыСезонность.ТочкаУчетаРодитель = ИзменениеНомеровСтрокРодитескихТочек.ТочкаУчета
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ИзменениеНомеровСтрокРодитескихТочек.Организация,
	|		ИзменениеНомеровСтрокРодитескихТочек.ПериодНачисления,
	|		ИзменениеНомеровСтрокРодитескихТочек.Район,
	|		ИзменениеНомеровСтрокРодитескихТочек.ЧастныйСектор,
	|		ИзменениеНомеровСтрокРодитескихТочек.Строение,
	|		ИзменениеНомеровСтрокРодитескихТочек.Помещение,
	|		ИзменениеНомеровСтрокРодитескихТочек.ТочкаУчета,
	|		ИзменениеНомеровСтрокРодитескихТочек.ПериодРегистрации,
	|		ИзменениеНомеровСтрокРодитескихТочек.ЭтоИзменениеТарифа
	|	ИЗ
	|		ИзменениеНомеровСтрокРодитескихТочек КАК ИзменениеНомеровСтрокРодитескихТочек) КАК ВложенныйЗапрос
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СтабильныеПериодыСезонность.Организация КАК Организация,
	|	СтабильныеПериодыСезонность.ПериодНачисления КАК ПериодНачисления,
	|	СтабильныеПериодыСезонность.Район КАК Район,
	|	СтабильныеПериодыСезонность.ЧастныйСектор КАК ЧастныйСектор,
	|	СтабильныеПериодыСезонность.Строение КАК Строение,
	|	СтабильныеПериодыСезонность.Помещение КАК Помещение,
	|	СтабильныеПериодыСезонность.ТочкаУчета КАК ТочкаУчета,
	|	СтабильныеПериодыСезонность.Услуга КАК Услуга,
	|	ИзменениеНомеровСтрокТочекУчетаВПодчинении.ПериодРегистрации КАК ПериодРегистрации,
	|	ИзменениеНомеровСтрокТочекУчетаВПодчинении.ЭтоИзменениеТарифа КАК ЭтоИзменениеТарифа,
	|	МАКСИМУМ(СтабильныеПериодыСезонность.НомерПозиции) КАК НомерПозиции
	|ПОМЕСТИТЬ ИзменениеНомеровСтрок
	|ИЗ
	|	СтабильныеПериодыСезонность КАК СтабильныеПериодыСезонность
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ИзменениеНомеровСтрокТочекУчетаВПодчинении КАК ИзменениеНомеровСтрокТочекУчетаВПодчинении
	|		ПО СтабильныеПериодыСезонность.Организация = ИзменениеНомеровСтрокТочекУчетаВПодчинении.Организация
	|			И СтабильныеПериодыСезонность.ПериодНачисления = ИзменениеНомеровСтрокТочекУчетаВПодчинении.ПериодНачисления
	|			И СтабильныеПериодыСезонность.Район = ИзменениеНомеровСтрокТочекУчетаВПодчинении.Район
	|			И СтабильныеПериодыСезонность.ЧастныйСектор = ИзменениеНомеровСтрокТочекУчетаВПодчинении.ЧастныйСектор
	|			И СтабильныеПериодыСезонность.Строение = ИзменениеНомеровСтрокТочекУчетаВПодчинении.Строение
	|			И СтабильныеПериодыСезонность.Помещение = ИзменениеНомеровСтрокТочекУчетаВПодчинении.Помещение
	|			И СтабильныеПериодыСезонность.ТочкаУчета = ИзменениеНомеровСтрокТочекУчетаВПодчинении.ТочкаУчета
	|			И СтабильныеПериодыСезонность.ПериодРегистрации < ИзменениеНомеровСтрокТочекУчетаВПодчинении.ПериодРегистрации
	|
	|СГРУППИРОВАТЬ ПО
	|	СтабильныеПериодыСезонность.Организация,
	|	СтабильныеПериодыСезонность.ПериодНачисления,
	|	СтабильныеПериодыСезонность.Район,
	|	СтабильныеПериодыСезонность.ЧастныйСектор,
	|	СтабильныеПериодыСезонность.Строение,
	|	СтабильныеПериодыСезонность.Помещение,
	|	СтабильныеПериодыСезонность.ТочкаУчета,
	|	СтабильныеПериодыСезонность.Услуга,
	|	ИзменениеНомеровСтрокТочекУчетаВПодчинении.ПериодРегистрации,
	|	ИзменениеНомеровСтрокТочекУчетаВПодчинении.ЭтоИзменениеТарифа
	|;
	|////////////////////////////////////////////////////////////////////////////////	
	|ВЫБРАТЬ
	|" + энргНачисления.СформироватьСтрокуДляЗапроса("энргСтабильныеПериоды","СтабильныеПериодыСезонность","НомерПозиции,ДокРегистратор,ДатаРегистратора,ПериодРегистрации",Истина,Ложь) + "
	|	СтабильныеПериодыСезонность.НачалоОП КАК НачалоОП,
	|	СтабильныеПериодыСезонность.ЗавершениеОП КАК ЗавершениеОП,
	|	СтабильныеПериодыСезонность.ДнейВПериоде КАК ДнейВПериоде,
	|	СтабильныеПериодыСезонность.МКД КАК МКД,
	|	СтабильныеПериодыСезонность.КоэффициентНорматива КАК КоэффициентНорматива,
	|	СтабильныеПериодыСезонность.КоэффициентНормативаНеПрименятьСезонность КАК КоэффициентНормативаНеПрименятьСезонность,
	|	СтабильныеПериодыСезонность.КорректироватьГодовойОбъем КАК КорректироватьГодовойОбъем,
	|	СтабильныеПериодыСезонность.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	СтабильныеПериодыСезонность.ОбъемЗаПрошлыйГод КАК ОбъемЗаПрошлыйГод,
	|	СтабильныеПериодыСезонность.Сезонность КАК Сезонность,
	|	СтабильныеПериодыСезонность.ВидПлощади КАК ВидПлощади,
	|	СтабильныеПериодыСезонность.НормативПоДням КАК НормативПоДням,
	|	СтабильныеПериодыСезонность.СпособОпределенияСоциальнойНормы КАК СпособОпределенияСоциальнойНормы,
	|	СтабильныеПериодыСезонность.ЕстьПоказанияАбонента КАК ЕстьПоказанияАбонента,
	|	СтабильныеПериодыСезонность.ЗависитОтУслуги КАК ЗависитОтУслуги,
	|	СтабильныеПериодыСезонность.УмножатьНаНормуРодительскойУслуги КАК УмножатьНаНормуРодительскойУслуги,		
	|	СтабильныеПериодыСезонность.МаксимальноВозможныеПоказания КАК МаксимальноВозможныеПоказания,
	|	СтабильныеПериодыСезонность.РегистрируетОбъем КАК РегистрируетОбъем,	
	|	СтабильныеПериодыСезонность.ФизЛицо КАК ФизЛицо,	
	|	СтабильныеПериодыСезонность.ТипСхемы КАК ТипСхемы,
	|	СтабильныеПериодыСезонность.ВидТепловогоПункта КАК ВидТепловогоПункта,	
	|	СтабильныеПериодыСезонность.ПомещениеРодитель КАК ПомещениеРодитель,	
	|	СтабильныеПериодыСезонность.ИспользоватьКоэффициентСдерживанияРостаПлаты КАК ИспользоватьКоэффициентСдерживанияРостаПлаты,
	|	СтабильныеПериодыСезонность.ПлощадьМОП КАК ПлощадьМОП,
	|	СтабильныеПериодыСезонность.ПлощадьАбонентов КАК ПлощадьАбонентов,
	|	СтабильныеПериодыСезонность.ПлощадьСобственнаяПоставка КАК ПлощадьСобственнаяПоставка,	
	|	СтабильныеПериодыСезонность.ДокументНачисления КАК ДокументНачисления,
	|	СтабильныеПериодыСезонность.ДокументНачисленияПометкаУдаления КАК ДокументНачисленияПометкаУдаления,	
	|	СтабильныеПериодыСезонность.ВыводПрибораУчета КАК ВыводПрибораУчета,
	|	СтабильныеПериодыСезонность.БылУстановленныйПриборВЭтомГоду КАК БылУстановленныйПриборВЭтомГоду,
	|	СтабильныеПериодыСезонность.ЕстьЗаписьПриборВЭтомГоду КАК ЕстьЗаписьПриборВЭтомГоду,
	|	СтабильныеПериодыСезонность.КлючПомещения,
	|	СтабильныеПериодыСезонность.АбонентЗакрытВТекущемПериоде,
	|	СтабильныеПериодыСезонность.НомерПозиции + ВЫБОР 
	|		КОГДА ИзменениеНомеровСтрок.НомерПозиции ЕСТЬ NULL 
	|			ТОГДА 0
	|		КОГДА СтабильныеПериодыСезонность.НомерПозиции <= ИзменениеНомеровСтрок.НомерПозиции
	|			ТОГДА 0
	|		ИНАЧЕ 1 
	|	КОНЕЦ КАК НомерПозиции,
	|	ВЫБОР 
	|		КОГДА ИзменениеНомеровСтрок.НомерПозиции ЕСТЬ NULL 
	|			ТОГДА 0
	|		КОГДА СтабильныеПериодыСезонность.НомерПозиции <= ИзменениеНомеровСтрок.НомерПозиции
	|			ТОГДА 0
	|		ИНАЧЕ 1 
	|	КОНЕЦ КАК УвеличениеПозиции,		
	|	СтабильныеПериодыСезонность.ПериодРегистрации,
	|	СтабильныеПериодыСезонность.ДокРегистратор,
	|	СтабильныеПериодыСезонность.ДатаРегистратора
	|ПОМЕСТИТЬ СтабильныеПериодыПослеИзмененияСезонности
	|ИЗ
	|	СтабильныеПериодыСезонность КАК СтабильныеПериодыСезонность
	|		ЛЕВОЕ СОЕДИНЕНИЕ ИзменениеНомеровСтрок КАК ИзменениеНомеровСтрок
	|		ПО СтабильныеПериодыСезонность.Организация = ИзменениеНомеровСтрок.Организация 
	|			И СтабильныеПериодыСезонность.ПериодНачисления = ИзменениеНомеровСтрок.ПериодНачисления
	|			И СтабильныеПериодыСезонность.Район = ИзменениеНомеровСтрок.Район
	|			И СтабильныеПериодыСезонность.ЧастныйСектор = ИзменениеНомеровСтрок.ЧастныйСектор
	|			И СтабильныеПериодыСезонность.Строение = ИзменениеНомеровСтрок.Строение
	|			И СтабильныеПериодыСезонность.Помещение = ИзменениеНомеровСтрок.Помещение
	|			И СтабильныеПериодыСезонность.ТочкаУчета = ИзменениеНомеровСтрок.ТочкаУчета
	|			И СтабильныеПериодыСезонность.Услуга = ИзменениеНомеровСтрок.Услуга
	|
	|ОБЪЕДИНИТЬ ВСЕ	
	|
	|ВЫБРАТЬ
	|" + энргНачисления.СформироватьСтрокуДляЗапроса("энргСтабильныеПериоды","СтабильныеПериодыСезонность","НомерПозиции,ДокРегистратор,ДатаРегистратора,ПериодРегистрации",Истина,Ложь) + "
	|	СтабильныеПериодыСезонность.НачалоОП КАК НачалоОП,
	|	СтабильныеПериодыСезонность.ЗавершениеОП КАК ЗавершениеОП,
	|	СтабильныеПериодыСезонность.ДнейВПериоде КАК ДнейВПериоде,
	|	СтабильныеПериодыСезонность.МКД КАК МКД,
	|	СтабильныеПериодыСезонность.КоэффициентНорматива КАК КоэффициентНорматива,
	|	СтабильныеПериодыСезонность.КоэффициентНормативаНеПрименятьСезонность КАК КоэффициентНормативаНеПрименятьСезонность,
	|	СтабильныеПериодыСезонность.КорректироватьГодовойОбъем КАК КорректироватьГодовойОбъем,
	|	СтабильныеПериодыСезонность.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	СтабильныеПериодыСезонность.ОбъемЗаПрошлыйГод КАК ОбъемЗаПрошлыйГод,
	|	СтабильныеПериодыСезонность.Сезонность КАК Сезонность,
	|	СтабильныеПериодыСезонность.ВидПлощади КАК ВидПлощади,
	|	СтабильныеПериодыСезонность.НормативПоДням КАК НормативПоДням,
	|	СтабильныеПериодыСезонность.СпособОпределенияСоциальнойНормы КАК СпособОпределенияСоциальнойНормы,
	|	СтабильныеПериодыСезонность.ЕстьПоказанияАбонента КАК ЕстьПоказанияАбонента,
	|	СтабильныеПериодыСезонность.ЗависитОтУслуги КАК ЗависитОтУслуги,
	|	СтабильныеПериодыСезонность.УмножатьНаНормуРодительскойУслуги КАК УмножатьНаНормуРодительскойУслуги,		
	|	СтабильныеПериодыСезонность.МаксимальноВозможныеПоказания КАК МаксимальноВозможныеПоказания,
	|	СтабильныеПериодыСезонность.РегистрируетОбъем КАК РегистрируетОбъем,	
	|	СтабильныеПериодыСезонность.ФизЛицо КАК ФизЛицо,	
	|	СтабильныеПериодыСезонность.ТипСхемы КАК ТипСхемы,
	|	СтабильныеПериодыСезонность.ВидТепловогоПункта КАК ВидТепловогоПункта,	
	|	СтабильныеПериодыСезонность.ПомещениеРодитель КАК ПомещениеРодитель,	
	|	СтабильныеПериодыСезонность.ИспользоватьКоэффициентСдерживанияРостаПлаты КАК ИспользоватьКоэффициентСдерживанияРостаПлаты,
	|	СтабильныеПериодыСезонность.ПлощадьМОП КАК ПлощадьМОП,
	|	СтабильныеПериодыСезонность.ПлощадьАбонентов КАК ПлощадьАбонентов,
	|	СтабильныеПериодыСезонность.ПлощадьСобственнаяПоставка КАК ПлощадьСобственнаяПоставка,	
	|	СтабильныеПериодыСезонность.ДокументНачисления КАК ДокументНачисления,
	|	СтабильныеПериодыСезонность.ДокументНачисленияПометкаУдаления КАК ДокументНачисленияПометкаУдаления,	
	|	СтабильныеПериодыСезонность.ВыводПрибораУчета КАК ВыводПрибораУчета,
	|	СтабильныеПериодыСезонность.БылУстановленныйПриборВЭтомГоду КАК БылУстановленныйПриборВЭтомГоду,
	|	СтабильныеПериодыСезонность.ЕстьЗаписьПриборВЭтомГоду КАК ЕстьЗаписьПриборВЭтомГоду,
	|	СтабильныеПериодыСезонность.КлючПомещения,
	|	СтабильныеПериодыСезонность.АбонентЗакрытВТекущемПериоде,
	|	СтабильныеПериодыСезонность.НомерПозиции + 1 КАК НомерПозиции,
	|	1 КАК УвеличениеПозиции,
	|	ИзменениеНомеровСтрок.ПериодРегистрации,
	|	ВЫБОР
	|		КОГДА ИзменениеНомеровСтрок.ЭтоИзменениеТарифа
	|			ТОГДА ЗНАЧЕНИЕ(Документ.энргУстановитьЗначениеТарифа.ПустаяСсылка)
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ КАК ДокРегистратор,
	|	ДАТАВРЕМЯ(1,1,1) КАК ДатаРегистратора
	|ИЗ 
	|	СтабильныеПериодыСезонность КАК СтабильныеПериодыСезонность
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ИзменениеНомеровСтрок КАК ИзменениеНомеровСтрок
	|			ПО СтабильныеПериодыСезонность.Организация = ИзменениеНомеровСтрок.Организация 
	|			И СтабильныеПериодыСезонность.ПериодНачисления = ИзменениеНомеровСтрок.ПериодНачисления
	|			И СтабильныеПериодыСезонность.Район = ИзменениеНомеровСтрок.Район
	|			И СтабильныеПериодыСезонность.ЧастныйСектор = ИзменениеНомеровСтрок.ЧастныйСектор
	|			И СтабильныеПериодыСезонность.Строение = ИзменениеНомеровСтрок.Строение
	|			И СтабильныеПериодыСезонность.Помещение = ИзменениеНомеровСтрок.Помещение
	|			И СтабильныеПериодыСезонность.ТочкаУчета = ИзменениеНомеровСтрок.ТочкаУчета
	|			И СтабильныеПериодыСезонность.Услуга = ИзменениеНомеровСтрок.Услуга
	|			И СтабильныеПериодыСезонность.НомерПозиции = ИзменениеНомеровСтрок.НомерПозиции	
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	" + энргНачисления.СформироватьСтрокуДляЗапроса("энргСтабильныеПериоды","СтабильныеПериодыПослеИзмененияСезонности","Шкала",Истина,Ложь) + "	
	|	СтабильныеПериодыПослеИзмененияСезонности.НачалоОП КАК НачалоОП,
	|	СтабильныеПериодыПослеИзмененияСезонности.ЗавершениеОП КАК ЗавершениеОП,
	|	СтабильныеПериодыПослеИзмененияСезонности.ДнейВПериоде КАК ДнейВПериоде,
	|	СтабильныеПериодыПослеИзмененияСезонности.МКД КАК МКД,
	|	СтабильныеПериодыПослеИзмененияСезонности.КоэффициентНорматива КАК КоэффициентНорматива,
	|	СтабильныеПериодыПослеИзмененияСезонности.КоэффициентНормативаНеПрименятьСезонность КАК КоэффициентНормативаНеПрименятьСезонность,
	|	СтабильныеПериодыПослеИзмененияСезонности.КорректироватьГодовойОбъем КАК КорректироватьГодовойОбъем,
	|	СтабильныеПериодыПослеИзмененияСезонности.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	СтабильныеПериодыПослеИзмененияСезонности.ОбъемЗаПрошлыйГод КАК ОбъемЗаПрошлыйГод,
	|	СтабильныеПериодыПослеИзмененияСезонности.Сезонность КАК Сезонность,
	|	СтабильныеПериодыПослеИзмененияСезонности.ВидПлощади КАК ВидПлощади,
	|	СтабильныеПериодыПослеИзмененияСезонности.НормативПоДням КАК НормативПоДням,
	|	СтабильныеПериодыПослеИзмененияСезонности.СпособОпределенияСоциальнойНормы КАК СпособОпределенияСоциальнойНормы,
	|	СтабильныеПериодыПослеИзмененияСезонности.ЕстьПоказанияАбонента КАК ЕстьПоказанияАбонента,
	|	СтабильныеПериодыПослеИзмененияСезонности.ЗависитОтУслуги КАК ЗависитОтУслуги,
	|	СтабильныеПериодыПослеИзмененияСезонности.УмножатьНаНормуРодительскойУслуги КАК УмножатьНаНормуРодительскойУслуги,		
	|	СтабильныеПериодыПослеИзмененияСезонности.МаксимальноВозможныеПоказания КАК МаксимальноВозможныеПоказания,
	|	СтабильныеПериодыПослеИзмененияСезонности.РегистрируетОбъем КАК РегистрируетОбъем,	
	|	СтабильныеПериодыПослеИзмененияСезонности.ФизЛицо КАК ФизЛицо,	
	|	СтабильныеПериодыПослеИзмененияСезонности.ТипСхемы КАК ТипСхемы,
	|	СтабильныеПериодыПослеИзмененияСезонности.ВидТепловогоПункта КАК ВидТепловогоПункта,	
	|	СтабильныеПериодыПослеИзмененияСезонности.ПомещениеРодитель КАК ПомещениеРодитель,	
	|	СтабильныеПериодыПослеИзмененияСезонности.ИспользоватьКоэффициентСдерживанияРостаПлаты КАК ИспользоватьКоэффициентСдерживанияРостаПлаты,
	|	СтабильныеПериодыПослеИзмененияСезонности.ПлощадьМОП КАК ПлощадьМОП,
	|	СтабильныеПериодыПослеИзмененияСезонности.ПлощадьАбонентов КАК ПлощадьАбонентов,
	|	СтабильныеПериодыПослеИзмененияСезонности.ПлощадьСобственнаяПоставка КАК ПлощадьСобственнаяПоставка,	
	|	СтабильныеПериодыПослеИзмененияСезонности.ДокументНачисления КАК ДокументНачисления,
	|	СтабильныеПериодыПослеИзмененияСезонности.ДокументНачисленияПометкаУдаления КАК ДокументНачисленияПометкаУдаления,	
	|	СтабильныеПериодыПослеИзмененияСезонности.ВыводПрибораУчета КАК ВыводПрибораУчета,
	|	СтабильныеПериодыПослеИзмененияСезонности.БылУстановленныйПриборВЭтомГоду КАК БылУстановленныйПриборВЭтомГоду,
	|	СтабильныеПериодыПослеИзмененияСезонности.ЕстьЗаписьПриборВЭтомГоду КАК ЕстьЗаписьПриборВЭтомГоду,
	|	СтабильныеПериодыПослеИзмененияСезонности.КлючПомещения,
	|	СтабильныеПериодыПослеИзмененияСезонности.АбонентЗакрытВТекущемПериоде,
	|	СтабильныеПериодыПослеИзмененияСезонности.УвеличениеПозиции КАК УвеличениеПозиции,
	|	ЕСТЬNULL(СтабильныеПериодыШкалы.Шкала, ЗНАЧЕНИЕ(Справочник.энргШкалыПриборовУчета.ПустаяСсылка)) КАК Шкала,
	|	ЕСТЬNULL(СтабильныеПериодыШкалы.ВидДифференцированности, ЗНАЧЕНИЕ(Справочник.энргВидыДифференцированности.ПустаяСсылка)) КАК ВидДифференцированности,
	|	ВЫБОР
	|		КОГДА СтабильныеПериодыПослеИзмененияСезонности.Шкала = ЗНАЧЕНИЕ(Справочник.энргШкалыПриборовУчета.ПустаяСсылка)
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ ИСТИНА
	|	КОНЕЦ КАК ПривязанаКШкале,
	|	ЕСТЬNULL(ПериодыРодителя.ПриборВведен, ЛОЖЬ) КАК ЕстьПриборУчетаРодителя	
	|ПОМЕСТИТЬ СтабильныеПериодыНачалоШкалы
	|ИЗ
	|	СтабильныеПериодыПослеИзмененияСезонности КАК СтабильныеПериодыПослеИзмененияСезонности
	|		ЛЕВОЕ СОЕДИНЕНИЕ СтабильныеПериодыШкалы КАК СтабильныеПериодыШкалы
	|		ПО СтабильныеПериодыПослеИзмененияСезонности.Организация = СтабильныеПериодыШкалы.Организация
	|			И СтабильныеПериодыПослеИзмененияСезонности.ПериодНачисления = СтабильныеПериодыШкалы.ПериодНачисления
	|			И СтабильныеПериодыПослеИзмененияСезонности.Район = СтабильныеПериодыШкалы.Район
	|			И СтабильныеПериодыПослеИзмененияСезонности.ЧастныйСектор = СтабильныеПериодыШкалы.ЧастныйСектор
	|			И СтабильныеПериодыПослеИзмененияСезонности.Строение = СтабильныеПериодыШкалы.Строение
	|			И СтабильныеПериодыПослеИзмененияСезонности.Помещение = СтабильныеПериодыШкалы.Помещение
	|			И СтабильныеПериодыПослеИзмененияСезонности.ТочкаУчета = СтабильныеПериодыШкалы.ТочкаУчета
	|			И СтабильныеПериодыПослеИзмененияСезонности.НомерПозиции-СтабильныеПериодыПослеИзмененияСезонности.УвеличениеПозиции = СтабильныеПериодыШкалы.НомерПозиции
	|			И (ВЫБОР
	|				КОГДА СтабильныеПериодыПослеИзмененияСезонности.Шкала = ЗНАЧЕНИЕ(Справочник.энргШкалыПриборовУчета.ПустаяСсылка)
	|					ТОГДА ИСТИНА
	|				ИНАЧЕ СтабильныеПериодыПослеИзмененияСезонности.Шкала = СтабильныеПериодыШкалы.Шкала
	|			КОНЕЦ)		
	|		ЛЕВОЕ СОЕДИНЕНИЕ СтабильныеПериодыПослеИзмененияСезонности КАК ПериодыРодителя
	|		ПО СтабильныеПериодыПослеИзмененияСезонности.Организация = ПериодыРодителя.Организация
	|			И СтабильныеПериодыПослеИзмененияСезонности.ПериодНачисления = ПериодыРодителя.ПериодНачисления
	|			И СтабильныеПериодыПослеИзмененияСезонности.Район = ПериодыРодителя.Район
	|			И СтабильныеПериодыПослеИзмененияСезонности.ЧастныйСектор = ПериодыРодителя.ЧастныйСектор
	|			И СтабильныеПериодыПослеИзмененияСезонности.Строение = ПериодыРодителя.Строение
	|			И СтабильныеПериодыПослеИзмененияСезонности.Помещение = ПериодыРодителя.Помещение
	|			И СтабильныеПериодыПослеИзмененияСезонности.ТочкаУчетаРодитель = ПериодыРодителя.ТочкаУчета
	|			И СтабильныеПериодыПослеИзмененияСезонности.Услуга = ПериодыРодителя.Услуга
	|			И СтабильныеПериодыПослеИзмененияСезонности.ПериодРегистрации = ПериодыРодителя.ПериодРегистрации
	
	|;	
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	" + энргНачисления.СформироватьСтрокуДляЗапроса("энргСтабильныеПериоды","СтабильныеПериоды","",Истина,Ложь) + "	
	|	СтабильныеПериоды.НачалоОП КАК НачалоОП,
	|	СтабильныеПериоды.ЗавершениеОП КАК ЗавершениеОП,
	|	СтабильныеПериоды.ДнейВПериоде КАК ДнейВПериоде,
	|	СтабильныеПериоды.МКД КАК МКД,
	|	СтабильныеПериоды.КоэффициентНорматива КАК КоэффициентНорматива,
	|	СтабильныеПериоды.КоэффициентНормативаНеПрименятьСезонность КАК КоэффициентНормативаНеПрименятьСезонность,
	|	СтабильныеПериоды.КорректироватьГодовойОбъем КАК КорректироватьГодовойОбъем,
	|	СтабильныеПериоды.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	СтабильныеПериоды.ОбъемЗаПрошлыйГод КАК ОбъемЗаПрошлыйГод,
	|	СтабильныеПериоды.Сезонность КАК Сезонность,
	|	СтабильныеПериоды.ВидПлощади КАК ВидПлощади,
	|	СтабильныеПериоды.НормативПоДням КАК НормативПоДням,
	|	СтабильныеПериоды.СпособОпределенияСоциальнойНормы КАК СпособОпределенияСоциальнойНормы,
	|	СтабильныеПериоды.ЕстьПоказанияАбонента КАК ЕстьПоказанияАбонента,
	|	СтабильныеПериоды.ЗависитОтУслуги КАК ЗависитОтУслуги,
	|	СтабильныеПериоды.УмножатьНаНормуРодительскойУслуги КАК УмножатьНаНормуРодительскойУслуги,		
	|	СтабильныеПериоды.МаксимальноВозможныеПоказания КАК МаксимальноВозможныеПоказания,
	|	СтабильныеПериоды.РегистрируетОбъем КАК РегистрируетОбъем,	
	|	СтабильныеПериоды.ФизЛицо КАК ФизЛицо,	
	|	СтабильныеПериоды.ТипСхемы КАК ТипСхемы,
	|	СтабильныеПериоды.ВидТепловогоПункта КАК ВидТепловогоПункта,	
	|	СтабильныеПериоды.ПомещениеРодитель КАК ПомещениеРодитель,	
	|	СтабильныеПериоды.ИспользоватьКоэффициентСдерживанияРостаПлаты КАК ИспользоватьКоэффициентСдерживанияРостаПлаты,
	|	СтабильныеПериоды.ПлощадьМОП КАК ПлощадьМОП,
	|	СтабильныеПериоды.ПлощадьАбонентов КАК ПлощадьАбонентов,
	|	СтабильныеПериоды.ПлощадьСобственнаяПоставка КАК ПлощадьСобственнаяПоставка,	
	|	СтабильныеПериоды.ДокументНачисления КАК ДокументНачисления,
	|	СтабильныеПериоды.ДокументНачисленияПометкаУдаления КАК ДокументНачисленияПометкаУдаления,	
	|	СтабильныеПериоды.ВыводПрибораУчета КАК ВыводПрибораУчета,
	|	СтабильныеПериоды.БылУстановленныйПриборВЭтомГоду КАК БылУстановленныйПриборВЭтомГоду,
	|	СтабильныеПериоды.ЕстьЗаписьПриборВЭтомГоду КАК ЕстьЗаписьПриборВЭтомГоду,
	|	СтабильныеПериоды.КлючПомещения,
	|	СтабильныеПериоды.АбонентЗакрытВТекущемПериоде,
	|	СтабильныеПериоды.УвеличениеПозиции КАК УвеличениеПозиции,
	|	СтабильныеПериоды.ВидДифференцированности КАК ВидДифференцированности,
	|	СтабильныеПериоды.ПривязанаКШкале КАК ПривязанаКШкале,
	|	СтабильныеПериоды.ЕстьПриборУчетаРодителя КАК ЕстьПриборУчетаРодителя,
	|	ВЫБОР
	|		КОГДА энргВидыДифференцированностиТарифныеЗоны.Ссылка ЕСТЬ NULL
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.энргТарифныеЗоны.БезРазбивки)
	|		ИНАЧЕ энргВидыДифференцированностиТарифныеЗоны.ТарифнаяЗона
	|	КОНЕЦ КАК ТарифнаяЗона	
	|ПОМЕСТИТЬ СтабильныеКонецСезонностиТарифнаяЗона
	|ИЗ
	|	СтабильныеПериодыНачалоШкалы КАК СтабильныеПериоды
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.энргВидыДифференцированности.ТарифныеЗоны КАК энргВидыДифференцированностиТарифныеЗоны
	|		ПО СтабильныеПериоды.ВидДифференцированности = энргВидыДифференцированностиТарифныеЗоны.Ссылка	
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ	
	|	" + энргНачисления.СформироватьСтрокуДляЗапроса("энргСтабильныеПериоды","СтабильныеПериоды","",Истина,Ложь) + "
	|	СтабильныеПериоды.НачалоОП КАК НачалоОП,
	|	СтабильныеПериоды.ЗавершениеОП КАК ЗавершениеОП,
	|	СтабильныеПериоды.ДнейВПериоде КАК ДнейВПериоде,
	|	СтабильныеПериоды.МКД КАК МКД,
	|	СтабильныеПериоды.КоэффициентНорматива КАК КоэффициентНорматива,
	|	СтабильныеПериоды.КоэффициентНормативаНеПрименятьСезонность КАК КоэффициентНормативаНеПрименятьСезонность,
	|	СтабильныеПериоды.КорректироватьГодовойОбъем КАК КорректироватьГодовойОбъем,
	|	СтабильныеПериоды.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	СтабильныеПериоды.ОбъемЗаПрошлыйГод КАК ОбъемЗаПрошлыйГод,
	|	СтабильныеПериоды.Сезонность КАК Сезонность,
	|	СтабильныеПериоды.ВидПлощади КАК ВидПлощади,
	|	СтабильныеПериоды.НормативПоДням КАК НормативПоДням,
	|	СтабильныеПериоды.СпособОпределенияСоциальнойНормы КАК СпособОпределенияСоциальнойНормы,
	|	СтабильныеПериоды.ЕстьПоказанияАбонента КАК ЕстьПоказанияАбонента,
	|	СтабильныеПериоды.ЗависитОтУслуги КАК ЗависитОтУслуги,
	|	СтабильныеПериоды.УмножатьНаНормуРодительскойУслуги КАК УмножатьНаНормуРодительскойУслуги,		
	|	СтабильныеПериоды.МаксимальноВозможныеПоказания КАК МаксимальноВозможныеПоказания,
	|	СтабильныеПериоды.РегистрируетОбъем КАК РегистрируетОбъем,	
	|	СтабильныеПериоды.ФизЛицо КАК ФизЛицо,	
	|	СтабильныеПериоды.ТипСхемы КАК ТипСхемы,
	|	СтабильныеПериоды.ВидТепловогоПункта КАК ВидТепловогоПункта,	
	|	СтабильныеПериоды.ПомещениеРодитель КАК ПомещениеРодитель,	
	|	СтабильныеПериоды.ИспользоватьКоэффициентСдерживанияРостаПлаты КАК ИспользоватьКоэффициентСдерживанияРостаПлаты,
	|	СтабильныеПериоды.ПлощадьМОП КАК ПлощадьМОП,
	|	СтабильныеПериоды.ПлощадьАбонентов КАК ПлощадьАбонентов,
	|	СтабильныеПериоды.ПлощадьСобственнаяПоставка КАК ПлощадьСобственнаяПоставка,	
	|	СтабильныеПериоды.ДокументНачисления КАК ДокументНачисления,
	|	СтабильныеПериоды.ДокументНачисленияПометкаУдаления КАК ДокументНачисленияПометкаУдаления,	
	|	СтабильныеПериоды.ВыводПрибораУчета КАК ВыводПрибораУчета,
	|	СтабильныеПериоды.БылУстановленныйПриборВЭтомГоду КАК БылУстановленныйПриборВЭтомГоду,
	|	СтабильныеПериоды.ЕстьЗаписьПриборВЭтомГоду КАК ЕстьЗаписьПриборВЭтомГоду,
	|	СтабильныеПериоды.КлючПомещения,
	|	СтабильныеПериоды.АбонентЗакрытВТекущемПериоде,
	|	СтабильныеПериоды.УвеличениеПозиции КАК УвеличениеПозиции,
	|	СтабильныеПериоды.ВидДифференцированности КАК ВидДифференцированности,
	|	СтабильныеПериоды.ПривязанаКШкале КАК ПривязанаКШкале,
	|	СтабильныеПериоды.ЕстьПриборУчетаРодителя КАК ЕстьПриборУчетаРодителя,
	|	СтабильныеПериоды.ТарифнаяЗона КАК ТарифнаяЗона,	
	|	ЕСТЬNULL(ПериодыПоказаний.Показания, 0) КАК Показания,
	|	ВЫБОР 
	|		КОГДА СтабильныеПериоды.НеПрименятьСезонность
	|			ТОГДА 1
	|		КОГДА ПериодыСезонности.Организация ЕСТЬ NULL
	|			ТОГДА 1
	|		КОГДА ПериодыСезонности.НачалоСезонности <= СтабильныеПериоды.ПериодРегистрации 
	|			И СтабильныеПериоды.ПериодРегистрации < ПериодыСезонности.КонецСезонности
	|			ТОГДА 1
	|		ИНАЧЕ 0
	| 	КОНЕЦ КАК КоэффициентСезоности,
	|	ВЫБОР 
	|		КОГДА ПериодыСезонности.Организация ЕСТЬ NULL
	|			ТОГДА 1
	|		КОГДА ПериодыСезонности.НачалоСезонности <= СтабильныеПериоды.ПериодРегистрации 
	|			И СтабильныеПериоды.ПериодРегистрации < ПериодыСезонности.КонецСезонности
	|			ТОГДА 1
	|		ИНАЧЕ 0
	| 	КОНЕЦ КАК КоэффициентСезоностиОбъемПотребленный,	
	|	ЕСТЬNULL(ЗначенияТарифов.ЗначениеТарифа, 0) КАК ПредыдущееЗначениеТарифа,
	|	ЕСТЬNULL(ЗначенияТарифов.ЗначениеСверхНорматива,0) КАК ПредыдущееЗначениеТарифаСверхНорматива,
	|	ЕСТЬNULL(ЗначенияТарифов.ЗначениеТарифаРЭК, 0 ) КАК ПредыдущееЗначениеТарифаРЭК,	
	|	ВЫБОР
	|		КОГДА ПредоставленныеПоказанияВСрок.ПериодНачисления ЕСТЬ NULL
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ ПредоставленныеПоказанияВСрок.ВСрок
	|	КОНЕЦ КАК ПоказанияВСрок,
	|	ВЫБОР
	|		КОГДА ПредоставленныеПоказанияВСрок.ПериодНачисления ЕСТЬ NULL
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ ИСТИНА
	|	КОНЕЦ КАК ПоказанияПредоставлены,	
	|	ЕСТЬNULL(СреднееПотреблениеАбонентов.СреднийОбъем, -1) КАК СреднийОбъем,
	|	ЕСТЬNULL(СреднееПотреблениеАбонентов.СреднийОбъемПотребленный, -1) КАК СреднийОбъемПотребленный,
	|	ВЫБОР 
	|		КОГДА НЕ СтабильныеПериоды.ЗависитОтУслуги = ЗНАЧЕНИЕ(Справочник.энргВидыУслуг.ПустаяСсылка) 
	|			ТОГДА ЕСТЬNULL(СреднееПотреблениеЗависитОтУслуги.СреднийОбъем,-1) 
	|		ИНАЧЕ -1 
	|	КОНЕЦ КАК СреднийОбъемЗависитОтУслуги,	
	|	ВЫБОР 
	|		КОГДА НЕ СтабильныеПериоды.ЗависитОтУслуги = ЗНАЧЕНИЕ(Справочник.энргВидыУслуг.ПустаяСсылка) 
	|			ТОГДА ЕСТЬNULL(СреднееПотреблениеЗависитОтУслуги.СреднийОбъемПотребленный, -1) 
	|		ИНАЧЕ -1 
	|	КОНЕЦ  КАК СреднийОбъемПотребленныйЗависитОтУслуги	
	|ПОМЕСТИТЬ СтабильныеПериодыПоказания
	|ИЗ
	|	СтабильныеКонецСезонностиТарифнаяЗона КАК СтабильныеПериоды
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПериодыПоказаний КАК ПериодыПоказаний
	|		ПО (ВЫБОР
	|				КОГДА СтабильныеПериоды.ДокРегистратор ССЫЛКА Документ.энргНачисление
	|					ТОГДА ПериодыПоказаний.ПризнакНачалаПериода
	|				КОГДА СтабильныеПериоды.ДокРегистратор ССЫЛКА Документ.энргВводНачальныхОстатков
	|					ТОГДА ПериодыПоказаний.ПризнакНачалаПериода
	|				КОГДА СтабильныеПериоды.ДокРегистратор ССЫЛКА Документ.энргОперацияСЛицевымСчетом
	|						И НЕ СтабильныеПериоды.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|					ТОГДА СтабильныеПериоды.ДокРегистратор = ПериодыПоказаний.ДокРегистратор
	|				КОГДА СтабильныеПериоды.ДокРегистратор ССЫЛКА Документ.энргОперацияСПриборомУчета
	|					ТОГДА СтабильныеПериоды.ДокРегистратор = ПериодыПоказаний.ДокРегистратор
	|				КОГДА СтабильныеПериоды.ДокРегистратор ССЫЛКА Документ.энргОперацияСУслугами
	|					ТОГДА СтабильныеПериоды.ДокРегистратор = ПериодыПоказаний.ДокРегистратор
	|				ИНАЧЕ СтабильныеПериоды.ПериодРегистрации МЕЖДУ ПериодыПоказаний.НачалоПериодДействия И ПериодыПоказаний.ОкончаниеПериодаДействия
	|			КОНЕЦ)
	|			И СтабильныеПериоды.Организация = ПериодыПоказаний.Организация
	|			И СтабильныеПериоды.ПериодНачисления = ПериодыПоказаний.ПериодНачисления
	|			И СтабильныеПериоды.Район = ПериодыПоказаний.Район
	|			И СтабильныеПериоды.ЧастныйСектор = ПериодыПоказаний.ЧастныйСектор
	|			И СтабильныеПериоды.Строение = ПериодыПоказаний.Строение
	|			И СтабильныеПериоды.Помещение = ПериодыПоказаний.Помещение
	|			И СтабильныеПериоды.ПриборУчета = ПериодыПоказаний.ПриборУчета
	|			И СтабильныеПериоды.Шкала = ПериодыПоказаний.Шкала
	|			И СтабильныеПериоды.ТарифнаяЗона = ПериодыПоказаний.ТарифнаяЗона	
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПериодыСезонности КАК ПериодыСезонности
	|		ПО СтабильныеПериоды.Организация = ПериодыСезонности.Организация
	|			И СтабильныеПериоды.ПериодНачисления = ПериодыСезонности.ПериодНачисления
	|			И СтабильныеПериоды.Район = ПериодыСезонности.Район
	|			И СтабильныеПериоды.Сезонность = ПериодыСезонности.Сезонность	
	|		ЛЕВОЕ СОЕДИНЕНИЕ ЗначенияТарифов КАК ЗначенияТарифов
	|		ПО СтабильныеПериоды.Организация = ЗначенияТарифов.Организация
	|			И СтабильныеПериоды.ПериодНачисления = ЗначенияТарифов.ПериодНачисления
	|			И СтабильныеПериоды.Район = ЗначенияТарифов.Район
	|			И СтабильныеПериоды.ТарифнаяГруппа = ЗначенияТарифов.ГруппаПотребителей
	|			И СтабильныеПериоды.Услуга = ЗначенияТарифов.Услуга	
	|			И СтабильныеПериоды.Поставщик = ЗначенияТарифов.Поставщик
	|			И СтабильныеПериоды.ТарифнаяЗона = ЗначенияТарифов.ТарифнаяЗона	
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПредоставленныеПоказанияВСрок КАК ПредоставленныеПоказанияВСрок
	|		ПО СтабильныеПериоды.Организация = ПредоставленныеПоказанияВСрок.Организация
	|			И СтабильныеПериоды.ПериодНачисления = ПредоставленныеПоказанияВСрок.ПериодНачисления
	|			И СтабильныеПериоды.Район = ПредоставленныеПоказанияВСрок.Район
	|			И СтабильныеПериоды.ЧастныйСектор = ПредоставленныеПоказанияВСрок.ЧастныйСектор
	|			И СтабильныеПериоды.Строение = ПредоставленныеПоказанияВСрок.Строение
	|			И СтабильныеПериоды.Помещение = ПредоставленныеПоказанияВСрок.Помещение
	|			И СтабильныеПериоды.ПриборУчета = ПредоставленныеПоказанияВСрок.ПриборУчета
	|			И СтабильныеПериоды.Шкала = ПредоставленныеПоказанияВСрок.Шкала
	|			И СтабильныеПериоды.ТарифнаяЗона = ПредоставленныеПоказанияВСрок.ТарифнаяЗона	
	|		ЛЕВОЕ СОЕДИНЕНИЕ СреднееПотреблениеАбонентов КАК СреднееПотреблениеАбонентов
	|		ПО СтабильныеПериоды.Организация = СреднееПотреблениеАбонентов.Организация
	|			И СтабильныеПериоды.ПериодНачисления = СреднееПотреблениеАбонентов.ПериодНачисления
	|			И СтабильныеПериоды.Район = СреднееПотреблениеАбонентов.Район
	|			И СтабильныеПериоды.ЧастныйСектор = СреднееПотреблениеАбонентов.ЧастныйСектор
	|			И СтабильныеПериоды.Строение = СреднееПотреблениеАбонентов.Строение
	|			И СтабильныеПериоды.Помещение = СреднееПотреблениеАбонентов.Помещение
	|			И СтабильныеПериоды.ТочкаУчета = СреднееПотреблениеАбонентов.ТочкаУчета
	|			И СтабильныеПериоды.Услуга = СреднееПотреблениеАбонентов.Услуга
	|			И СтабильныеПериоды.Шкала = СреднееПотреблениеАбонентов.Шкала
	|			И СтабильныеПериоды.ТарифнаяЗона = СреднееПотреблениеАбонентов.ТарифнаяЗона	
	|		ЛЕВОЕ СОЕДИНЕНИЕ СреднееПотреблениеАбонентов КАК СреднееПотреблениеЗависитОтУслуги
	|		ПО СтабильныеПериоды.Организация = СреднееПотреблениеЗависитОтУслуги.Организация
	|			И СтабильныеПериоды.ПериодНачисления = СреднееПотреблениеЗависитОтУслуги.ПериодНачисления
	|			И СтабильныеПериоды.Район = СреднееПотреблениеЗависитОтУслуги.Район
	|			И СтабильныеПериоды.ЧастныйСектор = СреднееПотреблениеЗависитОтУслуги.ЧастныйСектор
	|			И СтабильныеПериоды.Строение = СреднееПотреблениеЗависитОтУслуги.Строение
	|			И СтабильныеПериоды.Помещение = СреднееПотреблениеЗависитОтУслуги.Помещение
	|			И СтабильныеПериоды.ТочкаУчета = СреднееПотреблениеЗависитОтУслуги.ТочкаУчета
	|			И СтабильныеПериоды.ЗависитОтУслуги = СреднееПотреблениеЗависитОтУслуги.Услуга
	|			И СтабильныеПериоды.Шкала = СреднееПотреблениеЗависитОтУслуги.Шкала
	|			И СтабильныеПериоды.ТарифнаяЗона = СреднееПотреблениеЗависитОтУслуги.ТарифнаяЗона	
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////	
	|ВЫБРАТЬ
	|	" + энргНачисления.СформироватьСтрокуДляЗапроса("энргСтабильныеПериоды","СтабильныеПериодыПоказанияНачало","",Истина,Ложь) + "	
	|	СтабильныеПериодыПоказанияНачало.НачалоОП КАК НачалоОП,
	|	СтабильныеПериодыПоказанияНачало.ЗавершениеОП КАК ЗавершениеОП,
	|	СтабильныеПериодыПоказанияНачало.ДнейВПериоде КАК ДнейВПериоде,
	|	СтабильныеПериодыПоказанияНачало.МКД КАК МКД,
	|	СтабильныеПериодыПоказанияНачало.КоэффициентНорматива КАК КоэффициентНорматива,
	|	СтабильныеПериодыПоказанияНачало.КоэффициентНормативаНеПрименятьСезонность КАК КоэффициентНормативаНеПрименятьСезонность,
	|	СтабильныеПериодыПоказанияНачало.КорректироватьГодовойОбъем КАК КорректироватьГодовойОбъем,
	|	СтабильныеПериодыПоказанияНачало.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	СтабильныеПериодыПоказанияНачало.ОбъемЗаПрошлыйГод КАК ОбъемЗаПрошлыйГод,
	|	СтабильныеПериодыПоказанияНачало.Сезонность КАК Сезонность,
	|	СтабильныеПериодыПоказанияНачало.ВидПлощади КАК ВидПлощади,
	|	СтабильныеПериодыПоказанияНачало.НормативПоДням КАК НормативПоДням,
	|	СтабильныеПериодыПоказанияНачало.СпособОпределенияСоциальнойНормы КАК СпособОпределенияСоциальнойНормы,
	|	СтабильныеПериодыПоказанияНачало.ЕстьПоказанияАбонента КАК ЕстьПоказанияАбонента,
	|	СтабильныеПериодыПоказанияНачало.ЗависитОтУслуги КАК ЗависитОтУслуги,
	|	СтабильныеПериодыПоказанияНачало.УмножатьНаНормуРодительскойУслуги КАК УмножатьНаНормуРодительскойУслуги,		
	|	СтабильныеПериодыПоказанияНачало.МаксимальноВозможныеПоказания КАК МаксимальноВозможныеПоказания,
	|	СтабильныеПериодыПоказанияНачало.РегистрируетОбъем КАК РегистрируетОбъем,	
	|	СтабильныеПериодыПоказанияНачало.ФизЛицо КАК ФизЛицо,	
	|	СтабильныеПериодыПоказанияНачало.ТипСхемы КАК ТипСхемы,
	|	СтабильныеПериодыПоказанияНачало.ВидТепловогоПункта КАК ВидТепловогоПункта,	
	|	СтабильныеПериодыПоказанияНачало.ПомещениеРодитель КАК ПомещениеРодитель,	
	|	СтабильныеПериодыПоказанияНачало.ИспользоватьКоэффициентСдерживанияРостаПлаты КАК ИспользоватьКоэффициентСдерживанияРостаПлаты,
	|	СтабильныеПериодыПоказанияНачало.ПлощадьМОП КАК ПлощадьМОП,
	|	СтабильныеПериодыПоказанияНачало.ПлощадьАбонентов КАК ПлощадьАбонентов,
	|	СтабильныеПериодыПоказанияНачало.ПлощадьСобственнаяПоставка КАК ПлощадьСобственнаяПоставка,	
	|	СтабильныеПериодыПоказанияНачало.ДокументНачисления КАК ДокументНачисления,
	|	СтабильныеПериодыПоказанияНачало.ДокументНачисленияПометкаУдаления КАК ДокументНачисленияПометкаУдаления,	
	|	СтабильныеПериодыПоказанияНачало.ВыводПрибораУчета КАК ВыводПрибораУчета,
	|	СтабильныеПериодыПоказанияНачало.БылУстановленныйПриборВЭтомГоду КАК БылУстановленныйПриборВЭтомГоду,
	|	СтабильныеПериодыПоказанияНачало.ЕстьЗаписьПриборВЭтомГоду КАК ЕстьЗаписьПриборВЭтомГоду,
	|	СтабильныеПериодыПоказанияНачало.КлючПомещения,
	|	СтабильныеПериодыПоказанияНачало.АбонентЗакрытВТекущемПериоде,
	|	СтабильныеПериодыПоказанияНачало.УвеличениеПозиции КАК УвеличениеПозиции,
	|	СтабильныеПериодыПоказанияНачало.ВидДифференцированности КАК ВидДифференцированности,
	|	СтабильныеПериодыПоказанияНачало.ПривязанаКШкале КАК ПривязанаКШкале,
	|	СтабильныеПериодыПоказанияНачало.ЕстьПриборУчетаРодителя КАК ЕстьПриборУчетаРодителя,
	|	СтабильныеПериодыПоказанияНачало.ТарифнаяЗона КАК ТарифнаяЗона,	
	|	СтабильныеПериодыПоказанияНачало.Показания КАК Показания,
	|	СтабильныеПериодыПоказанияНачало.КоэффициентСезоности КАК КоэффициентСезоности,
	|	СтабильныеПериодыПоказанияНачало.КоэффициентСезоностиОбъемПотребленный КАК КоэффициентСезоностиОбъемПотребленный,
	|	СтабильныеПериодыПоказанияНачало.ПредыдущееЗначениеТарифа КАК ПредыдущееЗначениеТарифа,
	|	СтабильныеПериодыПоказанияНачало.ПредыдущееЗначениеТарифаСверхНорматива КАК ПредыдущееЗначениеТарифаСверхНорматива,
	|	СтабильныеПериодыПоказанияНачало.ПредыдущееЗначениеТарифаРЭК КАК ПредыдущееЗначениеТарифаРЭК,	
	|	СтабильныеПериодыПоказанияНачало.ПоказанияВСрок КАК ПоказанияВСрок,
	|	СтабильныеПериодыПоказанияНачало.ПоказанияПредоставлены КАК ПоказанияПредоставлены,	
	|	СтабильныеПериодыПоказанияНачало.СреднийОбъем КАК СреднийОбъем,
	|	СтабильныеПериодыПоказанияНачало.СреднийОбъемПотребленный КАК СреднийОбъемПотребленный,
	|	СтабильныеПериодыПоказанияНачало.СреднийОбъемЗависитОтУслуги КАК СреднийОбъемЗависитОтУслуги,	
	|	СтабильныеПериодыПоказанияНачало.СреднийОбъемПотребленныйЗависитОтУслуги  КАК СреднийОбъемПотребленныйЗависитОтУслуги,	
	|	ВЫБОР
	|		КОГДА СтабильныеПериодыПоказанияНачало.ПериодНачисления = &НачалоВеденияУчета
	|			ТОГДА ВЫБОР
	|					КОГДА СтабильныеПериодыПоказанияНачало.ПериодРегистрации < СтабильныеПериодыПоказанияНачало.ПериодНачисления
	|						ТОГДА СтабильныеПериодыПоказанияНачало.ПериодНачисления
	|					КОГДА СтабильныеПериодыПоказанияНачало.ПериодРегистрации > СтабильныеПериодыПоказанияНачало.ЗавершениеОП
	|						ТОГДА СтабильныеПериодыПоказанияНачало.ЗавершениеОП
	|					ИНАЧЕ СтабильныеПериодыПоказанияНачало.ПериодРегистрации
	|				КОНЕЦ
	|		КОГДА СтабильныеПериодыПоказанияНачало.ПериодРегистрации < СтабильныеПериодыПоказанияНачало.НачалоОП
	|			ТОГДА СтабильныеПериодыПоказанияНачало.НачалоОП
	|		КОГДА СтабильныеПериодыПоказанияНачало.ПериодРегистрации > СтабильныеПериодыПоказанияНачало.ЗавершениеОП
	|			ТОГДА СтабильныеПериодыПоказанияНачало.ДатаРегистратора
	|		ИНАЧЕ СтабильныеПериодыПоказанияНачало.ПериодРегистрации
	|	КОНЕЦ КАК НачалоПериода,	
	|	ВЫБОР
	|		КОГДА СтабильныеПериодыПоказанияКонец.ПериодРегистрации ЕСТЬ NULL
	|			ТОГДА СтабильныеПериодыПоказанияНачало.ЗавершениеОП
	|		КОГДА СтабильныеПериодыПоказанияНачало.ПериодНачисления = &НачалоВеденияУчета
	|			ТОГДА ВЫБОР
	|					КОГДА СтабильныеПериодыПоказанияКонец.ПериодРегистрации < СтабильныеПериодыПоказанияНачало.ПериодНачисления
	|						ТОГДА СтабильныеПериодыПоказанияНачало.ПериодНачисления
	|					КОГДА СтабильныеПериодыПоказанияКонец.ПериодРегистрации > СтабильныеПериодыПоказанияНачало.ЗавершениеОП
	|						ТОГДА СтабильныеПериодыПоказанияНачало.ЗавершениеОП
	|					ИНАЧЕ СтабильныеПериодыПоказанияКонец.ПериодРегистрации
	|				КОНЕЦ
	|		КОГДА СтабильныеПериодыПоказанияКонец.ПериодРегистрации < СтабильныеПериодыПоказанияНачало.НачалоОП
	|			ТОГДА СтабильныеПериодыПоказанияКонец.НачалоОП
	|		КОГДА СтабильныеПериодыПоказанияКонец.ПериодРегистрации > СтабильныеПериодыПоказанияНачало.ЗавершениеОП
	|			ТОГДА СтабильныеПериодыПоказанияКонец.ДатаРегистратора
	|		ИНАЧЕ СтабильныеПериодыПоказанияКонец.ПериодРегистрации
	|	КОНЕЦ КАК КонецПериода,
	|	СтабильныеПериодыПоказанияНачало.Показания КАК НачальныеПоказания,
	|	ВЫБОР
	|		КОГДА СтабильныеПериодыПоказанияКонец.ПриборУчета ЕСТЬ NULL
	|			ТОГДА СтабильныеПериодыПоказанияНачало.Показания
	|		ИНАЧЕ ВЫБОР
	|				КОГДА СтабильныеПериодыПоказанияНачало.ПриборУчета = СтабильныеПериодыПоказанияКонец.ПриборУчета
	|					ТОГДА СтабильныеПериодыПоказанияКонец.Показания
	|				ИНАЧЕ СтабильныеПериодыПоказанияНачало.Показания
	|			КОНЕЦ
	|	КОНЕЦ КАК КонечныеПоказания,
	|	ЕСТЬNULL(СтабильныеПериодыПоказанияКонец.ДокРегистратор, НЕОПРЕДЕЛЕНО) КАК СледующийРегистратор
	|ПОМЕСТИТЬ Периоды
	|ИЗ
	|	СтабильныеПериодыПоказания КАК СтабильныеПериодыПоказанияНачало
	|		ЛЕВОЕ СОЕДИНЕНИЕ СтабильныеПериодыПоказания КАК СтабильныеПериодыПоказанияКонец
	|		ПО (СтабильныеПериодыПоказанияНачало.НомерПозиции = СтабильныеПериодыПоказанияКонец.НомерПозиции - 1)
	|			И СтабильныеПериодыПоказанияНачало.Организация = СтабильныеПериодыПоказанияКонец.Организация
	|			И СтабильныеПериодыПоказанияНачало.ПериодНачисления = СтабильныеПериодыПоказанияКонец.ПериодНачисления
	|			И СтабильныеПериодыПоказанияНачало.Район = СтабильныеПериодыПоказанияКонец.Район
	|			И СтабильныеПериодыПоказанияНачало.ЧастныйСектор = СтабильныеПериодыПоказанияКонец.ЧастныйСектор
	|			И СтабильныеПериодыПоказанияНачало.Строение = СтабильныеПериодыПоказанияКонец.Строение
	|			И СтабильныеПериодыПоказанияНачало.Помещение = СтабильныеПериодыПоказанияКонец.Помещение
	|			И СтабильныеПериодыПоказанияНачало.ТочкаУчета = СтабильныеПериодыПоказанияКонец.ТочкаУчета
	|			И СтабильныеПериодыПоказанияНачало.Услуга = СтабильныеПериодыПоказанияКонец.Услуга";
	
	Если ЭтоПерерасчет тогда
		Текст 						= СтрЗаменить(Текст,"энргВводНачальныхОстатков","энргНачисление");
	КонецЕсли;
	
	Возврат Текст;
	
КонецФункции

Функция ТекстПолучитьДанныеДляРасчета()
	Текст   = 
	"ВЫБРАТЬ
	|	" + энргНачисления.СформироватьСтрокуДляЗапроса("энргСтабильныеПериоды","Периоды","",Истина,Ложь) + "	
	|	Периоды.НачалоОП КАК НачалоОП,
	|	Периоды.ЗавершениеОП КАК ЗавершениеОП,
	|	Периоды.ДнейВПериоде КАК ДнейВПериоде,
	|	Периоды.МКД КАК МКД,
	|	Периоды.КоэффициентНорматива КАК КоэффициентНорматива,
	|	Периоды.КоэффициентНормативаНеПрименятьСезонность КАК КоэффициентНормативаНеПрименятьСезонность,
	|	Периоды.КорректироватьГодовойОбъем КАК КорректироватьГодовойОбъем,
	|	Периоды.ОбъемЗаПрошлыйГод КАК ОбъемЗаПрошлыйГод,
	|	Периоды.Сезонность КАК Сезонность,
	|	Периоды.ВидПлощади КАК ВидПлощади,
	|	Периоды.НормативПоДням КАК НормативПоДням,
	|	Периоды.СпособОпределенияСоциальнойНормы КАК СпособОпределенияСоциальнойНормы,
	|	Периоды.ЕстьПоказанияАбонента КАК ЕстьПоказанияАбонента,
	|	Периоды.ЗависитОтУслуги КАК ЗависитОтУслуги,
	|	Периоды.УмножатьНаНормуРодительскойУслуги КАК УмножатьНаНормуРодительскойУслуги,
	|	Периоды.МаксимальноВозможныеПоказания КАК МаксимальноВозможныеПоказания,
	|	Периоды.РегистрируетОбъем КАК РегистрируетОбъем,
	|	Периоды.ФизЛицо КАК ФизЛицо,
	|	Периоды.ТипСхемы КАК ТипСхемы,
	|	Периоды.ВидТепловогоПункта КАК ВидТепловогоПункта,
	|	Периоды.ПомещениеРодитель КАК ПомещениеРодитель,
	|	Периоды.ИспользоватьКоэффициентСдерживанияРостаПлаты КАК ИспользоватьКоэффициентСдерживанияРостаПлаты,
	|	Периоды.ПлощадьМОП КАК ПлощадьМОП,
	|	Периоды.ПлощадьАбонентов КАК ПлощадьАбонентов,
	|	Периоды.ПлощадьСобственнаяПоставка КАК ПлощадьСобственнаяПоставка,
	|	Периоды.ДокументНачисления КАК ДокументНачисления,
	|	Периоды.ДокументНачисленияПометкаУдаления КАК ДокументНачисленияПометкаУдаления,
	|	Периоды.ВыводПрибораУчета КАК ВыводПрибораУчета,
	|	Периоды.БылУстановленныйПриборВЭтомГоду КАК БылУстановленныйПриборВЭтомГоду,
	|	Периоды.ЕстьЗаписьПриборВЭтомГоду КАК ЕстьЗаписьПриборВЭтомГоду,
	|	Периоды.КлючПомещения КАК КлючПомещения,
	|	Периоды.АбонентЗакрытВТекущемПериоде КАК АбонентЗакрытВТекущемПериоде,
	|	Периоды.УвеличениеПозиции КАК УвеличениеПозиции,
	|	Периоды.ВидДифференцированности КАК ВидДифференцированности,
	|	Периоды.ПривязанаКШкале КАК ПривязанаКШкале,
	|	Периоды.ЕстьПриборУчетаРодителя КАК ЕстьПриборУчетаРодителя,
	|	Периоды.ТарифнаяЗона КАК ТарифнаяЗона,
	|	Периоды.Показания КАК Показания,
	|	Периоды.КоэффициентСезоности КАК КоэффициентСезоности,
	|	Периоды.КоэффициентСезоностиОбъемПотребленный КАК КоэффициентСезоностиОбъемПотребленный,
	|	Периоды.ПредыдущееЗначениеТарифа КАК ПредыдущееЗначениеТарифа,
	|	Периоды.ПредыдущееЗначениеТарифаСверхНорматива КАК ПредыдущееЗначениеТарифаСверхНорматива,
	|	Периоды.ПредыдущееЗначениеТарифаРЭК КАК ПредыдущееЗначениеТарифаРЭК,
	|	Периоды.ПоказанияВСрок КАК ПоказанияВСрок,
	|	Периоды.ПоказанияПредоставлены КАК ПоказанияПредоставлены,
	|	Периоды.СреднийОбъем КАК СреднийОбъем,
	|	Периоды.СреднийОбъемПотребленный КАК СреднийОбъемПотребленный,
	|	Периоды.СреднийОбъемЗависитОтУслуги КАК СреднийОбъемЗависитОтУслуги,
	|	Периоды.СреднийОбъемПотребленныйЗависитОтУслуги КАК СреднийОбъемПотребленныйЗависитОтУслуги,
	|	Периоды.НачалоПериода КАК НачалоПериода,
	|	Периоды.КонецПериода КАК КонецПериода,
	|	Периоды.НачальныеПоказания КАК НачальныеПоказания,
	|	ВЫБОР
	|		КОГДА Периоды.КонецПериода = Периоды.ЗавершениеОП
	|			ТОГДА ЕСТЬNULL(МаксимальныеПоказания.Показания, 0)
	|		ИНАЧЕ Периоды.КонечныеПоказания
	|	КОНЕЦ КАК КонечныеПоказания,
	|	Периоды.СледующийРегистратор КАК СледующийРегистратор,
	|	ВЫБОР
	|		КОГДА НЕ Периоды.КорректироватьГодовойОбъем
	|				И НЕ Периоды.Сезонность = ЗНАЧЕНИЕ(Справочник.энргВидыСезонности.ПустаяСсылка)
	|				И ВЫБОР
	|					КОГДА НЕ Периоды.ЕстьЗаписьПриборВЭтомГоду
	|						ТОГДА Периоды.ЕстьПриборУчетаРодителя
	|					КОГДА Периоды.БылУстановленныйПриборВЭтомГоду
	|						ТОГДА ИСТИНА
	|					ИНАЧЕ Периоды.ЕстьПриборУчетаРодителя
	|				КОНЕЦ
	|			ТОГДА Периоды.КоэффициентСезоностиОбъемПотребленный
	|		ИНАЧЕ 1
	|	КОНЕЦ КАК КоэффициентНормативаСПУ,
	|	ВЫБОР
	|		КОГДА НЕ Периоды.КорректироватьГодовойОбъем
	|				И НЕ Периоды.Сезонность = ЗНАЧЕНИЕ(Справочник.энргВидыСезонности.ПустаяСсылка)
	|				И ВЫБОР
	|					КОГДА НЕ Периоды.ЕстьЗаписьПриборВЭтомГоду
	|						ТОГДА Периоды.ЕстьПриборУчетаРодителя
	|					КОГДА Периоды.БылУстановленныйПриборВЭтомГоду
	|						ТОГДА ИСТИНА
	|					ИНАЧЕ Периоды.ЕстьПриборУчетаРодителя
	|				КОНЕЦ
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ Периоды.НеПрименятьСезонность
	|	КОНЕЦ КАК НеПрименятьСезонность
	|ПОМЕСТИТЬ ДанныеДляРасчетаПередНормой
	|ИЗ
	|	Периоды КАК Периоды
	|		ЛЕВОЕ СОЕДИНЕНИЕ МаксимальныеПоказания КАК МаксимальныеПоказания
	|		ПО Периоды.Организация = МаксимальныеПоказания.Организация
	|			И Периоды.ПериодНачисления = МаксимальныеПоказания.ПериодНачисления
	|			И Периоды.Район = МаксимальныеПоказания.Район
	|			И Периоды.ЧастныйСектор = МаксимальныеПоказания.ЧастныйСектор
	|			И Периоды.Строение = МаксимальныеПоказания.Строение
	|			И Периоды.Помещение = МаксимальныеПоказания.Помещение
	|			И Периоды.ПриборУчета = МаксимальныеПоказания.ПриборУчета
	|			И Периоды.Шкала = МаксимальныеПоказания.Шкала
	|			И Периоды.ТарифнаяЗона = МаксимальныеПоказания.ТарифнаяЗона
	|ГДЕ
	|	Периоды.УслугаПодключена
	|	И НЕ Периоды.БлокировочныйАкт
	|;
	|//////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	" + энргНачисления.СформироватьСтрокуДляЗапроса("энргСтабильныеПериоды","ДанныеДляРасчетаПередНормой","НомерПозиции,ПериодРегистрации,ДатаРегистратора,ДокРегистратор,КлючНорматива",Истина,Ложь) + "
	|	ДанныеДляРасчетаПередНормой.НачалоОП КАК НачалоОП,
	|	ДанныеДляРасчетаПередНормой.ЗавершениеОП КАК ЗавершениеОП,
	|	ДанныеДляРасчетаПередНормой.ДнейВПериоде КАК ДнейВПериоде,
	|	ДанныеДляРасчетаПередНормой.МКД КАК МКД,
	|	ДанныеДляРасчетаПередНормой.КоэффициентНорматива КАК КоэффициентНорматива,
	|	ДанныеДляРасчетаПередНормой.КоэффициентНормативаНеПрименятьСезонность КАК КоэффициентНормативаНеПрименятьСезонность,
	|	ДанныеДляРасчетаПередНормой.КорректироватьГодовойОбъем КАК КорректироватьГодовойОбъем,
	|	ДанныеДляРасчетаПередНормой.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	ДанныеДляРасчетаПередНормой.ОбъемЗаПрошлыйГод КАК ОбъемЗаПрошлыйГод,
	|	ДанныеДляРасчетаПередНормой.Сезонность КАК Сезонность,
	|	ДанныеДляРасчетаПередНормой.ВидПлощади КАК ВидПлощади,
	|	ДанныеДляРасчетаПередНормой.НормативПоДням КАК НормативПоДням,
	|	ДанныеДляРасчетаПередНормой.СпособОпределенияСоциальнойНормы КАК СпособОпределенияСоциальнойНормы,
	|	ДанныеДляРасчетаПередНормой.ЕстьПоказанияАбонента КАК ЕстьПоказанияАбонента,
	|	ДанныеДляРасчетаПередНормой.ЗависитОтУслуги КАК ЗависитОтУслуги,
	|	ДанныеДляРасчетаПередНормой.УмножатьНаНормуРодительскойУслуги КАК УмножатьНаНормуРодительскойУслуги,		
	|	ДанныеДляРасчетаПередНормой.МаксимальноВозможныеПоказания КАК МаксимальноВозможныеПоказания,
	|	ДанныеДляРасчетаПередНормой.РегистрируетОбъем КАК РегистрируетОбъем,	
	|	ДанныеДляРасчетаПередНормой.ФизЛицо КАК ФизЛицо,	
	|	ДанныеДляРасчетаПередНормой.ТипСхемы КАК ТипСхемы,
	|	ДанныеДляРасчетаПередНормой.ВидТепловогоПункта КАК ВидТепловогоПункта,	
	|	ДанныеДляРасчетаПередНормой.ПомещениеРодитель КАК ПомещениеРодитель,	
	|	ДанныеДляРасчетаПередНормой.ИспользоватьКоэффициентСдерживанияРостаПлаты КАК ИспользоватьКоэффициентСдерживанияРостаПлаты,
	|	ДанныеДляРасчетаПередНормой.ПлощадьМОП КАК ПлощадьМОП,
	|	ДанныеДляРасчетаПередНормой.ПлощадьАбонентов КАК ПлощадьАбонентов,
	|	ДанныеДляРасчетаПередНормой.ПлощадьСобственнаяПоставка КАК ПлощадьСобственнаяПоставка,	
	|	ДанныеДляРасчетаПередНормой.ДокументНачисления КАК ДокументНачисления,
	|	ДанныеДляРасчетаПередНормой.ДокументНачисленияПометкаУдаления КАК ДокументНачисленияПометкаУдаления,	
	|	ДанныеДляРасчетаПередНормой.ВыводПрибораУчета КАК ВыводПрибораУчета,
	|	ДанныеДляРасчетаПередНормой.БылУстановленныйПриборВЭтомГоду КАК БылУстановленныйПриборВЭтомГоду,
	|	ДанныеДляРасчетаПередНормой.ЕстьЗаписьПриборВЭтомГоду КАК ЕстьЗаписьПриборВЭтомГоду,
	|	ДанныеДляРасчетаПередНормой.КлючПомещения,
	|	ДанныеДляРасчетаПередНормой.АбонентЗакрытВТекущемПериоде,
	|	ДанныеДляРасчетаПередНормой.УвеличениеПозиции КАК УвеличениеПозиции,
	|	ДанныеДляРасчетаПередНормой.ВидДифференцированности КАК ВидДифференцированности,
	|	ДанныеДляРасчетаПередНормой.ПривязанаКШкале КАК ПривязанаКШкале,
	|	ДанныеДляРасчетаПередНормой.ЕстьПриборУчетаРодителя КАК ЕстьПриборУчетаРодителя,
	|	ДанныеДляРасчетаПередНормой.ТарифнаяЗона КАК ТарифнаяЗона,	
	|	ДанныеДляРасчетаПередНормой.Показания КАК Показания,
	|	ДанныеДляРасчетаПередНормой.КоэффициентСезоности КАК КоэффициентСезоности,
	|	ДанныеДляРасчетаПередНормой.КоэффициентСезоностиОбъемПотребленный КАК КоэффициентСезоностиОбъемПотребленный,
	|	ДанныеДляРасчетаПередНормой.ПредыдущееЗначениеТарифа КАК ПредыдущееЗначениеТарифа,
	|	ДанныеДляРасчетаПередНормой.ПредыдущееЗначениеТарифаСверхНорматива КАК ПредыдущееЗначениеТарифаСверхНорматива,
	|	ДанныеДляРасчетаПередНормой.ПредыдущееЗначениеТарифаРЭК КАК ПредыдущееЗначениеТарифаРЭК,	
	|	ДанныеДляРасчетаПередНормой.ПоказанияВСрок КАК ПоказанияВСрок,
	|	ДанныеДляРасчетаПередНормой.ПоказанияПредоставлены КАК ПоказанияПредоставлены,	
	|	ДанныеДляРасчетаПередНормой.СреднийОбъем КАК СреднийОбъем,
	|	ДанныеДляРасчетаПередНормой.СреднийОбъемПотребленный КАК СреднийОбъемПотребленный,
	|	ДанныеДляРасчетаПередНормой.СреднийОбъемЗависитОтУслуги КАК СреднийОбъемЗависитОтУслуги,	
	|	ДанныеДляРасчетаПередНормой.СреднийОбъемПотребленныйЗависитОтУслуги  КАК СреднийОбъемПотребленныйЗависитОтУслуги,	
	|	ДанныеДляРасчетаПередНормой.НачалоПериода КАК НачалоПериода,	
	|	ДанныеДляРасчетаПередНормой.КонецПериода КАК КонецПериода,
	|	ДанныеДляРасчетаПередНормой.НачальныеПоказания КАК НачальныеПоказания,
	|	ДанныеДляРасчетаПередНормой.КонечныеПоказания КАК КонечныеПоказания,
	|	ДанныеДляРасчетаПередНормой.СледующийРегистратор КАК СледующийРегистратор,		
	|	ДанныеДляРасчетаПередНормой.КоэффициентНормативаСПУ КАК КоэффициентНормативаСПУ,	
	|	ЕСТЬNULL(СтабильныеПериодыИзмерителиНаправлений.Измеритель,ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ПустаяСсылка))  КАК Измеритель,
	|	ЕСТЬNULL(СтабильныеПериодыИзмерителиНаправлений.КлючНорматива,ДанныеДляРасчетаПередНормой.КлючНорматива) КАК КлючНорматива,
	|	ЕСТЬNULL(СтабильныеПериодыИзмерителиНаправлений.Количество,0) КАК КоличествоИзмеретелейНаправления,
	|	НЕ СтабильныеПериодыИзмерителиНаправлений.Количество ЕСТЬ NULL КАК ЕстьИзмерителиНаправления,
	|	выбор когда ДанныеДляРасчетаПередНормой.ДатаПоверки = ДАТАВРЕМЯ(1,1,1) тогда 0 когда ДОБАВИТЬКДАТЕ(ДанныеДляРасчетаПередНормой.ДатаПоверки, МЕСЯЦ, 3) < ДанныеДляРасчетаПередНормой.ЗавершениеОП Тогда 3 когда ДанныеДляРасчетаПередНормой.ДатаПоверки < ДанныеДляРасчетаПередНормой.ЗавершениеОП Тогда 2 Иначе 1 конец как УслНаДатуПоверки
	|ПОМЕСТИТЬ ДанныеДляРасчетаПередНормойИзмерители
	|	ИЗ ДанныеДляРасчетаПередНормой КАК ДанныеДляРасчетаПередНормой
	|		ЛЕВОЕ СОЕДИНЕНИЕ СтабильныеПериодыИзмерителиНаправлений КАК СтабильныеПериодыИзмерителиНаправлений
	|		ПО ДанныеДляРасчетаПередНормой.Организация = СтабильныеПериодыИзмерителиНаправлений.Организация
	|		И ДанныеДляРасчетаПередНормой.ПериодНачисления = СтабильныеПериодыИзмерителиНаправлений.ПериодНачисления
	|		И ДанныеДляРасчетаПередНормой.Район = СтабильныеПериодыИзмерителиНаправлений.Район
	|		И ДанныеДляРасчетаПередНормой.ЧастныйСектор = СтабильныеПериодыИзмерителиНаправлений.ЧастныйСектор
	|		И ДанныеДляРасчетаПередНормой.Строение = СтабильныеПериодыИзмерителиНаправлений.Строение
	|		И ДанныеДляРасчетаПередНормой.Помещение = СтабильныеПериодыИзмерителиНаправлений.Помещение
	|		И ДанныеДляРасчетаПередНормой.Услуга = СтабильныеПериодыИзмерителиНаправлений.Услуга
	|		И ДанныеДляРасчетаПередНормой.ТочкаУчета = СтабильныеПериодыИзмерителиНаправлений.ТочкаУчета
	|		И ДанныеДляРасчетаПередНормой.НомерПозиции - ДанныеДляРасчетаПередНормой.УвеличениеПозиции = СтабильныеПериодыИзмерителиНаправлений.НомерПозиции"; 	
	
	Возврат Текст

КонецФункции

Функция ТекстРассчитатьИндивидуальныйОбъемПотребления()
	Текст  = 
	"ВЫБРАТЬ
	|	ДанныеДляРасчетаПередНормой.Организация КАК Организация,
	|	ДанныеДляРасчетаПередНормой.ПериодНачисления КАК ПериодНачисления,
	|	ДанныеДляРасчетаПередНормой.Район КАК Район,
	|	ДанныеДляРасчетаПередНормой.ЧастныйСектор КАК ЧастныйСектор,
	|	ДанныеДляРасчетаПередНормой.Строение КАК Строение,
	|	ДанныеДляРасчетаПередНормой.Помещение КАК Помещение,
	|	ДанныеДляРасчетаПередНормой.Услуга КАК Услуга,
	|	ДанныеДляРасчетаПередНормой.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	ДанныеДляРасчетаПередНормой.НачалоПериода КАК НачалоПериода,
	|	МИНИМУМ(ВЫБОР
	|			КОГДА НЕ ДанныеДляРасчетаПередНормой.ТочкаУчетаРодитель = ЗНАЧЕНИЕ(Справочник.энргТочкиУчета.ПустаяСсылка)
	|					И (НЕ ДанныеДляРасчетаПередНормой.ПриборВведен
	|						ИЛИ НЕ ДанныеДляРасчетаПередНормой.ПоказанияВСрок)
	|				ТОГДА 1
	|			КОГДА ДанныеДляРасчетаПередНормой.ЗависимаяТочкаУчета <> ЗНАЧЕНИЕ(Справочник.энргТочкиУчета.ПустаяСсылка)
	|					И (НЕ ДанныеДляРасчетаПередНормой.ПриборВведен
	|						ИЛИ НЕ ДанныеДляРасчетаПередНормой.ПоказанияВСрок)
	|				ТОГДА 2
	|			КОГДА НЕ ДанныеДляРасчетаПередНормой.ПриборВведен
	|					ИЛИ НЕ ДанныеДляРасчетаПередНормой.ПоказанияВСрок
	|				ТОГДА 3
	|			ИНАЧЕ 4
	|		КОНЕЦ) КАК Приоритет,
	|	МИНИМУМ(ДанныеДляРасчетаПередНормой.ПриборВведен) КАК ПриборВведен,
	|	МИНИМУМ(ДанныеДляРасчетаПередНормой.ПоказанияВСрок) КАК ПоказанияВСрок,
	|	МАКСИМУМ(ДанныеДляРасчетаПередНормой.УслНаДатуПоверки) КАК УслНаДатуПоверки,
	|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ДанныеДляРасчетаПередНормой.ТочкаУчета) КАК КоличествоТочекУчета
	|ПОМЕСТИТЬ ПриоритетНормы
	|ИЗ
	|	ДанныеДляРасчетаПередНормойИзмерители КАК ДанныеДляРасчетаПередНормой
	|ГДЕ
	|	НЕ ДанныеДляРасчетаПередНормой.РасчетПоФормуле
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеДляРасчетаПередНормой.Организация,
	|	ДанныеДляРасчетаПередНормой.ПериодНачисления,
	|	ДанныеДляРасчетаПередНормой.Район,
	|	ДанныеДляРасчетаПередНормой.ЧастныйСектор,
	|	ДанныеДляРасчетаПередНормой.Строение,
	|	ДанныеДляРасчетаПередНормой.Помещение,
	|	ДанныеДляРасчетаПередНормой.Услуга,
	|	ДанныеДляРасчетаПередНормой.НаправлениеИспользованияТУ,
	|	ДанныеДляРасчетаПередНормой.НачалоПериода
	|
	|ИМЕЮЩИЕ
	|	(МИНИМУМ(ДанныеДляРасчетаПередНормой.ПриборВведен) = ЛОЖЬ
	|		ИЛИ МИНИМУМ(ДанныеДляРасчетаПередНормой.ПоказанияВСрок) = ЛОЖЬ
	|		ИЛИ МИНИМУМ(ДанныеДляРасчетаПередНормой.ОбъемЗаПрошлыйГод) = ИСТИНА
	|		ИЛИ МАКСИМУМ(ДанныеДляРасчетаПередНормой.УслНаДатуПоверки) = 3)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеДляРасчетаПередНормой.Организация КАК Организация,
	|	ДанныеДляРасчетаПередНормой.ПериодНачисления КАК ПериодНачисления,
	|	ДанныеДляРасчетаПередНормой.Район КАК Район,
	|	ДанныеДляРасчетаПередНормой.ЧастныйСектор КАК ЧастныйСектор,
	|	ДанныеДляРасчетаПередНормой.Строение КАК Строение,
	|	ДанныеДляРасчетаПередНормой.Помещение КАК Помещение,
	|	ДанныеДляРасчетаПередНормой.Услуга КАК Услуга,
	|	ДанныеДляРасчетаПередНормой.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	ДанныеДляРасчетаПередНормой.ТочкаУчетаРодитель КАК ТочкаУчетаРодитель,
	|	ДанныеДляРасчетаПередНормой.НачалоПериода КАК НачалоПериода,
	|	МИНИМУМ(ВЫБОР
	|			КОГДА ДанныеДляРасчетаПередНормой.СреднийОбъем >= 0
	|				ТОГДА ИСТИНА
	|			ИНАЧЕ ЛОЖЬ
	|		КОНЕЦ) КАК ЕстьСреднийПоВсемТочкамУслуги,
	|	МИНИМУМ(ВЫБОР
	|			КОГДА ДанныеДляРасчетаПередНормой.СреднийОбъемПотребленный >= 0
	|				ТОГДА ИСТИНА
	|			ИНАЧЕ ЛОЖЬ
	|		КОНЕЦ) КАК ЕстьСреднийПотребленныйПоВсемТочкамУслуги,
	|	МИНИМУМ(ВЫБОР
	|			КОГДА ДанныеДляРасчетаПередНормой.СреднийОбъемЗависитОтУслуги >= 0
	|				ТОГДА ИСТИНА
	|			ИНАЧЕ ЛОЖЬ
	|		КОНЕЦ) КАК ЕстьСреднийПоВсемТочкамУслугиЗависитОтУслуги,
	|	МИНИМУМ(ВЫБОР
	|			КОГДА ДанныеДляРасчетаПередНормой.СреднийОбъемПотребленныйЗависитОтУслуги >= 0
	|				ТОГДА ИСТИНА
	|			ИНАЧЕ ЛОЖЬ
	|		КОНЕЦ) КАК ЕстьСреднийПотребленныйПоВсемТочкамУслугиЗависитОтУслуги,
	|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ДанныеДляРасчетаПередНормой.ТочкаУчета) КАК КоличествоТочекУчета
	|ПОМЕСТИТЬ НаличиеСреднегоОбъемаПоРодительскимТочкам
	|ИЗ
	|	ДанныеДляРасчетаПередНормойИзмерители КАК ДанныеДляРасчетаПередНормой
	|ГДЕ
	|	НЕ ДанныеДляРасчетаПередНормой.РасчетПоФормуле
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеДляРасчетаПередНормой.Организация,
	|	ДанныеДляРасчетаПередНормой.ПериодНачисления,
	|	ДанныеДляРасчетаПередНормой.Район,
	|	ДанныеДляРасчетаПередНормой.ЧастныйСектор,
	|	ДанныеДляРасчетаПередНормой.Строение,
	|	ДанныеДляРасчетаПередНормой.Помещение,
	|	ДанныеДляРасчетаПередНормой.Услуга,
	|	ДанныеДляРасчетаПередНормой.ТочкаУчетаРодитель,
	|	ДанныеДляРасчетаПередНормой.НаправлениеИспользованияТУ,
	|	ДанныеДляРасчетаПередНормой.НачалоПериода
	|
	|ИМЕЮЩИЕ
	|	(МИНИМУМ(ДанныеДляРасчетаПередНормой.ПриборВведен) = ЛОЖЬ
	|		ИЛИ МИНИМУМ(ДанныеДляРасчетаПередНормой.ПоказанияВСрок) = ЛОЖЬ)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеДляРасчетаПередНормой.Организация КАК Организация,
	|	ДанныеДляРасчетаПередНормой.ПериодНачисления КАК ПериодНачисления,
	|	ДанныеДляРасчетаПередНормой.Район КАК Район,
	|	ДанныеДляРасчетаПередНормой.ЧастныйСектор КАК ЧастныйСектор,
	|	ДанныеДляРасчетаПередНормой.Строение КАК Строение,
	|	ДанныеДляРасчетаПередНормой.Помещение КАК Помещение,
	|	ДанныеДляРасчетаПередНормой.Услуга КАК Услуга,
	|	ДанныеДляРасчетаПередНормой.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	ДанныеДляРасчетаПередНормой.НачалоПериода КАК НачалоПериода,
	|	ДанныеДляРасчетаПередНормой.ТочкаУчетаРодитель КАК ТочкаУчетаРодитель,
	|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ДанныеДляРасчетаПередНормой.ТочкаУчета) КАК КоличествоТочекУчета
	|ПОМЕСТИТЬ УслугиРодительскихТочекБезПоказаний
	|ИЗ
	|	ДанныеДляРасчетаПередНормойИзмерители КАК ДанныеДляРасчетаПередНормой
	|ГДЕ
	|	НЕ ДанныеДляРасчетаПередНормой.ТочкаУчетаРодитель = ЗНАЧЕНИЕ(Справочник.энргТочкиУчета.ПустаяСсылка)
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеДляРасчетаПередНормой.Организация,
	|	ДанныеДляРасчетаПередНормой.ПериодНачисления,
	|	ДанныеДляРасчетаПередНормой.Район,
	|	ДанныеДляРасчетаПередНормой.ЧастныйСектор,
	|	ДанныеДляРасчетаПередНормой.Строение,
	|	ДанныеДляРасчетаПередНормой.Помещение,
	|	ДанныеДляРасчетаПередНормой.Услуга,
	|	ДанныеДляРасчетаПередНормой.НаправлениеИспользованияТУ,
	|	ДанныеДляРасчетаПередНормой.НачалоПериода,
	|	ДанныеДляРасчетаПередНормой.ТочкаУчетаРодитель
	|
	|ИМЕЮЩИЕ
	|	(МИНИМУМ(ДанныеДляРасчетаПередНормой.ПриборВведен) = ЛОЖЬ
	|		ИЛИ МИНИМУМ(ДанныеДляРасчетаПередНормой.ПоказанияВСрок) = ЛОЖЬ
	|		ИЛИ МИНИМУМ(ДанныеДляРасчетаПередНормой.ОбъемЗаПрошлыйГод) = ИСТИНА)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДанныеДляРасчетаПередНормой.Организация КАК Организация,
	|	ДанныеДляРасчетаПередНормой.ПериодНачисления КАК ПериодНачисления,
	|	ДанныеДляРасчетаПередНормой.Район КАК Район,
	|	ДанныеДляРасчетаПередНормой.ЧастныйСектор КАК ЧастныйСектор,
	|	ДанныеДляРасчетаПередНормой.Строение КАК Строение,
	|	ДанныеДляРасчетаПередНормой.Помещение КАК Помещение,
	|	ДанныеДляРасчетаПередНормой.НачалоПериода КАК НачалоПериода,
	|	ДанныеДляРасчетаПередНормой.ТочкаУчетаРодитель КАК ТочкаУчета
	|ПОМЕСТИТЬ РодительскиеТочкиУчета
	|ИЗ
	|	ДанныеДляРасчетаПередНормойИзмерители КАК ДанныеДляРасчетаПередНормой
	|ГДЕ
	|	НЕ ДанныеДляРасчетаПередНормой.ТочкаУчетаРодитель = ЗНАЧЕНИЕ(Справочник.энргТочкиУчета.ПустаяСсылка)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеДляРасчетаПередНормой.Организация КАК Организация,
	|	ДанныеДляРасчетаПередНормой.ПериодНачисления КАК ПериодНачисления,
	|	ДанныеДляРасчетаПередНормой.Район КАК Район,
	|	ДанныеДляРасчетаПередНормой.ЧастныйСектор КАК ЧастныйСектор,
	|	ДанныеДляРасчетаПередНормой.Строение КАК Строение,
	|	ДанныеДляРасчетаПередНормой.Помещение КАК Помещение,
	|	ДанныеДляРасчетаПередНормой.Услуга КАК Услуга,
	|	ДанныеДляРасчетаПередНормой.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	ДанныеДляРасчетаПередНормой.НачалоПериода КАК НачалоПериода,
	|	ВЫБОР КОГДА ДанныеДляРасчетаПередНормой.ПомещениеРодитель <> ДанныеДляРасчетаПередНормой.Помещение 
	|		ТОГДА ДанныеДляРасчетаПередНормой.СоставнаяУслуга
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.энргВидыУслуг.ПустаяСсылка)
	|	КОНЕЦ КАК СоставнаяУслуга,
	|	МАКСИМУМ(ДанныеДляРасчетаПередНормой.ТочкаУчета) КАК ТочкаУчета
	|ПОМЕСТИТЬ ТочкиНачисленияНормы
	|ИЗ
	|	ДанныеДляРасчетаПередНормойИзмерители КАК ДанныеДляРасчетаПередНормой
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПриоритетНормы КАК ПриоритетНормы
	|		ПО ДанныеДляРасчетаПередНормой.Организация = ПриоритетНормы.Организация
	|			И ДанныеДляРасчетаПередНормой.ПериодНачисления = ПриоритетНормы.ПериодНачисления
	|			И ДанныеДляРасчетаПередНормой.Район = ПриоритетНормы.Район
	|			И ДанныеДляРасчетаПередНормой.ЧастныйСектор = ПриоритетНормы.ЧастныйСектор
	|			И ДанныеДляРасчетаПередНормой.Строение = ПриоритетНормы.Строение
	|			И ДанныеДляРасчетаПередНормой.Помещение = ПриоритетНормы.Помещение
	|			И ДанныеДляРасчетаПередНормой.Услуга = ПриоритетНормы.Услуга
	|			И ДанныеДляРасчетаПередНормой.НачалоПериода = ПриоритетНормы.НачалоПериода
	|			И ДанныеДляРасчетаПередНормой.НаправлениеИспользованияТУ = ПриоритетНормы.НаправлениеИспользованияТУ
	|			И (НЕ ДанныеДляРасчетаПередНормой.РасчетПоФормуле)
	|			И (ВЫБОР
	|				КОГДА ПриоритетНормы.Приоритет = 1
	|					ТОГДА НЕ ДанныеДляРасчетаПередНормой.ТочкаУчетаРодитель = ЗНАЧЕНИЕ(Справочник.энргТочкиУчета.ПустаяСсылка)
	|							И (НЕ ДанныеДляРасчетаПередНормой.ПриборВведен
	|								ИЛИ НЕ ДанныеДляРасчетаПередНормой.ПоказанияВСрок)
	|				КОГДА ПриоритетНормы.Приоритет = 2
	|					ТОГДА ДанныеДляРасчетаПередНормой.ЗависимаяТочкаУчета <> ЗНАЧЕНИЕ(Справочник.энргТочкиУчета.ПустаяСсылка)
	|							И (НЕ ДанныеДляРасчетаПередНормой.ПриборВведен
	|								ИЛИ НЕ ДанныеДляРасчетаПередНормой.ПоказанияВСрок)
	|				КОГДА ПриоритетНормы.Приоритет = 3
	|					ТОГДА НЕ ДанныеДляРасчетаПередНормой.ПриборВведен
	|							ИЛИ НЕ ДанныеДляРасчетаПередНормой.ПоказанияВСрок
	|				ИНАЧЕ ИСТИНА
	|			КОНЕЦ)
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеДляРасчетаПередНормой.Организация,
	|	ДанныеДляРасчетаПередНормой.ПериодНачисления,
	|	ДанныеДляРасчетаПередНормой.Район,
	|	ДанныеДляРасчетаПередНормой.ЧастныйСектор,
	|	ДанныеДляРасчетаПередНормой.Строение,
	|	ДанныеДляРасчетаПередНормой.Помещение,
	|	ДанныеДляРасчетаПередНормой.Услуга,
	|	ДанныеДляРасчетаПередНормой.НаправлениеИспользованияТУ,
	|	ДанныеДляРасчетаПередНормой.НачалоПериода,
	|	ВЫБОР КОГДА ДанныеДляРасчетаПередНормой.ПомещениеРодитель <> ДанныеДляРасчетаПередНормой.Помещение 
	|		ТОГДА ДанныеДляРасчетаПередНормой.СоставнаяУслуга
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.энргВидыУслуг.ПустаяСсылка)
	|	КОНЕЦ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	" + энргНачисления.СформироватьСтрокуДляЗапроса("энргСтабильныеПериоды","ДанныеДляРасчетаПередНормой","НомерПозиции,ПериодРегистрации,ДатаРегистратора,ДокРегистратор",Истина,Ложь) + "
	|	ДанныеДляРасчетаПередНормой.НачалоОП КАК НачалоОП,
	|	ДанныеДляРасчетаПередНормой.ЗавершениеОП КАК ЗавершениеОП,
	|	ДанныеДляРасчетаПередНормой.ДнейВПериоде КАК ДнейВПериоде,
	|	ДанныеДляРасчетаПередНормой.МКД КАК МКД,
	|	ДанныеДляРасчетаПередНормой.КоэффициентНорматива КАК КоэффициентНорматива,
	|	ДанныеДляРасчетаПередНормой.КоэффициентНормативаНеПрименятьСезонность КАК КоэффициентНормативаНеПрименятьСезонность,
	|	ДанныеДляРасчетаПередНормой.КорректироватьГодовойОбъем КАК КорректироватьГодовойОбъем,
	|	ДанныеДляРасчетаПередНормой.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	ДанныеДляРасчетаПередНормой.ОбъемЗаПрошлыйГод КАК ОбъемЗаПрошлыйГод,
	|	ДанныеДляРасчетаПередНормой.Сезонность КАК Сезонность,
	|	ДанныеДляРасчетаПередНормой.ВидПлощади КАК ВидПлощади,
	|	ДанныеДляРасчетаПередНормой.НормативПоДням КАК НормативПоДням,
	|	ДанныеДляРасчетаПередНормой.СпособОпределенияСоциальнойНормы КАК СпособОпределенияСоциальнойНормы,
	|	ДанныеДляРасчетаПередНормой.ЕстьПоказанияАбонента КАК ЕстьПоказанияАбонента,
	|	ДанныеДляРасчетаПередНормой.УмножатьНаНормуРодительскойУслуги КАК УмножатьНаНормуРодительскойУслуги,		
	|	ДанныеДляРасчетаПередНормой.МаксимальноВозможныеПоказания КАК МаксимальноВозможныеПоказания,
	|	ДанныеДляРасчетаПередНормой.РегистрируетОбъем КАК РегистрируетОбъем,	
	|	ДанныеДляРасчетаПередНормой.ФизЛицо КАК ФизЛицо,	
	|	ДанныеДляРасчетаПередНормой.ТипСхемы КАК ТипСхемы,
	|	ДанныеДляРасчетаПередНормой.ВидТепловогоПункта КАК ВидТепловогоПункта,	
	|	ДанныеДляРасчетаПередНормой.ПомещениеРодитель КАК ПомещениеРодитель,	
	|	ДанныеДляРасчетаПередНормой.ИспользоватьКоэффициентСдерживанияРостаПлаты КАК ИспользоватьКоэффициентСдерживанияРостаПлаты,
	|	ДанныеДляРасчетаПередНормой.ПлощадьМОП КАК ПлощадьМОП,
	|	ДанныеДляРасчетаПередНормой.ПлощадьАбонентов КАК ПлощадьАбонентов,
	|	ДанныеДляРасчетаПередНормой.ПлощадьСобственнаяПоставка КАК ПлощадьСобственнаяПоставка,	
	|	ДанныеДляРасчетаПередНормой.ДокументНачисления КАК ДокументНачисления,
	|	ДанныеДляРасчетаПередНормой.ДокументНачисленияПометкаУдаления КАК ДокументНачисленияПометкаУдаления,	
	|	ДанныеДляРасчетаПередНормой.ВыводПрибораУчета КАК ВыводПрибораУчета,
	|	ДанныеДляРасчетаПередНормой.БылУстановленныйПриборВЭтомГоду КАК БылУстановленныйПриборВЭтомГоду,
	|	ДанныеДляРасчетаПередНормой.ЕстьЗаписьПриборВЭтомГоду КАК ЕстьЗаписьПриборВЭтомГоду,
	|	ДанныеДляРасчетаПередНормой.КлючПомещения,
	|	ДанныеДляРасчетаПередНормой.АбонентЗакрытВТекущемПериоде,
	|	ДанныеДляРасчетаПередНормой.УвеличениеПозиции КАК УвеличениеПозиции,
	|	ДанныеДляРасчетаПередНормой.ВидДифференцированности КАК ВидДифференцированности,
	|	ДанныеДляРасчетаПередНормой.ПривязанаКШкале КАК ПривязанаКШкале,
	|	ДанныеДляРасчетаПередНормой.ЕстьПриборУчетаРодителя КАК ЕстьПриборУчетаРодителя,
	|	ДанныеДляРасчетаПередНормой.ТарифнаяЗона КАК ТарифнаяЗона,	
	|	ДанныеДляРасчетаПередНормой.Показания КАК Показания,
	|	ДанныеДляРасчетаПередНормой.КоэффициентСезоности КАК КоэффициентСезоности,
	|	ДанныеДляРасчетаПередНормой.КоэффициентСезоностиОбъемПотребленный КАК КоэффициентСезоностиОбъемПотребленный,
	|	ДанныеДляРасчетаПередНормой.ПредыдущееЗначениеТарифа КАК ПредыдущееЗначениеТарифа,
	|	ДанныеДляРасчетаПередНормой.ПредыдущееЗначениеТарифаСверхНорматива КАК ПредыдущееЗначениеТарифаСверхНорматива,
	|	ДанныеДляРасчетаПередНормой.ПредыдущееЗначениеТарифаРЭК КАК ПредыдущееЗначениеТарифаРЭК,	
	|	ДанныеДляРасчетаПередНормой.ПоказанияВСрок КАК ПоказанияВСрок,
	|	ДанныеДляРасчетаПередНормой.ПоказанияПредоставлены КАК ПоказанияПредоставлены,	
	|	ДанныеДляРасчетаПередНормой.СреднийОбъем КАК СреднийОбъем,
	|	ДанныеДляРасчетаПередНормой.СреднийОбъемПотребленный КАК СреднийОбъемПотребленный,
	|	ДанныеДляРасчетаПередНормой.СреднийОбъемЗависитОтУслуги КАК СреднийОбъемЗависитОтУслуги,	
	|	ДанныеДляРасчетаПередНормой.СреднийОбъемПотребленныйЗависитОтУслуги  КАК СреднийОбъемПотребленныйЗависитОтУслуги,	
	|	ДанныеДляРасчетаПередНормой.НачалоПериода КАК НачалоПериода,	
	|	ДанныеДляРасчетаПередНормой.КонецПериода КАК КонецПериода,
	|	ДанныеДляРасчетаПередНормой.НачальныеПоказания КАК НачальныеПоказания,
	|	ДанныеДляРасчетаПередНормой.КонечныеПоказания КАК КонечныеПоказания,
	|	ДанныеДляРасчетаПередНормой.СледующийРегистратор КАК СледующийРегистратор,		
	|	ДанныеДляРасчетаПередНормой.КоэффициентНормативаСПУ КАК КоэффициентНормативаСПУ,	
	|	ДанныеДляРасчетаПередНормой.Измеритель  КАК Измеритель,
	|	ДанныеДляРасчетаПередНормой.КоличествоИзмеретелейНаправления КАК КоличествоИзмеретелейНаправления,
	|	ДанныеДляРасчетаПередНормой.ЕстьИзмерителиНаправления КАК ЕстьИзмерителиНаправления,	
	|	ЕСТЬNULL(ЗначенияТекущихТарифов.Значение, 0) КАК ЗначениеТарифа,
	|	ЕСТЬNULL(ЗначенияТекущихТарифов.ЗначениеСверхНорматива, 0) КАК ЗначениеТарифаСверхНорматива,
	|	ЕСТЬNULL(ЗначенияТекущихТарифов.ЗначениеТарифаРЭК, 0) КАК ЗначениеТарифаРЭК,
	|	ЕСТЬNULL(МКДНеНачислятьТЭМКД.НеНачислять, ЕСТЬNULL(МКДНеНачислятьТЭ.НеНачислять, ЛОЖЬ)) КАК ЗакрытаяСхемаГВС,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчетаПередНормой.НетВозможностьУстановкиПУ
	|			ТОГДА 1
	|		ИНАЧЕ
	|			ЕСТЬNULL(ЗначенияПовышающихКоэффициентов.Коэффициент , -1)
	|	КОНЕЦ КАК ПовышающийКоэффициент,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчетаПередНормой.РасчетПоФормуле
	|			ТОГДА ИСТИНА
	|		КОГДА НЕ РодительскиеТочкиУчета.Организация ЕСТЬ NULL
	|			ТОГДА ИСТИНА
	|		КОГДА НЕ ВЫБОР
	|					КОГДА &НеПрименятьЗависимостьЕслиБольшеОднойТочки
	|							И ЕСТЬNULL(ПриоритетНормы.КоличествоТочекУчета, 0) >= 1 
	|							И НЕ ДанныеДляРасчетаПередНормой.ЗависитОтУслуги = ЗНАЧЕНИЕ(Справочник.энргВидыУслуг.ПустаяСсылка)
	|							И НЕ ЕСТЬNULL(НаличиеСреднегоОбъемаПоРодительскимТочкам.ЕстьСреднийПоВсемТочкамУслугиЗависитОтУслуги, ИСТИНА)
	|						ТОГДА ЗНАЧЕНИЕ(Справочник.энргВидыУслуг.ПустаяСсылка)
	|					КОГДА &НеПрименятьЗависимостьЕслиБольшеОднойТочки
	|							И ЕСТЬNULL(ПриоритетНормы.КоличествоТочекУчета, 0) >= 1								
	|							И ЕСТЬNULL(НаличиеСреднегоОбъемаПоРодительскимТочкам.ЕстьСреднийПоВсемТочкамУслуги, ИСТИНА)	
	|						ТОГДА НЕОПРЕДЕЛЕНО
	|					КОГДА ЕСТЬNULL(ПриоритетНормы.КоличествоТочекУчета, 0) > 1								
	|							И ЕСТЬNULL(НаличиеСреднегоОбъемаПоРодительскимТочкам.ЕстьСреднийПоВсемТочкамУслуги, ИСТИНА)
	|							И ДанныеДляРасчетаПередНормой.ПриборВведен
	|                       ТОГДА НЕОПРЕДЕЛЕНО
	|					ИНАЧЕ ДанныеДляРасчетаПередНормой.ЗависитОтУслуги
	|				КОНЕЦ = ЗНАЧЕНИЕ(Справочник.энргВидыУслуг.ПустаяСсылка)
	|			ТОГДА ИСТИНА
	|		КОГДА ДанныеДляРасчетаПередНормой.КоэффициентФормула = 1
	|			ТОГДА ИСТИНА
	|		КОГДА ДанныеДляРасчетаПередНормой.ТочкаУчета = ТочкиНачисленияНормы.ТочкаУчета
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК НачислятьНорму,
	|	НЕ ПоставщикиНеНачислять.Поставщик ЕСТЬ NULL КАК НеНачислять,
	|	ВЫБОР
	|		КОГДА &НеПрименятьЗависимостьЕслиБольшеОднойТочки
	|				И ЕСТЬNULL(НаличиеСреднегоОбъемаПоРодительскимТочкам.ЕстьСреднийПоВсемТочкамУслугиЗависитОтУслуги, ИСТИНА)
	|			ТОГДА ДанныеДляРасчетаПередНормой.ЗависитОтУслуги
	|		КОГДА &НеПрименятьЗависимостьЕслиБольшеОднойТочки
	|				И ЕСТЬNULL(ПриоритетНормы.КоличествоТочекУчета, 0) >= 1
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.энргВидыУслуг.ПустаяСсылка)
	|		ИНАЧЕ ДанныеДляРасчетаПередНормой.ЗависитОтУслуги
	|	КОНЕЦ КАК ЗависитОтУслуги,
	|	ВЫБОР
	|  		КОГДА НЕ ДанныеДляРасчетаПередНормой.ЗависитОтУслуги = ЗНАЧЕНИЕ(Справочник.энргВидыУслуг.ПустаяСсылка) 
	|				И ЕСТЬNULL(НаличиеСреднегоОбъемаПоРодительскимТочкам.ЕстьСреднийПотребленныйПоВсемТочкамУслугиЗависитОтУслуги, ИСТИНА)	
	|			ТОГДА ИСТИНА	
	|  		КОГДА ЕСТЬNULL(НаличиеСреднегоОбъемаПоРодительскимТочкам.ЕстьСреднийПотребленныйПоВсемТочкамУслуги, ИСТИНА) 
	|			ТОГДА ИСТИНА
	|  		КОГДА ЕСТЬNULL(НаличиеСреднегоОбъемаПоРодительскимТочкам.КоличествоТочекУчета, 0) = 0	
	|			ТОГДА ИСТИНА 	
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК НачислятьПоПрибору,
	|	ЕСТЬNULL(НормаСкоростиДвиженияВоды.СкоростьДвижения, 0) КАК СкоростьДвижения,
	|	ЕСТЬNULL(НаличиеСреднегоОбъемаПоРодительскимТочкам.ЕстьСреднийПоВсемТочкамУслуги, ИСТИНА) КАК ЕстьСреднийПоВсемТочкамУслуги,
	|	ЕСТЬNULL(НаличиеСреднегоОбъемаПоРодительскимТочкам.ЕстьСреднийПотребленныйПоВсемТочкамУслуги, ИСТИНА) КАК ЕстьСреднийПотребленныйПоВсемТочкамУслуги,
	|	ЕСТЬNULL(НаличиеСреднегоОбъемаПоРодительскимТочкам.ЕстьСреднийПоВсемТочкамУслугиЗависитОтУслуги, ИСТИНА) КАК ЕстьСреднийПоВсемТочкамУслугиЗависитОтУслуги,
	|	ЕСТЬNULL(НаличиеСреднегоОбъемаПоРодительскимТочкам.ЕстьСреднийПотребленныйПоВсемТочкамУслугиЗависитОтУслуги, ИСТИНА) КАК ЕстьСреднийПотребленныйПоВсемТочкамУслугиЗависитОтУслуги,
	|	ЕСТЬNULL(ЗначенияТекущихНормПотребления.ЗначениеНорматива, 0) КАК НормаПотребления,
	|	ЕСТЬNULL(ЗначенияТекущихСоциальныхНормПотребления.ЗначениеНорматива, 0) КАК СоциальнаяНормаПотребления,
	|	ДанныеДляРасчетаПередНормой.КоэффициентСезоности * ВЫБОР КОГДА ДанныеДляРасчетаПередНормой.НеПрименятьСезонность ТОГДА ДанныеДляРасчетаПередНормой.КоэффициентНормативаНеПрименятьСезонность ИНАЧЕ ДанныеДляРасчетаПередНормой.КоэффициентНорматива КОНЕЦ * ДанныеДляРасчетаПередНормой.КоэффициентНормативаСПУ КАК КоэффициентНормативаИСезонности,
	|	ДанныеДляРасчетаПередНормой.УслНаДатуПоверки
	|ПОМЕСТИТЬ ДанныеДляРасчета
	|ИЗ
	|	ДанныеДляРасчетаПередНормойИзмерители КАК ДанныеДляРасчетаПередНормой
	|		ЛЕВОЕ СОЕДИНЕНИЕ ТочкиНачисленияНормы КАК ТочкиНачисленияНормы
	|		ПО ДанныеДляРасчетаПередНормой.Организация = ТочкиНачисленияНормы.Организация
	|			И ДанныеДляРасчетаПередНормой.ПериодНачисления = ТочкиНачисленияНормы.ПериодНачисления
	|			И ДанныеДляРасчетаПередНормой.Район = ТочкиНачисленияНормы.Район
	|			И ДанныеДляРасчетаПередНормой.ЧастныйСектор = ТочкиНачисленияНормы.ЧастныйСектор
	|			И ДанныеДляРасчетаПередНормой.Строение = ТочкиНачисленияНормы.Строение
	|			И ДанныеДляРасчетаПередНормой.Помещение = ТочкиНачисленияНормы.Помещение
	|			И ДанныеДляРасчетаПередНормой.Услуга = ТочкиНачисленияНормы.Услуга
	|			И ДанныеДляРасчетаПередНормой.ТочкаУчета = ТочкиНачисленияНормы.ТочкаУчета
	|			И ДанныеДляРасчетаПередНормой.НаправлениеИспользованияТУ = ТочкиНачисленияНормы.НаправлениеИспользованияТУ
	|			И ДанныеДляРасчетаПередНормой.НачалоПериода = ТочкиНачисленияНормы.НачалоПериода
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПриоритетНормы КАК ПриоритетНормы
	|		ПО ДанныеДляРасчетаПередНормой.Организация = ПриоритетНормы.Организация
	|			И ДанныеДляРасчетаПередНормой.ПериодНачисления = ПриоритетНормы.ПериодНачисления
	|			И ДанныеДляРасчетаПередНормой.Район = ПриоритетНормы.Район
	|			И ДанныеДляРасчетаПередНормой.ЧастныйСектор = ПриоритетНормы.ЧастныйСектор
	|			И ДанныеДляРасчетаПередНормой.Строение = ПриоритетНормы.Строение
	|			И ДанныеДляРасчетаПередНормой.Помещение = ПриоритетНормы.Помещение
	|			И ДанныеДляРасчетаПередНормой.Услуга = ПриоритетНормы.Услуга
	|			И ДанныеДляРасчетаПередНормой.НаправлениеИспользованияТУ = ПриоритетНормы.НаправлениеИспользованияТУ
	|			И ДанныеДляРасчетаПередНормой.НачалоПериода = ПриоритетНормы.НачалоПериода	
	|		ЛЕВОЕ СОЕДИНЕНИЕ УслугиРодительскихТочекБезПоказаний КАК УслугиРодительскихТочекБезПоказаний
	|		ПО ДанныеДляРасчетаПередНормой.Организация = УслугиРодительскихТочекБезПоказаний.Организация
	|			И ДанныеДляРасчетаПередНормой.ПериодНачисления = УслугиРодительскихТочекБезПоказаний.ПериодНачисления
	|			И ДанныеДляРасчетаПередНормой.Район = УслугиРодительскихТочекБезПоказаний.Район
	|			И ДанныеДляРасчетаПередНормой.ЧастныйСектор = УслугиРодительскихТочекБезПоказаний.ЧастныйСектор
	|			И ДанныеДляРасчетаПередНормой.Строение = УслугиРодительскихТочекБезПоказаний.Строение
	|			И ДанныеДляРасчетаПередНормой.Помещение = УслугиРодительскихТочекБезПоказаний.Помещение
	|			И ДанныеДляРасчетаПередНормой.Услуга = УслугиРодительскихТочекБезПоказаний.Услуга
	|			И ДанныеДляРасчетаПередНормой.НаправлениеИспользованияТУ = УслугиРодительскихТочекБезПоказаний.НаправлениеИспользованияТУ
	|			И ДанныеДляРасчетаПередНормой.ТочкаУчетаРодитель = УслугиРодительскихТочекБезПоказаний.ТочкаУчетаРодитель
	|			И ДанныеДляРасчетаПередНормой.НачалоПериода = УслугиРодительскихТочекБезПоказаний.НачалоПериода	
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаличиеСреднегоОбъемаПоРодительскимТочкам КАК НаличиеСреднегоОбъемаПоРодительскимТочкам
	|		ПО ДанныеДляРасчетаПередНормой.Организация = НаличиеСреднегоОбъемаПоРодительскимТочкам.Организация
	|			И ДанныеДляРасчетаПередНормой.ПериодНачисления = НаличиеСреднегоОбъемаПоРодительскимТочкам.ПериодНачисления
	|			И ДанныеДляРасчетаПередНормой.Район = НаличиеСреднегоОбъемаПоРодительскимТочкам.Район
	|			И ДанныеДляРасчетаПередНормой.ЧастныйСектор = НаличиеСреднегоОбъемаПоРодительскимТочкам.ЧастныйСектор
	|			И ДанныеДляРасчетаПередНормой.Строение = НаличиеСреднегоОбъемаПоРодительскимТочкам.Строение
	|			И ДанныеДляРасчетаПередНормой.Помещение = НаличиеСреднегоОбъемаПоРодительскимТочкам.Помещение
	|			И ДанныеДляРасчетаПередНормой.Услуга = НаличиеСреднегоОбъемаПоРодительскимТочкам.Услуга
	|			И ДанныеДляРасчетаПередНормой.НаправлениеИспользованияТУ = НаличиеСреднегоОбъемаПоРодительскимТочкам.НаправлениеИспользованияТУ
	|			И ДанныеДляРасчетаПередНормой.ТочкаУчетаРодитель = НаличиеСреднегоОбъемаПоРодительскимТочкам.ТочкаУчетаРодитель
	|			И ДанныеДляРасчетаПередНормой.НачалоПериода = НаличиеСреднегоОбъемаПоРодительскимТочкам.НачалоПериода	
	|		ЛЕВОЕ СОЕДИНЕНИЕ РодительскиеТочкиУчета КАК РодительскиеТочкиУчета
	|		ПО ДанныеДляРасчетаПередНормой.Организация = РодительскиеТочкиУчета.Организация
	|			И ДанныеДляРасчетаПередНормой.ПериодНачисления = РодительскиеТочкиУчета.ПериодНачисления
	|			И ДанныеДляРасчетаПередНормой.Район = РодительскиеТочкиУчета.Район
	|			И ДанныеДляРасчетаПередНормой.ЧастныйСектор = РодительскиеТочкиУчета.ЧастныйСектор
	|			И ДанныеДляРасчетаПередНормой.Строение = РодительскиеТочкиУчета.Строение
	|			И ДанныеДляРасчетаПередНормой.Помещение = РодительскиеТочкиУчета.Помещение
	|			И ДанныеДляРасчетаПередНормой.ТочкаУчета = РодительскиеТочкиУчета.ТочкаУчета
	|			И ДанныеДляРасчетаПередНормой.НачалоПериода = РодительскиеТочкиУчета.НачалоПериода
	|		ЛЕВОЕ СОЕДИНЕНИЕ ЗначенияТекущихТарифов КАК ЗначенияТекущихТарифов
	|		ПО ДанныеДляРасчетаПередНормой.Организация = ЗначенияТекущихТарифов.Организация
	|			И ДанныеДляРасчетаПередНормой.Район = ЗначенияТекущихТарифов.Район
	|			И ДанныеДляРасчетаПередНормой.ПериодНачисления = ЗначенияТекущихТарифов.ПериодНачисления
	|			И ДанныеДляРасчетаПередНормой.ТарифнаяГруппа = ЗначенияТекущихТарифов.ГруппаПотребителей
	|			И ДанныеДляРасчетаПередНормой.Услуга = ЗначенияТекущихТарифов.Услуга
	|			И ДанныеДляРасчетаПередНормой.Поставщик = ЗначенияТекущихТарифов.Поставщик
	|			И ДанныеДляРасчетаПередНормой.ТарифнаяЗона = ЗначенияТекущихТарифов.ТарифнаяЗона
	|		ЛЕВОЕ СОЕДИНЕНИЕ ЗначенияТекущихНормПотребления КАК ЗначенияТекущихНормПотребления
	|		ПО ДанныеДляРасчетаПередНормой.Организация = ЗначенияТекущихНормПотребления.Организация
	|			И ДанныеДляРасчетаПередНормой.Район = ЗначенияТекущихНормПотребления.Район
	|			И ДанныеДляРасчетаПередНормой.ПериодНачисления = ЗначенияТекущихНормПотребления.ПериодНачисления
	|			И ДанныеДляРасчетаПередНормой.Услуга = ЗначенияТекущихНормПотребления.Услуга
	|			И ДанныеДляРасчетаПередНормой.КлючНорматива = ЗначенияТекущихНормПотребления.КлючНорматива
	|			И ДанныеДляРасчетаПередНормой.НаправлениеИспользованияТУ = ЗначенияТекущихНормПотребления.НаправлениеИспользованияТУ
	|		ЛЕВОЕ СОЕДИНЕНИЕ ЗначенияТекущихСоциальныхНормПотребления КАК ЗначенияТекущихСоциальныхНормПотребления
	|		ПО ДанныеДляРасчетаПередНормой.Организация = ЗначенияТекущихСоциальныхНормПотребления.Организация
	|			И ДанныеДляРасчетаПередНормой.Район = ЗначенияТекущихСоциальныхНормПотребления.Район
	|			И ДанныеДляРасчетаПередНормой.ПериодНачисления = ЗначенияТекущихСоциальныхНормПотребления.ПериодНачисления
	|			И ДанныеДляРасчетаПередНормой.Услуга = ЗначенияТекущихСоциальныхНормПотребления.Услуга
	|			И ДанныеДляРасчетаПередНормой.КлючСоцНорматива = ЗначенияТекущихСоциальныхНормПотребления.КлючНорматива
	|			И ДанныеДляРасчетаПередНормой.НаправлениеИспользованияТУ = ЗначенияТекущихСоциальныхНормПотребления.НаправлениеИспользованияТУ
	|		ЛЕВОЕ СОЕДИНЕНИЕ ЗначенияПовышающихКоэффициентов КАК ЗначенияПовышающихКоэффициентов
	|		ПО ДанныеДляРасчетаПередНормой.Организация = ЗначенияПовышающихКоэффициентов.Организация
	|			И ДанныеДляРасчетаПередНормой.Район = ЗначенияПовышающихКоэффициентов.Район
	|			И ДанныеДляРасчетаПередНормой.ПериодНачисления = ЗначенияПовышающихКоэффициентов.ПериодНачисления
	|			И ДанныеДляРасчетаПередНормой.Услуга = ЗначенияПовышающихКоэффициентов.Услуга
	|			И ДанныеДляРасчетаПередНормой.НаправлениеИспользованияТУ = ЗначенияПовышающихКоэффициентов.НаправлениеИспользованияТУ
	|		ЛЕВОЕ СОЕДИНЕНИЕ МКДНеНачислятьТЭ КАК МКДНеНачислятьТЭМКД
	|		ПО ДанныеДляРасчетаПередНормой.Организация = МКДНеНачислятьТЭМКД.Организация
	|			И ДанныеДляРасчетаПередНормой.Район = МКДНеНачислятьТЭМКД.Район
	|			И ДанныеДляРасчетаПередНормой.Услуга = МКДНеНачислятьТЭМКД.Услуга
	|			И ДанныеДляРасчетаПередНормой.Строение = МКДНеНачислятьТЭМКД.Строение
	|			И ДанныеДляРасчетаПередНормой.ТипСхемы = МКДНеНачислятьТЭМКД.ТипСхемы
	|			И ДанныеДляРасчетаПередНормой.ВидТепловогоПункта = МКДНеНачислятьТЭМКД.ПринадлежностьКТепловомуПункту
	|		ЛЕВОЕ СОЕДИНЕНИЕ МКДНеНачислятьТЭ КАК МКДНеНачислятьТЭ
	|		ПО ДанныеДляРасчетаПередНормой.Организация = МКДНеНачислятьТЭ.Организация
	|			И ДанныеДляРасчетаПередНормой.Район = МКДНеНачислятьТЭ.Район
	|			И ДанныеДляРасчетаПередНормой.Услуга = МКДНеНачислятьТЭ.Услуга
	|			И (ДанныеДляРасчетаПередНормой.Строение = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка))
	|			И ДанныеДляРасчетаПередНормой.ТипСхемы = МКДНеНачислятьТЭ.ТипСхемы
	|			И ДанныеДляРасчетаПередНормой.ВидТепловогоПункта = МКДНеНачислятьТЭ.ПринадлежностьКТепловомуПункту
	|		ЛЕВОЕ СОЕДИНЕНИЕ НормаСкоростиДвиженияВоды КАК НормаСкоростиДвиженияВоды
	|		ПО ДанныеДляРасчетаПередНормой.Организация = НормаСкоростиДвиженияВоды.Организация
	|			И ДанныеДляРасчетаПередНормой.ПериодНачисления = НормаСкоростиДвиженияВоды.ПериодНачисления
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПоставщикиНеНачислять КАК ПоставщикиНеНачислять
	|		ПО ДанныеДляРасчетаПередНормой.Организация = ПоставщикиНеНачислять.Организация
	|			И ДанныеДляРасчетаПередНормой.ПериодНачисления = ПоставщикиНеНачислять.ПериодНачисления
	|			И ДанныеДляРасчетаПередНормой.Район = ПоставщикиНеНачислять.Район
	|			И ДанныеДляРасчетаПередНормой.Поставщик = ПоставщикиНеНачислять.Поставщик		
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////	
	|ВЫБРАТЬ
	|	ДанныеДляРасчета.Организация КАК Организация,
	|	ДанныеДляРасчета.ПериодНачисления КАК ПериодНачисления,
	|	НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ) КАК НачалоПериода,
	|	ДанныеДляРасчета.КонецПериода КАК КонецПериода,
	|	ДанныеДляРасчета.Район КАК Район,
	|	ДанныеДляРасчета.МКД КАК МКД,
	|	ДанныеДляРасчета.ЧастныйСектор КАК ЧастныйСектор,
	|	ДанныеДляРасчета.Строение КАК Строение,
	|	ДанныеДляРасчета.ПомещениеРодитель КАК ПомещениеРодитель,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.ПомещениеРодитель = ДанныеДляРасчета.Помещение
	|			ТОГДА 0
	|		ИНАЧЕ 1
	|	КОНЕЦ КАК ПорядокПомещения,
	|	ДанныеДляРасчета.Помещение КАК Помещение,
	|	ДанныеДляРасчета.Абонент КАК Абонент,
	|	ДанныеДляРасчета.Услуга КАК Услуга,
	|	ДанныеДляРасчета.ТочкаУчета КАК ТочкаУчета,
	|	ДанныеДляРасчета.ЗависитОтУслуги КАК ЗависитОтУслуги,
	|	ДанныеДляРасчета.ПриборУчета КАК ПриборУчета,
	|	ДанныеДляРасчета.Шкала КАК Шкала,
	|	ДанныеДляРасчета.ТарифнаяЗона КАК ТарифнаяЗона,
	|	ДанныеДляРасчета.ПриборВведен КАК ПриборВведен,
	|	ВЫРАЗИТЬ(ВЫБОР
	|			КОГДА ДанныеДляРасчета.РегистрируетОбъем
	|					И НЕ ДанныеДляРасчета.КонечныеПоказания = ДанныеДляРасчета.НачальныеПоказания
	|				ТОГДА ДанныеДляРасчета.КонечныеПоказания
	|			КОГДА ДанныеДляРасчета.РегистрируетОбъем
	|				ТОГДА 0
	|			КОГДА ДанныеДляРасчета.КонечныеПоказания < ДанныеДляРасчета.НачальныеПоказания
	|				ТОГДА ДанныеДляРасчета.МаксимальноВозможныеПоказания - ДанныеДляРасчета.НачальныеПоказания + ДанныеДляРасчета.КонечныеПоказания
	|			ИНАЧЕ ДанныеДляРасчета.КонечныеПоказания - ДанныеДляРасчета.НачальныеПоказания
	|		КОНЕЦ * ДанныеДляРасчета.КоэффициентПУ КАК ЧИСЛО(15, 6)) КАК ОбъемУслугиПотребленный,
	|	ВЫРАЗИТЬ(ВЫБОР
	|			КОГДА ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|				ТОГДА 0
	|			КОГДА ДанныеДляРасчета.Поставщик = ДанныеДляРасчета.Абонент
	|				ТОГДА 0
	|			КОГДА ДанныеДляРасчета.РегистрируетОбъем
	|					И НЕ ДанныеДляРасчета.КонечныеПоказания = ДанныеДляРасчета.НачальныеПоказания
	|				ТОГДА ДанныеДляРасчета.КонечныеПоказания
	|			КОГДА ДанныеДляРасчета.РегистрируетОбъем
	|				ТОГДА 0
	|			КОГДА ДанныеДляРасчета.КонечныеПоказания < ДанныеДляРасчета.НачальныеПоказания
	|				ТОГДА ДанныеДляРасчета.МаксимальноВозможныеПоказания - ДанныеДляРасчета.НачальныеПоказания + ДанныеДляРасчета.КонечныеПоказания
	|			ИНАЧЕ ДанныеДляРасчета.КонечныеПоказания - ДанныеДляРасчета.НачальныеПоказания
	|		КОНЕЦ * ДанныеДляРасчета.КоэффициентПУ КАК ЧИСЛО(15, 6)) КАК ОбъемУслуги,
	|	ДанныеДляРасчета.КоэффициентСезоности * ВЫБОР
	|		КОГДА ДанныеДляРасчета.НеПрименятьСезонность
	|			ТОГДА ДанныеДляРасчета.КоэффициентНормативаНеПрименятьСезонность
	|		ИНАЧЕ ДанныеДляРасчета.КоэффициентНорматива
	|	КОНЕЦ * ВЫБОР
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.ПустаяСсылка)
	|			ТОГДА -1
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.СоциальнаяНормаРавнаНормативуПотребления)
	|			ТОГДА ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|					КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|							И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|						ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|					КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|					ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|				КОНЕЦ
	|		ИНАЧЕ ДанныеДляРасчета.СоциальнаяНормаПотребления * ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|				КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|					ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|				ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|			КОНЕЦ
	|	КОНЕЦ КАК ЗначениеСоциальнойНормы,
	|	ДанныеДляРасчета.КоэффициентСезоности * ВЫБОР
	|		КОГДА ДанныеДляРасчета.НеПрименятьСезонность
	|			ТОГДА ДанныеДляРасчета.КоэффициентНормативаНеПрименятьСезонность
	|		ИНАЧЕ ДанныеДляРасчета.КоэффициентНорматива
	|	КОНЕЦ * ВЫБОР
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.ПустаяСсылка)
	|			ТОГДА ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|					КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|					КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|							И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|						ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|					КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|					ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|				КОНЕЦ * ВЫБОР
	|					КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|							И НЕ ДанныеДляРасчета.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.Пустаяссылка)
	|						ТОГДА ВЫБОР
	|								КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|									ТОГДА 0
	|								ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|							КОНЕЦ
	|					ИНАЧЕ 1
	|				КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|					КОГДА ДанныеДляРасчета.НормативПоДням
	|							И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|						ТОГДА 1
	|					ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|				КОНЕЦ)
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.СоциальнаяНормаРавнаНормативуПотребления)
	|			ТОГДА ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|					КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|							И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|						ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|					КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|					ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|				КОНЕЦ
	|		ИНАЧЕ ДанныеДляРасчета.СоциальнаяНормаПотребления * ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|				КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|					ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|				ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|			КОНЕЦ
	|	КОНЕЦ КАК ЗначениеСоциальнойНормыРасчетныйСпособ,
	|	ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.ПоПриборам) КАК СпособНачисления,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.СледующийРегистратор = НЕОПРЕДЕЛЕНО
	|			ТОГДА ДанныеДляРасчета.ЗначениеТарифа
	|		КОГДА ДанныеДляРасчета.СледующийРегистратор ЕСТЬ NULL
	|			ТОГДА ДанныеДляРасчета.ЗначениеТарифа
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДляРасчета.СледующийРегистратор) = ТИП(Документ.энргУстановитьЗначениеТарифа)
	|			ТОГДА ДанныеДляРасчета.ПредыдущееЗначениеТарифа
	|		ИНАЧЕ ДанныеДляРасчета.ЗначениеТарифа
	|	КОНЕЦ КАК ЗначениеТарифа,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.СледующийРегистратор = НЕОПРЕДЕЛЕНО
	|			ТОГДА ДанныеДляРасчета.ЗначениеТарифаСверхНорматива
	|		КОГДА ДанныеДляРасчета.СледующийРегистратор ЕСТЬ NULL
	|			ТОГДА ДанныеДляРасчета.ЗначениеТарифаСверхНорматива
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДляРасчета.СледующийРегистратор) = ТИП(Документ.энргУстановитьЗначениеТарифа)
	|			ТОГДА ДанныеДляРасчета.ПредыдущееЗначениеТарифаСверхНорматива
	|		ИНАЧЕ ДанныеДляРасчета.ЗначениеТарифаСверхНорматива
	|	КОНЕЦ КАК ЗначениеТарифаСверхНорматива,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.СледующийРегистратор = НЕОПРЕДЕЛЕНО
	|			ТОГДА ДанныеДляРасчета.ЗначениеТарифаРЭК
	|		КОГДА ДанныеДляРасчета.СледующийРегистратор ЕСТЬ NULL
	|			ТОГДА ДанныеДляРасчета.ЗначениеТарифаРЭК
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДляРасчета.СледующийРегистратор) = ТИП(Документ.энргУстановитьЗначениеТарифа)
	|			ТОГДА ДанныеДляРасчета.ПредыдущееЗначениеТарифаРЭК
	|		ИНАЧЕ ДанныеДляРасчета.ЗначениеТарифаРЭК
	|	КОНЕЦ КАК ЗначениеРЭК,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|			ТОГДА 0
	|		КОГДА ДанныеДляРасчета.Поставщик = ДанныеДляРасчета.Абонент
	|			ТОГДА 0
	|		КОГДА ДанныеДляРасчета.РегистрируетОбъем
	|				И НЕ ДанныеДляРасчета.КонечныеПоказания = ДанныеДляРасчета.НачальныеПоказания
	|			ТОГДА ДанныеДляРасчета.КонечныеПоказания
	|		КОГДА ДанныеДляРасчета.РегистрируетОбъем
	|			ТОГДА 0
	|		КОГДА ДанныеДляРасчета.КонечныеПоказания < ДанныеДляРасчета.НачальныеПоказания
	|			ТОГДА ДанныеДляРасчета.МаксимальноВозможныеПоказания - ДанныеДляРасчета.НачальныеПоказания + ДанныеДляРасчета.КонечныеПоказания
	|		ИНАЧЕ ДанныеДляРасчета.КонечныеПоказания - ДанныеДляРасчета.НачальныеПоказания
	|	КОНЕЦ * ДанныеДляРасчета.КоэффициентПУ * ВЫБОР
	|		КОГДА ДанныеДляРасчета.СледующийРегистратор = НЕОПРЕДЕЛЕНО
	|			ТОГДА ДанныеДляРасчета.ЗначениеТарифа
	|		КОГДА ДанныеДляРасчета.СледующийРегистратор ЕСТЬ NULL
	|			ТОГДА ДанныеДляРасчета.ЗначениеТарифа
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДляРасчета.СледующийРегистратор) = ТИП(Документ.энргУстановитьЗначениеТарифа)
	|			ТОГДА ДанныеДляРасчета.ПредыдущееЗначениеТарифа
	|		ИНАЧЕ ДанныеДляРасчета.ЗначениеТарифа
	|	КОНЕЦ КАК Сумма,
	|	ДанныеДляРасчета.ДокументНачисления КАК ДокументНачисления,
	|	ДанныеДляРасчета.ДокументНачисленияПометкаУдаления КАК ДокументНачисленияПометкаУдаления,
	|	ДанныеДляРасчета.Поставщик КАК Поставщик,
	|	ДанныеДляРасчета.КоэффициентСезоности КАК КоэффициентСезоности,
	|	ДанныеДляРасчета.НачальныеПоказания КАК НачальныеПоказания,
	|	ДанныеДляРасчета.КонечныеПоказания КАК КонечныеПоказания,
	|	ДанныеДляРасчета.РасчетПоФормуле КАК РасчетПоФормуле,
	|	ДанныеДляРасчета.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|	ДанныеДляРасчета.КоэффициентФормула КАК КоэффициентФормула,
	|	ДанныеДляРасчета.ЗначениеПлощади КАК ЗначениеПлощади,
	|	ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|		КОГДА ДанныеДляРасчета.НеПрименятьСезонность
	|			ТОГДА ДанныеДляРасчета.КоэффициентНормативаНеПрименятьСезонность
	|		ИНАЧЕ ДанныеДляРасчета.КоэффициентНорматива
	|	КОНЕЦ КАК НормаПотребления,
	|	ДанныеДляРасчета.КоличествоПрописанных КАК КоличествоПрописанных,
	|	ДанныеДляРасчета.КоличествоСобственников КАК КоличествоСобственников,
	|	ДанныеДляРасчета.КоличествоПроживающих КАК КоличествоПроживающих,
	|	ДанныеДляРасчета.КоличествоЖильцов КАК КоличествоЖильцов,
	|	ДанныеДляРасчета.ВидПлощади КАК ВидПлощади,
	|	ДанныеДляРасчета.ПоказанияВСрок КАК ПоказанияВСрок,
	|	ДанныеДляРасчета.КоэффициентПУ КАК КоэффициентПУ,
	|	ДанныеДляРасчета.ТарифнаяГруппа КАК ТарифнаяГруппа,
	|	ДанныеДляРасчета.ВидБлагоустройства КАК ВидБлагоустройства,
	|	ДанныеДляРасчета.ВидДифференцированности КАК ВидДифференцированности,
	|	ДанныеДляРасчета.КоличествоКомнат КАК КоличествоКомнат,
	|	1 КАК ПовыщающийКоэффициент,
	|	ДанныеДляРасчета.ДатаПоверки КАК ДатаПоверки,
	|	ДанныеДляРасчета.ЗакрытаяСхемаГВС КАК ЗакрытаяСхемаГВС,	
	|	НЕ ДанныеДляРасчета.НачислятьПоПрибору КАК СниматьНачисленныйСредний,
	|	ДанныеДляРасчета.СоставнаяУслуга КАК СоставнаяУслуга,
	|	ДанныеДляРасчета.УмножатьНаНормуРодительскойУслуги КАК УмножатьНаНормуРодительскойУслуги,
	|	ДанныеДляРасчета.ПлощадьМОП КАК ПлощадьМОП,
	|	ДанныеДляРасчета.ПлощадьАбонентов КАК ПлощадьАбонентов,
	|	ДанныеДляРасчета.ПлощадьСобственнаяПоставка КАК ПлощадьСобственнаяПоставка,
	|	ДанныеДляРасчета.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	ДанныеДляРасчета.Измеритель КАК Измеритель,
	|	ДанныеДляРасчета.СпособРаспределенияОбъемаПомещения КАК СпособРаспределенияОбъемаПомещения,
	|	ДанныеДляРасчета.ФиксированныйОбъемПотребления КАК ФиксированныйОбъемПотребления,
	|	ДанныеДляРасчета.ДоляПотребленияЧислитель КАК ДоляПотребленияЧислитель,
	|	ДанныеДляРасчета.ДоляПотребленияЗнаменатель КАК ДоляПотребленияЗнаменатель,
	|	ДанныеДляРасчета.КоэффициентРаспределенияОстатка КАК КоэффициентРаспределенияОстатка,
	|	ДанныеДляРасчета.ЗавершениеОП КАК ЗавершениеОП,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.СпособРаспределенияОбъемаПомещения = ЗНАЧЕНИЕ(Перечисление.энргСпособыРаспределенияОбъема.Остаток)
	|			ТОГДА 1
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК ПорядокСпособРаспределенияОбъемаПомещения,
	|	ДанныеДляРасчета.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	ДанныеДляРасчета.НачислятьНорму КАК НачислятьНорму,
	|	ДанныеДляРасчета.НачислятьПоПрибору КАК НачислятьПоПрибору,
	|	ДанныеДляРасчета.Техническая КАК Техническая,
	|	ДанныеДляРасчета.ТочкаУчетаРодитель КАК ТочкаУчетаРодитель,
	|	ДанныеДляРасчета.НеНачислять КАК УдалитьЗапись,
	|	ДанныеДляРасчета.ЕстьСреднийПоВсемТочкамУслуги КАК ЕстьСреднийПоВсемТочкамУслуги,
	|	ДанныеДляРасчета.КлючПомещения КАК КлючПомещения
	|ИЗ
	|	ДанныеДляРасчета КАК ДанныеДляРасчета
	|ГДЕ
	|	ДанныеДляРасчета.ПриборВведен
	|	И ДанныеДляРасчета.ЕстьПоказанияАбонента
	|	И НЕ ДанныеДляРасчета.СпособРаспределенияОбъемаПомещения = ЗНАЧЕНИЕ(Перечисление.энргСпособыРаспределенияОбъема.ФиксированныйОбъем)
	|	И ВЫБОР
	|			КОГДА РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) = 0
	|					И ВЫБОР
	|						КОГДА ДанныеДляРасчета.КонечныеПоказания < ДанныеДляРасчета.НачальныеПоказания
	|							ТОГДА ДанныеДляРасчета.МаксимальноВозможныеПоказания - ДанныеДляРасчета.НачальныеПоказания + ДанныеДляРасчета.КонечныеПоказания
	|						ИНАЧЕ ДанныеДляРасчета.КонечныеПоказания - ДанныеДляРасчета.НачальныеПоказания
	|					КОНЕЦ = 0
	|				ТОГДА ЛОЖЬ
	|			ИНАЧЕ ИСТИНА
	|		КОНЕЦ
	|	И (ДанныеДляРасчета.УслНаДатуПоверки = 0 или ДанныеДляРасчета.УслНаДатуПоверки = 1)	
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ДанныеДляРасчета.Организация,
	|	ДанныеДляРасчета.ПериодНачисления,
	|	НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ),
	|	ДанныеДляРасчета.КонецПериода,
	|	ДанныеДляРасчета.Район,
	|	ДанныеДляРасчета.МКД,
	|	ДанныеДляРасчета.ЧастныйСектор,
	|	ДанныеДляРасчета.Строение,
	|	ДанныеДляРасчета.ПомещениеРодитель,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.ПомещениеРодитель = ДанныеДляРасчета.Помещение
	|			ТОГДА 0
	|		ИНАЧЕ 1
	|	КОНЕЦ,
	|	ДанныеДляРасчета.Помещение,
	|	ДанныеДляРасчета.Абонент,
	|	ДанныеДляРасчета.Услуга,
	|	ДанныеДляРасчета.ТочкаУчета,
	|	ДанныеДляРасчета.ЗависитОтУслуги,
	|	ЗНАЧЕНИЕ(Справочник.энргПриборыУчетаАбонента.ПУстаяСсылка),
	|	ЗНАЧЕНИЕ(Справочник.энргШкалыПриборовУчета.ПУстаяСсылка),
	|	ЗНАЧЕНИЕ(Справочник.энргТарифныеЗоны.БезРазбивки),
	|	ДанныеДляРасчета.ПриборВведен,
	|	ВЫРАЗИТЬ(ВЫБОР
	|			КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|				ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|			КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|					И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|				ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|			КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|				ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|			КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|				ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|			КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|				ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|			ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|		КОНЕЦ * ДанныеДляРасчета.КоэффициентСезоностиОбъемПотребленный * ДанныеДляРасчета.КоэффициентНормативаСПУ * ВЫРАЗИТЬ(ДанныеДляРасчета.НормаПотребления * ДанныеДляРасчета.КоэффициентНорматива КАК ЧИСЛО(15,6)) * ВЫБОР
	|			КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|					И НЕ ДанныеДляРасчета.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.Пустаяссылка)
	|				ТОГДА ВЫБОР
	|						КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|							ТОГДА 0
	|						ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|					КОНЕЦ
	|			ИНАЧЕ 1
	|		КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|			КОГДА ДанныеДляРасчета.НормативПоДням
	|					И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|				ТОГДА 1
	|			ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|		КОНЕЦ) КАК ЧИСЛО(15, 6)),
	|	ВЫРАЗИТЬ(ВЫБОР
	|			КОГДА ДанныеДляРасчета.Поставщик = ДанныеДляРасчета.Абонент
	|				ТОГДА 0
	|			КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|				ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|			КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|					И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|				ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|			КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|				ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|			КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|				ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|			КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|				ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|			ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|		КОНЕЦ * ДанныеДляРасчета.КоэффициентСезоности * ДанныеДляРасчета.КоэффициентНормативаСПУ * ВЫРАЗИТЬ(ДанныеДляРасчета.НормаПотребления * ВЫБОР КОГДА ДанныеДляРасчета.НеПрименятьСезонность ТОГДА ДанныеДляРасчета.КоэффициентНормативаНеПрименятьСезонность ИНАЧЕ ДанныеДляРасчета.КоэффициентНорматива КОНЕЦ КАК ЧИСЛО(15,6)) * ВЫБОР
	|			КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|					И НЕ ДанныеДляРасчета.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.Пустаяссылка)
	|				ТОГДА ВЫБОР
	|						КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|							ТОГДА 0
	|						ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|					КОНЕЦ
	|			ИНАЧЕ 1
	|		КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|			КОГДА ДанныеДляРасчета.НормативПоДням
	|					И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|				ТОГДА 1
	|			ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|		КОНЕЦ) КАК ЧИСЛО(15, 6)),
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.ПустаяСсылка)
	|			ТОГДА -1
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.СоциальнаяНормаРавнаНормативуПотребления)
	|			ТОГДА ВЫРАЗИТЬ(ДанныеДляРасчета.КоэффициентНормативаИСезонности * ДанныеДляРасчета.НормаПотребления КАК ЧИСЛО (15,6)) * ВЫБОР
	|					КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|							И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|						ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|					КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|					ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|				КОНЕЦ
	|		ИНАЧЕ ВЫРАЗИТЬ(ДанныеДляРасчета.КоэффициентНормативаИСезонности * ДанныеДляРасчета.СоциальнаяНормаПотребления * ДанныеДляРасчета.НормаПотребления КАК ЧИСЛО(15,6)) * ВЫБОР
	|				КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|					ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|				ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|			КОНЕЦ
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.ПустаяСсылка)
	|			ТОГДА ВЫРАЗИТЬ(ДанныеДляРасчета.КоэффициентНормативаИСезонности * ДанныеДляРасчета.НормаПотребления КАК ЧИСЛО(15,6)) * ВЫБОР
	|					КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|					КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|							И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|						ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|					КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|					ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|				КОНЕЦ * ВЫБОР
	|					КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|							И НЕ ДанныеДляРасчета.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.Пустаяссылка)
	|						ТОГДА ВЫБОР
	|								КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|									ТОГДА 0
	|								ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|							КОНЕЦ
	|					ИНАЧЕ 1
	|				КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|					КОГДА ДанныеДляРасчета.НормативПоДням
	|							И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|						ТОГДА 1
	|					ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|				КОНЕЦ)
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.СоциальнаяНормаРавнаНормативуПотребления)
	|			ТОГДА ВЫРАЗИТЬ(ДанныеДляРасчета.КоэффициентНормативаИСезонности * ДанныеДляРасчета.НормаПотребления КАК ЧИСЛО(15,6)) * ВЫБОР
	|					КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|					КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|							И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|						ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|					КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|					ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|				КОНЕЦ * ВЫБОР
	|					КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|							И НЕ ДанныеДляРасчета.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.Пустаяссылка)
	|						ТОГДА ВЫБОР
	|								КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|									ТОГДА 0
	|								ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|							КОНЕЦ
	|					ИНАЧЕ 1
	|				КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|					КОГДА ДанныеДляРасчета.НормативПоДням
	|							И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|						ТОГДА 1
	|					ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|				КОНЕЦ)
	|		ИНАЧЕ ВЫРАЗИТЬ(ДанныеДляРасчета.КоэффициентНормативаИСезонности * ДанныеДляРасчета.СоциальнаяНормаПотребления * ДанныеДляРасчета.НормаПотребления КАК ЧИСЛО(15,6)) * ВЫБОР
	|				КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|					ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|				ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|			КОНЕЦ
	|	КОНЕЦ,
	|	ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.ПоНормативу),
	|	ДанныеДляРасчета.ЗначениеТарифа,
	|	ДанныеДляРасчета.ЗначениеТарифаСверхНорматива,
	|	ДанныеДляРасчета.ЗначениеТарифаРЭК,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.Поставщик = ДанныеДляРасчета.Абонент
	|			ТОГДА 0
	|		КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|			ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|		КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|				И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|			ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|		КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|			ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|		КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|			ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|		КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|			ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|		ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|	КОНЕЦ * ДанныеДляРасчета.КоэффициентСезоности * ВЫРАЗИТЬ(ДанныеДляРасчета.НормаПотребления * ВЫБОР КОГДА ДанныеДляРасчета.НеПрименятьСезонность ТОГДА ДанныеДляРасчета.КоэффициентНормативаНеПрименятьСезонность ИНАЧЕ ДанныеДляРасчета.КоэффициентНорматива КОНЕЦ КАК ЧИСЛО(15,6)) * ДанныеДляРасчета.КоэффициентНормативаСПУ * ВЫБОР
	|		КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|				И НЕ ДанныеДляРасчета.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.Пустаяссылка)
	|			ТОГДА ВЫБОР
	|					КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|						ТОГДА 0
	|					ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|				КОНЕЦ
	|		ИНАЧЕ 1
	|	КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|		КОГДА ДанныеДляРасчета.НормативПоДням
	|				И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|			ТОГДА 1
	|		ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|	КОНЕЦ) * ДанныеДляРасчета.ЗначениеТарифа,
	|	ДанныеДляРасчета.ДокументНачисления,
	|	ДанныеДляРасчета.ДокументНачисленияПометкаУдаления,
	|	ДанныеДляРасчета.Поставщик,
	|	ДанныеДляРасчета.КоэффициентСезоности,
	|	0,
	|	0,
	|	ДанныеДляРасчета.РасчетПоФормуле,
	|	ДанныеДляРасчета.ЗависимаяТочкаУчета,
	|	ДанныеДляРасчета.КоэффициентФормула,
	|	ДанныеДляРасчета.ЗначениеПлощади,
	|	ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|		КОГДА ДанныеДляРасчета.НеПрименятьСезонность
	|			ТОГДА ДанныеДляРасчета.КоэффициентНормативаНеПрименятьСезонность
	|		ИНАЧЕ ДанныеДляРасчета.КоэффициентНорматива
	|	КОНЕЦ,
	|	ДанныеДляРасчета.КоличествоПрописанных,
	|	ДанныеДляРасчета.КоличествоСобственников,
	|	ДанныеДляРасчета.КоличествоПроживающих,
	|	ДанныеДляРасчета.КоличествоЖильцов,
	|	ДанныеДляРасчета.ВидПлощади,
	|	ДанныеДляРасчета.ПоказанияВСрок,
	|	ДанныеДляРасчета.КоэффициентПУ,
	|	ДанныеДляРасчета.ТарифнаяГруппа,
	|	ДанныеДляРасчета.ВидБлагоустройства,
	|	ДанныеДляРасчета.ВидДифференцированности,
	|	ДанныеДляРасчета.КоличествоКомнат,
	|	ВЫБОР
	|		КОГДА НЕ ДанныеДляРасчета.ПовышающийКоэффициент = -1
	|				И НЕ ДанныеДляРасчета.НетВозможностьУстановкиПУ
	|			ТОГДА ДанныеДляРасчета.ПовышающийКоэффициент
	|		ИНАЧЕ 1
	|	КОНЕЦ,
	|	ДанныеДляРасчета.ДатаПоверки,
	|	ДанныеДляРасчета.ЗакрытаяСхемаГВС,
	|	ЛОЖЬ,
	|	ДанныеДляРасчета.СоставнаяУслуга,
	|	ДанныеДляРасчета.УмножатьНаНормуРодительскойУслуги,
	|	ДанныеДляРасчета.ПлощадьМОП,
	|	ДанныеДляРасчета.ПлощадьАбонентов,
	|	ДанныеДляРасчета.ПлощадьСобственнаяПоставка,
	|	ДанныеДляРасчета.НаправлениеИспользованияТУ,
	|	ДанныеДляРасчета.Измеритель,
	|	ДанныеДляРасчета.СпособРаспределенияОбъемаПомещения,
	|	ДанныеДляРасчета.ФиксированныйОбъемПотребления,
	|	ДанныеДляРасчета.ДоляПотребленияЧислитель,
	|	ДанныеДляРасчета.ДоляПотребленияЗнаменатель,
	|	ДанныеДляРасчета.КоэффициентРаспределенияОстатка,
	|	ДанныеДляРасчета.ЗавершениеОП,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.СпособРаспределенияОбъемаПомещения = ЗНАЧЕНИЕ(Перечисление.энргСпособыРаспределенияОбъема.Остаток)
	|			ТОГДА 1
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	ДанныеДляРасчета.НеПрименятьСезонность,
	|	ДанныеДляРасчета.НачислятьНорму,
	|	ДанныеДляРасчета.НачислятьПоПрибору,
	|	ДанныеДляРасчета.Техническая,
	|	ДанныеДляРасчета.ТочкаУчетаРодитель,
	|	ДанныеДляРасчета.НеНачислять,
	|	ДанныеДляРасчета.ЕстьСреднийПоВсемТочкамУслуги,
	|	ДанныеДляРасчета.КлючПомещения
	|ИЗ
	|	ДанныеДляРасчета КАК ДанныеДляРасчета
	|ГДЕ
	|	ВЫБОР КОГДА ДанныеДляРасчета.УслНаДатуПоверки = 3 ТОГДА ИСТИНА ИНАЧЕ НЕ ДанныеДляРасчета.ПриборВведен
	|	И (ДанныеДляРасчета.НачислятьНорму
	|			ИЛИ НЕ ДанныеДляРасчета.ЗависитОтУслуги = ЗНАЧЕНИЕ(Справочник.энргВидыУслуг.ПустаяСсылка))
	|	И РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) >= 1
	|	И НЕ ДанныеДляРасчета.СпособРаспределенияОбъемаПомещения = ЗНАЧЕНИЕ(Перечисление.энргСпособыРаспределенияОбъема.ФиксированныйОбъем)
	|	И НЕ ДанныеДляРасчета.РасчетТолькоПоПоказаниям КОНЕЦ
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ДанныеДляРасчета.Организация,
	|	ДанныеДляРасчета.ПериодНачисления,
	|	НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ),
	|	ДанныеДляРасчета.КонецПериода,
	|	ДанныеДляРасчета.Район,
	|	ДанныеДляРасчета.МКД,
	|	ДанныеДляРасчета.ЧастныйСектор,
	|	ДанныеДляРасчета.Строение,
	|	ДанныеДляРасчета.ПомещениеРодитель,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.ПомещениеРодитель = ДанныеДляРасчета.Помещение
	|			ТОГДА 0
	|		ИНАЧЕ 1
	|	КОНЕЦ,
	|	ДанныеДляРасчета.Помещение,
	|	ДанныеДляРасчета.Абонент,
	|	ДанныеДляРасчета.Услуга,
	|	ДанныеДляРасчета.ТочкаУчета,
	|	ДанныеДляРасчета.ЗависитОтУслуги,
	|	ДанныеДляРасчета.ПриборУчета,
	|	ДанныеДляРасчета.Шкала,
	|	ДанныеДляРасчета.ТарифнаяЗона,
	|	ДанныеДляРасчета.ПриборВведен,
	|	ВЫРАЗИТЬ(ДанныеДляРасчета.СреднийОбъем * ДанныеДляРасчета.КоэффициентСезоности * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ДанныеДляРасчета.ДнейВПериоде) КАК ЧИСЛО(15, 6)),
	|	ВЫРАЗИТЬ(ВЫБОР
	|			КОГДА ДанныеДляРасчета.Поставщик = ДанныеДляРасчета.Абонент
	|				ТОГДА 0
	|			ИНАЧЕ ДанныеДляРасчета.СреднийОбъем * ДанныеДляРасчета.КоэффициентСезоности * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ДанныеДляРасчета.ДнейВПериоде)
	|		КОНЕЦ КАК ЧИСЛО(15, 6)),
	|	ДанныеДляРасчета.КоэффициентСезоности * ВЫБОР
	|		КОГДА ДанныеДляРасчета.НеПрименятьСезонность
	|			ТОГДА ДанныеДляРасчета.КоэффициентНормативаНеПрименятьСезонность
	|		ИНАЧЕ ДанныеДляРасчета.КоэффициентНорматива
	|	КОНЕЦ * ВЫБОР
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.ПустаяСсылка)
	|			ТОГДА -1
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.СоциальнаяНормаРавнаНормативуПотребления)
	|			ТОГДА ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|					КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|							И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|						ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|					КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|					ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|				КОНЕЦ
	|		ИНАЧЕ ДанныеДляРасчета.СоциальнаяНормаПотребления * ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|				КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|					ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|				ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|			КОНЕЦ
	|	КОНЕЦ,
	|	ДанныеДляРасчета.КоэффициентСезоности * ВЫБОР
	|		КОГДА ДанныеДляРасчета.НеПрименятьСезонность
	|			ТОГДА ДанныеДляРасчета.КоэффициентНормативаНеПрименятьСезонность
	|		ИНАЧЕ ДанныеДляРасчета.КоэффициентНорматива
	|	КОНЕЦ * ВЫБОР
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.ПустаяСсылка)
	|			ТОГДА ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|					КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|					КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|							И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|						ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|					КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|					ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|				КОНЕЦ * ВЫБОР
	|					КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|							И НЕ ДанныеДляРасчета.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.Пустаяссылка)
	|						ТОГДА ВЫБОР
	|								КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|									ТОГДА 0
	|								ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|							КОНЕЦ
	|					ИНАЧЕ 1
	|				КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|					КОГДА ДанныеДляРасчета.НормативПоДням
	|							И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|						ТОГДА 1
	|					ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|				КОНЕЦ)
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.СоциальнаяНормаРавнаНормативуПотребления)
	|			ТОГДА ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|					КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|					КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|							И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|						ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|					КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|					ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|				КОНЕЦ * ВЫБОР
	|					КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|							И НЕ ДанныеДляРасчета.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.Пустаяссылка)
	|						ТОГДА ВЫБОР
	|								КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|									ТОГДА 0
	|								ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|							КОНЕЦ
	|					ИНАЧЕ 1
	|				КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|					КОГДА ДанныеДляРасчета.НормативПоДням
	|							И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|						ТОГДА 1
	|					ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|				КОНЕЦ)
	|		ИНАЧЕ ДанныеДляРасчета.СоциальнаяНормаПотребления * ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|				КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|					ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|				ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|			КОНЕЦ
	|	КОНЕЦ,
	|	ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.НачислениеПоСреднему),
	|	ДанныеДляРасчета.ЗначениеТарифа,
	|	ДанныеДляРасчета.ЗначениеТарифаСверхНорматива,
	|	ДанныеДляРасчета.ЗначениеТарифаРЭК,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.Поставщик = ДанныеДляРасчета.Абонент
	|			ТОГДА 0
	|		ИНАЧЕ ДанныеДляРасчета.СреднийОбъем * ДанныеДляРасчета.КоэффициентСезоности * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ДанныеДляРасчета.ДнейВПериоде)
	|	КОНЕЦ * ДанныеДляРасчета.ЗначениеТарифа,
	|	ДанныеДляРасчета.ДокументНачисления,
	|	ДанныеДляРасчета.ДокументНачисленияПометкаУдаления,
	|	ДанныеДляРасчета.Поставщик,
	|	ДанныеДляРасчета.КоэффициентСезоности,
	|	0,
	|	0,
	|	ДанныеДляРасчета.РасчетПоФормуле,
	|	ДанныеДляРасчета.ЗависимаяТочкаУчета,
	|	ДанныеДляРасчета.КоэффициентФормула,
	|	ДанныеДляРасчета.ЗначениеПлощади,
	|	ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|		КОГДА ДанныеДляРасчета.НеПрименятьСезонность
	|			ТОГДА ДанныеДляРасчета.КоэффициентНормативаНеПрименятьСезонность
	|		ИНАЧЕ ДанныеДляРасчета.КоэффициентНорматива
	|	КОНЕЦ,
	|	ДанныеДляРасчета.КоличествоПрописанных,
	|	ДанныеДляРасчета.КоличествоСобственников,
	|	ДанныеДляРасчета.КоличествоПроживающих,
	|	ДанныеДляРасчета.КоличествоЖильцов,
	|	ДанныеДляРасчета.ВидПлощади,
	|	ДанныеДляРасчета.ПоказанияВСрок,
	|	ДанныеДляРасчета.КоэффициентПУ,
	|	ДанныеДляРасчета.ТарифнаяГруппа,
	|	ДанныеДляРасчета.ВидБлагоустройства,
	|	ДанныеДляРасчета.ВидДифференцированности,
	|	ДанныеДляРасчета.КоличествоКомнат,
	|	1,
	|	ДанныеДляРасчета.ДатаПоверки,
	|	ДанныеДляРасчета.ЗакрытаяСхемаГВС,
	|	ИСТИНА,
	|	ДанныеДляРасчета.СоставнаяУслуга,
	|	ДанныеДляРасчета.УмножатьНаНормуРодительскойУслуги,
	|	ДанныеДляРасчета.ПлощадьМОП,
	|	ДанныеДляРасчета.ПлощадьАбонентов,
	|	ДанныеДляРасчета.ПлощадьСобственнаяПоставка,
	|	ДанныеДляРасчета.НаправлениеИспользованияТУ,
	|	ДанныеДляРасчета.Измеритель,
	|	ДанныеДляРасчета.СпособРаспределенияОбъемаПомещения,
	|	ДанныеДляРасчета.ФиксированныйОбъемПотребления,
	|	ДанныеДляРасчета.ДоляПотребленияЧислитель,
	|	ДанныеДляРасчета.ДоляПотребленияЗнаменатель,
	|	ДанныеДляРасчета.КоэффициентРаспределенияОстатка,
	|	ДанныеДляРасчета.ЗавершениеОП,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.СпособРаспределенияОбъемаПомещения = ЗНАЧЕНИЕ(Перечисление.энргСпособыРаспределенияОбъема.Остаток)
	|			ТОГДА 1
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	ДанныеДляРасчета.НеПрименятьСезонность,
	|	ДанныеДляРасчета.НачислятьНорму,
	|	ДанныеДляРасчета.НачислятьПоПрибору,
	|	ДанныеДляРасчета.Техническая,
	|	ДанныеДляРасчета.ТочкаУчетаРодитель,
	|	ДанныеДляРасчета.НеНачислять,
	|	ДанныеДляРасчета.ЕстьСреднийПоВсемТочкамУслуги,
	|	ДанныеДляРасчета.КлючПомещения
	|ИЗ
	|	ДанныеДляРасчета КАК ДанныеДляРасчета
	|ГДЕ
	|	выбор когда ДанныеДляРасчета.УслНаДатуПоверки = 2 тогда истина иначе НЕ ДанныеДляРасчета.ПоказанияВСрок
	|	И ВЫБОР
	|			КОГДА ДанныеДляРасчета.ЗависитОтУслуги = ЗНАЧЕНИЕ(Справочник.энргВидыУслуг.ПустаяСсылка)
	|				ТОГДА ДанныеДляРасчета.ЕстьСреднийПоВсемТочкамУслуги
	|						И ДанныеДляРасчета.СреднийОбъем >= 0
	|			ИНАЧЕ ДанныеДляРасчета.ЕстьСреднийПоВсемТочкамУслугиЗависитОтУслуги
	|					И ДанныеДляРасчета.СреднийОбъемЗависитОтУслуги >= 0
	|		КОНЕЦ
	|	И НЕ ДанныеДляРасчета.ВыводПрибораУчета
	|	И НЕ ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|	И НЕ ДанныеДляРасчета.АбонентЗакрытВТекущемПериоде
	|	И ДанныеДляРасчета.ПриборВведен
	|	И ДанныеДляРасчета.НачислятьНорму
	|	И РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) >= 1
	|	И НЕ ДанныеДляРасчета.СпособРаспределенияОбъемаПомещения = ЗНАЧЕНИЕ(Перечисление.энргСпособыРаспределенияОбъема.ФиксированныйОбъем)
	|	И НЕ ДанныеДляРасчета.РасчетТолькоПоПоказаниям  конец
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ДанныеДляРасчета.Организация,
	|	ДанныеДляРасчета.ПериодНачисления,
	|	НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ),
	|	ДанныеДляРасчета.КонецПериода,
	|	ДанныеДляРасчета.Район,
	|	ДанныеДляРасчета.МКД,
	|	ДанныеДляРасчета.ЧастныйСектор,
	|	ДанныеДляРасчета.Строение,
	|	ДанныеДляРасчета.ПомещениеРодитель,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.ПомещениеРодитель = ДанныеДляРасчета.Помещение
	|			ТОГДА 0
	|		ИНАЧЕ 1
	|	КОНЕЦ,
	|	ДанныеДляРасчета.Помещение,
	|	ДанныеДляРасчета.Абонент,
	|	ДанныеДляРасчета.Услуга,
	|	ДанныеДляРасчета.ТочкаУчета,
	|	ДанныеДляРасчета.ЗависитОтУслуги,
	|	ДанныеДляРасчета.ПриборУчета,
	|	ДанныеДляРасчета.Шкала,
	|	ДанныеДляРасчета.ТарифнаяЗона,
	|	ДанныеДляРасчета.ПриборВведен,
	|	ВЫРАЗИТЬ(ДанныеДляРасчета.СреднийОбъемПотребленный * ДанныеДляРасчета.КоэффициентСезоностиОбъемПотребленный * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|			КОГДА ДанныеДляРасчета.НормативПоДням
	|					И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|				ТОГДА 1
	|			ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|		КОНЕЦ) КАК ЧИСЛО(15, 6)),
	|	0,
	|	ДанныеДляРасчета.КоэффициентСезоностиОбъемПотребленный * ВЫБОР
	|		КОГДА ДанныеДляРасчета.НеПрименятьСезонность
	|			ТОГДА ДанныеДляРасчета.КоэффициентНормативаНеПрименятьСезонность
	|		ИНАЧЕ ДанныеДляРасчета.КоэффициентНорматива
	|	КОНЕЦ * ВЫБОР
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.ПустаяСсылка)
	|			ТОГДА -1
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.СоциальнаяНормаРавнаНормативуПотребления)
	|			ТОГДА ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|					КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|							И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|						ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|					КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|					ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|				КОНЕЦ
	|		ИНАЧЕ ДанныеДляРасчета.СоциальнаяНормаПотребления * ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|				КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|					ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|				ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|			КОНЕЦ
	|	КОНЕЦ,
	|	ДанныеДляРасчета.КоэффициентСезоности * ВЫБОР
	|		КОГДА ДанныеДляРасчета.НеПрименятьСезонность
	|			ТОГДА ДанныеДляРасчета.КоэффициентНормативаНеПрименятьСезонность
	|		ИНАЧЕ ДанныеДляРасчета.КоэффициентНорматива
	|	КОНЕЦ * ВЫБОР
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.ПустаяСсылка)
	|			ТОГДА ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|					КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|					КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|							И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|						ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|					КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|					ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|				КОНЕЦ * ВЫБОР
	|					КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|							И НЕ ДанныеДляРасчета.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.Пустаяссылка)
	|						ТОГДА ВЫБОР
	|								КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|									ТОГДА 0
	|								ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|							КОНЕЦ
	|					ИНАЧЕ 1
	|				КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|					КОГДА ДанныеДляРасчета.НормативПоДням
	|							И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|						ТОГДА 1
	|					ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|				КОНЕЦ)
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.СоциальнаяНормаРавнаНормативуПотребления)
	|			ТОГДА ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|					КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|					КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|							И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|						ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|					КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|					ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|				КОНЕЦ * ВЫБОР
	|					КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|							И НЕ ДанныеДляРасчета.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.Пустаяссылка)
	|						ТОГДА ВЫБОР
	|								КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|									ТОГДА 0
	|								ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|							КОНЕЦ
	|					ИНАЧЕ 1
	|				КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|					КОГДА ДанныеДляРасчета.НормативПоДням
	|							И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|						ТОГДА 1
	|					ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|				КОНЕЦ)
	|		ИНАЧЕ ДанныеДляРасчета.СоциальнаяНормаПотребления * ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|				КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|					ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|				ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|			КОНЕЦ
	|	КОНЕЦ,
	|	ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.НачислениеПоСреднему),
	|	ДанныеДляРасчета.ЗначениеТарифа,
	|	ДанныеДляРасчета.ЗначениеТарифаСверхНорматива,
	|	ДанныеДляРасчета.ЗначениеТарифаРЭК,
	|	0,
	|	ДанныеДляРасчета.ДокументНачисления,
	|	ДанныеДляРасчета.ДокументНачисленияПометкаУдаления,
	|	ДанныеДляРасчета.Поставщик,
	|	ДанныеДляРасчета.КоэффициентСезоностиОбъемПотребленный,
	|	0,
	|	0,
	|	ДанныеДляРасчета.РасчетПоФормуле,
	|	ДанныеДляРасчета.ЗависимаяТочкаУчета,
	|	ДанныеДляРасчета.КоэффициентФормула,
	|	ДанныеДляРасчета.ЗначениеПлощади,
	|	ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|		КОГДА ДанныеДляРасчета.НеПрименятьСезонность
	|			ТОГДА ДанныеДляРасчета.КоэффициентНормативаНеПрименятьСезонность
	|		ИНАЧЕ ДанныеДляРасчета.КоэффициентНорматива
	|	КОНЕЦ,
	|	ДанныеДляРасчета.КоличествоПрописанных,
	|	ДанныеДляРасчета.КоличествоСобственников,
	|	ДанныеДляРасчета.КоличествоПроживающих,
	|	ДанныеДляРасчета.КоличествоЖильцов,
	|	ДанныеДляРасчета.ВидПлощади,
	|	ДанныеДляРасчета.ПоказанияВСрок,
	|	ДанныеДляРасчета.КоэффициентПУ,
	|	ДанныеДляРасчета.ТарифнаяГруппа,
	|	ДанныеДляРасчета.ВидБлагоустройства,
	|	ДанныеДляРасчета.ВидДифференцированности,
	|	ДанныеДляРасчета.КоличествоКомнат,
	|	1,
	|	ДанныеДляРасчета.ДатаПоверки,
	|	ДанныеДляРасчета.ЗакрытаяСхемаГВС,
	|	ЛОЖЬ,
	|	ДанныеДляРасчета.СоставнаяУслуга,
	|	ДанныеДляРасчета.УмножатьНаНормуРодительскойУслуги,
	|	ДанныеДляРасчета.ПлощадьМОП,
	|	ДанныеДляРасчета.ПлощадьАбонентов,
	|	ДанныеДляРасчета.ПлощадьСобственнаяПоставка,
	|	ДанныеДляРасчета.НаправлениеИспользованияТУ,
	|	ДанныеДляРасчета.Измеритель,
	|	ДанныеДляРасчета.СпособРаспределенияОбъемаПомещения,
	|	ДанныеДляРасчета.ФиксированныйОбъемПотребления,
	|	ДанныеДляРасчета.ДоляПотребленияЧислитель,
	|	ДанныеДляРасчета.ДоляПотребленияЗнаменатель,
	|	ДанныеДляРасчета.КоэффициентРаспределенияОстатка,
	|	ДанныеДляРасчета.ЗавершениеОП,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.СпособРаспределенияОбъемаПомещения = ЗНАЧЕНИЕ(Перечисление.энргСпособыРаспределенияОбъема.Остаток)
	|			ТОГДА 1
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	ДанныеДляРасчета.НеПрименятьСезонность,
	|	ДанныеДляРасчета.НачислятьНорму,
	|	ДанныеДляРасчета.НачислятьПоПрибору,
	|	ДанныеДляРасчета.Техническая,
	|	ДанныеДляРасчета.ТочкаУчетаРодитель,
	|	ДанныеДляРасчета.НеНачислять,
	|	ДанныеДляРасчета.ЕстьСреднийПоВсемТочкамУслуги,
	|	ДанныеДляРасчета.КлючПомещения
	|ИЗ
	|	ДанныеДляРасчета КАК ДанныеДляРасчета
	|ГДЕ
	|	НЕ ДанныеДляРасчета.ПоказанияВСрок
	|	И ВЫБОР
	|			КОГДА ДанныеДляРасчета.ЗависитОтУслуги = ЗНАЧЕНИЕ(Справочник.энргВидыУслуг.ПустаяСсылка)
	|				ТОГДА ДанныеДляРасчета.ЕстьСреднийПоВсемТочкамУслуги
	|						И ДанныеДляРасчета.СреднийОбъемПотребленный >= 0
	|			ИНАЧЕ ДанныеДляРасчета.ЕстьСреднийПоВсемТочкамУслугиЗависитОтУслуги
	|					И ДанныеДляРасчета.СреднийОбъемПотребленныйЗависитОтУслуги >= 0
	|		КОНЕЦ
	|	И НЕ ДанныеДляРасчета.ВыводПрибораУчета
	|	И ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|	И ДанныеДляРасчета.ПриборВведен
	|	И ДанныеДляРасчета.НачислятьНорму
	|	И РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) >= 1
	|	И НЕ ДанныеДляРасчета.СпособРаспределенияОбъемаПомещения = ЗНАЧЕНИЕ(Перечисление.энргСпособыРаспределенияОбъема.ФиксированныйОбъем)
	|	И НЕ ДанныеДляРасчета.РасчетТолькоПоПоказаниям
	|	И (ДанныеДляРасчета.УслНаДатуПоверки = 0 или ДанныеДляРасчета.УслНаДатуПоверки = 1)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ДанныеДляРасчета.Организация,
	|	ДанныеДляРасчета.ПериодНачисления,
	|	НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ),
	|	ДанныеДляРасчета.КонецПериода,
	|	ДанныеДляРасчета.Район,
	|	ДанныеДляРасчета.МКД,
	|	ДанныеДляРасчета.ЧастныйСектор,
	|	ДанныеДляРасчета.Строение,
	|	ДанныеДляРасчета.ПомещениеРодитель,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.ПомещениеРодитель = ДанныеДляРасчета.Помещение
	|			ТОГДА 0
	|		ИНАЧЕ 1
	|	КОНЕЦ,
	|	ДанныеДляРасчета.Помещение,
	|	ДанныеДляРасчета.Абонент,
	|	ДанныеДляРасчета.Услуга,
	|	ДанныеДляРасчета.ТочкаУчета,
	|	ДанныеДляРасчета.ЗависитОтУслуги,
	|	ДанныеДляРасчета.ПриборУчета,
	|	ДанныеДляРасчета.Шкала,
	|	ДанныеДляРасчета.ТарифнаяЗона,
	|	ДанныеДляРасчета.ПриборВведен,
	|	ВЫРАЗИТЬ(ВЫБОР
	|			КОГДА ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|				ТОГДА 0
	|			КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|				ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|			КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|					И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|				ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|			КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|				ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|			КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|				ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|			КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|				ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|			ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|		КОНЕЦ * ДанныеДляРасчета.КоэффициентСезоности * ДанныеДляРасчета.КоэффициентНормативаСПУ * ВЫРАЗИТЬ(ДанныеДляРасчета.НормаПотребления * ДанныеДляРасчета.КоэффициентНорматива КАК ЧИСЛО(15,6)) * ВЫБОР
	|			КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|					И НЕ ДанныеДляРасчета.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.Пустаяссылка)
	|				ТОГДА ВЫБОР
	|						КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|							ТОГДА 0
	|						ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|					КОНЕЦ
	|			ИНАЧЕ 1
	|		КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|			КОГДА ДанныеДляРасчета.НормативПоДням
	|					И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|				ТОГДА 1
	|			ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|		КОНЕЦ) КАК ЧИСЛО(15, 6)),
	|	ВЫРАЗИТЬ(ВЫБОР
	|			КОГДА ДанныеДляРасчета.Поставщик = ДанныеДляРасчета.Абонент
	|				ТОГДА 0
	|			КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|				ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|			КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|					И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|				ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|			КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|				ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|			КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|				ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|			КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|				ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|			ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|		КОНЕЦ * ДанныеДляРасчета.КоэффициентСезоности * ДанныеДляРасчета.КоэффициентНормативаСПУ * ВЫРАЗИТЬ(ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|			КОГДА ДанныеДляРасчета.НеПрименятьСезонность
	|				ТОГДА ДанныеДляРасчета.КоэффициентНормативаНеПрименятьСезонность
	|			ИНАЧЕ ДанныеДляРасчета.КоэффициентНорматива
	|		КОНЕЦ  КАК ЧИСЛО(15,6)) * ВЫБОР
	|			КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|					И НЕ ДанныеДляРасчета.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.Пустаяссылка)
	|				ТОГДА ВЫБОР
	|						КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|							ТОГДА 0
	|						ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|					КОНЕЦ
	|			ИНАЧЕ 1
	|		КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|			КОГДА ДанныеДляРасчета.НормативПоДням
	|					И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|				ТОГДА 1
	|			ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|		КОНЕЦ) КАК ЧИСЛО(15, 6)),
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.ПустаяСсылка)
	|			ТОГДА ДанныеДляРасчета.КоэффициентНормативаИСезонности * -1
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.СоциальнаяНормаРавнаНормативуПотребления)
	|			ТОГДА ВЫРАЗИТЬ(ДанныеДляРасчета.КоэффициентНормативаИСезонности * ДанныеДляРасчета.НормаПотребления КАК ЧИСЛО(15,6)) * ВЫБОР
	|					КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|							И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|						ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|					КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|					ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|				КОНЕЦ
	|		ИНАЧЕ ВЫРАЗИТЬ(ДанныеДляРасчета.КоэффициентНормативаИСезонности * ДанныеДляРасчета.СоциальнаяНормаПотребления * ДанныеДляРасчета.НормаПотребления КАК ЧИСЛО(15,6)) * ВЫБОР
	|				КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|					ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|				ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|			КОНЕЦ
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.ПустаяСсылка)
	|			ТОГДА ВЫРАЗИТЬ(ДанныеДляРасчета.КоэффициентНормативаИСезонности * ДанныеДляРасчета.НормаПотребления КАК ЧИСЛО(15,6)) * ВЫБОР
	|					КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|					КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|							И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|						ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|					КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|					ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|				КОНЕЦ * ВЫБОР
	|					КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|							И НЕ ДанныеДляРасчета.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.Пустаяссылка)
	|						ТОГДА ВЫБОР
	|								КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|									ТОГДА 0
	|								ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|							КОНЕЦ
	|					ИНАЧЕ 1
	|				КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|					КОГДА ДанныеДляРасчета.НормативПоДням
	|							И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|						ТОГДА 1
	|					ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|				КОНЕЦ)
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.СоциальнаяНормаРавнаНормативуПотребления)
	|			ТОГДА ВЫРАЗИТЬ(ДанныеДляРасчета.КоэффициентНормативаИСезонности * ДанныеДляРасчета.НормаПотребления КАК ЧИСЛО(15,6)) * ВЫБОР
	|					КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|					КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|							И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|						ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|					КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|					ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|				КОНЕЦ * ВЫБОР
	|					КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|							И НЕ ДанныеДляРасчета.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.Пустаяссылка)
	|						ТОГДА ВЫБОР
	|								КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|									ТОГДА 0
	|								ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|							КОНЕЦ
	|					ИНАЧЕ 1
	|				КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|					КОГДА ДанныеДляРасчета.НормативПоДням
	|							И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|						ТОГДА 1
	|					ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|				КОНЕЦ)
	|		ИНАЧЕ ВЫРАЗИТЬ(ДанныеДляРасчета.КоэффициентНормативаИСезонности * ДанныеДляРасчета.СоциальнаяНормаПотребления * ДанныеДляРасчета.НормаПотребления КАК ЧИСЛО (15,6)) * ВЫБОР
	|				КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|					ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|				ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|			КОНЕЦ
	|	КОНЕЦ,
	|	ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.СреднееПоНормативу),
	|	ДанныеДляРасчета.ЗначениеТарифа,
	|	ДанныеДляРасчета.ЗначениеТарифаСверхНорматива,
	|	ДанныеДляРасчета.ЗначениеТарифаРЭК,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.Поставщик = ДанныеДляРасчета.Абонент
	|			ТОГДА 0
	|		КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|			ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|		КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|				И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|			ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|		КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|			ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|		КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|			ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|		КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|			ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|		ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|	КОНЕЦ * ДанныеДляРасчета.КоэффициентСезоности * ДанныеДляРасчета.КоэффициентНормативаСПУ * ВЫРАЗИТЬ(ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|		КОГДА ДанныеДляРасчета.НеПрименятьСезонность
	|			ТОГДА ДанныеДляРасчета.КоэффициентНормативаНеПрименятьСезонность
	|		ИНАЧЕ ДанныеДляРасчета.КоэффициентНорматива
	|	КОНЕЦ КАК ЧИСЛО(15,6)) * ВЫБОР
	|		КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|				И НЕ ДанныеДляРасчета.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.Пустаяссылка)
	|			ТОГДА ВЫБОР
	|					КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|						ТОГДА 0
	|					ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|				КОНЕЦ
	|		ИНАЧЕ 1
	|	КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|		КОГДА ДанныеДляРасчета.НормативПоДням
	|				И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|			ТОГДА 1
	|		ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|	КОНЕЦ) * ДанныеДляРасчета.ЗначениеТарифа,
	|	ДанныеДляРасчета.ДокументНачисления,
	|	ДанныеДляРасчета.ДокументНачисленияПометкаУдаления,
	|	ДанныеДляРасчета.Поставщик,
	|	ДанныеДляРасчета.КоэффициентСезоности * ДанныеДляРасчета.КоэффициентНормативаСПУ,
	|	0,
	|	0,
	|	ДанныеДляРасчета.РасчетПоФормуле,
	|	ДанныеДляРасчета.ЗависимаяТочкаУчета,
	|	ДанныеДляРасчета.КоэффициентФормула,
	|	ДанныеДляРасчета.ЗначениеПлощади,
	|	ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|		КОГДА ДанныеДляРасчета.НеПрименятьСезонность
	|			ТОГДА ДанныеДляРасчета.КоэффициентНормативаНеПрименятьСезонность
	|		ИНАЧЕ ДанныеДляРасчета.КоэффициентНорматива
	|	КОНЕЦ,
	|	ДанныеДляРасчета.КоличествоПрописанных,
	|	ДанныеДляРасчета.КоличествоСобственников,
	|	ДанныеДляРасчета.КоличествоПроживающих,
	|	ДанныеДляРасчета.КоличествоЖильцов,
	|	ДанныеДляРасчета.ВидПлощади,
	|	ДанныеДляРасчета.ПоказанияВСрок,
	|	ДанныеДляРасчета.КоэффициентПУ,
	|	ДанныеДляРасчета.ТарифнаяГруппа,
	|	ДанныеДляРасчета.ВидБлагоустройства,
	|	ДанныеДляРасчета.ВидДифференцированности,
	|	ДанныеДляРасчета.КоличествоКомнат,
	|	1,
	|	ДанныеДляРасчета.ДатаПоверки,
	|	ДанныеДляРасчета.ЗакрытаяСхемаГВС,
	|	НЕ ДанныеДляРасчета.ОбъемЗаПрошлыйГод,
	|	ДанныеДляРасчета.СоставнаяУслуга,
	|	ДанныеДляРасчета.УмножатьНаНормуРодительскойУслуги,
	|	ДанныеДляРасчета.ПлощадьМОП,
	|	ДанныеДляРасчета.ПлощадьАбонентов,
	|	ДанныеДляРасчета.ПлощадьСобственнаяПоставка,
	|	ДанныеДляРасчета.НаправлениеИспользованияТУ,
	|	ДанныеДляРасчета.Измеритель,
	|	ДанныеДляРасчета.СпособРаспределенияОбъемаПомещения,
	|	ДанныеДляРасчета.ФиксированныйОбъемПотребления,
	|	ДанныеДляРасчета.ДоляПотребленияЧислитель,
	|	ДанныеДляРасчета.ДоляПотребленияЗнаменатель,
	|	ДанныеДляРасчета.КоэффициентРаспределенияОстатка,
	|	ДанныеДляРасчета.ЗавершениеОП,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.СпособРаспределенияОбъемаПомещения = ЗНАЧЕНИЕ(Перечисление.энргСпособыРаспределенияОбъема.Остаток)
	|			ТОГДА 1
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	ДанныеДляРасчета.НеПрименятьСезонность,
	|	ДанныеДляРасчета.НачислятьНорму,
	|	ДанныеДляРасчета.НачислятьПоПрибору,
	|	ДанныеДляРасчета.Техническая,
	|	ДанныеДляРасчета.ТочкаУчетаРодитель,
	|	ДанныеДляРасчета.НеНачислять,
	|	ДанныеДляРасчета.ЕстьСреднийПоВсемТочкамУслуги,
	|	ДанныеДляРасчета.КлючПомещения
	|ИЗ
	|	ДанныеДляРасчета КАК ДанныеДляРасчета
	|ГДЕ
	|	(НЕ ДанныеДляРасчета.ПоказанияВСрок
	|			ИЛИ ДанныеДляРасчета.ОбъемЗаПрошлыйГод)
	|	И НЕ ДанныеДляРасчета.ВыводПрибораУчета
	|	И НЕ ДанныеДляРасчета.АбонентЗакрытВТекущемПериоде
	|	И ВЫБОР
	|			КОГДА ДанныеДляРасчета.ЗависитОтУслуги = ЗНАЧЕНИЕ(Справочник.энргВидыУслуг.ПустаяСсылка)
	|				ТОГДА ДанныеДляРасчета.СреднийОбъем < 0
	|			ИНАЧЕ ДанныеДляРасчета.СреднийОбъемЗависитОтУслуги < 0
	|		КОНЕЦ
	|	И ДанныеДляРасчета.ПриборВведен
	|	И ДанныеДляРасчета.НачислятьНорму
	|	И РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) >= 1
	|	И НЕ ДанныеДляРасчета.СпособРаспределенияОбъемаПомещения = ЗНАЧЕНИЕ(Перечисление.энргСпособыРаспределенияОбъема.ФиксированныйОбъем)
	|	И НЕ ДанныеДляРасчета.РасчетТолькоПоПоказаниям
	|	И (ДанныеДляРасчета.УслНаДатуПоверки = 0 или ДанныеДляРасчета.УслНаДатуПоверки = 1)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ДанныеДляРасчета.Организация,
	|	ДанныеДляРасчета.ПериодНачисления,
	|	НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ),
	|	ДанныеДляРасчета.КонецПериода,
	|	ДанныеДляРасчета.Район,
	|	ДанныеДляРасчета.МКД,
	|	ДанныеДляРасчета.ЧастныйСектор,
	|	ДанныеДляРасчета.Строение,
	|	ДанныеДляРасчета.ПомещениеРодитель,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.ПомещениеРодитель = ДанныеДляРасчета.Помещение
	|			ТОГДА 0
	|		ИНАЧЕ 1
	|	КОНЕЦ,
	|	ДанныеДляРасчета.Помещение,
	|	ДанныеДляРасчета.Абонент,
	|	ДанныеДляРасчета.Услуга,
	|	ДанныеДляРасчета.ТочкаУчета,
	|	ДанныеДляРасчета.ЗависитОтУслуги,
	|	ДанныеДляРасчета.ПриборУчета,
	|	ДанныеДляРасчета.Шкала,
	|	ДанныеДляРасчета.ТарифнаяЗона,
	|	ДанныеДляРасчета.ПриборВведен,
	|	0,
	|	ВЫРАЗИТЬ(ВЫБОР
	|			КОГДА ДанныеДляРасчета.Поставщик = ДанныеДляРасчета.Абонент
	|				ТОГДА 0
	|			ИНАЧЕ ДанныеДляРасчета.СреднийОбъем * ДанныеДляРасчета.КоэффициентСезоности * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|					КОГДА ДанныеДляРасчета.НормативПоДням
	|							И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|						ТОГДА 1
	|					ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|				КОНЕЦ)
	|		КОНЕЦ КАК ЧИСЛО(15, 6)),
	|	ДанныеДляРасчета.КоэффициентСезоности * ВЫБОР
	|		КОГДА ДанныеДляРасчета.НеПрименятьСезонность
	|			ТОГДА ДанныеДляРасчета.КоэффициентНормативаНеПрименятьСезонность
	|		ИНАЧЕ ДанныеДляРасчета.КоэффициентНорматива
	|	КОНЕЦ * ВЫБОР
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.ПустаяСсылка)
	|			ТОГДА -1
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.СоциальнаяНормаРавнаНормативуПотребления)
	|			ТОГДА ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|					КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|							И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|						ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|					КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|					ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|				КОНЕЦ
	|		ИНАЧЕ ДанныеДляРасчета.СоциальнаяНормаПотребления * ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|				КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|					ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|				ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|			КОНЕЦ
	|	КОНЕЦ,
	|	ДанныеДляРасчета.КоэффициентСезоности * ВЫБОР
	|		КОГДА ДанныеДляРасчета.НеПрименятьСезонность
	|			ТОГДА ДанныеДляРасчета.КоэффициентНормативаНеПрименятьСезонность
	|		ИНАЧЕ ДанныеДляРасчета.КоэффициентНорматива
	|	КОНЕЦ * ВЫБОР
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.ПустаяСсылка)
	|			ТОГДА ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|					КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|					КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|							И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|						ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|					КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|					ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|				КОНЕЦ * ВЫБОР
	|					КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|							И НЕ ДанныеДляРасчета.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.Пустаяссылка)
	|						ТОГДА ВЫБОР
	|								КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|									ТОГДА 0
	|								ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|							КОНЕЦ
	|					ИНАЧЕ 1
	|				КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|					КОГДА ДанныеДляРасчета.НормативПоДням
	|							И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|						ТОГДА 1
	|					ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|				КОНЕЦ)
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.СоциальнаяНормаРавнаНормативуПотребления)
	|			ТОГДА ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|					КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|					КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|							И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|						ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|					КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|					ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|				КОНЕЦ * ВЫБОР
	|					КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|							И НЕ ДанныеДляРасчета.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.Пустаяссылка)
	|						ТОГДА ВЫБОР
	|								КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|									ТОГДА 0
	|								ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|							КОНЕЦ
	|					ИНАЧЕ 1
	|				КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|					КОГДА ДанныеДляРасчета.НормативПоДням
	|							И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|						ТОГДА 1
	|					ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|				КОНЕЦ)
	|		ИНАЧЕ ДанныеДляРасчета.СоциальнаяНормаПотребления * ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|				КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|					ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|				ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|			КОНЕЦ
	|	КОНЕЦ,
	|	ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.НачислениеПоСреднему),
	|	ДанныеДляРасчета.ЗначениеТарифа,
	|	ДанныеДляРасчета.ЗначениеТарифаСверхНорматива,
	|	ДанныеДляРасчета.ЗначениеТарифаРЭК,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.Поставщик = ДанныеДляРасчета.Абонент
	|			ТОГДА 0
	|		ИНАЧЕ ДанныеДляРасчета.СреднийОбъем * ДанныеДляРасчета.КоэффициентСезоности * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|				КОГДА ДанныеДляРасчета.НормативПоДням
	|						И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|					ТОГДА 1
	|				ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|			КОНЕЦ)
	|	КОНЕЦ * ДанныеДляРасчета.ЗначениеТарифа,
	|	ДанныеДляРасчета.ДокументНачисления,
	|	ДанныеДляРасчета.ДокументНачисленияПометкаУдаления,
	|	ДанныеДляРасчета.Поставщик,
	|	ДанныеДляРасчета.КоэффициентСезоности,
	|	0,
	|	0,
	|	ДанныеДляРасчета.РасчетПоФормуле,
	|	ДанныеДляРасчета.ЗависимаяТочкаУчета,
	|	ДанныеДляРасчета.КоэффициентФормула,
	|	ДанныеДляРасчета.ЗначениеПлощади,
	|	ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|		КОГДА ДанныеДляРасчета.НеПрименятьСезонность
	|			ТОГДА ДанныеДляРасчета.КоэффициентНормативаНеПрименятьСезонность
	|		ИНАЧЕ ДанныеДляРасчета.КоэффициентНорматива
	|	КОНЕЦ,
	|	ДанныеДляРасчета.КоличествоПрописанных,
	|	ДанныеДляРасчета.КоличествоСобственников,
	|	ДанныеДляРасчета.КоличествоПроживающих,
	|	ДанныеДляРасчета.КоличествоЖильцов,
	|	ДанныеДляРасчета.ВидПлощади,
	|	ДанныеДляРасчета.ПоказанияВСрок,
	|	ДанныеДляРасчета.КоэффициентПУ,
	|	ДанныеДляРасчета.ТарифнаяГруппа,
	|	ДанныеДляРасчета.ВидБлагоустройства,
	|	ДанныеДляРасчета.ВидДифференцированности,
	|	ДанныеДляРасчета.КоличествоКомнат,
	|	1,
	|	ДанныеДляРасчета.ДатаПоверки,
	|	ДанныеДляРасчета.ЗакрытаяСхемаГВС,
	|	ЛОЖЬ,
	|	ДанныеДляРасчета.СоставнаяУслуга,
	|	ДанныеДляРасчета.УмножатьНаНормуРодительскойУслуги,
	|	ДанныеДляРасчета.ПлощадьМОП,
	|	ДанныеДляРасчета.ПлощадьАбонентов,
	|	ДанныеДляРасчета.ПлощадьСобственнаяПоставка,
	|	ДанныеДляРасчета.НаправлениеИспользованияТУ,
	|	ДанныеДляРасчета.Измеритель,
	|	ДанныеДляРасчета.СпособРаспределенияОбъемаПомещения,
	|	ДанныеДляРасчета.ФиксированныйОбъемПотребления,
	|	ДанныеДляРасчета.ДоляПотребленияЧислитель,
	|	ДанныеДляРасчета.ДоляПотребленияЗнаменатель,
	|	ДанныеДляРасчета.КоэффициентРаспределенияОстатка,
	|	ДанныеДляРасчета.ЗавершениеОП,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.СпособРаспределенияОбъемаПомещения = ЗНАЧЕНИЕ(Перечисление.энргСпособыРаспределенияОбъема.Остаток)
	|			ТОГДА 1
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	ДанныеДляРасчета.НеПрименятьСезонность,
	|	ДанныеДляРасчета.НачислятьНорму,
	|	ДанныеДляРасчета.НачислятьПоПрибору,
	|	ДанныеДляРасчета.Техническая,
	|	ДанныеДляРасчета.ТочкаУчетаРодитель,
	|	ДанныеДляРасчета.НеНачислять,
	|	ДанныеДляРасчета.ЕстьСреднийПоВсемТочкамУслуги,
	|	ДанныеДляРасчета.КлючПомещения
	|ИЗ
	|	ДанныеДляРасчета КАК ДанныеДляРасчета
	|ГДЕ
	|	НЕ ДанныеДляРасчета.ВыводПрибораУчета
	|	И ДанныеДляРасчета.СреднийОбъем >= 0
	|	И ДанныеДляРасчета.ПриборВведен
	|	И ДанныеДляРасчета.НеПрименятьСезонность
	|	И ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|	И НЕ ДанныеДляРасчета.СпособРаспределенияОбъемаПомещения = ЗНАЧЕНИЕ(Перечисление.энргСпособыРаспределенияОбъема.ФиксированныйОбъем)
	|	И НЕ ДанныеДляРасчета.РасчетТолькоПоПоказаниям
	|	И (ДанныеДляРасчета.УслНаДатуПоверки = 0 или ДанныеДляРасчета.УслНаДатуПоверки = 1)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ДанныеДляРасчета.Организация,
	|	ДанныеДляРасчета.ПериодНачисления,
	|	НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ),
	|	ДанныеДляРасчета.КонецПериода,
	|	ДанныеДляРасчета.Район,
	|	ДанныеДляРасчета.МКД,
	|	ДанныеДляРасчета.ЧастныйСектор,
	|	ДанныеДляРасчета.Строение,
	|	ДанныеДляРасчета.ПомещениеРодитель,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.ПомещениеРодитель = ДанныеДляРасчета.Помещение
	|			ТОГДА 0
	|		ИНАЧЕ 1
	|	КОНЕЦ,
	|	ДанныеДляРасчета.Помещение,
	|	ДанныеДляРасчета.Абонент,
	|	ДанныеДляРасчета.Услуга,
	|	ДанныеДляРасчета.ТочкаУчета,
	|	ДанныеДляРасчета.ЗависитОтУслуги,
	|	ДанныеДляРасчета.ПриборУчета,
	|	ДанныеДляРасчета.Шкала,
	|	ДанныеДляРасчета.ТарифнаяЗона,
	|	ДанныеДляРасчета.ПриборВведен,
	|	0,
	|	ВЫРАЗИТЬ(ВЫБОР
	|			КОГДА ДанныеДляРасчета.Поставщик = ДанныеДляРасчета.Абонент
	|				ТОГДА 0
	|			ИНАЧЕ ДанныеДляРасчета.ФиксированныйОбъемПотребления * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|					КОГДА ДанныеДляРасчета.НормативПоДням
	|							И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|						ТОГДА 1
	|					ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|				КОНЕЦ)
	|		КОНЕЦ КАК ЧИСЛО(15, 6)),
	|	ДанныеДляРасчета.КоэффициентСезоности * ВЫБОР
	|		КОГДА ДанныеДляРасчета.НеПрименятьСезонность
	|			ТОГДА ДанныеДляРасчета.КоэффициентНормативаНеПрименятьСезонность
	|		ИНАЧЕ ДанныеДляРасчета.КоэффициентНорматива
	|	КОНЕЦ * ВЫБОР
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.ПустаяСсылка)
	|			ТОГДА -1
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.СоциальнаяНормаРавнаНормативуПотребления)
	|			ТОГДА ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|					КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|					ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|				КОНЕЦ
	|		ИНАЧЕ ДанныеДляРасчета.СоциальнаяНормаПотребления * ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|				КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|					ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|				ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|			КОНЕЦ
	|	КОНЕЦ,
	|	ДанныеДляРасчета.КоэффициентСезоности * ВЫБОР
	|		КОГДА ДанныеДляРасчета.НеПрименятьСезонность
	|			ТОГДА ДанныеДляРасчета.КоэффициентНормативаНеПрименятьСезонность
	|		ИНАЧЕ ДанныеДляРасчета.КоэффициентНорматива
	|	КОНЕЦ * ВЫБОР
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.ПустаяСсылка)
	|			ТОГДА ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|					КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|					КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|							И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|						ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|					КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|					ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|				КОНЕЦ * ВЫБОР
	|					КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|							И НЕ ДанныеДляРасчета.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.Пустаяссылка)
	|						ТОГДА ВЫБОР
	|								КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|									ТОГДА 0
	|								ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|							КОНЕЦ
	|					ИНАЧЕ 1
	|				КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|					КОГДА ДанныеДляРасчета.НормативПоДням
	|							И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|						ТОГДА 1
	|					ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|				КОНЕЦ)
	|		КОГДА ДанныеДляРасчета.СпособОпределенияСоциальнойНормы = ЗНАЧЕНИЕ(Перечисление.энргСпособыОпределенияСоциальнойНормы.СоциальнаяНормаРавнаНормативуПотребления)
	|			ТОГДА ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|					КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|					КОГДА НЕ ДанныеДляРасчета.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|							И ДанныеДляРасчета.ЕстьИзмерителиНаправления
	|						ТОГДА ДанныеДляРасчета.КоличествоИзмеретелейНаправления
	|					КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|					КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|						ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|					ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|				КОНЕЦ * ВЫБОР
	|					КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|							И НЕ ДанныеДляРасчета.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.Пустаяссылка)
	|						ТОГДА ВЫБОР
	|								КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|									ТОГДА 0
	|								ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|							КОНЕЦ
	|					ИНАЧЕ 1
	|				КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|					КОГДА ДанныеДляРасчета.НормативПоДням
	|							И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|						ТОГДА 1
	|					ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|				КОНЕЦ)
	|		ИНАЧЕ ДанныеДляРасчета.СоциальнаяНормаПотребления * ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|				КОГДА ДанныеДляРасчета.Абонент = ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка)
	|					ТОГДА ДанныеДляРасчета.КоличествоЖильцов
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПроживающих = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПроживающих
	|				КОГДА НЕ ДанныеДляРасчета.КоличествоПрописанных = 0
	|					ТОГДА ДанныеДляРасчета.КоличествоПрописанных
	|				ИНАЧЕ ДанныеДляРасчета.КоличествоСобственников
	|			КОНЕЦ
	|	КОНЕЦ,
	|	ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.ПоНормативу),
	|	ДанныеДляРасчета.ЗначениеТарифа,
	|	ДанныеДляРасчета.ЗначениеТарифаСверхНорматива,
	|	ДанныеДляРасчета.ЗначениеТарифаРЭК,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.Поставщик = ДанныеДляРасчета.Абонент
	|			ТОГДА 0
	|		ИНАЧЕ ДанныеДляРасчета.ФиксированныйОбъемПотребления * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ВЫБОР
	|				КОГДА ДанныеДляРасчета.НормативПоДням
	|						И НЕ ДанныеДляРасчета.НеПрименятьСезонность
	|					ТОГДА 1
	|				ИНАЧЕ ДанныеДляРасчета.ДнейВПериоде
	|			КОНЕЦ)
	|	КОНЕЦ * ДанныеДляРасчета.ЗначениеТарифа,
	|	ДанныеДляРасчета.ДокументНачисления,
	|	ДанныеДляРасчета.ДокументНачисленияПометкаУдаления,
	|	ДанныеДляРасчета.Поставщик,
	|	ДанныеДляРасчета.КоэффициентСезоности,
	|	0,
	|	0,
	|	ДанныеДляРасчета.РасчетПоФормуле,
	|	ДанныеДляРасчета.ЗависимаяТочкаУчета,
	|	ДанныеДляРасчета.КоэффициентФормула,
	|	ДанныеДляРасчета.ЗначениеПлощади,
	|	ДанныеДляРасчета.НормаПотребления * ВЫБОР
	|		КОГДА ДанныеДляРасчета.НеПрименятьСезонность
	|			ТОГДА ДанныеДляРасчета.КоэффициентНормативаНеПрименятьСезонность
	|		ИНАЧЕ ДанныеДляРасчета.КоэффициентНорматива
	|	КОНЕЦ,
	|	ДанныеДляРасчета.КоличествоПрописанных,
	|	ДанныеДляРасчета.КоличествоСобственников,
	|	ДанныеДляРасчета.КоличествоПроживающих,
	|	ДанныеДляРасчета.КоличествоЖильцов,
	|	ДанныеДляРасчета.ВидПлощади,
	|	ДанныеДляРасчета.ПоказанияВСрок,
	|	ДанныеДляРасчета.КоэффициентПУ,
	|	ДанныеДляРасчета.ТарифнаяГруппа,
	|	ДанныеДляРасчета.ВидБлагоустройства,
	|	ДанныеДляРасчета.ВидДифференцированности,
	|	ДанныеДляРасчета.КоличествоКомнат,
	|	1,
	|	ДанныеДляРасчета.ДатаПоверки,
	|	ДанныеДляРасчета.ЗакрытаяСхемаГВС,
	|	ЛОЖЬ,
	|	ДанныеДляРасчета.СоставнаяУслуга,
	|	ДанныеДляРасчета.УмножатьНаНормуРодительскойУслуги,
	|	ДанныеДляРасчета.ПлощадьМОП,
	|	ДанныеДляРасчета.ПлощадьАбонентов,
	|	ДанныеДляРасчета.ПлощадьСобственнаяПоставка,
	|	ДанныеДляРасчета.НаправлениеИспользованияТУ,
	|	ДанныеДляРасчета.Измеритель,
	|	ДанныеДляРасчета.СпособРаспределенияОбъемаПомещения,
	|	ДанныеДляРасчета.ФиксированныйОбъемПотребления,
	|	ДанныеДляРасчета.ДоляПотребленияЧислитель,
	|	ДанныеДляРасчета.ДоляПотребленияЗнаменатель,
	|	ДанныеДляРасчета.КоэффициентРаспределенияОстатка,
	|	ДанныеДляРасчета.ЗавершениеОП,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.СпособРаспределенияОбъемаПомещения = ЗНАЧЕНИЕ(Перечисление.энргСпособыРаспределенияОбъема.Остаток)
	|			ТОГДА 1
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	ДанныеДляРасчета.НеПрименятьСезонность,
	|	ДанныеДляРасчета.НачислятьНорму,
	|	ДанныеДляРасчета.НачислятьПоПрибору,
	|	ДанныеДляРасчета.Техническая,
	|	ДанныеДляРасчета.ТочкаУчетаРодитель,
	|	ДанныеДляРасчета.НеНачислять,
	|	ДанныеДляРасчета.ЕстьСреднийПоВсемТочкамУслуги,
	|	ДанныеДляРасчета.КлючПомещения
	|ИЗ
	|	ДанныеДляРасчета КАК ДанныеДляРасчета
	|ГДЕ
	|	ДанныеДляРасчета.СпособРаспределенияОбъемаПомещения = ЗНАЧЕНИЕ(Перечисление.энргСпособыРаспределенияОбъема.ФиксированныйОбъем)
	|	И НЕ ДанныеДляРасчета.РасчетТолькоПоПоказаниям
	|	И (ДанныеДляРасчета.УслНаДатуПоверки = 0 или ДанныеДляРасчета.УслНаДатуПоверки = 1)
	|
	|УПОРЯДОЧИТЬ ПО
	|	ПериодНачисления,
	|	Район,
	|	МКД,
	|	ЧастныйСектор,
	|	Строение,
	|	ПомещениеРодитель,
	|	ПорядокПомещения,
	|	Помещение,
	|	Абонент,
	|	НачалоПериода,
	|	КонецПериода,
	|	ПорядокСпособРаспределенияОбъемаПомещения,
	|	ЗависитОтУслуги,
	|	ЗависимаяТочкаУчета,
	|	ТочкаУчета";

	Возврат Текст;
КонецФункции

#КонецОбласти

#Область НачисленияМКД

Функция ТекстЗапросаВспомогательныеДанныеНачисленияМКД(ОтборПоМКД)
	Текст  =  
	"ВЫБРАТЬ
	|	&ПериодНачисления КАК ПериодНачисления,
	|	энргЗначенияНормативовПотребленияСрезПоследних.Организация КАК Организация,
	|	энргЗначенияНормативовПотребленияСрезПоследних.Район КАК Район,
	|	энргЗначенияНормативовПотребленияСрезПоследних.КлючНорматива КАК КлючНорматива,
	|	энргЗначенияНормативовПотребленияСрезПоследних.Услуга КАК Услуга,
	|	энргЗначенияНормативовПотребленияСрезПоследних.ЗначениеНорматива КАК ЗначениеНорматива
	|ПОМЕСТИТЬ ЗначенияТекущихНормПотребления
	|ИЗ
	|	РегистрСведений.энргЗначенияНормативовПотребления.СрезПоследних(
	|			&КонецПериодаРасчета,
	|			Организация = &Организация
	|				И Район = &Район
	|				И ТипНачисления = ЗНАЧЕНИЕ(Перечисление.энргТипыНачислений.ОбщедомовыеНачисления)
	|				И НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)) КАК энргЗначенияНормативовПотребленияСрезПоследних
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	&ПериодНачисления,
	|	энргЗначенияНормативовПотребленияСрезПоследних.Организация,
	|	энргЗначенияНормативовПотребленияСрезПоследних.Район,
	|	энргЗначенияНормативовПотребленияСрезПоследних.КлючНорматива,
	|	энргЗначенияНормативовПотребленияСрезПоследних.Услуга,
	|	энргЗначенияНормативовПотребленияСрезПоследних.ЗначениеНорматива
	|ИЗ
	|	РегистрСведений.энргЗначенияНормативовПотребления.СрезПоследних(
	|			&КонецПериодаРасчета,
	|			Организация = &Организация
	|				И Район = &Район
	|				И ТипНачисления = ЗНАЧЕНИЕ(Перечисление.энргТипыНачислений.ИндивидуальныеНачисления)
	|				И НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)) КАК энргЗначенияНормативовПотребленияСрезПоследних
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.энргВидыУслуг КАК энргВидыУслуг
	|		ПО энргЗначенияНормативовПотребленияСрезПоследних.Услуга = энргВидыУслуг.Ссылка
	|			И (энргВидыУслуг.НормативДляИндивидуальных)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НастройкаСезонностиУслуг.Организация КАК Организация,
	|	&ПериодНачисления КАК ПериодНачисления,
	|	НастройкаСезонностиУслуг.Район КАК Район,
	|	НастройкаСезонностиУслуг.МКД КАК Строение,
	|	НастройкаСезонностиУслуг.Услуга КАК Услуга,
	|	НастройкаСезонностиУслуг.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	НастройкаСезонностиУслуг.Коэффициент КАК КоэффициентНорматива,
	|	НастройкаСезонностиУслуг.КоэффициентНеПрименятьСезонность КАК КоэффициентНеПрименятьСезонность,
	|	НастройкаСезонностиУслуг.ОбъемЗаПрошлыйГод КАК ОбъемЗаПрошлыйГод
	|ПОМЕСТИТЬ УслугиНеПрименятьСезонность
	|ИЗ
	|	РегистрСведений.энргНастройкаСезонностиУслуг.СрезПоследних(
	|			&КонецПериодаРасчета,
	|			Организация = &Организация
	|				И Район = &Район
	|				И НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|				И (МКД = &МКД
	|					ИЛИ МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка))) КАК НастройкаСезонностиУслуг
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргНастройкаНачисленияГВСМКДСрезПоследних.Организация КАК Организация,
	|	энргНастройкаНачисленияГВСМКДСрезПоследних.Район КАК Район,
	|	энргНастройкаНачисленияГВСМКДСрезПоследних.МКД КАК МКД,
	|	энргНастройкаНачисленияГВСМКДСрезПоследних.Услуга КАК Услуга,
	|	энргНастройкаНачисленияГВСМКДСрезПоследних.ТипСхемы КАК ТипСхемы,
	|	энргНастройкаНачисленияГВСМКДСрезПоследних.ПринадлежностьКТепловомуПункту КАК ПринадлежностьКТепловомуПункту,
	|	энргНастройкаНачисленияГВСМКДСрезПоследних.НеНачислять КАК НеНачислять
	|ПОМЕСТИТЬ МКДНеНачислятьТЭ
	|ИЗ
	|	РегистрСведений.энргНастройкаНачисленияГВСМКД.СрезПоследних(
	|			&КонецПериодаРасчета,
	|			Организация = &Организация
	|				И Район = &Район
	|				И НеНачислять) КАК энргНастройкаНачисленияГВСМКДСрезПоследних
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&Организация КАК Организация,
	|	&ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Сезонность КАК Сезонность,
	|	ВложенныйЗапрос.НачалоФактическогоПериода КАК НачалоФактическогоПериода,
	|	ВложенныйЗапрос.КонецФактическогоПериода КАК КонецФактическогоПериода,
	|	энргВидыУслуг.Ссылка КАК Услуга,
	|	ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление) КАК НаправлениеИспользования,
	|	ЛОЖЬ КАК НормативПоДням
	|ПОМЕСТИТЬ ДлительностьПериодов
	|ИЗ
	|	(ВЫБРАТЬ
	|		ВложенныйЗапрос.Сезонность КАК Сезонность,
	|		ВЫБОР
	|			КОГДА &НачалоПериодаРасчета МЕЖДУ ВложенныйЗапрос.НачалоПериодаДействия И ВложенныйЗапрос.КонецПериодаДействия
	|					ИЛИ &КонецПериодаРасчета МЕЖДУ ВложенныйЗапрос.НачалоПериодаДействия И ВложенныйЗапрос.КонецПериодаДействия
	|				ТОГДА ВЫБОР
	|						КОГДА &НачалоПериодаРасчета > ВложенныйЗапрос.НачалоПериодаДействия
	|							ТОГДА &НачалоПериодаРасчета
	|						ИНАЧЕ ВложенныйЗапрос.НачалоПериодаДействия
	|					КОНЕЦ
	|			ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1)
	|		КОНЕЦ КАК НачалоФактическогоПериода,
	|		ВЫБОР
	|			КОГДА &НачалоПериодаРасчета МЕЖДУ ВложенныйЗапрос.НачалоПериодаДействия И ВложенныйЗапрос.КонецПериодаДействия
	|					ИЛИ &КонецПериодаРасчета МЕЖДУ ВложенныйЗапрос.НачалоПериодаДействия И ВложенныйЗапрос.КонецПериодаДействия
	|				ТОГДА ВЫБОР
	|						КОГДА &КонецПериодаРасчета > ВложенныйЗапрос.КонецПериодаДействия
	|							ТОГДА ВложенныйЗапрос.КонецПериодаДействия
	|						ИНАЧЕ &КонецПериодаРасчета
	|					КОНЕЦ
	|			ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1)
	|		КОНЕЦ КАК КонецФактическогоПериода,
	|		ВложенныйЗапрос.НачалоПериодаДействия КАК НачалоПериодаДействия,
	|		ВложенныйЗапрос.КонецПериодаДействия КАК КонецПериодаДействия
	|	ИЗ
	|		(ВЫБРАТЬ
	|			ВложенныйЗапрос.Сезонность КАК Сезонность,
	|			ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(ДАТАВРЕМЯ(1, 1, 1), ГОД, ВложенныйЗапрос.ГодНачало - 1), МЕСЯЦ, ВложенныйЗапрос.МесяцНачала - 1), ДЕНЬ, ВложенныйЗапрос.ДеньНачала - 1) КАК НачалоПериодаДействия,
	|			ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(ДАТАВРЕМЯ(1, 1, 1), ГОД, ВложенныйЗапрос.ГодОкончания - 1), МЕСЯЦ, ВложенныйЗапрос.МесяцОкончания - 1), ДЕНЬ, ВложенныйЗапрос.ДеньОкончания - 1) КАК КонецПериодаДействия
	|		ИЗ
	|			(ВЫБРАТЬ
	|				энргДлительностиПериодов.Сезонность КАК Сезонность,
	|				ДЕНЬ(энргДлительностиПериодов.НачалоПериода) КАК ДеньНачала,
	|				МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) КАК МесяцНачала,
	|				ДЕНЬ(энргДлительностиПериодов.КонецПериода) + 1 КАК ДеньОкончания,
	|				МЕСЯЦ(энргДлительностиПериодов.КонецПериода) КАК МесяцОкончания,
	|				ВЫБОР
	|					КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(энргДлительностиПериодов.КонецПериода)
	|						ТОГДА ВЫБОР
	|								КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(&КонецПериодаРасчета)
	|									ТОГДА ГОД(&КонецПериодаРасчета) - 1
	|								ИНАЧЕ ГОД(&КонецПериодаРасчета)
	|							КОНЕЦ
	|					ИНАЧЕ ГОД(&КонецПериодаРасчета)
	|				КОНЕЦ КАК ГодНачало,
	|				ВЫБОР
	|					КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(энргДлительностиПериодов.КонецПериода)
	|						ТОГДА ВЫБОР
	|								КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(&КонецПериодаРасчета)
	|									ТОГДА ГОД(&КонецПериодаРасчета)
	|								ИНАЧЕ ГОД(&КонецПериодаРасчета) + 1
	|							КОНЕЦ
	|					ИНАЧЕ ГОД(&КонецПериодаРасчета)
	|				КОНЕЦ КАК ГодОкончания
	|			ИЗ
	|				РегистрСведений.энргДлительностиПериодов.СрезПоследних(
	|						&НачалоПериодаРасчета,
	|						Организация = &Организация
	|							И Район = &Район) КАК энргДлительностиПериодов) КАК ВложенныйЗапрос) КАК ВложенныйЗапрос) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.энргВидыУслуг КАК энргВидыУслуг
	|		ПО ВложенныйЗапрос.Сезонность = энргВидыУслуг.Сезонность
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргСреднийОбъемПотребленияМКД.Организация КАК Организация,
	|	энргСреднийОбъемПотребленияМКД.ПериодНачисления КАК ПериодНачисления,
	|	энргСреднийОбъемПотребленияМКД.Район КАК Район,
	|	энргСреднийОбъемПотребленияМКД.МКД КАК МКД,
	|	энргСреднийОбъемПотребленияМКД.Услуга КАК Услуга,
	|	энргСреднийОбъемПотребленияМКД.ТочкаУчета КАК ТочкаУчета,
	|	энргСреднийОбъемПотребленияМКД.Шкала КАК Шкала,
	|	энргСреднийОбъемПотребленияМКД.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргСреднийОбъемПотребленияМКД.Объем КАК СреднийОбъем
	|ПОМЕСТИТЬ СреднееПотреблениеМКД
	|ИЗ
	|	РегистрСведений.энргСреднийОбъемПотребленияМКД КАК энргСреднийОбъемПотребленияМКД
	|ГДЕ
	|	энргСреднийОбъемПотребленияМКД.Организация = &Организация
	|	И энргСреднийОбъемПотребленияМКД.ПериодНачисления = &ПериодНачисления
	|	И энргСреднийОбъемПотребленияМКД.Район = &Район
	|	И энргСреднийОбъемПотребленияМКД.МКД = &МКД
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргСтабильныеПериодыМКД.Организация КАК Организация,
	|	энргСтабильныеПериодыМКД.ПериодНачисления КАК ПериодНачисления,
	|	энргСтабильныеПериодыМКД.Район КАК Район,
	|	энргСтабильныеПериодыМКД.МКД КАК МКД,
	|	энргСтабильныеПериодыМКД.Услуга КАК Услуга,
	|	МАКСИМУМ(энргСтабильныеПериодыМКД.ЗначениеПлощади) КАК ПлощадьМОП
	|ПОМЕСТИТЬ ЗначениеПлощадейМКД
	|ИЗ
	|	(ВЫБРАТЬ
	|		энргСтабильныеПериодыМКД.Организация КАК Организация,
	|		энргСтабильныеПериодыМКД.ПериодНачисления КАК ПериодНачисления,
	|		энргСтабильныеПериодыМКД.Район КАК Район,
	|		энргСтабильныеПериодыМКД.МКД КАК МКД,
	|		энргСтабильныеПериодыМКД.Услуга КАК Услуга,
	|		энргСтабильныеПериодыМКД.ТочкаУчета КАК ТочкаУчета,
	|		МАКСИМУМ(энргСтабильныеПериодыМКД.НомерПозиции) КАК НомерПозиции
	|	ИЗ
	|		РегистрСведений.энргСтабильныеПериодыМКД КАК энргСтабильныеПериодыМКД
	|	ГДЕ
	|		энргСтабильныеПериодыМКД.Организация = &Организация
	|		И энргСтабильныеПериодыМКД.ПериодНачисления = &ПериодНачисления
	|		И энргСтабильныеПериодыМКД.Район = &Район
	|		И энргСтабильныеПериодыМКД.МКД = &МКД
	|	
	|	СГРУППИРОВАТЬ ПО
	|		энргСтабильныеПериодыМКД.Организация,
	|		энргСтабильныеПериодыМКД.ПериодНачисления,
	|		энргСтабильныеПериодыМКД.Район,
	|		энргСтабильныеПериодыМКД.МКД,
	|		энргСтабильныеПериодыМКД.Услуга,
	|		энргСтабильныеПериодыМКД.ТочкаУчета) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргСтабильныеПериодыМКД КАК энргСтабильныеПериодыМКД
	|		ПО ВложенныйЗапрос.Организация = энргСтабильныеПериодыМКД.Организация
	|			И ВложенныйЗапрос.ПериодНачисления = энргСтабильныеПериодыМКД.ПериодНачисления
	|			И ВложенныйЗапрос.Район = энргСтабильныеПериодыМКД.Район
	|			И ВложенныйЗапрос.МКД = энргСтабильныеПериодыМКД.МКД
	|			И ВложенныйЗапрос.Услуга = энргСтабильныеПериодыМКД.Услуга
	|			И ВложенныйЗапрос.ТочкаУчета = энргСтабильныеПериодыМКД.ТочкаУчета
	|			И ВложенныйЗапрос.НомерПозиции = энргСтабильныеПериодыМКД.НомерПозиции
	|			И (энргСтабильныеПериодыМКД.Организация = &Организация)
	|			И (энргСтабильныеПериодыМКД.ПериодНачисления = &ПериодНачисления)
	|			И (энргСтабильныеПериодыМКД.Район = &Район)
	|			И (энргСтабильныеПериодыМКД.МКД = &МКД)
	|
	|СГРУППИРОВАТЬ ПО
	|	энргСтабильныеПериодыМКД.Организация,
	|	энргСтабильныеПериодыМКД.ПериодНачисления,
	|	энргСтабильныеПериодыМКД.Район,
	|	энргСтабильныеПериодыМКД.МКД,
	|	энргСтабильныеПериодыМКД.Услуга
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.ЧастныйСектор КАК ЧастныйСектор,
	|	ВложенныйЗапрос.Строение КАК Строение,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	СУММА(ВложенныйЗапрос.ПлощадьАбонента) КАК ПлощадьАбонентов,
	|	СУММА(ВложенныйЗапрос.ПлощадьСобственнаяПоставка) КАК ПлощадьСобственнаяПоставка
	|ПОМЕСТИТЬ ЗначениеИндивидуальныхПлощадей
	|ИЗ
	|	(ВЫБРАТЬ
	|		энргСтабильныеПериоды.Организация КАК Организация,
	|		энргСтабильныеПериоды.ПериодНачисления КАК ПериодНачисления,
	|		энргСтабильныеПериоды.Район КАК Район,
	|		энргСтабильныеПериоды.ЧастныйСектор КАК ЧастныйСектор,
	|		энргСтабильныеПериоды.Строение КАК Строение,
	|		энргСтабильныеПериоды.Помещение КАК Помещение,
	|		энргСтабильныеПериоды.Услуга КАК Услуга,
	|		МАКСИМУМ(энргСтабильныеПериоды.ЗначениеПлощади) КАК ПлощадьАбонента,
	|		МАКСИМУМ(ВЫБОР
	|				КОГДА энргСтабильныеПериоды.Поставщик = энргСтабильныеПериоды.Абонент
	|					ТОГДА энргСтабильныеПериоды.ЗначениеПлощади
	|				ИНАЧЕ 0
	|			КОНЕЦ) КАК ПлощадьСобственнаяПоставка
	|	ИЗ
	|		(ВЫБРАТЬ
	|			энргСтабильныеПериоды.Организация КАК Организация,
	|			энргСтабильныеПериоды.ПериодНачисления КАК ПериодНачисления,
	|			энргСтабильныеПериоды.Район КАК Район,
	|			энргСтабильныеПериоды.ЧастныйСектор КАК ЧастныйСектор,
	|			энргСтабильныеПериоды.Строение КАК Строение,
	|			энргСтабильныеПериоды.Помещение КАК Помещение,
	|			энргСтабильныеПериоды.Услуга КАК Услуга,
	|			энргСтабильныеПериоды.ТочкаУчета КАК ТочкаУчета,
	|			МАКСИМУМ(энргСтабильныеПериоды.НомерПозиции) КАК НомерПозиции
	|		ИЗ
	|			РегистрСведений.энргСтабильныеПериоды КАК энргСтабильныеПериоды
	|		ГДЕ
	|			энргСтабильныеПериоды.Организация = &Организация
	|			И энргСтабильныеПериоды.ПериодНачисления = &ПериодНачисления
	|			И энргСтабильныеПериоды.Район = &Район
	|			И НЕ энргСтабильныеПериоды.ЧастныйСектор
	|			И энргСтабильныеПериоды.Строение = &МКД
	|		
	|		СГРУППИРОВАТЬ ПО
	|			энргСтабильныеПериоды.Организация,
	|			энргСтабильныеПериоды.ПериодНачисления,
	|			энргСтабильныеПериоды.Район,
	|			энргСтабильныеПериоды.ЧастныйСектор,
	|			энргСтабильныеПериоды.Строение,
	|			энргСтабильныеПериоды.Помещение,
	|			энргСтабильныеПериоды.Услуга,
	|			энргСтабильныеПериоды.ТочкаУчета) КАК ВложенныйЗапрос
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргСтабильныеПериоды КАК энргСтабильныеПериоды
	|			ПО ВложенныйЗапрос.Организация = энргСтабильныеПериоды.Организация
	|				И ВложенныйЗапрос.ПериодНачисления = энргСтабильныеПериоды.ПериодНачисления
	|				И ВложенныйЗапрос.Район = энргСтабильныеПериоды.Район
	|				И ВложенныйЗапрос.ЧастныйСектор = энргСтабильныеПериоды.ЧастныйСектор
	|				И ВложенныйЗапрос.Строение = энргСтабильныеПериоды.Строение
	|				И ВложенныйЗапрос.Помещение = энргСтабильныеПериоды.Помещение
	|				И ВложенныйЗапрос.Услуга = энргСтабильныеПериоды.Услуга
	|				И ВложенныйЗапрос.ТочкаУчета = энргСтабильныеПериоды.ТочкаУчета
	|				И ВложенныйЗапрос.НомерПозиции = энргСтабильныеПериоды.НомерПозиции
	|				И (энргСтабильныеПериоды.Организация = &Организация)
	|				И (энргСтабильныеПериоды.ПериодНачисления = &ПериодНачисления)
	|				И (энргСтабильныеПериоды.Район = &Район)
	|				И (НЕ энргСтабильныеПериоды.ЧастныйСектор)
	|				И (энргСтабильныеПериоды.Строение = &МКД)
	|				И (энргСтабильныеПериоды.Помещение.Родитель = ЗНАЧЕНИЕ(Справочник.энргПомещения.ПустаяСсылка))
	|	
	|	СГРУППИРОВАТЬ ПО
	|		энргСтабильныеПериоды.Организация,
	|		энргСтабильныеПериоды.ПериодНачисления,
	|		энргСтабильныеПериоды.Район,
	|		энргСтабильныеПериоды.ЧастныйСектор,
	|		энргСтабильныеПериоды.Строение,
	|		энргСтабильныеПериоды.Помещение,
	|		энргСтабильныеПериоды.Услуга
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		бестСтабильныеПериодыНП.Организация,
	|		бестСтабильныеПериодыНП.ПериодНачисления,
	|		бестСтабильныеПериодыНП.Район,
	|		ЛОЖЬ,
	|		бестСтабильныеПериодыНП.МКД,
	|		бестСтабильныеПериодыНП.ОбъектРасчета.Помещение,
	|		бестСтабильныеПериодыНП.Услуга,
	|		МАКСИМУМ(бестСтабильныеПериодыНП.ЗначениеПлощади),
	|		СУММА(ВЫБОР
	|				КОГДА бестСтабильныеПериодыНП.Поставщик = бестСтабильныеПериодыНП.Договор.Контрагент
	|					ТОГДА бестСтабильныеПериодыНП.ЗначениеПлощади
	|				ИНАЧЕ 0
	|			КОНЕЦ)
	|	ИЗ
	|		(ВЫБРАТЬ
	|			бестСтабильныеПериодыНП.Организация КАК Организация,
	|			бестСтабильныеПериодыНП.ПериодНачисления КАК ПериодНачисления,
	|			бестСтабильныеПериодыНП.Район КАК Район,
	|			ЛОЖЬ КАК ЧастныйСектор,
	|			бестСтабильныеПериодыНП.МКД КАК Строение,
	|			бестСтабильныеПериодыНП.ОбъектРасчета.Помещение КАК Помещение,
	|			бестСтабильныеПериодыНП.Услуга КАК Услуга,
	|			бестСтабильныеПериодыНП.ТочкаУчета КАК ТочкаУчета,
	|			МАКСИМУМ(бестСтабильныеПериодыНП.НомерПозиции) КАК НомерПозиции,
	|			бестСтабильныеПериодыНП.ОбъектРасчета КАК ОбъектРасчета,
	|			бестСтабильныеПериодыНП.Договор КАК Договор
	|		ИЗ
	|			РегистрСведений.бестСтабильныеПериодыНП КАК бестСтабильныеПериодыНП
	|		ГДЕ
	|			бестСтабильныеПериодыНП.Организация = &Организация
	|			И бестСтабильныеПериодыНП.ПериодНачисления = &ПериодНачисления
	|			И бестСтабильныеПериодыНП.Район = &Район
	|			И бестСтабильныеПериодыНП.МКД = &МКД
	|		
	|		СГРУППИРОВАТЬ ПО
	|			бестСтабильныеПериодыНП.Организация,
	|			бестСтабильныеПериодыНП.ПериодНачисления,
	|			бестСтабильныеПериодыНП.Район,
	|			бестСтабильныеПериодыНП.Услуга,
	|			бестСтабильныеПериодыНП.ТочкаУчета,
	|			бестСтабильныеПериодыНП.ОбъектРасчета,
	|			бестСтабильныеПериодыНП.Договор,
	|			бестСтабильныеПериодыНП.МКД,
	|			бестСтабильныеПериодыНП.ОбъектРасчета.Помещение) КАК ВложенныйЗапрос
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.бестСтабильныеПериодыНП КАК бестСтабильныеПериодыНП
	|			ПО ВложенныйЗапрос.Организация = бестСтабильныеПериодыНП.Организация
	|				И ВложенныйЗапрос.ПериодНачисления = бестСтабильныеПериодыНП.ПериодНачисления
	|				И ВложенныйЗапрос.Район = бестСтабильныеПериодыНП.Район
	|				И ВложенныйЗапрос.Услуга = бестСтабильныеПериодыНП.Услуга
	|				И ВложенныйЗапрос.ТочкаУчета = бестСтабильныеПериодыНП.ТочкаУчета
	|				И ВложенныйЗапрос.НомерПозиции = бестСтабильныеПериодыНП.НомерПозиции
	|				И (бестСтабильныеПериодыНП.Организация = &Организация)
	|				И (бестСтабильныеПериодыНП.ПериодНачисления = &ПериодНачисления)
	|				И (бестСтабильныеПериодыНП.Район = &Район)
	|				И (бестСтабильныеПериодыНП.МКД = &МКД)
	|				И ВложенныйЗапрос.ОбъектРасчета = бестСтабильныеПериодыНП.ОбъектРасчета
	|				И ВложенныйЗапрос.Договор = бестСтабильныеПериодыНП.Договор
	|				И (бестСтабильныеПериодыНП.Договор.ТипДоговора <> ЗНАЧЕНИЕ(Перечисление.бестТипыДоговоров.УправляющаяКомпания))
	|	
	|	СГРУППИРОВАТЬ ПО
	|		бестСтабильныеПериодыНП.Организация,
	|		бестСтабильныеПериодыНП.ПериодНачисления,
	|		бестСтабильныеПериодыНП.Район,
	|		бестСтабильныеПериодыНП.Услуга,
	|		бестСтабильныеПериодыНП.МКД,
	|		бестСтабильныеПериодыНП.ОбъектРасчета.Помещение) КАК ВложенныйЗапрос
	|
	|СГРУППИРОВАТЬ ПО
	|	ВложенныйЗапрос.Организация,
	|	ВложенныйЗапрос.ПериодНачисления,
	|	ВложенныйЗапрос.Район,
	|	ВложенныйЗапрос.ЧастныйСектор,
	|	ВложенныйЗапрос.Строение,
	|	ВложенныйЗапрос.Услуга
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргСтабильныеПериодыШкалы.Организация КАК Организация,
	|	энргСтабильныеПериодыШкалы.ПериодНачисления КАК ПериодНачисления,
	|	энргСтабильныеПериодыШкалы.Район КАК Район,
	|	энргСтабильныеПериодыШкалы.МКД КАК МКД,
	|	энргСтабильныеПериодыШкалы.ТочкаУчета КАК ТочкаУчета,
	|	энргСтабильныеПериодыШкалы.ЧастьУзлаУчета КАК ЧастьУзлаУчета,
	|	энргСтабильныеПериодыШкалы.Шкала КАК Шкала,
	|	энргСтабильныеПериодыШкалы.НомерПозиции КАК НомерПозиции,
	|	энргСтабильныеПериодыШкалы.ВидДифференцированности КАК ВидДифференцированности
	|ПОМЕСТИТЬ СтабильныеПериодыШкалы
	|ИЗ
	|	РегистрСведений.энргСтабильныеПериодыМКДШкалы КАК энргСтабильныеПериодыШкалы
	|ГДЕ
	|	энргСтабильныеПериодыШкалы.Организация = &Организация
	|	И энргСтабильныеПериодыШкалы.ПериодНачисления = &ПериодНачисления
	|	И энргСтабильныеПериодыШкалы.Район = &Район
	|	И энргСтабильныеПериодыШкалы.МКД = &МКД
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргСтабильныеПериодыМКДСоставУзловУчета.Организация КАК Организация,
	|	энргСтабильныеПериодыМКДСоставУзловУчета.ПериодНачисления КАК ПериодНачисления,
	|	энргСтабильныеПериодыМКДСоставУзловУчета.Район КАК Район,
	|	энргСтабильныеПериодыМКДСоставУзловУчета.МКД КАК МКД,
	|	энргСтабильныеПериодыМКДСоставУзловУчета.ТочкаУчета КАК ТочкаУчета,
	|	энргСтабильныеПериодыМКДСоставУзловУчета.УзелУчета КАК УзелУчета,
	|	энргСтабильныеПериодыМКДСоставУзловУчета.ЧастьУзлаУчета КАК ЧастьУзлаУчета,
	|	энргСтабильныеПериодыМКДСоставУзловУчета.НомерПозиции КАК НомерПозиции,
	|	энргСтабильныеПериодыМКДСоставУзловУчета.ПриборВведен КАК ПриборВведен,
	|	энргСтабильныеПериодыМКДСоставУзловУчета.ДатаСостоянияПрибора КАК ДатаСостоянияПрибора,
	|	энргСтабильныеПериодыМКДСоставУзловУчета.КоэффициентПУ КАК КоэффициентПУ
	|ПОМЕСТИТЬ СтабильныеПериодыСоставУзла
	|ИЗ
	|	РегистрСведений.энргСтабильныеПериодыМКДСоставУзловУчета КАК энргСтабильныеПериодыМКДСоставУзловУчета
	|ГДЕ
	|	энргСтабильныеПериодыМКДСоставУзловУчета.Организация = &Организация
	|	И энргСтабильныеПериодыМКДСоставУзловУчета.ПериодНачисления = &ПериодНачисления
	|	И энргСтабильныеПериодыМКДСоставУзловУчета.Район = &Район
	|	И энргСтабильныеПериодыМКДСоставУзловУчета.МКД = &МКД
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргПредоставленныеПоказанияМКД.Организация КАК Организация,
	|	энргПредоставленныеПоказанияМКД.ПериодНачисления КАК ПериодНачисления,
	|	энргПредоставленныеПоказанияМКД.Район КАК Район,
	|	энргПредоставленныеПоказанияМКД.МКД КАК МКД,
	|	энргПредоставленныеПоказанияМКД.ПриборУчета КАК ПриборУчета,
	|	энргПредоставленныеПоказанияМКД.Шкала КАК Шкала,
	|	энргПредоставленныеПоказанияМКД.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргПредоставленныеПоказанияМКД.НомерПозиции КАК НомерПозиции,
	|	энргПредоставленныеПоказанияМКД.ДатаРегистратора КАК ДатаРегистратора,
	|	энргПредоставленныеПоказанияМКД.ДокРегистратор КАК ДокРегистратор,
	|	энргПредоставленныеПоказанияМКД.Показания КАК Показания,
	|	энргПредоставленныеПоказанияМКД.ПоказанияТекущегоПериода КАК ПоказанияТекущегоПериода,
	|	энргПредоставленныеПоказанияМКД.ВСрок КАК ВСрок,
	|	&КонецПериодаРасчета КАК КонецПериодаРасчета
	|ПОМЕСТИТЬ ПредоставленныеПоказания
	|ИЗ
	|	РегистрСведений.энргПредоставленныеПоказанияМКД КАК энргПредоставленныеПоказанияМКД
	|ГДЕ
	|	энргПредоставленныеПоказанияМКД.Организация = &Организация
	|	И энргПредоставленныеПоказанияМКД.ПериодНачисления = &ПериодНачисления
	|	И энргПредоставленныеПоказанияМКД.Район = &Район
	|	И энргПредоставленныеПоказанияМКД.МКД = &МКД
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	энргВыводПриборовУчетаМКД.Организация КАК Организация,
	|	энргВыводПриборовУчетаМКД.ПериодНачисления КАК ПериодНачисления,
	|	энргВыводПриборовУчетаМКД.Район КАК Район,
	|	энргВыводПриборовУчетаМКД.МКД КАК МКД,
	|	энргВыводПриборовУчетаМКД.ТочкаУчета КАК ТочкаУчета,
	|	энргВыводПриборовУчетаМКД.ПриборУчета КАК ПриборУчета
	|ПОМЕСТИТЬ ДанныеВыводаПрибораУчета
	|ИЗ
	|	РегистрСведений.энргВыводПриборовУчетаМКД КАК энргВыводПриборовУчетаМКД
	|ГДЕ
	|	энргВыводПриборовУчетаМКД.Организация = &Организация
	|	И энргВыводПриборовУчетаМКД.ПериодНачисления = &ПериодНачисления
	|	И энргВыводПриборовУчетаМКД.Район = &Район
	|	И энргВыводПриборовУчетаМКД.МКД = &МКД
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.МКД КАК МКД,
	|	ВложенныйЗапрос.ПриборУчета КАК ПриборУчета,
	|	ВложенныйЗапрос.Шкала КАК Шкала,
	|	ВложенныйЗапрос.ТарифнаяЗона КАК ТарифнаяЗона,
	|	ВложенныйЗапрос.Показания КАК Показания,
	|	ВложенныйЗапрос.ДокРегистратор КАК ДокРегистратор,
	|	ВложенныйЗапрос.ДатаРегистратора КАК ДатаРегистратора,
	|	ВложенныйЗапрос.Период КАК Период,
	|	ВложенныйЗапрос.КонецПериодаРасчета КАК КонецПериодаРасчета,
	|	ВложенныйЗапрос.Приоритет КАК Приоритет
	|ПОМЕСТИТЬ МаксимальныеПоказанияСрезНабор
	|ИЗ
	|	(ВЫБРАТЬ
	|		энргМаксимальныеПоказанияСрезМКД.Организация КАК Организация,
	|		&ПериодНачисления КАК ПериодНачисления,
	|		энргМаксимальныеПоказанияСрезМКД.Район КАК Район,
	|		энргМаксимальныеПоказанияСрезМКД.МКД КАК МКД,
	|		энргМаксимальныеПоказанияСрезМКД.ПриборУчета КАК ПриборУчета,
	|		энргМаксимальныеПоказанияСрезМКД.Шкала КАК Шкала,
	|		энргМаксимальныеПоказанияСрезМКД.ТарифнаяЗона КАК ТарифнаяЗона,
	|		энргМаксимальныеПоказанияСрезМКД.Показания КАК Показания,
	|		энргМаксимальныеПоказанияСрезМКД.ДокРегистратор КАК ДокРегистратор,
	|		энргМаксимальныеПоказанияСрезМКД.ДатаРегистратора КАК ДатаРегистратора,
	|		&НачалоПериодаРасчета КАК Период,
	|		&КонецПериодаРасчета КАК КонецПериодаРасчета,
	|		0 КАК Приоритет
	|	ИЗ
	|		РегистрСведений.энргМаксимальныеПоказанияСрезМКД КАК энргМаксимальныеПоказанияСрезМКД
	|	ГДЕ
	|		энргМаксимальныеПоказанияСрезМКД.Организация = &Организация
	|		И энргМаксимальныеПоказанияСрезМКД.ПериодНачисления = НАЧАЛОПЕРИОДА(ДОБАВИТЬКДАТЕ(&ПериодНачисления, СЕКУНДА, -1), МЕСЯЦ)
	|		И энргМаксимальныеПоказанияСрезМКД.Район = &Район
	|		И энргМаксимальныеПоказанияСрезМКД.МКД = &МКД
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		энргПредоставленныеПоказанияМКД.Организация,
	|		&ПериодНачисления,
	|		энргПредоставленныеПоказанияМКД.Район,
	|		энргПредоставленныеПоказанияМКД.МКД,
	|		энргПредоставленныеПоказанияМКД.ПриборУчета,
	|		энргПредоставленныеПоказанияМКД.Шкала,
	|		энргПредоставленныеПоказанияМКД.ТарифнаяЗона,
	|		энргПредоставленныеПоказанияМКД.Показания,
	|		энргПредоставленныеПоказанияМКД.ДокРегистратор,
	|		энргПредоставленныеПоказанияМКД.ДатаРегистратора,
	|		&НачалоПериодаРасчета,
	|		&КонецПериодаРасчета,
	|		1
	|	ИЗ
	|		РегистрСведений.энргПредоставленныеПоказанияМКД КАК энргПредоставленныеПоказанияМКД
	|	ГДЕ
	|		энргПредоставленныеПоказанияМКД.Организация = &Организация
	|		И энргПредоставленныеПоказанияМКД.ПериодНачисления = &ПериодНачисления
	|		И энргПредоставленныеПоказанияМКД.Район = &Район
	|		И энргПредоставленныеПоказанияМКД.МКД = &МКД
	|		И энргПредоставленныеПоказанияМКД.НомерПозиции = -1) КАК ВложенныйЗапрос
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	МаксимальныеПоказанияСрезНабор.Организация КАК Организация,
	|	МаксимальныеПоказанияСрезНабор.ПериодНачисления КАК ПериодНачисления,
	|	МаксимальныеПоказанияСрезНабор.Район КАК Район,
	|	МаксимальныеПоказанияСрезНабор.МКД КАК МКД,
	|	МаксимальныеПоказанияСрезНабор.ПриборУчета КАК ПриборУчета,
	|	МаксимальныеПоказанияСрезНабор.Шкала КАК Шкала,
	|	МаксимальныеПоказанияСрезНабор.ТарифнаяЗона КАК ТарифнаяЗона,
	|	МаксимальныеПоказанияСрезНабор.Показания КАК Показания,
	|	МаксимальныеПоказанияСрезНабор.ДокРегистратор КАК ДокРегистратор,
	|	МаксимальныеПоказанияСрезНабор.ДатаРегистратора КАК ДатаРегистратора,
	|	МаксимальныеПоказанияСрезНабор.Период КАК Период,
	|	МаксимальныеПоказанияСрезНабор.КонецПериодаРасчета КАК КонецПериодаРасчета,
	|	МаксимальныеПоказанияСрезНабор.Приоритет КАК Приоритет
	|ПОМЕСТИТЬ МаксимальныеПоказанияСрез
	|ИЗ
	|	МаксимальныеПоказанияСрезНабор КАК МаксимальныеПоказанияСрезНабор
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	|			МаксимальныеПоказанияСрезНабор.Организация КАК Организация,
	|			МаксимальныеПоказанияСрезНабор.ПериодНачисления КАК ПериодНачисления,
	|			МаксимальныеПоказанияСрезНабор.Район КАК Район,
	|			МаксимальныеПоказанияСрезНабор.МКД КАК МКД,
	|			МаксимальныеПоказанияСрезНабор.ПриборУчета КАК ПриборУчета,
	|			МаксимальныеПоказанияСрезНабор.Шкала КАК Шкала,
	|			МаксимальныеПоказанияСрезНабор.ТарифнаяЗона КАК ТарифнаяЗона,
	|			МАКСИМУМ(МаксимальныеПоказанияСрезНабор.Приоритет) КАК Приоритет
	|		ИЗ
	|			МаксимальныеПоказанияСрезНабор КАК МаксимальныеПоказанияСрезНабор
	|		
	|		СГРУППИРОВАТЬ ПО
	|			МаксимальныеПоказанияСрезНабор.Организация,
	|			МаксимальныеПоказанияСрезНабор.ПериодНачисления,
	|			МаксимальныеПоказанияСрезНабор.Район,
	|			МаксимальныеПоказанияСрезНабор.МКД,
	|			МаксимальныеПоказанияСрезНабор.ПриборУчета,
	|			МаксимальныеПоказанияСрезНабор.Шкала,
	|			МаксимальныеПоказанияСрезНабор.ТарифнаяЗона) КАК МаксимальныйПриоритетПоказаний
	|		ПО МаксимальныеПоказанияСрезНабор.Организация = МаксимальныйПриоритетПоказаний.Организация
	|			И МаксимальныеПоказанияСрезНабор.Организация = МаксимальныйПриоритетПоказаний.Организация
	|			И МаксимальныеПоказанияСрезНабор.ПериодНачисления = МаксимальныйПриоритетПоказаний.ПериодНачисления
	|			И МаксимальныеПоказанияСрезНабор.Район = МаксимальныйПриоритетПоказаний.Район
	|			И МаксимальныеПоказанияСрезНабор.МКД = МаксимальныйПриоритетПоказаний.МКД
	|			И МаксимальныеПоказанияСрезНабор.ПриборУчета = МаксимальныйПриоритетПоказаний.ПриборУчета
	|			И МаксимальныеПоказанияСрезНабор.Шкала = МаксимальныйПриоритетПоказаний.Шкала
	|			И МаксимальныеПоказанияСрезНабор.ТарифнаяЗона = МаксимальныйПриоритетПоказаний.ТарифнаяЗона
	|			И МаксимальныеПоказанияСрезНабор.Приоритет = МаксимальныйПриоритетПоказаний.Приоритет
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргМаксимальныеПоказанияСрезМКД.Организация КАК Организация,
	|	энргМаксимальныеПоказанияСрезМКД.ПериодНачисления КАК ПериодНачисления,
	|	энргМаксимальныеПоказанияСрезМКД.Район КАК Район,
	|	энргМаксимальныеПоказанияСрезМКД.МКД КАК МКД,
	|	энргМаксимальныеПоказанияСрезМКД.ПриборУчета КАК ПриборУчета,
	|	энргМаксимальныеПоказанияСрезМКД.Шкала КАК Шкала,
	|	энргМаксимальныеПоказанияСрезМКД.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргМаксимальныеПоказанияСрезМКД.Показания КАК Показания
	|ПОМЕСТИТЬ МаксимальныеПоказания
	|ИЗ
	|	РегистрСведений.энргМаксимальныеПоказанияСрезМКД КАК энргМаксимальныеПоказанияСрезМКД
	|ГДЕ
	|	энргМаксимальныеПоказанияСрезМКД.Организация = &Организация
	|	И энргМаксимальныеПоказанияСрезМКД.ПериодНачисления = &ПериодНачисления
	|	И энргМаксимальныеПоказанияСрезМКД.Район = &Район
	|	И энргМаксимальныеПоказанияСрезМКД.МКД = &МКД
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргНомераСтрокСтабильногоПериодаМКД.Организация КАК Организация,
	|	энргНомераСтрокСтабильногоПериодаМКД.ПериодНачисления КАК ПериодНачисления,
	|	энргНомераСтрокСтабильногоПериодаМКД.Район КАК Район,
	|	энргНомераСтрокСтабильногоПериодаМКД.МКД КАК МКД,
	|	энргНомераСтрокСтабильногоПериодаМКД.ТочкаУчета КАК ТочкаУчета,
	|	МАКСИМУМ(энргНомераСтрокСтабильногоПериодаМКД.НомерПозиции) КАК НомерПозиции,
	|	ДлительностьПериодов.НачалоФактическогоПериода КАК ПериодСезонности
	|ПОМЕСТИТЬ НомераСтрокНачалоСезонности
	|ИЗ
	|	РегистрСведений.энргНомераСтрокСтабильногоПериодаМКД КАК энргНомераСтрокСтабильногоПериодаМКД
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДлительностьПериодов КАК ДлительностьПериодов
	|		ПО (энргНомераСтрокСтабильногоПериодаМКД.Организация = &Организация)
	|			И (энргНомераСтрокСтабильногоПериодаМКД.ПериодНачисления = &ПериодНачисления)
	|			И (энргНомераСтрокСтабильногоПериодаМКД.Район = &Район)
	|			И (энргНомераСтрокСтабильногоПериодаМКД.МКД = &МКД)
	|			И энргНомераСтрокСтабильногоПериодаМКД.Услуга = ДлительностьПериодов.Услуга
	|			И энргНомераСтрокСтабильногоПериодаМКД.ДатаРегистратора < ДлительностьПериодов.НачалоФактическогоПериода
	|			И (ДлительностьПериодов.НачалоФактическогоПериода <> &НачалоПериодаРасчета)
	|			И (ДлительностьПериодов.НачалоФактическогоПериода <> &КонецПериодаРасчета)
	|
	|СГРУППИРОВАТЬ ПО
	|	энргНомераСтрокСтабильногоПериодаМКД.Организация,
	|	энргНомераСтрокСтабильногоПериодаМКД.ПериодНачисления,
	|	энргНомераСтрокСтабильногоПериодаМКД.Район,
	|	энргНомераСтрокСтабильногоПериодаМКД.МКД,
	|	энргНомераСтрокСтабильногоПериодаМКД.ТочкаУчета,
	|	ДлительностьПериодов.НачалоФактическогоПериода
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргНомераСтрокСтабильногоПериодаМКД.Организация КАК Организация,
	|	энргНомераСтрокСтабильногоПериодаМКД.ПериодНачисления КАК ПериодНачисления,
	|	энргНомераСтрокСтабильногоПериодаМКД.Район КАК Район,
	|	энргНомераСтрокСтабильногоПериодаМКД.МКД КАК МКД,
	|	энргНомераСтрокСтабильногоПериодаМКД.ТочкаУчета КАК ТочкаУчета,
	|	МАКСИМУМ(энргНомераСтрокСтабильногоПериодаМКД.НомерПозиции) КАК НомерПозиции,
	|	ДлительностьПериодов.КонецФактическогоПериода КАК ПериодСезонности
	|ПОМЕСТИТЬ НомераСтрокКонецСезонности
	|ИЗ
	|	РегистрСведений.энргНомераСтрокСтабильногоПериодаМКД КАК энргНомераСтрокСтабильногоПериодаМКД
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДлительностьПериодов КАК ДлительностьПериодов
	|		ПО (энргНомераСтрокСтабильногоПериодаМКД.Организация = &Организация)
	|			И (энргНомераСтрокСтабильногоПериодаМКД.ПериодНачисления = &ПериодНачисления)
	|			И (энргНомераСтрокСтабильногоПериодаМКД.Район = &Район)
	|			И (энргНомераСтрокСтабильногоПериодаМКД.МКД = &МКД)
	|			И энргНомераСтрокСтабильногоПериодаМКД.Услуга = ДлительностьПериодов.Услуга
	|			И энргНомераСтрокСтабильногоПериодаМКД.ДатаРегистратора < ДлительностьПериодов.КонецФактическогоПериода
	|			И (ДлительностьПериодов.КонецФактическогоПериода <> &НачалоПериодаРасчета)
	|			И (ДлительностьПериодов.КонецФактическогоПериода <> &КонецПериодаРасчета)
	|
	|СГРУППИРОВАТЬ ПО
	|	энргНомераСтрокСтабильногоПериодаМКД.Организация,
	|	энргНомераСтрокСтабильногоПериодаМКД.ПериодНачисления,
	|	энргНомераСтрокСтабильногоПериодаМКД.Район,
	|	энргНомераСтрокСтабильногоПериодаМКД.МКД,
	|	энргНомераСтрокСтабильногоПериодаМКД.ТочкаУчета,
	|	ДлительностьПериодов.КонецФактическогоПериода
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргСтабильныеПериодыМКД.Организация КАК Организация,
	|	энргСтабильныеПериодыМКД.ПериодНачисления КАК ПериодНачисления,
	|	энргСтабильныеПериодыМКД.Район КАК Район,
	|	энргСтабильныеПериодыМКД.МКД КАК МКД,
	|	энргСтабильныеПериодыМКД.Услуга КАК Услуга,
	|	энргСтабильныеПериодыМКД.ТочкаУчета КАК ТочкаУчета,
	|	энргСтабильныеПериодыМКД.НомерПозиции КАК НомерПозиции,
	|	ВЫБОР
	|		КОГДА энргСтабильныеПериодыМКД.ПериодРегистрации < &НачалоПериодаРасчета
	|			ТОГДА &НачалоПериодаРасчета
	|		ИНАЧЕ энргСтабильныеПериодыМКД.ПериодРегистрации
	|	КОНЕЦ КАК ПериодРегистрации,
	|	энргСтабильныеПериодыМКД.ДокРегистратор КАК ДокРегистратор,
	|	энргСтабильныеПериодыМКД.МКДОткрыт КАК МКДОткрыт,
	|	энргСтабильныеПериодыМКД.УслугаПодключена КАК УслугаПодключена,
	|	энргСтабильныеПериодыМКД.ПриборВведен КАК ПриборВведен,
	|	энргСтабильныеПериодыМКД.ПриборУчета КАК ПриборУчета,
	|	энргСтабильныеПериодыМКД.ВидБлагоустройства КАК ВидБлагоустройства,
	|	энргСтабильныеПериодыМКД.ЗначениеПлощади КАК ЗначениеПлощади,
	|	энргСтабильныеПериодыМКД.Поставщик КАК Поставщик,
	|	энргСтабильныеПериодыМКД.МенялосьСостояниеПУ КАК МенялосьСостояниеПУ,
	|	&НачалоПериодаРасчета КАК НачалоОП,
	|	&КонецПериодаРасчета КАК ЗавершениеОП,
	|	&ДнейВПериоде КАК ДнейВПериоде,
	|	энргСтабильныеПериодыМКД.ФормулаРасчета КАК ФормулаРасчета,
	|	энргСтабильныеПериодыМКД.РасчетПоФормуле КАК РасчетПоФормуле,
	|	энргСтабильныеПериодыМКД.СоставнаяУслуга КАК СоставнаяУслуга,
	|	энргСтабильныеПериодыМКД.КлючНорматива КАК КлючНорматива,
	|	энргСтабильныеПериодыМКД.Шкала КАК Шкала,
	|	энргСтабильныеПериодыМКД.ЧастьУзлаУчета КАК ЧастьУзлаУчета,
	|	энргСтабильныеПериодыМКД.НеРаспределятьНаАбонентов КАК НеРаспределятьНаАбонентов,
	|	энргСтабильныеПериодыМКД.ТипСхемы КАК ТипСхемы,
	|	энргСтабильныеПериодыМКД.ВидТепловогоПункта КАК ВидТепловогоПункта,
	|	энргСтабильныеПериодыМКД.РаспределятьНаТочку КАК РаспределятьНаТочку
	|ПОМЕСТИТЬ СтабильныеПериодыНачало
	|ИЗ
	|	РегистрСведений.энргСтабильныеПериодыМКД КАК энргСтабильныеПериодыМКД
	|ГДЕ
	|	энргСтабильныеПериодыМКД.Организация = &Организация
	|	И энргСтабильныеПериодыМКД.ПериодНачисления = &ПериодНачисления
	|	И энргСтабильныеПериодыМКД.Район = &Район
	|	И энргСтабильныеПериодыМКД.МКД = &МКД";
	
	
	Если НЕ ОтборПоМКД тогда
		Текст 						= СтрЗаменить(Текст,"И энргМаксимальныеПоказанияСрезМКД.МКД = &МКД","");
		Текст 						= СтрЗаменить(Текст,"И энргПредоставленныеПоказанияМКД.МКД = &МКД","");
		Текст 						= СтрЗаменить(Текст,"И энргСреднийОбъемПотребленияМКД.МКД = &МКД","");
		Текст 						= СтрЗаменить(Текст,"И энргВыводПриборовУчетаМКД.МКД = &МКД","");
		Текст 						= СтрЗаменить(Текст,"И (энргНомераСтрокСтабильногоПериодаМКД.МКД = &МКД)","");
		Текст 						= СтрЗаменить(Текст,"И энргСтабильныеПериодыМКД.МКД = &МКД","");
		Текст 						= СтрЗаменить(Текст,"И энргСтабильныеПериодыШкалы.МКД = &МКД",""); 		
		Текст 						= СтрЗаменить(Текст,"И энргСтабильныеПериодыМКДСоставУзловУчета.МКД = &МКД","");
		
		Текст 						= СтрЗаменить(Текст,"И (энргСтабильныеПериодыМКД.МКД = &МКД)","");
		Текст 						= СтрЗаменить(Текст,"И энргСтабильныеПериоды.Строение = &МКД","");
		Текст 						= СтрЗаменить(Текст,"И (энргСтабильныеПериоды.Строение = &МКД)","");
		Текст 						= СтрЗаменить(Текст,"И бестСтабильныеПериодыНП.МКД = &МКД","");
		Текст 						= СтрЗаменить(Текст,"И (бестСтабильныеПериодыНП.МКД = &МКД)","");
	КонецЕсли;
	
	Возврат Текст;
	
КонецФункции

Функция ТекстЗапросаПолучитьСтабильныеПериодыМКД()
	Текст  = 
	"ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.МКД КАК МКД,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	СУММА(ВложенныйЗапрос.ПлощадьМОП) КАК ПлощадьМОП,
	|	СУММА(ВложенныйЗапрос.ПлощадьАбонентов) КАК ПлощадьАбонентов,
	|	СУММА(ВложенныйЗапрос.ПлощадьСобственнаяПоставка) КАК ПлощадьСобственнаяПоставка
	|ПОМЕСТИТЬ ЗначенияПлощадейСтроений
	|ИЗ
	|	(ВЫБРАТЬ
	|		ЗначениеПлощадейМКД.Организация КАК Организация,
	|		ЗначениеПлощадейМКД.ПериодНачисления КАК ПериодНачисления,
	|		ЗначениеПлощадейМКД.Район КАК Район,
	|		ЗначениеПлощадейМКД.МКД КАК МКД,
	|		ЗначениеПлощадейМКД.Услуга КАК Услуга,
	|		ЗначениеПлощадейМКД.ПлощадьМОП КАК ПлощадьМОП,
	|		0 КАК ПлощадьАбонентов,
	|		0 КАК ПлощадьСобственнаяПоставка
	|	ИЗ
	|		ЗначениеПлощадейМКД КАК ЗначениеПлощадейМКД
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ЗначениеИндивидуальныхПлощадей.Организация,
	|		ЗначениеИндивидуальныхПлощадей.ПериодНачисления,
	|		ЗначениеИндивидуальныхПлощадей.Район,
	|		ЗначениеИндивидуальныхПлощадей.Строение,
	|		ЗначениеИндивидуальныхПлощадей.Услуга,
	|		0,
	|		ЗначениеИндивидуальныхПлощадей.ПлощадьАбонентов,
	|		ЗначениеИндивидуальныхПлощадей.ПлощадьСобственнаяПоставка
	|	ИЗ
	|		ЗначениеИндивидуальныхПлощадей КАК ЗначениеИндивидуальныхПлощадей) КАК ВложенныйЗапрос
	|
	|СГРУППИРОВАТЬ ПО
	|	ВложенныйЗапрос.Организация,
	|	ВложенныйЗапрос.ПериодНачисления,
	|	ВложенныйЗапрос.Район,
	|	ВложенныйЗапрос.МКД,
	|	ВложенныйЗапрос.Услуга
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	МаксимальныеПоказанияСрез.Организация КАК Организация,
	|	МаксимальныеПоказанияСрез.ПериодНачисления КАК ПериодНачисления,
	|	МаксимальныеПоказанияСрез.Район КАК Район,
	|	МаксимальныеПоказанияСрез.МКД КАК МКД,
	|	МаксимальныеПоказанияСрез.ПриборУчета КАК ПриборУчета,
	|	МаксимальныеПоказанияСрез.Шкала КАК Шкала,
	|	МаксимальныеПоказанияСрез.ТарифнаяЗона КАК ТарифнаяЗона,
	|	МаксимальныеПоказанияСрез.Показания КАК Показания,
	|	МаксимальныеПоказанияСрез.Период КАК Период,
	|	-1 КАК НомерПозиции,
	|	МаксимальныеПоказанияСрез.ДокРегистратор КАК ДокРегистратор,
	|	МаксимальныеПоказанияСрез.КонецПериодаРасчета КАК КонецПериодаРасчета
	|ПОМЕСТИТЬ НаборПоказаний
	|ИЗ
	|	МаксимальныеПоказанияСрез КАК МаксимальныеПоказанияСрез
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ПредоставленныеПоказания.Организация,
	|	ПредоставленныеПоказания.ПериодНачисления,
	|	ПредоставленныеПоказания.Район,
	|	ПредоставленныеПоказания.МКД,
	|	ПредоставленныеПоказания.ПриборУчета,
	|	ПредоставленныеПоказания.Шкала,
	|	ПредоставленныеПоказания.ТарифнаяЗона,
	|	ПредоставленныеПоказания.Показания,
	|	ПредоставленныеПоказания.ДатаРегистратора,
	|	ПредоставленныеПоказания.НомерПозиции,
	|	ПредоставленныеПоказания.ДокРегистратор,
	|	ПредоставленныеПоказания.КонецПериодаРасчета
	|ИЗ
	|	ПредоставленныеПоказания КАК ПредоставленныеПоказания
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПоказанияНачало.Организация КАК Организация,
	|	ПоказанияНачало.ПериодНачисления КАК ПериодНачисления,
	|	ПоказанияНачало.Район КАК Район,
	|	ПоказанияНачало.МКД КАК МКД,
	|	ПоказанияНачало.ПриборУчета КАК ПриборУчета,
	|	ПоказанияНачало.Шкала КАК Шкала,
	|	ПоказанияНачало.ТарифнаяЗона КАК ТарифнаяЗона,
	|	ПоказанияНачало.Показания КАК Показания,
	|	ПоказанияНачало.Период КАК НачалоПериодДействия,
	|	ВЫБОР
	|		КОГДА ПоказанияКонец.Период ЕСТЬ NULL
	|			ТОГДА ПоказанияНачало.КонецПериодаРасчета
	|		ИНАЧЕ ДОБАВИТЬКДАТЕ(ПоказанияКонец.Период, СЕКУНДА, -1)
	|	КОНЕЦ КАК ОкончаниеПериодаДействия,
	|	ВЫБОР
	|		КОГДА ПоказанияНачало.НомерПозиции = -1
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ПризнакНачалаПериода,
	|	ПоказанияНачало.ДокРегистратор КАК ДокРегистратор
	|ПОМЕСТИТЬ ПериодыПоказаний
	|ИЗ
	|	НаборПоказаний КАК ПоказанияНачало
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборПоказаний КАК ПоказанияКонец
	|		ПО ПоказанияНачало.Организация = ПоказанияКонец.Организация
	|			И ПоказанияНачало.ПериодНачисления = ПоказанияКонец.ПериодНачисления
	|			И ПоказанияНачало.Район = ПоказанияКонец.Район
	|			И ПоказанияНачало.МКД = ПоказанияКонец.МКД
	|			И ПоказанияНачало.ПриборУчета = ПоказанияКонец.ПриборУчета
	|			И ПоказанияНачало.Шкала = ПоказанияКонец.Шкала
	|			И ПоказанияНачало.ТарифнаяЗона = ПоказанияКонец.ТарифнаяЗона
	|			И (ПоказанияНачало.НомерПозиции = ПоказанияКонец.НомерПозиции - 1)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПредоставленныеПоказания.Организация КАК Организация,
	|	ПредоставленныеПоказания.ПериодНачисления КАК ПериодНачисления,
	|	ПредоставленныеПоказания.Район КАК Район,
	|	ПредоставленныеПоказания.МКД КАК МКД,
	|	МАКСИМУМ(ПредоставленныеПоказания.ПоказанияТекущегоПериода) КАК ПоказанияТекущегоПериода
	|ПОМЕСТИТЬ ПредоставленныеПоказанияПоМКД
	|ИЗ
	|	ПредоставленныеПоказания КАК ПредоставленныеПоказания
	|
	|СГРУППИРОВАТЬ ПО
	|	ПредоставленныеПоказания.Организация,
	|	ПредоставленныеПоказания.ПериодНачисления,
	|	ПредоставленныеПоказания.Район,
	|	ПредоставленныеПоказания.МКД
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СтабильныеПериодыНачало.Организация КАК Организация,
	|	СтабильныеПериодыНачало.ПериодНачисления КАК ПериодНачисления,
	|	СтабильныеПериодыНачало.Район КАК Район,
	|	СтабильныеПериодыНачало.МКД КАК МКД,
	|	СтабильныеПериодыНачало.Услуга КАК Услуга,
	|	СтабильныеПериодыНачало.ТочкаУчета КАК ТочкаУчета,
	|	СтабильныеПериодыНачало.ДокРегистратор КАК ДокРегистратор,
	|	СтабильныеПериодыНачало.НомерПозиции КАК НомерПозиции,
	|	СтабильныеПериодыНачало.МКДОткрыт КАК МКДОткрыт,
	|	СтабильныеПериодыНачало.УслугаПодключена КАК УслугаПодключена,
	|	СтабильныеПериодыНачало.ПриборВведен КАК ПриборВведен,
	|	СтабильныеПериодыНачало.ПриборУчета КАК УзелПриборУчета,
	|	СтабильныеПериодыНачало.ВидБлагоустройства КАК ВидБлагоустройства,
	|	СтабильныеПериодыНачало.ЗначениеПлощади КАК ЗначениеПлощади,
	|	СтабильныеПериодыНачало.Поставщик КАК Поставщик,
	|	СтабильныеПериодыНачало.МенялосьСостояниеПУ КАК МенялосьСостояниеПУ,
	|	СтабильныеПериодыНачало.ФормулаРасчета КАК ФормулаРасчета,
	|	СтабильныеПериодыНачало.РасчетПоФормуле КАК РасчетПоФормуле,
	|	СтабильныеПериодыНачало.СоставнаяУслуга КАК СоставнаяУслуга,
	|	СтабильныеПериодыНачало.КлючНорматива КАК КлючНорматива,
	|	СтабильныеПериодыНачало.НеРаспределятьНаАбонентов КАК НеРаспределятьНаАбонентов,
	|	СтабильныеПериодыНачало.ПериодРегистрации КАК ПериодРегистрации,
	|	СтабильныеПериодыНачало.НачалоОП КАК НачалоОП,
	|	СтабильныеПериодыНачало.ЗавершениеОП КАК ЗавершениеОП,
	|	СтабильныеПериодыНачало.ДнейВПериоде КАК ДнейВПериоде,
	|	СтабильныеПериодыНачало.ТипСхемы КАК ТипСхемы,
	|	СтабильныеПериодыНачало.Шкала КАК Шкала,
	|	СтабильныеПериодыНачало.ЧастьУзлаУчета КАК ЧастьУзлаУчета,
	|	СтабильныеПериодыНачало.ВидТепловогоПункта КАК ВидТепловогоПункта,
	|	СтабильныеПериодыНачало.РаспределятьНаТочку КАК РаспределятьНаТочку,
	|	ЕСТЬNULL(СтабильныеПериодыСоставУзла.ЧастьУзлаУчета, ЗНАЧЕНИЕ(Справочник.энргПриборыУчетаАбонента.ПустаяСсылка)) КАК ЧастьУзлаПриборУчета,
	|	ЕСТЬNULL(СтабильныеПериодыСоставУзла.ПриборВведен, ЛОЖЬ) КАК ЧастьУзлаПриборВведен,
	|	ЕСТЬNULL(СтабильныеПериодыСоставУзла.КоэффициентПУ, 0) КАК КоэффициентПУ
	|ПОМЕСТИТЬ СтабильныеПериодыНачалоСоставУзла
	|ИЗ
	|	СтабильныеПериодыНачало КАК СтабильныеПериодыНачало
	|		ЛЕВОЕ СОЕДИНЕНИЕ СтабильныеПериодыСоставУзла КАК СтабильныеПериодыСоставУзла
	|		ПО СтабильныеПериодыНачало.Организация = СтабильныеПериодыСоставУзла.Организация
	|			И СтабильныеПериодыНачало.ПериодНачисления = СтабильныеПериодыСоставУзла.ПериодНачисления
	|			И СтабильныеПериодыНачало.Район = СтабильныеПериодыСоставУзла.Район
	|			И СтабильныеПериодыНачало.МКД = СтабильныеПериодыСоставУзла.МКД
	|			И СтабильныеПериодыНачало.ТочкаУчета = СтабильныеПериодыСоставУзла.ТочкаУчета
	|			И СтабильныеПериодыНачало.НомерПозиции = СтабильныеПериодыСоставУзла.НомерПозиции
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СтабильныеПериодыНачалоСоставУзла.Организация КАК Организация,
	|	СтабильныеПериодыНачалоСоставУзла.ПериодНачисления КАК ПериодНачисления,
	|	СтабильныеПериодыНачалоСоставУзла.Район КАК Район,
	|	СтабильныеПериодыНачалоСоставУзла.МКД КАК МКД,
	|	СтабильныеПериодыНачалоСоставУзла.Услуга КАК Услуга,
	|	СтабильныеПериодыНачалоСоставУзла.ТочкаУчета КАК ТочкаУчета,
	|	СтабильныеПериодыНачалоСоставУзла.НомерПозиции КАК НомерПозиции,
	|	СтабильныеПериодыНачалоСоставУзла.ДокРегистратор КАК ДокРегистратор,
	|	СтабильныеПериодыНачалоСоставУзла.МКДОткрыт КАК МКДОткрыт,
	|	СтабильныеПериодыНачалоСоставУзла.УслугаПодключена КАК УслугаПодключена,
	|	СтабильныеПериодыНачалоСоставУзла.ПриборВведен КАК ПриборВведен,
	|	СтабильныеПериодыНачалоСоставУзла.УзелПриборУчета КАК УзелПриборУчета,
	|	СтабильныеПериодыНачалоСоставУзла.ВидБлагоустройства КАК ВидБлагоустройства,
	|	СтабильныеПериодыНачалоСоставУзла.ЗначениеПлощади КАК ЗначениеПлощади,
	|	СтабильныеПериодыНачалоСоставУзла.Поставщик КАК Поставщик,
	|	СтабильныеПериодыНачалоСоставУзла.МенялосьСостояниеПУ КАК МенялосьСостояниеПУ,
	|	СтабильныеПериодыНачалоСоставУзла.ФормулаРасчета КАК ФормулаРасчета,
	|	СтабильныеПериодыНачалоСоставУзла.РасчетПоФормуле КАК РасчетПоФормуле,
	|	СтабильныеПериодыНачалоСоставУзла.СоставнаяУслуга КАК СоставнаяУслуга,
	|	СтабильныеПериодыНачалоСоставУзла.КлючНорматива КАК КлючНорматива,
	|	СтабильныеПериодыНачалоСоставУзла.НеРаспределятьНаАбонентов КАК НеРаспределятьНаАбонентов,
	|	СтабильныеПериодыНачалоСоставУзла.ПериодРегистрации КАК ПериодРегистрации,
	|	СтабильныеПериодыНачалоСоставУзла.НачалоОП КАК НачалоОП,
	|	СтабильныеПериодыНачалоСоставУзла.ЗавершениеОП КАК ЗавершениеОП,
	|	СтабильныеПериодыНачалоСоставУзла.ДнейВПериоде КАК ДнейВПериоде,
	|	СтабильныеПериодыНачалоСоставУзла.ТипСхемы КАК ТипСхемы,
	|	СтабильныеПериодыНачалоСоставУзла.ВидТепловогоПункта КАК ВидТепловогоПункта,
	|	СтабильныеПериодыНачалоСоставУзла.ЧастьУзлаПриборУчета КАК ЧастьУзлаПриборУчета,
	|	СтабильныеПериодыНачалоСоставУзла.ЧастьУзлаПриборВведен КАК ЧастьУзлаПриборВведен,
	|	СтабильныеПериодыНачалоСоставУзла.КоэффициентПУ КАК КоэффициентПУ,
	|	СтабильныеПериодыНачалоСоставУзла.РаспределятьНаТочку КАК РаспределятьНаТочку,
	|	ЕСТЬNULL(СтабильныеПериодыШкалы.Шкала, СтабильныеПериодыНачалоСоставУзла.Шкала) КАК Шкала,
	|	ЕСТЬNULL(СтабильныеПериодыШкалы.ЧастьУзлаУчета, ЗНАЧЕНИЕ(Справочник.энргПриборыУчетаАбонента.ПустаяСсылка)) КАК ЧастьУзлаУчета,
	|	ЕСТЬNULL(СтабильныеПериодыШкалы.ВидДифференцированности, ЗНАЧЕНИЕ(Справочник.энргВидыДифференцированности.ПустаяСсылка)) КАК ВидДифференцированности,
	|	ВЫБОР
	|		КОГДА СтабильныеПериодыНачалоСоставУзла.Шкала = ЗНАЧЕНИЕ(Справочник.энргШкалыПриборовУчета.ПустаяСсылка)
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ ИСТИНА
	|	КОНЕЦ КАК ПривязанаКШкале
	|ПОМЕСТИТЬ СтабильныеПериодыНачалоШкалы
	|ИЗ
	|	СтабильныеПериодыНачалоСоставУзла КАК СтабильныеПериодыНачалоСоставУзла
	|		ЛЕВОЕ СОЕДИНЕНИЕ СтабильныеПериодыШкалы КАК СтабильныеПериодыШкалы
	|		ПО СтабильныеПериодыНачалоСоставУзла.Организация = СтабильныеПериодыШкалы.Организация
	|			И СтабильныеПериодыНачалоСоставУзла.ПериодНачисления = СтабильныеПериодыШкалы.ПериодНачисления
	|			И СтабильныеПериодыНачалоСоставУзла.Район = СтабильныеПериодыШкалы.Район
	|			И СтабильныеПериодыНачалоСоставУзла.МКД = СтабильныеПериодыШкалы.МКД
	|			И СтабильныеПериодыНачалоСоставУзла.ТочкаУчета = СтабильныеПериодыШкалы.ТочкаУчета
	|			И СтабильныеПериодыНачалоСоставУзла.НомерПозиции = СтабильныеПериодыШкалы.НомерПозиции
	|			И СтабильныеПериодыНачалоСоставУзла.ЧастьУзлаПриборУчета = СтабильныеПериодыШкалы.ЧастьУзлаУчета
	|			И (ВЫБОР
	|				КОГДА СтабильныеПериодыНачалоСоставУзла.Шкала = ЗНАЧЕНИЕ(Справочник.энргШкалыПриборовУчета.ПустаяСсылка)
	|						И СтабильныеПериодыНачалоСоставУзла.ЧастьУзлаУчета = ЗНАЧЕНИЕ(Справочник.энргПриборыУчетаАбонента.ПустаяСсылка)
	|					ТОГДА ИСТИНА
	|				ИНАЧЕ СтабильныеПериодыНачалоСоставУзла.Шкала = СтабильныеПериодыШкалы.Шкала
	|						И СтабильныеПериодыНачалоСоставУзла.ЧастьУзлаУчета = СтабильныеПериодыШкалы.ЧастьУзлаУчета
	|			КОНЕЦ)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НомераСтрокНачалоСезонности.Организация КАК Организация,
	|	НомераСтрокНачалоСезонности.ПериодНачисления КАК ПериодНачисления,
	|	НомераСтрокНачалоСезонности.Район КАК Район,
	|	НомераСтрокНачалоСезонности.МКД КАК МКД,
	|	СтабильныеПериодыНачало.Услуга КАК Услуга,
	|	НомераСтрокНачалоСезонности.ТочкаУчета КАК ТочкаУчета,
	|	СтабильныеПериодыНачало.Шкала КАК Шкала,
	|	НомераСтрокНачалоСезонности.НомерПозиции КАК НомерПозиции,
	|	НомераСтрокНачалоСезонности.ПериодСезонности КАК ПериодСезонности
	|ПОМЕСТИТЬ НомераСтрокНачалоСезонностиБезФормулы
	|ИЗ
	|	НомераСтрокНачалоСезонности КАК НомераСтрокНачалоСезонности
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ СтабильныеПериодыНачалоШкалы КАК СтабильныеПериодыНачало
	|		ПО НомераСтрокНачалоСезонности.Организация = СтабильныеПериодыНачало.Организация
	|			И НомераСтрокНачалоСезонности.ПериодНачисления = СтабильныеПериодыНачало.ПериодНачисления
	|			И НомераСтрокНачалоСезонности.Район = СтабильныеПериодыНачало.Район
	|			И НомераСтрокНачалоСезонности.МКД = СтабильныеПериодыНачало.МКД
	|			И НомераСтрокНачалоСезонности.ТочкаУчета = СтабильныеПериодыНачало.ТочкаУчета
	|			И НомераСтрокНачалоСезонности.НомерПозиции = СтабильныеПериодыНачало.НомерПозиции
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НомераСтрокКонецСезонности.Организация КАК Организация,
	|	НомераСтрокКонецСезонности.ПериодНачисления КАК ПериодНачисления,
	|	НомераСтрокКонецСезонности.Район КАК Район,
	|	НомераСтрокКонецСезонности.МКД КАК МКД,
	|	СтабильныеПериодыНачало.Услуга КАК Услуга,
	|	НомераСтрокКонецСезонности.ТочкаУчета КАК ТочкаУчета,
	|	СтабильныеПериодыНачало.Шкала КАК Шкала,
	|	НомераСтрокКонецСезонности.НомерПозиции КАК НомерПозиции,
	|	НомераСтрокКонецСезонности.ПериодСезонности КАК ПериодСезонности
	|ПОМЕСТИТЬ НомераСтрокКонецСезонностиБезФормулы
	|ИЗ
	|	НомераСтрокКонецСезонности КАК НомераСтрокКонецСезонности
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ СтабильныеПериодыНачалоШкалы КАК СтабильныеПериодыНачало
	|		ПО НомераСтрокКонецСезонности.Организация = СтабильныеПериодыНачало.Организация
	|			И НомераСтрокКонецСезонности.ПериодНачисления = СтабильныеПериодыНачало.ПериодНачисления
	|			И НомераСтрокКонецСезонности.Район = СтабильныеПериодыНачало.Район
	|			И НомераСтрокКонецСезонности.МКД = СтабильныеПериодыНачало.МКД
	|			И НомераСтрокКонецСезонности.ТочкаУчета = СтабильныеПериодыНачало.ТочкаУчета
	|			И НомераСтрокКонецСезонности.НомерПозиции = СтабильныеПериодыНачало.НомерПозиции
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СтабильныеПериодыНачалоШкалы.Организация КАК Организация,
	|	СтабильныеПериодыНачалоШкалы.ПериодНачисления КАК ПериодНачисления,
	|	СтабильныеПериодыНачалоШкалы.Район КАК Район,
	|	СтабильныеПериодыНачалоШкалы.МКД КАК МКД,
	|	СтабильныеПериодыНачалоШкалы.Услуга КАК Услуга,
	|	СтабильныеПериодыНачалоШкалы.ТочкаУчета КАК ТочкаУчета,
	|	СтабильныеПериодыНачалоШкалы.НомерПозиции КАК НомерПозиции,
	|	СтабильныеПериодыНачалоШкалы.ПериодРегистрации КАК ПериодРегистрации,
	|	СтабильныеПериодыНачалоШкалы.ДокРегистратор КАК ДокРегистратор,
	|	СтабильныеПериодыНачалоШкалы.МКДОткрыт КАК МКДОткрыт,
	|	СтабильныеПериодыНачалоШкалы.УслугаПодключена КАК УслугаПодключена,
	|	СтабильныеПериодыНачалоШкалы.ПриборВведен КАК ПриборВведен,
	|	СтабильныеПериодыНачалоШкалы.УзелПриборУчета КАК УзелПриборУчета,
	|	СтабильныеПериодыНачалоШкалы.КоэффициентПУ КАК КоэффициентПУ,
	|	СтабильныеПериодыНачалоШкалы.ВидБлагоустройства КАК ВидБлагоустройства,
	|	СтабильныеПериодыНачалоШкалы.ЗначениеПлощади КАК ЗначениеПлощади,
	|	СтабильныеПериодыНачалоШкалы.Поставщик КАК Поставщик,
	|	СтабильныеПериодыНачалоШкалы.МенялосьСостояниеПУ КАК МенялосьСостояниеПУ,
	|	ВЫБОР
	|		КОГДА НЕ УслугиНеПрименятьСезонностьМКД.НеПрименятьСезонность ЕСТЬ NULL
	|				И УслугиНеПрименятьСезонностьМКД.НеПрименятьСезонность
	|			ТОГДА 1
	|		КОГДА УслугиНеПрименятьСезонностьМКД.НеПрименятьСезонность ЕСТЬ NULL
	|				И НЕ УслугиНеПрименятьСезонностьРайон.НеПрименятьСезонность ЕСТЬ NULL
	|				И УслугиНеПрименятьСезонностьРайон.НеПрименятьСезонность
	|			ТОГДА 1
	|		КОГДА ДлительностьПериодов.НачалоФактическогоПериода ЕСТЬ NULL
	|			ТОГДА 1
	|		КОГДА ДлительностьПериодов.НачалоФактическогоПериода = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА 0
	|		КОГДА СтабильныеПериодыНачалоШкалы.ПериодРегистрации МЕЖДУ ДлительностьПериодов.НачалоФактическогоПериода И ДлительностьПериодов.КонецФактическогоПериода
	|			ТОГДА 1
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СезонностьНачало,
	|	СтабильныеПериодыНачалоШкалы.НачалоОП КАК НачалоОП,
	|	СтабильныеПериодыНачалоШкалы.ЗавершениеОП КАК ЗавершениеОП,
	|	СтабильныеПериодыНачалоШкалы.ДнейВПериоде КАК ДнейВПериоде,
	|	ЕСТЬNULL(УслугиНеПрименятьСезонностьМКД.НеПрименятьСезонность, ЕСТЬNULL(УслугиНеПрименятьСезонностьРайон.НеПрименятьСезонность, ЛОЖЬ)) КАК НеПрименятьСезонность,
	|	ЕСТЬNULL(УслугиНеПрименятьСезонностьМКД.ОбъемЗаПрошлыйГод, ЕСТЬNULL(УслугиНеПрименятьСезонностьРайон.ОбъемЗаПрошлыйГод, ЛОЖЬ)) КАК ОбъемЗаПрошлыйГод,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(УслугиНеПрименятьСезонностьМКД.НеПрименятьСезонность, ЕСТЬNULL(УслугиНеПрименятьСезонностьРайон.НеПрименятьСезонность, ЛОЖЬ))
	|			ТОГДА  ЕСТЬNULL(УслугиНеПрименятьСезонностьМКД.КоэффициентНеПрименятьСезонность, ЕСТЬNULL(УслугиНеПрименятьСезонностьРайон.КоэффициентНеПрименятьСезонность, 1)) 
	|   	ИНАЧЕ ЕСТЬNULL(УслугиНеПрименятьСезонностьМКД.КоэффициентНорматива, ЕСТЬNULL(УслугиНеПрименятьСезонностьРайон.КоэффициентНорматива, 1)) 
	|	КОНЕЦ КАК КоэффициентНорматива,
	|	СтабильныеПериодыНачалоШкалы.ФормулаРасчета КАК ФормулаРасчета,
	|	СтабильныеПериодыНачалоШкалы.РасчетПоФормуле КАК РасчетПоФормуле,
	|	СтабильныеПериодыНачалоШкалы.СоставнаяУслуга КАК СоставнаяУслуга,
	|	СтабильныеПериодыНачалоШкалы.КлючНорматива КАК КлючНорматива,
	|	СтабильныеПериодыНачалоШкалы.НеРаспределятьНаАбонентов КАК НеРаспределятьНаАбонентов,
	|	СтабильныеПериодыНачалоШкалы.ТипСхемы КАК ТипСхемы,
	|	СтабильныеПериодыНачалоШкалы.ВидТепловогоПункта КАК ВидТепловогоПункта,
	|	СтабильныеПериодыНачалоШкалы.Шкала КАК Шкала,
	|	СтабильныеПериодыНачалоШкалы.ВидДифференцированности КАК ВидДифференцированности,
	|	СтабильныеПериодыНачалоШкалы.ПривязанаКШкале КАК ПривязанаКШкале,
	|	СтабильныеПериодыНачалоШкалы.ЧастьУзлаПриборУчета КАК ЧастьУзлаПриборУчета,
	|	СтабильныеПериодыНачалоШкалы.ЧастьУзлаПриборВведен КАК ЧастьУзлаПриборВведен,
	|	СтабильныеПериодыНачалоШкалы.РаспределятьНаТочку КАК РаспределятьНаТочку
	|ПОМЕСТИТЬ СтабильныеПериодыНачалоСезонности
	|ИЗ
	|	СтабильныеПериодыНачалоШкалы КАК СтабильныеПериодыНачалоШкалы
	|		ЛЕВОЕ СОЕДИНЕНИЕ ДлительностьПериодов КАК ДлительностьПериодов
	|		ПО СтабильныеПериодыНачалоШкалы.Услуга = ДлительностьПериодов.Услуга
	|			И СтабильныеПериодыНачалоШкалы.ПериодНачисления = ДлительностьПериодов.ПериодНачисления
	|		ЛЕВОЕ СОЕДИНЕНИЕ УслугиНеПрименятьСезонность КАК УслугиНеПрименятьСезонностьМКД
	|		ПО СтабильныеПериодыНачалоШкалы.Организация = УслугиНеПрименятьСезонностьМКД.Организация
	|			И СтабильныеПериодыНачалоШкалы.ПериодНачисления = УслугиНеПрименятьСезонностьМКД.ПериодНачисления
	|			И СтабильныеПериодыНачалоШкалы.Район = УслугиНеПрименятьСезонностьМКД.Район
	|			И СтабильныеПериодыНачалоШкалы.МКД = УслугиНеПрименятьСезонностьМКД.Строение
	|			И СтабильныеПериодыНачалоШкалы.Услуга = УслугиНеПрименятьСезонностьМКД.Услуга
	|		ЛЕВОЕ СОЕДИНЕНИЕ УслугиНеПрименятьСезонность КАК УслугиНеПрименятьСезонностьРайон
	|		ПО СтабильныеПериодыНачалоШкалы.Организация = УслугиНеПрименятьСезонностьРайон.Организация
	|			И СтабильныеПериодыНачалоШкалы.ПериодНачисления = УслугиНеПрименятьСезонностьРайон.ПериодНачисления
	|			И СтабильныеПериодыНачалоШкалы.Район = УслугиНеПрименятьСезонностьРайон.Район
	|			И (УслугиНеПрименятьСезонностьРайон.Строение = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка))
	|			И СтабильныеПериодыНачалоШкалы.Услуга = УслугиНеПрименятьСезонностьРайон.Услуга
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СтабильныеПериодыНачалоСезонности.Организация КАК Организация,
	|	СтабильныеПериодыНачалоСезонности.ПериодНачисления КАК ПериодНачисления,
	|	СтабильныеПериодыНачалоСезонности.Район КАК Район,
	|	СтабильныеПериодыНачалоСезонности.МКД КАК МКД,
	|	СтабильныеПериодыНачалоСезонности.Услуга КАК Услуга,
	|	СтабильныеПериодыНачалоСезонности.ТочкаУчета КАК ТочкаУчета,
	|	ВЫБОР
	|		КОГДА НомераСтрокНачалоСезонностиБезФормулы.НомерПозиции ЕСТЬ NULL
	|			ТОГДА СтабильныеПериодыНачалоСезонности.НомерПозиции
	|		КОГДА СтабильныеПериодыНачалоСезонности.НомерПозиции > НомераСтрокНачалоСезонностиБезФормулы.НомерПозиции
	|			ТОГДА СтабильныеПериодыНачалоСезонности.НомерПозиции + 1
	|		ИНАЧЕ СтабильныеПериодыНачалоСезонности.НомерПозиции
	|	КОНЕЦ КАК НомерПозиции,
	|	СтабильныеПериодыНачалоСезонности.ПериодРегистрации КАК ПериодРегистрации,
	|	СтабильныеПериодыНачалоСезонности.ДокРегистратор КАК ДокРегистратор,
	|	СтабильныеПериодыНачалоСезонности.МКДОткрыт КАК МКДОткрыт,
	|	СтабильныеПериодыНачалоСезонности.УслугаПодключена КАК УслугаПодключена,
	|	СтабильныеПериодыНачалоСезонности.ПриборВведен КАК ПриборВведен,
	|	СтабильныеПериодыНачалоСезонности.УзелПриборУчета КАК УзелПриборУчета,
	|	СтабильныеПериодыНачалоСезонности.КоэффициентПУ КАК КоэффициентПУ,
	|	СтабильныеПериодыНачалоСезонности.ВидБлагоустройства КАК ВидБлагоустройства,
	|	СтабильныеПериодыНачалоСезонности.ЗначениеПлощади КАК ЗначениеПлощади,
	|	СтабильныеПериодыНачалоСезонности.Поставщик КАК Поставщик,
	|	СтабильныеПериодыНачалоСезонности.МенялосьСостояниеПУ КАК МенялосьСостояниеПУ,
	|	ВЫБОР
	|		КОГДА НомераСтрокНачалоСезонностиБезФормулы.НомерПозиции ЕСТЬ NULL
	|			ТОГДА СтабильныеПериодыНачалоСезонности.СезонностьНачало
	|		ИНАЧЕ 1
	|	КОНЕЦ КАК КоэффициентСезоности,
	|	СтабильныеПериодыНачалоСезонности.НачалоОП КАК НачалоОП,
	|	СтабильныеПериодыНачалоСезонности.ЗавершениеОП КАК ЗавершениеОП,
	|	СтабильныеПериодыНачалоСезонности.ДнейВПериоде КАК ДнейВПериоде,
	|	ВЫБОР
	|		КОГДА НомераСтрокНачалоСезонностиБезФормулы.НомерПозиции ЕСТЬ NULL
	|			ТОГДА 0
	|		КОГДА СтабильныеПериодыНачалоСезонности.НомерПозиции > НомераСтрокНачалоСезонностиБезФормулы.НомерПозиции
	|			ТОГДА 1
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК УвеличениеПозиции,
	|	СтабильныеПериодыНачалоСезонности.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	СтабильныеПериодыНачалоСезонности.ОбъемЗаПрошлыйГод КАК ОбъемЗаПрошлыйГод,
	|	СтабильныеПериодыНачалоСезонности.КоэффициентНорматива КАК КоэффициентНорматива,
	|	СтабильныеПериодыНачалоСезонности.ФормулаРасчета КАК ФормулаРасчета,
	|	СтабильныеПериодыНачалоСезонности.РасчетПоФормуле КАК РасчетПоФормуле,
	|	СтабильныеПериодыНачалоСезонности.СоставнаяУслуга КАК СоставнаяУслуга,
	|	СтабильныеПериодыНачалоСезонности.КлючНорматива КАК КлючНорматива,
	|	СтабильныеПериодыНачалоСезонности.НеРаспределятьНаАбонентов КАК НеРаспределятьНаАбонентов,
	|	СтабильныеПериодыНачалоСезонности.Шкала КАК Шкала,
	|	СтабильныеПериодыНачалоСезонности.ВидДифференцированности КАК ВидДифференцированности,
	|	СтабильныеПериодыНачалоСезонности.ПривязанаКШкале КАК ПривязанаКШкале,
	|	СтабильныеПериодыНачалоСезонности.ТипСхемы КАК ТипСхемы,
	|	СтабильныеПериодыНачалоСезонности.ВидТепловогоПункта КАК ВидТепловогоПункта,
	|	СтабильныеПериодыНачалоСезонности.ЧастьУзлаПриборУчета КАК ЧастьУзлаПриборУчета,
	|	СтабильныеПериодыНачалоСезонности.ЧастьУзлаПриборВведен КАК ЧастьУзлаПриборВведен,
	|	СтабильныеПериодыНачалоСезонности.РаспределятьНаТочку КАК РаспределятьНаТочку
	|ПОМЕСТИТЬ СтабильныеПериодыСезонность
	|ИЗ
	|	СтабильныеПериодыНачалоСезонности КАК СтабильныеПериодыНачалоСезонности
	|		ЛЕВОЕ СОЕДИНЕНИЕ НомераСтрокНачалоСезонностиБезФормулы КАК НомераСтрокНачалоСезонностиБезФормулы
	|		ПО СтабильныеПериодыНачалоСезонности.Организация = НомераСтрокНачалоСезонностиБезФормулы.Организация
	|			И СтабильныеПериодыНачалоСезонности.ПериодНачисления = НомераСтрокНачалоСезонностиБезФормулы.ПериодНачисления
	|			И СтабильныеПериодыНачалоСезонности.МКД = НомераСтрокНачалоСезонностиБезФормулы.МКД
	|			И СтабильныеПериодыНачалоСезонности.Услуга = НомераСтрокНачалоСезонностиБезФормулы.Услуга
	|			И СтабильныеПериодыНачалоСезонности.ТочкаУчета = НомераСтрокНачалоСезонностиБезФормулы.ТочкаУчета
	|			И СтабильныеПериодыНачалоСезонности.Шкала = НомераСтрокНачалоСезонностиБезФормулы.Шкала
	|			И (НЕ СтабильныеПериодыНачалоСезонности.НеПрименятьСезонность)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	СтабильныеПериодыНачалоСезонности.Организация,
	|	СтабильныеПериодыНачалоСезонности.ПериодНачисления,
	|	СтабильныеПериодыНачалоСезонности.Район,
	|	СтабильныеПериодыНачалоСезонности.МКД,
	|	СтабильныеПериодыНачалоСезонности.Услуга,
	|	СтабильныеПериодыНачалоСезонности.ТочкаУчета,
	|	СтабильныеПериодыНачалоСезонности.НомерПозиции + 1,
	|	НомераСтрокНачалоСезонностиБезФормулы.ПериодСезонности,
	|	СтабильныеПериодыНачалоСезонности.ДокРегистратор,
	|	СтабильныеПериодыНачалоСезонности.МКДОткрыт,
	|	СтабильныеПериодыНачалоСезонности.УслугаПодключена,
	|	СтабильныеПериодыНачалоСезонности.ПриборВведен,
	|	СтабильныеПериодыНачалоСезонности.УзелПриборУчета,
	|	СтабильныеПериодыНачалоСезонности.КоэффициентПУ,
	|	СтабильныеПериодыНачалоСезонности.ВидБлагоустройства,
	|	СтабильныеПериодыНачалоСезонности.ЗначениеПлощади,
	|	СтабильныеПериодыНачалоСезонности.Поставщик,
	|	СтабильныеПериодыНачалоСезонности.МенялосьСостояниеПУ,
	|	1,
	|	СтабильныеПериодыНачалоСезонности.НачалоОП,
	|	СтабильныеПериодыНачалоСезонности.ЗавершениеОП,
	|	СтабильныеПериодыНачалоСезонности.ДнейВПериоде,
	|	1,
	|	СтабильныеПериодыНачалоСезонности.НеПрименятьСезонность,
	|	СтабильныеПериодыНачалоСезонности.ОбъемЗаПрошлыйГод,
	|	СтабильныеПериодыНачалоСезонности.КоэффициентНорматива,
	|	СтабильныеПериодыНачалоСезонности.ФормулаРасчета,
	|	СтабильныеПериодыНачалоСезонности.РасчетПоФормуле,
	|	СтабильныеПериодыНачалоСезонности.СоставнаяУслуга,
	|	СтабильныеПериодыНачалоСезонности.КлючНорматива,
	|	СтабильныеПериодыНачалоСезонности.НеРаспределятьНаАбонентов,
	|	СтабильныеПериодыНачалоСезонности.Шкала,
	|	СтабильныеПериодыНачалоСезонности.ВидДифференцированности,
	|	СтабильныеПериодыНачалоСезонности.ПривязанаКШкале,
	|	СтабильныеПериодыНачалоСезонности.ТипСхемы,
	|	СтабильныеПериодыНачалоСезонности.ВидТепловогоПункта,
	|	СтабильныеПериодыНачалоСезонности.ЧастьУзлаПриборУчета,
	|	СтабильныеПериодыНачалоСезонности.ЧастьУзлаПриборВведен,
	|	СтабильныеПериодыНачалоСезонности.РаспределятьНаТочку
	|ИЗ
	|	СтабильныеПериодыНачалоСезонности КАК СтабильныеПериодыНачалоСезонности
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ НомераСтрокНачалоСезонностиБезФормулы КАК НомераСтрокНачалоСезонностиБезФормулы
	|		ПО СтабильныеПериодыНачалоСезонности.Организация = НомераСтрокНачалоСезонностиБезФормулы.Организация
	|			И СтабильныеПериодыНачалоСезонности.ПериодНачисления = НомераСтрокНачалоСезонностиБезФормулы.ПериодНачисления
	|			И СтабильныеПериодыНачалоСезонности.МКД = НомераСтрокНачалоСезонностиБезФормулы.МКД
	|			И СтабильныеПериодыНачалоСезонности.Услуга = НомераСтрокНачалоСезонностиБезФормулы.Услуга
	|			И СтабильныеПериодыНачалоСезонности.ТочкаУчета = НомераСтрокНачалоСезонностиБезФормулы.ТочкаУчета
	|			И СтабильныеПериодыНачалоСезонности.Шкала = НомераСтрокНачалоСезонностиБезФормулы.Шкала
	|			И СтабильныеПериодыНачалоСезонности.НомерПозиции = НомераСтрокНачалоСезонностиБезФормулы.НомерПозиции
	|			И (НЕ СтабильныеПериодыНачалоСезонности.НеПрименятьСезонность)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СтабильныеПериодыСезонность.Организация КАК Организация,
	|	СтабильныеПериодыСезонность.ПериодНачисления КАК ПериодНачисления,
	|	СтабильныеПериодыСезонность.Район КАК Район,
	|	СтабильныеПериодыСезонность.МКД КАК МКД,
	|	СтабильныеПериодыСезонность.Услуга КАК Услуга,
	|	СтабильныеПериодыСезонность.ТочкаУчета КАК ТочкаУчета,
	|	СтабильныеПериодыСезонность.НомерПозиции + ВЫБОР
	|		КОГДА НомераСтрокКонецСезонностиБезФормулы.НомерПозиции ЕСТЬ NULL
	|			ТОГДА 0
	|		КОГДА НомераСтрокКонецСезонностиБезФормулы.НомерПозиции + СтабильныеПериодыСезонность.УвеличениеПозиции > СтабильныеПериодыСезонность.НомерПозиции
	|			ТОГДА 1
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК НомерПозиции,
	|	СтабильныеПериодыСезонность.ПериодРегистрации КАК ПериодРегистрации,
	|	СтабильныеПериодыСезонность.ДокРегистратор КАК ДокРегистратор,
	|	ВЫБОР
	|		КОГДА НомераСтрокКонецСезонностиБезФормулы.НомерПозиции ЕСТЬ NULL
	|			ТОГДА СтабильныеПериодыСезонность.КоэффициентСезоности
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК КоэффициентСезоности,
	|	СтабильныеПериодыСезонность.НачалоОП КАК НачалоОП,
	|	СтабильныеПериодыСезонность.ЗавершениеОП КАК ЗавершениеОП,
	|	СтабильныеПериодыСезонность.ДнейВПериоде КАК ДнейВПериоде,
	|	СтабильныеПериодыСезонность.МКДОткрыт КАК МКДОткрыт,
	|	СтабильныеПериодыСезонность.УслугаПодключена КАК УслугаПодключена,
	|	СтабильныеПериодыСезонность.ПриборВведен КАК ПриборВведен,
	|	СтабильныеПериодыСезонность.УзелПриборУчета КАК УзелПриборУчета,
	|	СтабильныеПериодыСезонность.КоэффициентПУ КАК КоэффициентПУ,
	|	СтабильныеПериодыСезонность.ВидБлагоустройства КАК ВидБлагоустройства,
	|	СтабильныеПериодыСезонность.ЗначениеПлощади КАК ЗначениеПлощади,
	|	СтабильныеПериодыСезонность.Поставщик КАК Поставщик,
	|	СтабильныеПериодыСезонность.КоэффициентНорматива КАК КоэффициентНорматива,
	|	СтабильныеПериодыСезонность.ФормулаРасчета КАК ФормулаРасчета,
	|	СтабильныеПериодыСезонность.РасчетПоФормуле КАК РасчетПоФормуле,
	|	СтабильныеПериодыСезонность.СоставнаяУслуга КАК СоставнаяУслуга,
	|	СтабильныеПериодыСезонность.КлючНорматива КАК КлючНорматива,
	|	СтабильныеПериодыСезонность.НеРаспределятьНаАбонентов КАК НеРаспределятьНаАбонентов,
	|	СтабильныеПериодыСезонность.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	СтабильныеПериодыСезонность.ОбъемЗаПрошлыйГод КАК ОбъемЗаПрошлыйГод,
	|	СтабильныеПериодыСезонность.Шкала КАК Шкала,
	|	СтабильныеПериодыСезонность.ВидДифференцированности КАК ВидДифференцированности,
	|	СтабильныеПериодыСезонность.ПривязанаКШкале КАК ПривязанаКШкале,
	|	СтабильныеПериодыСезонность.ТипСхемы КАК ТипСхемы,
	|	СтабильныеПериодыСезонность.ВидТепловогоПункта КАК ВидТепловогоПункта,
	|	СтабильныеПериодыСезонность.ЧастьУзлаПриборУчета КАК ЧастьУзлаПриборУчета,
	|	СтабильныеПериодыСезонность.ЧастьУзлаПриборВведен КАК ЧастьУзлаПриборВведен,
	|	СтабильныеПериодыСезонность.РаспределятьНаТочку КАК РаспределятьНаТочку
	|ПОМЕСТИТЬ СтабильныеКонецСезонности
	|ИЗ
	|	СтабильныеПериодыСезонность КАК СтабильныеПериодыСезонность
	|		ЛЕВОЕ СОЕДИНЕНИЕ НомераСтрокКонецСезонностиБезФормулы КАК НомераСтрокКонецСезонностиБезФормулы
	|		ПО СтабильныеПериодыСезонность.Организация = НомераСтрокКонецСезонностиБезФормулы.Организация
	|			И СтабильныеПериодыСезонность.ПериодНачисления = НомераСтрокКонецСезонностиБезФормулы.ПериодНачисления
	|			И СтабильныеПериодыСезонность.МКД = НомераСтрокКонецСезонностиБезФормулы.МКД
	|			И СтабильныеПериодыСезонность.Услуга = НомераСтрокКонецСезонностиБезФормулы.Услуга
	|			И СтабильныеПериодыСезонность.ТочкаУчета = НомераСтрокКонецСезонностиБезФормулы.ТочкаУчета
	|			И СтабильныеПериодыСезонность.Шкала = НомераСтрокКонецСезонностиБезФормулы.Шкала
	|			И (НЕ СтабильныеПериодыСезонность.НеПрименятьСезонность)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	СтабильныеПериодыСезонность.Организация,
	|	СтабильныеПериодыСезонность.ПериодНачисления,
	|	СтабильныеПериодыСезонность.Район,
	|	СтабильныеПериодыСезонность.МКД,
	|	СтабильныеПериодыСезонность.Услуга,
	|	СтабильныеПериодыСезонность.ТочкаУчета,
	|	НомераСтрокКонецСезонностиБезФормулы.НомерПозиции + 1,
	|	НомераСтрокКонецСезонностиБезФормулы.ПериодСезонности,
	|	СтабильныеПериодыСезонность.ДокРегистратор,
	|	0,
	|	СтабильныеПериодыСезонность.НачалоОП,
	|	СтабильныеПериодыСезонность.ЗавершениеОП,
	|	СтабильныеПериодыСезонность.ДнейВПериоде,
	|	СтабильныеПериодыСезонность.МКДОткрыт,
	|	СтабильныеПериодыСезонность.УслугаПодключена,
	|	СтабильныеПериодыСезонность.ПриборВведен,
	|	СтабильныеПериодыСезонность.УзелПриборУчета,
	|	СтабильныеПериодыСезонность.КоэффициентПУ,
	|	СтабильныеПериодыСезонность.ВидБлагоустройства,
	|	СтабильныеПериодыСезонность.ЗначениеПлощади,
	|	СтабильныеПериодыСезонность.Поставщик,
	|	СтабильныеПериодыСезонность.КоэффициентНорматива,
	|	СтабильныеПериодыСезонность.ФормулаРасчета,
	|	СтабильныеПериодыСезонность.РасчетПоФормуле,
	|	СтабильныеПериодыСезонность.СоставнаяУслуга,
	|	СтабильныеПериодыСезонность.КлючНорматива,
	|	СтабильныеПериодыСезонность.НеРаспределятьНаАбонентов,
	|	СтабильныеПериодыСезонность.НеПрименятьСезонность,
	|	СтабильныеПериодыСезонность.ОбъемЗаПрошлыйГод,
	|	СтабильныеПериодыСезонность.Шкала,
	|	СтабильныеПериодыСезонность.ВидДифференцированности,
	|	СтабильныеПериодыСезонность.ПривязанаКШкале,
	|	СтабильныеПериодыСезонность.ТипСхемы,
	|	СтабильныеПериодыСезонность.ВидТепловогоПункта,
	|	СтабильныеПериодыСезонность.ЧастьУзлаПриборУчета,
	|	СтабильныеПериодыСезонность.ЧастьУзлаПриборВведен,
	|	СтабильныеПериодыСезонность.РаспределятьНаТочку
	|ИЗ
	|	СтабильныеПериодыСезонность КАК СтабильныеПериодыСезонность
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ НомераСтрокКонецСезонностиБезФормулы КАК НомераСтрокКонецСезонностиБезФормулы
	|		ПО СтабильныеПериодыСезонность.Организация = НомераСтрокКонецСезонностиБезФормулы.Организация
	|			И СтабильныеПериодыСезонность.ПериодНачисления = НомераСтрокКонецСезонностиБезФормулы.ПериодНачисления
	|			И СтабильныеПериодыСезонность.МКД = НомераСтрокКонецСезонностиБезФормулы.МКД
	|			И СтабильныеПериодыСезонность.Услуга = НомераСтрокКонецСезонностиБезФормулы.Услуга
	|			И СтабильныеПериодыСезонность.ТочкаУчета = НомераСтрокКонецСезонностиБезФормулы.ТочкаУчета
	|			И СтабильныеПериодыСезонность.Шкала = НомераСтрокКонецСезонностиБезФормулы.Шкала
	|			И (СтабильныеПериодыСезонность.НомерПозиции - СтабильныеПериодыСезонность.УвеличениеПозиции = НомераСтрокКонецСезонностиБезФормулы.НомерПозиции)
	|			И (НЕ СтабильныеПериодыСезонность.НеПрименятьСезонность)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СтабильныеКонецСезонности.Организация КАК Организация,
	|	СтабильныеКонецСезонности.ПериодНачисления КАК ПериодНачисления,
	|	СтабильныеКонецСезонности.Район КАК Район,
	|	СтабильныеКонецСезонности.МКД КАК МКД,
	|	СтабильныеКонецСезонности.Услуга КАК Услуга,
	|	СтабильныеКонецСезонности.ТочкаУчета КАК ТочкаУчета,
	|	СтабильныеКонецСезонности.НомерПозиции КАК НомерПозиции,
	|	СтабильныеКонецСезонности.ПериодРегистрации КАК ПериодРегистрации,
	|	СтабильныеКонецСезонности.ДокРегистратор КАК ДокРегистратор,
	|	СтабильныеКонецСезонности.КоэффициентСезоности КАК КоэффициентСезоности,
	|	СтабильныеКонецСезонности.НачалоОП КАК НачалоОП,
	|	СтабильныеКонецСезонности.ЗавершениеОП КАК ЗавершениеОП,
	|	СтабильныеКонецСезонности.ДнейВПериоде КАК ДнейВПериоде,
	|	СтабильныеКонецСезонности.МКДОткрыт КАК МКДОткрыт,
	|	СтабильныеКонецСезонности.УслугаПодключена КАК УслугаПодключена,
	|	СтабильныеКонецСезонности.ПриборВведен КАК ПриборВведен,
	|	СтабильныеКонецСезонности.УзелПриборУчета КАК УзелПриборУчета,
	|	СтабильныеКонецСезонности.КоэффициентПУ КАК КоэффициентПУ,
	|	СтабильныеКонецСезонности.ВидБлагоустройства КАК ВидБлагоустройства,
	|	СтабильныеКонецСезонности.ЗначениеПлощади КАК ЗначениеПлощади,
	|	СтабильныеКонецСезонности.Поставщик КАК Поставщик,
	|	СтабильныеКонецСезонности.ФормулаРасчета КАК ФормулаРасчета,
	|	СтабильныеКонецСезонности.РасчетПоФормуле КАК РасчетПоФормуле,
	|	СтабильныеКонецСезонности.СоставнаяУслуга КАК СоставнаяУслуга,
	|	СтабильныеКонецСезонности.КлючНорматива КАК КлючНорматива,
	|	СтабильныеКонецСезонности.НеРаспределятьНаАбонентов КАК НеРаспределятьНаАбонентов,
	|	СтабильныеКонецСезонности.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	СтабильныеКонецСезонности.ОбъемЗаПрошлыйГод КАК ОбъемЗаПрошлыйГод,
	|	СтабильныеКонецСезонности.Шкала КАК Шкала,
	|	СтабильныеКонецСезонности.ВидДифференцированности КАК ВидДифференцированности,
	|	СтабильныеКонецСезонности.ПривязанаКШкале КАК ПривязанаКШкале,
	|	ВЫБОР
	|		КОГДА энргВидыДифференцированностиТарифныеЗоны.Ссылка ЕСТЬ NULL
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.энргТарифныеЗоны.БезРазбивки)
	|		ИНАЧЕ энргВидыДифференцированностиТарифныеЗоны.ТарифнаяЗона
	|	КОНЕЦ КАК ТарифнаяЗона,
	|	СтабильныеКонецСезонности.ТипСхемы КАК ТипСхемы,
	|	СтабильныеКонецСезонности.ВидТепловогоПункта КАК ВидТепловогоПункта,
	|	СтабильныеКонецСезонности.КоэффициентНорматива КАК КоэффициентНорматива,
	|	СтабильныеКонецСезонности.ЧастьУзлаПриборУчета КАК ЧастьУзлаПриборУчета,
	|	СтабильныеКонецСезонности.ЧастьУзлаПриборВведен КАК ЧастьУзлаПриборВведен,
	|	СтабильныеКонецСезонности.РаспределятьНаТочку КАК РаспределятьНаТочку
	|ПОМЕСТИТЬ СтабильныеКонецСезонностиТарифнаяЗона
	|ИЗ
	|	СтабильныеКонецСезонности КАК СтабильныеКонецСезонности
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.энргВидыДифференцированности.ТарифныеЗоны КАК энргВидыДифференцированностиТарифныеЗоны
	|		ПО СтабильныеКонецСезонности.ВидДифференцированности = энргВидыДифференцированностиТарифныеЗоны.Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СтабильныеКонецСезонностиТарифнаяЗона.Организация КАК Организация,
	|	СтабильныеКонецСезонностиТарифнаяЗона.ПериодНачисления КАК ПериодНачисления,
	|	СтабильныеКонецСезонностиТарифнаяЗона.Район КАК Район,
	|	СтабильныеКонецСезонностиТарифнаяЗона.МКД КАК МКД,
	|	СтабильныеКонецСезонностиТарифнаяЗона.Услуга КАК Услуга,
	|	СтабильныеКонецСезонностиТарифнаяЗона.ТочкаУчета КАК ТочкаУчета,
	|	СтабильныеКонецСезонностиТарифнаяЗона.НомерПозиции КАК НомерПозиции,
	|	СтабильныеКонецСезонностиТарифнаяЗона.ПериодРегистрации КАК ПериодРегистрации,
	|	СтабильныеКонецСезонностиТарифнаяЗона.ДокРегистратор КАК ДокРегистратор,
	|	СтабильныеКонецСезонностиТарифнаяЗона.Шкала КАК Шкала,
	|	СтабильныеКонецСезонностиТарифнаяЗона.ПривязанаКШкале КАК ПривязанаКШкале,
	|	СтабильныеКонецСезонностиТарифнаяЗона.ТарифнаяЗона КАК ТарифнаяЗона,
	|	СтабильныеКонецСезонностиТарифнаяЗона.ВидДифференцированности КАК ВидДифференцированности,
	|	ЕСТЬNULL(ПериодыПоказаний.Показания, 0) КАК Показания,
	|	СтабильныеКонецСезонностиТарифнаяЗона.КоэффициентСезоности КАК КоэффициентСезоности,
	|	СтабильныеКонецСезонностиТарифнаяЗона.НачалоОП КАК НачалоОП,
	|	СтабильныеКонецСезонностиТарифнаяЗона.ЗавершениеОП КАК ЗавершениеОП,
	|	СтабильныеКонецСезонностиТарифнаяЗона.ДнейВПериоде КАК ДнейВПериоде,
	|	СтабильныеКонецСезонностиТарифнаяЗона.МКДОткрыт КАК МКДОткрыт,
	|	СтабильныеКонецСезонностиТарифнаяЗона.УслугаПодключена КАК УслугаПодключена,
	|	СтабильныеКонецСезонностиТарифнаяЗона.ПриборВведен КАК ПриборВведен,
	|	СтабильныеКонецСезонностиТарифнаяЗона.УзелПриборУчета КАК УзелПриборУчета,
	|	СтабильныеКонецСезонностиТарифнаяЗона.КоэффициентПУ КАК КоэффициентПУ,
	|	СтабильныеКонецСезонностиТарифнаяЗона.ВидБлагоустройства КАК ВидБлагоустройства,
	|	СтабильныеКонецСезонностиТарифнаяЗона.ЗначениеПлощади КАК ЗначениеПлощади,
	|	СтабильныеКонецСезонностиТарифнаяЗона.Поставщик КАК Поставщик,
	|	СтабильныеКонецСезонностиТарифнаяЗона.ФормулаРасчета КАК ФормулаРасчета,
	|	СтабильныеКонецСезонностиТарифнаяЗона.РасчетПоФормуле КАК РасчетПоФормуле,
	|	СтабильныеКонецСезонностиТарифнаяЗона.СоставнаяУслуга КАК СоставнаяУслуга,
	|	СтабильныеКонецСезонностиТарифнаяЗона.КлючНорматива КАК КлючНорматива,
	|	СтабильныеКонецСезонностиТарифнаяЗона.НеРаспределятьНаАбонентов КАК НеРаспределятьНаАбонентов,
	|	СтабильныеКонецСезонностиТарифнаяЗона.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	СтабильныеКонецСезонностиТарифнаяЗона.ОбъемЗаПрошлыйГод КАК ОбъемЗаПрошлыйГод,
	|	СтабильныеКонецСезонностиТарифнаяЗона.ТипСхемы КАК ТипСхемы,
	|	СтабильныеКонецСезонностиТарифнаяЗона.ВидТепловогоПункта КАК ВидТепловогоПункта,
	|	СтабильныеКонецСезонностиТарифнаяЗона.КоэффициентНорматива КАК КоэффициентНорматива,
	|	СтабильныеКонецСезонностиТарифнаяЗона.ЧастьУзлаПриборУчета КАК ЧастьУзлаПриборУчета,
	|	СтабильныеКонецСезонностиТарифнаяЗона.ЧастьУзлаПриборВведен КАК ЧастьУзлаПриборВведен,
	|	СтабильныеКонецСезонностиТарифнаяЗона.РаспределятьНаТочку КАК РаспределятьНаТочку
	|ПОМЕСТИТЬ СтабильныеПериодыПоказания
	|ИЗ
	|	СтабильныеКонецСезонностиТарифнаяЗона КАК СтабильныеКонецСезонностиТарифнаяЗона
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПериодыПоказаний КАК ПериодыПоказаний
	|		ПО (ВЫБОР
	|				КОГДА ТИПЗНАЧЕНИЯ(СтабильныеКонецСезонностиТарифнаяЗона.ДокРегистратор) = ТИП(Документ.энргНачислениеМКД)
	|					ТОГДА ПериодыПоказаний.ПризнакНачалаПериода
	|				КОГДА ТИПЗНАЧЕНИЯ(СтабильныеКонецСезонностиТарифнаяЗона.ДокРегистратор) = ТИП(Документ.энргВводНачальныхОстатковМКД)
	|					ТОГДА ПериодыПоказаний.ПризнакНачалаПериода
	|				КОГДА ТИПЗНАЧЕНИЯ(СтабильныеКонецСезонностиТарифнаяЗона.ДокРегистратор) = ТИП(Документ.энргОткрытиеМКД)
	|					ТОГДА СтабильныеКонецСезонностиТарифнаяЗона.ДокРегистратор = ПериодыПоказаний.ДокРегистратор
	|				КОГДА ТИПЗНАЧЕНИЯ(СтабильныеКонецСезонностиТарифнаяЗона.ДокРегистратор) = ТИП(Документ.энргОперацияСПриборомУчетаМКД)
	|					ТОГДА СтабильныеКонецСезонностиТарифнаяЗона.ДокРегистратор = ПериодыПоказаний.ДокРегистратор
	|				КОГДА ТИПЗНАЧЕНИЯ(СтабильныеКонецСезонностиТарифнаяЗона.ДокРегистратор) = ТИП(Документ.энргОперацияСУслугамиМКД)
	|					ТОГДА СтабильныеКонецСезонностиТарифнаяЗона.ДокРегистратор = ПериодыПоказаний.ДокРегистратор
	|				ИНАЧЕ СтабильныеКонецСезонностиТарифнаяЗона.ПериодРегистрации МЕЖДУ ПериодыПоказаний.НачалоПериодДействия И ПериодыПоказаний.ОкончаниеПериодаДействия
	|			КОНЕЦ)
	|			И СтабильныеКонецСезонностиТарифнаяЗона.Организация = ПериодыПоказаний.Организация
	|			И СтабильныеКонецСезонностиТарифнаяЗона.ПериодНачисления = ПериодыПоказаний.ПериодНачисления
	|			И СтабильныеКонецСезонностиТарифнаяЗона.Район = ПериодыПоказаний.Район
	|			И СтабильныеКонецСезонностиТарифнаяЗона.МКД = ПериодыПоказаний.МКД
	|			И СтабильныеКонецСезонностиТарифнаяЗона.ЧастьУзлаПриборУчета = ПериодыПоказаний.ПриборУчета
	|			И СтабильныеКонецСезонностиТарифнаяЗона.Шкала = ПериодыПоказаний.Шкала
	|			И СтабильныеКонецСезонностиТарифнаяЗона.ТарифнаяЗона = ПериодыПоказаний.ТарифнаяЗона
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СтабильныеПериодыПоказанияНачало.Организация КАК Организация,
	|	СтабильныеПериодыПоказанияНачало.ПериодНачисления КАК ПериодНачисления,
	|	СтабильныеПериодыПоказанияНачало.Район КАК Район,
	|	СтабильныеПериодыПоказанияНачало.МКД КАК МКД,
	|	СтабильныеПериодыПоказанияНачало.Услуга КАК Услуга,
	|	СтабильныеПериодыПоказанияНачало.ТочкаУчета КАК ТочкаУчета,
	|	СтабильныеПериодыПоказанияНачало.НомерПозиции КАК НомерПозиции,
	|	СтабильныеПериодыПоказанияНачало.Шкала КАК Шкала,
	|	СтабильныеПериодыПоказанияНачало.ПривязанаКШкале КАК ПривязанаКШкале,
	|	СтабильныеПериодыПоказанияНачало.ТарифнаяЗона КАК ТарифнаяЗона,
	|	ВЫБОР
	|		КОГДА СтабильныеПериодыПоказанияНачало.ПериодНачисления = &НачалоВеденияУчета
	|			ТОГДА ВЫБОР
	|					КОГДА СтабильныеПериодыПоказанияНачало.ПериодРегистрации < СтабильныеПериодыПоказанияНачало.ПериодНачисления
	|						ТОГДА СтабильныеПериодыПоказанияНачало.ПериодНачисления
	|					ИНАЧЕ СтабильныеПериодыПоказанияНачало.ПериодРегистрации
	|				КОНЕЦ
	|		ИНАЧЕ СтабильныеПериодыПоказанияНачало.ПериодРегистрации
	|	КОНЕЦ КАК НачалоПериода,
	|	ВЫБОР
	|		КОГДА СтабильныеПериодыПоказанияКонец.ПериодРегистрации ЕСТЬ NULL
	|			ТОГДА СтабильныеПериодыПоказанияНачало.ЗавершениеОП
	|		КОГДА СтабильныеПериодыПоказанияНачало.ПериодНачисления = &НачалоВеденияУчета
	|			ТОГДА ВЫБОР
	|					КОГДА СтабильныеПериодыПоказанияКонец.ПериодРегистрации < СтабильныеПериодыПоказанияНачало.ПериодНачисления
	|						ТОГДА СтабильныеПериодыПоказанияНачало.ПериодНачисления
	|					ИНАЧЕ СтабильныеПериодыПоказанияКонец.ПериодРегистрации
	|				КОНЕЦ
	|		ИНАЧЕ СтабильныеПериодыПоказанияКонец.ПериодРегистрации
	|	КОНЕЦ КАК КонецПериода,
	|	СтабильныеПериодыПоказанияНачало.Показания КАК НачальныеПоказания,
	|	ВЫБОР
	|		КОГДА СтабильныеПериодыПоказанияКонец.ЧастьУзлаПриборУчета ЕСТЬ NULL
	|			ТОГДА СтабильныеПериодыПоказанияНачало.Показания
	|		ИНАЧЕ ВЫБОР
	|				КОГДА СтабильныеПериодыПоказанияНачало.ЧастьУзлаПриборУчета = СтабильныеПериодыПоказанияКонец.ЧастьУзлаПриборУчета
	|					ТОГДА СтабильныеПериодыПоказанияКонец.Показания
	|				ИНАЧЕ СтабильныеПериодыПоказанияНачало.Показания
	|			КОНЕЦ
	|	КОНЕЦ КАК КонечныеПоказания,
	|	СтабильныеПериодыПоказанияНачало.КоэффициентСезоности КАК КоэффициентСезоности,
	|	СтабильныеПериодыПоказанияНачало.НачалоОП КАК НачалоОП,
	|	СтабильныеПериодыПоказанияНачало.ЗавершениеОП КАК ЗавершениеОП,
	|	СтабильныеПериодыПоказанияНачало.ДнейВПериоде КАК ДнейВПериоде,
	|	ЕСТЬNULL(СтабильныеПериодыПоказанияКонец.ДокРегистратор, НЕОПРЕДЕЛЕНО) КАК СледующийРегистратор,
	|	СтабильныеПериодыПоказанияНачало.МКДОткрыт КАК МКДОткрыт,
	|	СтабильныеПериодыПоказанияНачало.УслугаПодключена КАК УслугаПодключена,
	|	СтабильныеПериодыПоказанияНачало.ПриборВведен КАК ПриборВведен,
	|	СтабильныеПериодыПоказанияНачало.УзелПриборУчета КАК УзелПриборУчета,
	|	СтабильныеПериодыПоказанияНачало.КоэффициентПУ КАК КоэффициентПУ,
	|	СтабильныеПериодыПоказанияНачало.ВидБлагоустройства КАК ВидБлагоустройства,
	|	СтабильныеПериодыПоказанияНачало.ЗначениеПлощади КАК ЗначениеПлощади,
	|	СтабильныеПериодыПоказанияНачало.Поставщик КАК Поставщик,
	|	СтабильныеПериодыПоказанияНачало.ВидДифференцированности КАК ВидДифференцированности,
	|	СтабильныеПериодыПоказанияНачало.ФормулаРасчета КАК ФормулаРасчета,
	|	СтабильныеПериодыПоказанияНачало.РасчетПоФормуле КАК РасчетПоФормуле,
	|	СтабильныеПериодыПоказанияНачало.СоставнаяУслуга КАК СоставнаяУслуга,
	|	СтабильныеПериодыПоказанияНачало.КлючНорматива КАК КлючНорматива,
	|	СтабильныеПериодыПоказанияНачало.НеРаспределятьНаАбонентов КАК НеРаспределятьНаАбонентов,
	|	СтабильныеПериодыПоказанияНачало.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	СтабильныеПериодыПоказанияНачало.ОбъемЗаПрошлыйГод КАК ОбъемЗаПрошлыйГод,
	|	СтабильныеПериодыПоказанияНачало.ТипСхемы КАК ТипСхемы,
	|	СтабильныеПериодыПоказанияНачало.ВидТепловогоПункта КАК ВидТепловогоПункта,
	|	СтабильныеПериодыПоказанияНачало.КоэффициентНорматива КАК КоэффициентНорматива,
	|	СтабильныеПериодыПоказанияНачало.ЧастьУзлаПриборУчета КАК ЧастьУзлаПриборУчета,
	|	СтабильныеПериодыПоказанияНачало.ЧастьУзлаПриборВведен КАК ЧастьУзлаПриборВведен,
	|	СтабильныеПериодыПоказанияНачало.РаспределятьНаТочку КАК РаспределятьНаТочку
	|ПОМЕСТИТЬ Периоды
	|ИЗ
	|	СтабильныеПериодыПоказания КАК СтабильныеПериодыПоказанияНачало
	|		ЛЕВОЕ СОЕДИНЕНИЕ СтабильныеПериодыПоказания КАК СтабильныеПериодыПоказанияКонец
	|		ПО СтабильныеПериодыПоказанияНачало.Организация = СтабильныеПериодыПоказанияКонец.Организация
	|			И (СтабильныеПериодыПоказанияНачало.НомерПозиции = СтабильныеПериодыПоказанияКонец.НомерПозиции - 1)
	|			И СтабильныеПериодыПоказанияНачало.ПериодНачисления = СтабильныеПериодыПоказанияКонец.ПериодНачисления
	|			И СтабильныеПериодыПоказанияНачало.Район = СтабильныеПериодыПоказанияКонец.Район
	|			И СтабильныеПериодыПоказанияНачало.МКД = СтабильныеПериодыПоказанияКонец.МКД
	|			И СтабильныеПериодыПоказанияНачало.ТочкаУчета = СтабильныеПериодыПоказанияКонец.ТочкаУчета
	|			И СтабильныеПериодыПоказанияНачало.Услуга = СтабильныеПериодыПоказанияКонец.Услуга";
	
	Возврат Текст;
	
КонецФункции

Функция ТекстЗапросаПолучитьДанныеДляРасчетаМКД(ИмяДокумента)	
	Текст  = 
	"ВЫБРАТЬ
	|	Периоды.НачалоПериода КАК НачалоПериода,
	|	Периоды.КонецПериода КАК КонецПериода,
	|	Периоды.Организация КАК Организация,
	|	Периоды.ПериодНачисления КАК ПериодНачисления,
	|	Периоды.Район КАК Район,
	|	Периоды.МКД КАК МКД,
	|	Периоды.Услуга КАК Услуга,
	|	Периоды.ТочкаУчета КАК ТочкаУчета,
	|	Периоды.ТарифнаяЗона КАК ТарифнаяЗона,
	|	Периоды.Шкала КАК Шкала,
	|	Периоды.ПривязанаКШкале КАК ПривязанаКШкале,
	|	Периоды.НачальныеПоказания КАК НачПок,
	|	ЕСТЬNULL(СреднееПотребление.СреднийОбъем, -1) КАК СреднийОбъем,
	|	ВЫБОР
	|		КОГДА Периоды.КонецПериода = Периоды.ЗавершениеОП
	|			ТОГДА ЕСТЬNULL(МаксимальныеПоказания.Показания, 0)
	|		ИНАЧЕ Периоды.КонечныеПоказания
	|	КОНЕЦ КАК КонПок,
	|	МАКСИМУМ(ВЫБОР
	|			КОГДА ПредоставленныеПоказания.МКД ЕСТЬ NULL
	|				ТОГДА ЛОЖЬ
	|			ИНАЧЕ ПредоставленныеПоказания.ВСрок
	|		КОНЕЦ) КАК ПоказанияВСрок,
	|	МАКСИМУМ(ВЫБОР
	|			КОГДА ДанныеВыводаПрибораУчета.ПериодНачисления ЕСТЬ NULL
	|				ТОГДА ЛОЖЬ
	|			ИНАЧЕ ИСТИНА
	|		КОНЕЦ) КАК ВыводПрибораУчета,
	|	МАКСИМУМ(ВЫБОР
	|			КОГДА ПредоставленныеПоказания.ПериодНачисления ЕСТЬ NULL
	|				ТОГДА ЛОЖЬ
	|			ИНАЧЕ ИСТИНА
	|		КОНЕЦ) КАК ПоказанияПредоставлены,
	|	МАКСИМУМ(ЕСТЬNULL(ТаблицаДокумента.Ссылка, ЗНАЧЕНИЕ(Документ.энргНачислениеМКД.ПустаяСсылка))) КАК ДокументНачисления,
	|	МАКСИМУМ(ЕСТЬNULL(ТаблицаДокумента.ПометкаУдаления, ЛОЖЬ)) КАК ДокументНачисленияПометкаУдаления,
	|	энргПриборыУчетаАбонента.МаксимальноВозможныеПоказания КАК МаксимальноВозможныеПоказания,
	|	Периоды.КоэффициентСезоности КАК КоэффициентСезоности,
	|	ЕСТЬNULL(энргВидыУслуг.ВидПлощадиМКД, ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)) КАК ВидПлощади,
	|	МАКСИМУМ(ЕСТЬNULL(ПредоставленныеПоказанияПоМКД.ПоказанияТекущегоПериода, ЛОЖЬ)) КАК ЕстьПоказанияМКД,
	|	Периоды.МКДОткрыт КАК МКДОткрыт,
	|	Периоды.УслугаПодключена КАК УслугаПодключена,
	|	Периоды.ПриборВведен КАК ПриборВведен,
	|	Периоды.УзелПриборУчета КАК УзелПриборУчета,
	|	Периоды.КоэффициентПУ КАК КоэффициентПУ,
	|	Периоды.ВидБлагоустройства КАК ВидБлагоустройства,
	|	Периоды.ЗначениеПлощади КАК ЗначениеПлощади,
	|	Периоды.Поставщик КАК Поставщик,
	|	Периоды.ВидДифференцированности КАК ВидДифференцированности,
	|	Периоды.ДнейВПериоде КАК ДнейВПериоде,
	|	Периоды.РасчетПоФормуле КАК РасчетПоФормуле,
	|	ВЫРАЗИТЬ(Периоды.ФормулаРасчета КАК СТРОКА(1000)) КАК ФормулаРасчета,
	|	Периоды.СоставнаяУслуга КАК СоставнаяУслуга,
	|	Периоды.КлючНорматива КАК КлючНорматива,
	|	Периоды.НеРаспределятьНаАбонентов КАК НеРаспределятьНаАбонентов,
	|	Периоды.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	Периоды.ОбъемЗаПрошлыйГод КАК ОбъемЗаПрошлыйГод,
	|	Периоды.ТипСхемы КАК ТипСхемы,
	|	Периоды.ВидТепловогоПункта КАК ВидТепловогоПункта,
	|	ЕСТЬNULL(энргВидыУслуг.ЗависитОтУслуги, ЗНАЧЕНИЕ(Справочник.энргВидыУслуг.ПустаяСсылка)) КАК ЗависитОтУслуги,
	|	ВЫБОР
	|		КОГДА МКДНеНачислятьТЭ.НеНачислять
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ЗакрытаяСхемаГВС,
	|	энргВидыУслуг.ИспользоватьКоэффициентСдерживанияРостаПлаты КАК ИспользоватьКоэффициентСдерживанияРостаПлаты,
	|	ЕСТЬNULL(ЗначенияПлощадейСтроений.ПлощадьМОП, 0) КАК ПлощадьМОП,
	|	ЕСТЬNULL(ЗначенияПлощадейСтроений.ПлощадьАбонентов, 0) КАК ПлощадьАбонентов,
	|	ЕСТЬNULL(ЗначенияПлощадейСтроений.ПлощадьСобственнаяПоставка, 0) КАК ПлощадьСобственнаяПоставка,
	|	Периоды.КоэффициентНорматива КАК КоэффициентНорматива,
	|	Периоды.ЧастьУзлаПриборУчета КАК ЧастьУзлаПриборУчета,
	|	Периоды.ЧастьУзлаПриборВведен КАК ЧастьУзлаПриборВведен,
	|	Периоды.ЗавершениеОП КАК ЗавершениеОП,
	|	ЕСТЬNULL(энргПриборыУчетаАбонента.РегистрируетОбъем, ЛОЖЬ) КАК РегистрируетОбъем,
	|	Периоды.РаспределятьНаТочку КАК РаспределятьНаТочку
	|ПОМЕСТИТЬ ДанныеДляРасчетаПередНормой
	|ИЗ
	|	Периоды КАК Периоды
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПредоставленныеПоказания КАК ПредоставленныеПоказания
	|		ПО Периоды.Организация = ПредоставленныеПоказания.Организация
	|			И Периоды.ПериодНачисления = ПредоставленныеПоказания.ПериодНачисления
	|			И Периоды.Район = ПредоставленныеПоказания.Район
	|			И Периоды.МКД = ПредоставленныеПоказания.МКД
	|			И Периоды.ЧастьУзлаПриборУчета = ПредоставленныеПоказания.ПриборУчета
	|			И Периоды.Шкала = ПредоставленныеПоказания.Шкала
	|			И Периоды.ТарифнаяЗона = ПредоставленныеПоказания.ТарифнаяЗона
	|		ЛЕВОЕ СОЕДИНЕНИЕ МаксимальныеПоказания КАК МаксимальныеПоказания
	|		ПО Периоды.Организация = МаксимальныеПоказания.Организация
	|			И Периоды.ПериодНачисления = МаксимальныеПоказания.ПериодНачисления
	|			И Периоды.Район = МаксимальныеПоказания.Район
	|			И Периоды.МКД = МаксимальныеПоказания.МКД
	|			И Периоды.ЧастьУзлаПриборУчета = МаксимальныеПоказания.ПриборУчета
	|			И Периоды.Шкала = МаксимальныеПоказания.Шкала
	|			И Периоды.ТарифнаяЗона = МаксимальныеПоказания.ТарифнаяЗона
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.энргНачислениеМКД КАК ТаблицаДокумента
	|		ПО (ТаблицаДокумента.Дата МЕЖДУ НАЧАЛОПЕРИОДА(Периоды.ПериодНачисления, МЕСЯЦ) И КОНЕЦПЕРИОДА(Периоды.ПериодНачисления, МЕСЯЦ))
	|			И Периоды.Организация = ТаблицаДокумента.Организация
	|			И Периоды.Район = ТаблицаДокумента.Район
	|		ЛЕВОЕ СОЕДИНЕНИЕ СреднееПотреблениеМКД КАК СреднееПотребление
	|		ПО Периоды.Организация = СреднееПотребление.Организация
	|			И Периоды.ПериодНачисления = СреднееПотребление.ПериодНачисления
	|			И Периоды.Район = СреднееПотребление.Район
	|			И Периоды.МКД = СреднееПотребление.МКД
	|			И Периоды.Услуга = СреднееПотребление.Услуга
	|			И Периоды.ТочкаУчета = СреднееПотребление.ТочкаУчета
	|			И Периоды.Шкала = СреднееПотребление.Шкала
	|			И Периоды.ТарифнаяЗона = СреднееПотребление.ТарифнаяЗона
	|		ЛЕВОЕ СОЕДИНЕНИЕ ДанныеВыводаПрибораУчета КАК ДанныеВыводаПрибораУчета
	|		ПО Периоды.Организация = ДанныеВыводаПрибораУчета.Организация
	|			И Периоды.ПериодНачисления = ДанныеВыводаПрибораУчета.ПериодНачисления
	|			И Периоды.Район = ДанныеВыводаПрибораУчета.Район
	|			И Периоды.МКД = ДанныеВыводаПрибораУчета.МКД
	|			И Периоды.ТочкаУчета = ДанныеВыводаПрибораУчета.ТочкаУчета
	|			И Периоды.ЧастьУзлаПриборУчета = ДанныеВыводаПрибораУчета.ПриборУчета
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.энргПриборыУчетаАбонента КАК энргПриборыУчетаАбонента
	|		ПО Периоды.ЧастьУзлаПриборУчета = энргПриборыУчетаАбонента.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.энргВидыУслуг КАК энргВидыУслуг
	|		ПО Периоды.Услуга = энргВидыУслуг.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПредоставленныеПоказанияПоМКД КАК ПредоставленныеПоказанияПоМКД
	|		ПО Периоды.Организация = ПредоставленныеПоказанияПоМКД.Организация
	|			И Периоды.ПериодНачисления = ПредоставленныеПоказанияПоМКД.ПериодНачисления
	|			И Периоды.Район = ПредоставленныеПоказанияПоМКД.Район
	|			И Периоды.МКД = ПредоставленныеПоказанияПоМКД.МКД
	|		ЛЕВОЕ СОЕДИНЕНИЕ МКДНеНачислятьТЭ КАК МКДНеНачислятьТЭ
	|		ПО Периоды.Организация = МКДНеНачислятьТЭ.Организация
	|			И Периоды.Район = МКДНеНачислятьТЭ.Район
	|			И Периоды.Услуга = МКДНеНачислятьТЭ.Услуга
	|			И Периоды.ТипСхемы = МКДНеНачислятьТЭ.ТипСхемы
	|			И Периоды.ВидТепловогоПункта = МКДНеНачислятьТЭ.ПринадлежностьКТепловомуПункту
	|			И (ВЫБОР
	|				КОГДА МКДНеНачислятьТЭ.МКД <> ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка)
	|					ТОГДА Периоды.МКД = МКДНеНачислятьТЭ.МКД
	|				ИНАЧЕ ИСТИНА
	|			КОНЕЦ)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ЗначенияПлощадейСтроений КАК ЗначенияПлощадейСтроений
	|		ПО Периоды.Организация = ЗначенияПлощадейСтроений.Организация
	|			И Периоды.ПериодНачисления = ЗначенияПлощадейСтроений.ПериодНачисления
	|			И Периоды.Район = ЗначенияПлощадейСтроений.Район
	|			И Периоды.Услуга = ЗначенияПлощадейСтроений.Услуга
	|			И Периоды.МКД = ЗначенияПлощадейСтроений.МКД
	|ГДЕ
	|	Периоды.МКДОткрыт
	|	И Периоды.УслугаПодключена
	|
	|СГРУППИРОВАТЬ ПО
	|	Периоды.Организация,
	|	Периоды.ПериодНачисления,
	|	Периоды.МКД,
	|	Периоды.Шкала,
	|	Периоды.ПривязанаКШкале,
	|	Периоды.ТарифнаяЗона,
	|	Периоды.КонецПериода,
	|	Периоды.НачалоПериода,
	|	Периоды.Район,
	|	Периоды.ТочкаУчета,
	|	Периоды.НачальныеПоказания,
	|	ЕСТЬNULL(СреднееПотребление.СреднийОбъем, -1),
	|	энргПриборыУчетаАбонента.МаксимальноВозможныеПоказания,
	|	Периоды.Услуга,
	|	ВЫБОР
	|		КОГДА Периоды.КонецПериода = Периоды.ЗавершениеОП
	|			ТОГДА ЕСТЬNULL(МаксимальныеПоказания.Показания, 0)
	|		ИНАЧЕ Периоды.КонечныеПоказания
	|	КОНЕЦ,
	|	Периоды.КоэффициентСезоности,
	|	ЕСТЬNULL(энргВидыУслуг.ВидПлощадиМКД, ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)),
	|	Периоды.ДнейВПериоде,
	|	Периоды.МКДОткрыт,
	|	Периоды.УслугаПодключена,
	|	Периоды.ПриборВведен,
	|	Периоды.УзелПриборУчета,
	|	Периоды.КоэффициентПУ,
	|	Периоды.ВидБлагоустройства,
	|	Периоды.ЗначениеПлощади,
	|	Периоды.Поставщик,
	|	Периоды.ВидДифференцированности,
	|	Периоды.РасчетПоФормуле,
	|	ВЫРАЗИТЬ(Периоды.ФормулаРасчета КАК СТРОКА(1000)),
	|	Периоды.СоставнаяУслуга,
	|	Периоды.КлючНорматива,
	|	Периоды.НеРаспределятьНаАбонентов,
	|	Периоды.НеПрименятьСезонность,
	|	Периоды.ОбъемЗаПрошлыйГод,
	|	Периоды.ТипСхемы,
	|	Периоды.ВидТепловогоПункта,
	|	ЕСТЬNULL(энргВидыУслуг.ЗависитОтУслуги, ЗНАЧЕНИЕ(Справочник.энргВидыУслуг.ПустаяСсылка)),
	|	ВЫБОР
	|		КОГДА МКДНеНачислятьТЭ.НеНачислять
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ,
	|	энргВидыУслуг.ИспользоватьКоэффициентСдерживанияРостаПлаты,
	|	ЕСТЬNULL(ЗначенияПлощадейСтроений.ПлощадьМОП, 0),
	|	ЕСТЬNULL(ЗначенияПлощадейСтроений.ПлощадьАбонентов, 0),
	|	ЕСТЬNULL(ЗначенияПлощадейСтроений.ПлощадьСобственнаяПоставка, 0),
	|	Периоды.КоэффициентНорматива,
	|	Периоды.ЧастьУзлаПриборУчета,
	|	Периоды.ЧастьУзлаПриборВведен,
	|	Периоды.ЗавершениеОП,
	|	энргПриборыУчетаАбонента.РегистрируетОбъем,
	|	Периоды.РаспределятьНаТочку";
	
	Возврат Текст;
	
КонецФункции

Функция ТекстЗапросаРассчитатьОбъемПотребленияМКД()
	Текст  =  
	"ВЫБРАТЬ
	|	ДанныеДляРасчетаПередНормой.Организация КАК Организация,
	|	ДанныеДляРасчетаПередНормой.ПериодНачисления КАК ПериодНачисления,
	|	ДанныеДляРасчетаПередНормой.Район КАК Район,
	|	ДанныеДляРасчетаПередНормой.МКД КАК МКД,
	|	ДанныеДляРасчетаПередНормой.Услуга КАК Услуга,
	|	МИНИМУМ(ВЫБОР
	|			КОГДА НЕ ДанныеДляРасчетаПередНормой.ПриборВведен
	|					ИЛИ НЕ ДанныеДляРасчетаПередНормой.ПоказанияВСрок
	|				ТОГДА 1
	|			ИНАЧЕ 2
	|		КОНЕЦ) КАК Приоритет,
	|	МИНИМУМ(ВЫБОР
	|			КОГДА ДанныеДляРасчетаПередНормой.СреднийОбъем >= 0
	|				ТОГДА ИСТИНА
	|			ИНАЧЕ ЛОЖЬ
	|		КОНЕЦ) КАК ЕстьСреднийПоВсемТочкамУслуги,
	|	МИНИМУМ(ДанныеДляРасчетаПередНормой.ПриборВведен) КАК ПриборВведен,
	|	МИНИМУМ(ДанныеДляРасчетаПередНормой.ПоказанияВСрок) КАК ПоказанияВСрок,
	|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ДанныеДляРасчетаПередНормой.ТочкаУчета) КАК КоличествоТочекУчета
	|ПОМЕСТИТЬ ПриоритетНормы
	|ИЗ
	|	ДанныеДляРасчетаПередНормой КАК ДанныеДляРасчетаПередНормой
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеДляРасчетаПередНормой.Организация,
	|	ДанныеДляРасчетаПередНормой.ПериодНачисления,
	|	ДанныеДляРасчетаПередНормой.Район,
	|	ДанныеДляРасчетаПередНормой.МКД,
	|	ДанныеДляРасчетаПередНормой.Услуга
	|
	|ИМЕЮЩИЕ
	|	(МИНИМУМ(ДанныеДляРасчетаПередНормой.ПриборВведен) = ЛОЖЬ
	|		ИЛИ МИНИМУМ(ДанныеДляРасчетаПередНормой.ПоказанияВСрок) = ЛОЖЬ
	|		ИЛИ МИНИМУМ(ДанныеДляРасчетаПередНормой.ОбъемЗаПрошлыйГод) = ИСТИНА)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеДляРасчетаПередНормой.Организация КАК Организация,
	|	ДанныеДляРасчетаПередНормой.ПериодНачисления КАК ПериодНачисления,
	|	ДанныеДляРасчетаПередНормой.Район КАК Район,
	|	ДанныеДляРасчетаПередНормой.МКД КАК МКД,
	|	ДанныеДляРасчетаПередНормой.Услуга КАК Услуга,
	|	МИНИМУМ(ДанныеДляРасчетаПередНормой.ТочкаУчета) КАК ТочкаУчета
	|ПОМЕСТИТЬ ТочкиНачисленияНормы
	|ИЗ
	|	ДанныеДляРасчетаПередНормой КАК ДанныеДляРасчетаПередНормой
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПриоритетНормы КАК ПриоритетНормы
	|		ПО ДанныеДляРасчетаПередНормой.Организация = ПриоритетНормы.Организация
	|			И ДанныеДляРасчетаПередНормой.ПериодНачисления = ПриоритетНормы.ПериодНачисления
	|			И ДанныеДляРасчетаПередНормой.Район = ПриоритетНормы.Район
	|			И ДанныеДляРасчетаПередНормой.МКД = ПриоритетНормы.МКД
	|			И ДанныеДляРасчетаПередНормой.Услуга = ПриоритетНормы.Услуга
	|			И (ВЫБОР
	|				КОГДА ПриоритетНормы.Приоритет = 1
	|					ТОГДА НЕ ДанныеДляРасчетаПередНормой.ПриборВведен
	|							ИЛИ НЕ ДанныеДляРасчетаПередНормой.ПоказанияВСрок
	|				ИНАЧЕ ИСТИНА
	|			КОНЕЦ)
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеДляРасчетаПередНормой.Организация,
	|	ДанныеДляРасчетаПередНормой.ПериодНачисления,
	|	ДанныеДляРасчетаПередНормой.Район,
	|	ДанныеДляРасчетаПередНормой.МКД,
	|	ДанныеДляРасчетаПередНормой.Услуга
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеДляРасчетаПередНормой.НачалоПериода КАК НачалоПериода,
	|	ДанныеДляРасчетаПередНормой.КонецПериода КАК КонецПериода,
	|	ДанныеДляРасчетаПередНормой.Организация КАК Организация,
	|	ДанныеДляРасчетаПередНормой.ПериодНачисления КАК ПериодНачисления,
	|	ДанныеДляРасчетаПередНормой.Район КАК Район,
	|	ДанныеДляРасчетаПередНормой.МКД КАК МКД,
	|	ДанныеДляРасчетаПередНормой.Услуга КАК Услуга,
	|	ДанныеДляРасчетаПередНормой.ТочкаУчета КАК ТочкаУчета,
	|	ДанныеДляРасчетаПередНормой.УслугаПодключена КАК УслугаПодключена,
	|	ДанныеДляРасчетаПередНормой.УзелПриборУчета КАК УзелПриборУчета,
	|	ДанныеДляРасчетаПередНормой.Шкала КАК Шкала,
	|	ДанныеДляРасчетаПередНормой.ПривязанаКШкале КАК ПривязанаКШкале,
	|	ДанныеДляРасчетаПередНормой.ТарифнаяЗона КАК ТарифнаяЗона,
	|	ДанныеДляРасчетаПередНормой.МКДОткрыт КАК МКДОткрыт,
	|	ДанныеДляРасчетаПередНормой.ПриборВведен КАК ПриборВведен,
	|	ДанныеДляРасчетаПередНормой.НачПок КАК НачПок,
	|	ЕСТЬNULL(ЗначенияТекущихНормПотребления.ЗначениеНорматива, 0) КАК НормаПотребления,
	|	ДанныеДляРасчетаПередНормой.СреднийОбъем КАК СреднийОбъем,
	|	ДанныеДляРасчетаПередНормой.КонПок КАК КонПок,
	|	ДанныеДляРасчетаПередНормой.ПоказанияВСрок КАК ПоказанияВСрок,
	|	ДанныеДляРасчетаПередНормой.ВыводПрибораУчета КАК ВыводПрибораУчета,
	|	ДанныеДляРасчетаПередНормой.ПоказанияПредоставлены КАК ДанныеДляРасчетаПЕредНормой,
	|	ДанныеДляРасчетаПередНормой.ДокументНачисления КАК ДокументНачисления,
	|	ДанныеДляРасчетаПередНормой.ДокументНачисленияПометкаУдаления КАК ДокументНачисленияПометкаУдаления,
	|	ДанныеДляРасчетаПередНормой.КоэффициентПУ КАК КоэффициентПУ,
	|	ДанныеДляРасчетаПередНормой.ЗначениеПлощади КАК ЗначениеПлощади,
	|	ДанныеДляРасчетаПередНормой.МаксимальноВозможныеПоказания КАК МаксимальноВозможныеПоказания,
	|	ДанныеДляРасчетаПередНормой.Поставщик КАК Поставщик,
	|	ДанныеДляРасчетаПередНормой.НеРаспределятьНаАбонентов КАК НеРаспределятьНаАбонентов,
	|	ДанныеДляРасчетаПередНормой.ВидПлощади КАК ВидПлощади,
	|	ДанныеДляРасчетаПередНормой.ЕстьПоказанияМКД КАК ЕстьПоказанияМКД,
	|	ВЫБОР
	|		КОГДА НЕ ТочкиНачисленияНормы.ПериодНачисления ЕСТЬ NULL
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК НачислятьНорму,
	|	ДанныеДляРасчетаПередНормой.ДнейВПериоде КАК ДнейВПериоде,
	|	ДанныеДляРасчетаПередНормой.ФормулаРасчета КАК ФормулаРасчета,
	|	ДанныеДляРасчетаПередНормой.РасчетПоФормуле КАК РасчетПоФормуле,
	|	ДанныеДляРасчетаПередНормой.СоставнаяУслуга КАК СоставнаяУслуга,
	|	ДанныеДляРасчетаПередНормой.ПоказанияПредоставлены КАК ПоказанияПредоставлены,
	|	ДанныеДляРасчетаПередНормой.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	ДанныеДляРасчетаПередНормой.ОбъемЗаПрошлыйГод КАК ОбъемЗаПрошлыйГод,
	|	ДанныеДляРасчетаПередНормой.ЗакрытаяСхемаГВС КАК ЗакрытаяСхемаГВС,
	|	ДанныеДляРасчетаПередНормой.ЗависитОтУслуги КАК ЗависитОтУслуги,
	|	ДанныеДляРасчетаПередНормой.ВидБлагоустройства КАК ВидБлагоустройства,
	|	ДанныеДляРасчетаПередНормой.ИспользоватьКоэффициентСдерживанияРостаПлаты КАК ИспользоватьКоэффициентСдерживанияРостаПлаты,
	|	ДанныеДляРасчетаПередНормой.ПлощадьМОП КАК ПлощадьМОП,
	|	ДанныеДляРасчетаПередНормой.ПлощадьАбонентов КАК ПлощадьАбонентов,
	|	ДанныеДляРасчетаПередНормой.ПлощадьСобственнаяПоставка КАК ПлощадьСобственнаяПоставка,
	|	ЕСТЬNULL(ЗначенияТекущихНормПотребления.ЗначениеНорматива, 0) * ВЫБОР
	|		КОГДА НЕ ДанныеДляРасчетаПередНормой.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|			ТОГДА ДанныеДляРасчетаПередНормой.ЗначениеПлощади
	|		ИНАЧЕ 1
	|	КОНЕЦ * ВЫБОР
	|		КОГДА ДанныеДляРасчетаПередНормой.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|			ТОГДА ВЫБОР
	|					КОГДА ДанныеДляРасчетаПередНормой.ПлощадьАбонентов - ДанныеДляРасчетаПередНормой.ПлощадьСобственнаяПоставка + ДанныеДляРасчетаПередНормой.ПлощадьМОП = 0
	|						ТОГДА 0
	|					ИНАЧЕ (ДанныеДляРасчетаПередНормой.ПлощадьАбонентов - ДанныеДляРасчетаПередНормой.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчетаПередНормой.ПлощадьАбонентов - ДанныеДляРасчетаПередНормой.ПлощадьСобственнаяПоставка + ДанныеДляРасчетаПередНормой.ПлощадьМОП)
	|				КОНЕЦ
	|		ИНАЧЕ 1
	|	КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчетаПередНормой.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчетаПередНормой.КонецПериода, ДЕНЬ), ДЕНЬ) / ДанныеДляРасчетаПередНормой.ДнейВПериоде) КАК ОбъемПоНорме,
	|	ДанныеДляРасчетаПередНормой.КоэффициентНорматива КАК КоэффициентНорматива,
	|	ДанныеДляРасчетаПередНормой.КоэффициентСезоности КАК КоэффициентСезоности,
	|	ДанныеДляРасчетаПередНормой.ЧастьУзлаПриборУчета КАК ЧастьУзлаПриборУчета,
	|	ДанныеДляРасчетаПередНормой.ЧастьУзлаПриборВведен КАК ЧастьУзлаПриборВведен,
	|	ДанныеДляРасчетаПередНормой.ЗавершениеОП КАК ЗавершениеОП,
	|	ДанныеДляРасчетаПередНормой.РегистрируетОбъем КАК РегистрируетОбъем,
	|	ДанныеДляРасчетаПередНормой.РаспределятьНаТочку КАК РаспределятьНаТочку
	|ПОМЕСТИТЬ ДанныеДляРасчета
	|ИЗ
	|	ДанныеДляРасчетаПередНормой КАК ДанныеДляРасчетаПередНормой
	|		ЛЕВОЕ СОЕДИНЕНИЕ ТочкиНачисленияНормы КАК ТочкиНачисленияНормы
	|		ПО ДанныеДляРасчетаПередНормой.Организация = ТочкиНачисленияНормы.Организация
	|			И ДанныеДляРасчетаПередНормой.ПериодНачисления = ТочкиНачисленияНормы.ПериодНачисления
	|			И ДанныеДляРасчетаПередНормой.Район = ТочкиНачисленияНормы.Район
	|			И ДанныеДляРасчетаПередНормой.МКД = ТочкиНачисленияНормы.МКД
	|			И ДанныеДляРасчетаПередНормой.Услуга = ТочкиНачисленияНормы.Услуга
	|			И ДанныеДляРасчетаПередНормой.ТочкаУчета = ТочкиНачисленияНормы.ТочкаУчета
	|		ЛЕВОЕ СОЕДИНЕНИЕ ЗначенияТекущихНормПотребления КАК ЗначенияТекущихНормПотребления
	|		ПО ДанныеДляРасчетаПередНормой.Организация = ЗначенияТекущихНормПотребления.Организация
	|			И ДанныеДляРасчетаПередНормой.Район = ЗначенияТекущихНормПотребления.Район
	|			И ДанныеДляРасчетаПередНормой.ПериодНачисления = ЗначенияТекущихНормПотребления.ПериодНачисления
	|			И ДанныеДляРасчетаПередНормой.Услуга = ЗначенияТекущихНормПотребления.Услуга
	|			И ДанныеДляРасчетаПередНормой.КлючНорматива = ЗначенияТекущихНормПотребления.КлючНорматива
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеДляРасчета.Организация КАК Организация,
	|	ДанныеДляРасчета.ПериодНачисления КАК ПериодНачисления,
	|	ДанныеДляРасчета.НачалоПериода КАК НачалоПериода,
	|	ДанныеДляРасчета.КонецПериода КАК КонецПериода,
	|	ДанныеДляРасчета.Район КАК Район,
	|	ДанныеДляРасчета.МКД КАК МКД,
	|	ДанныеДляРасчета.Услуга КАК Услуга,
	|	ДанныеДляРасчета.ТочкаУчета КАК ТочкаУчета,
	|	ДанныеДляРасчета.УзелПриборУчета КАК УзелПриборУчета,
	|	ДанныеДляРасчета.ЧастьУзлаПриборУчета КАК ЧастьУзлаПриборУчета,
	|	ДанныеДляРасчета.Шкала КАК Шкала,
	|	ДанныеДляРасчета.ТарифнаяЗона КАК ТарифнаяЗона,
	|	ДанныеДляРасчета.ПриборВведен КАК ПриборВведен,
	|	ДанныеДляРасчета.ЧастьУзлаПриборВведен КАК ЧастьУзлаПриборВведен,
	|	ВЫРАЗИТЬ(ВЫБОР
	|			КОГДА ДанныеДляРасчета.РегистрируетОбъем
	|					И НЕ ДанныеДляРасчета.КонПок = ДанныеДляРасчета.НачПок
	|				ТОГДА ДанныеДляРасчета.КонПок
	|			КОГДА ДанныеДляРасчета.РегистрируетОбъем
	|				ТОГДА 0
	|			КОГДА ДанныеДляРасчета.КонПок < ДанныеДляРасчета.НачПок
	|				ТОГДА ДанныеДляРасчета.МаксимальноВозможныеПоказания - ДанныеДляРасчета.НачПок + ДанныеДляРасчета.КонПок
	|			ИНАЧЕ ДанныеДляРасчета.КонПок - ДанныеДляРасчета.НачПок
	|		КОНЕЦ * ДанныеДляРасчета.КоэффициентПУ КАК ЧИСЛО(15, 6)) КАК ОбъемУслугиПотребленный,
	|	ВЫРАЗИТЬ(ВЫБОР
	|			КОГДА ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|				ТОГДА 0
	|			КОГДА ДанныеДляРасчета.РегистрируетОбъем
	|					И НЕ ДанныеДляРасчета.КонПок = ДанныеДляРасчета.НачПок
	|				ТОГДА ДанныеДляРасчета.КонПок
	|			КОГДА ДанныеДляРасчета.РегистрируетОбъем
	|				ТОГДА 0
	|			КОГДА ДанныеДляРасчета.КонПок < ДанныеДляРасчета.НачПок
	|				ТОГДА ДанныеДляРасчета.МаксимальноВозможныеПоказания - ДанныеДляРасчета.НачПок + ДанныеДляРасчета.КонПок
	|			ИНАЧЕ ДанныеДляРасчета.КонПок - ДанныеДляРасчета.НачПок
	|		КОНЕЦ * ДанныеДляРасчета.КоэффициентПУ КАК ЧИСЛО(15, 6)) КАК ОбъемУслуги,
	|	ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.ПоПриборам) КАК СпособНачисления,
	|	ДанныеДляРасчета.ДокументНачисления КАК ДокументНачисления,
	|	ДанныеДляРасчета.ДокументНачисленияПометкаУдаления КАК ДокументНачисленияПометкаУдаления,
	|	ДанныеДляРасчета.Поставщик КАК Поставщик,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.РегистрируетОбъем
	|			ТОГДА 0
	|		ИНАЧЕ ДанныеДляРасчета.НачПок
	|	КОНЕЦ КАК НачальныеПоказания,
	|	ДанныеДляРасчета.КонПок КАК КонечныеПоказания,
	|	ДанныеДляРасчета.ЗначениеПлощади КАК ЗначениеПлощади,
	|	ДанныеДляРасчета.НормаПотребления * ДанныеДляРасчета.КоэффициентНорматива КАК НормаПотребления,
	|	ДанныеДляРасчета.ВидПлощади КАК ВидПлощади,
	|	ДанныеДляРасчета.ПоказанияВСрок КАК ПоказанияВСрок,
	|	ДанныеДляРасчета.ФормулаРасчета КАК ФормулаРасчета,
	|	ДанныеДляРасчета.РасчетПоФормуле КАК РасчетПоФормуле,
	|	ДанныеДляРасчета.СоставнаяУслуга КАК СоставнаяУслуга,
	|	ДанныеДляРасчета.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	ДанныеДляРасчета.ОбъемЗаПрошлыйГод КАК ОбъемЗаПрошлыйГод,
	|	ДанныеДляРасчета.ЗависитОтУслуги КАК ЗависитОтУслуги,
	|	ДанныеДляРасчета.ПривязанаКШкале КАК ПривязанаКШкале,
	|	ДанныеДляРасчета.ВидБлагоустройства КАК ВидБлагоустройства,
	|	ДанныеДляРасчета.НеРаспределятьНаАбонентов КАК НеРаспределятьНаАбонентов,
	|	ДанныеДляРасчета.ЗакрытаяСхемаГВС КАК ЗакрытаяСхемаГВС,
	|	НЕ ДанныеДляРасчета.ОбъемЗаПрошлыйГод КАК СниматьНачисленныйСредний,
	|	ДанныеДляРасчета.ПлощадьМОП КАК ПлощадьМОП,
	|	ДанныеДляРасчета.ПлощадьАбонентов КАК ПлощадьАбонентов,
	|	ДанныеДляРасчета.ПлощадьСобственнаяПоставка КАК ПлощадьСобственнаяПоставка,
	|	ДанныеДляРасчета.ОбъемПоНорме КАК ОбъемУслугиНорматив,
	|	ДанныеДляРасчета.КоэффициентНорматива КАК КоэффициентНорматива,
	|	ДанныеДляРасчета.КоэффициентСезоности КАК КоэффициентСезоности,
	|	ДанныеДляРасчета.ЗавершениеОП КАК ЗавершениеОП,
	|	ДанныеДляРасчета.УзелПриборУчета КАК ПриборУчета,
	|	1 КАК ПоказанияПредоставленыПотребленный,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|				И ДанныеДляРасчета.СреднийОбъем >= 0
	|			ТОГДА 1
	|		КОГДА НЕ ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|			ТОГДА ВЫБОР
	|					КОГДА ДанныеДляРасчета.ПоказанияПредоставлены
	|						ТОГДА 1
	|					ИНАЧЕ 0
	|				КОНЕЦ
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК ПоказанияПредоставлены,
	|	ДанныеДляРасчета.РаспределятьНаТочку КАК РаспределятьНаТочку
	|ИЗ
	|	ДанныеДляРасчета КАК ДанныеДляРасчета
	|ГДЕ
	|	ДанныеДляРасчета.ЧастьУзлаПриборВведен
	|	И ДанныеДляРасчета.ПоказанияПредоставлены
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ДанныеДляРасчета.Организация,
	|	ДанныеДляРасчета.ПериодНачисления,
	|	ДанныеДляРасчета.НачалоПериода,
	|	ДанныеДляРасчета.КонецПериода,
	|	ДанныеДляРасчета.Район,
	|	ДанныеДляРасчета.МКД,
	|	ДанныеДляРасчета.Услуга,
	|	ДанныеДляРасчета.ТочкаУчета,
	|	ЗНАЧЕНИЕ(Справочник.энргПриборыУчетаАбонента.ПУстаяСсылка),
	|	ЗНАЧЕНИЕ(Справочник.энргПриборыУчетаАбонента.ПУстаяСсылка),
	|	ЗНАЧЕНИЕ(Справочник.энргШкалыПриборовУчета.Основная),
	|	ЗНАЧЕНИЕ(Справочник.энргТарифныеЗоны.БезРазбивки),
	|	ДанныеДляРасчета.ПриборВведен,
	|	ДанныеДляРасчета.ЧастьУзлаПриборВведен,
	|	ДанныеДляРасчета.КоэффициентСезоности * ДанныеДляРасчета.НормаПотребления * ДанныеДляРасчета.КоэффициентНорматива * ВЫБОР
	|		КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|			ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|		ИНАЧЕ 1
	|	КОНЕЦ * ВЫБОР
	|		КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|			ТОГДА ВЫБОР
	|					КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|						ТОГДА 0
	|					ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|				КОНЕЦ
	|		ИНАЧЕ 1
	|	КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ДанныеДляРасчета.ДнейВПериоде),
	|	ДанныеДляРасчета.КоэффициентСезоности * ДанныеДляРасчета.НормаПотребления * ДанныеДляРасчета.КоэффициентНорматива * ВЫБОР
	|		КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|			ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|		ИНАЧЕ 1
	|	КОНЕЦ * ВЫБОР
	|		КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|			ТОГДА ВЫБОР
	|					КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|						ТОГДА 0
	|					ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|				КОНЕЦ
	|		ИНАЧЕ 1
	|	КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ДанныеДляРасчета.ДнейВПериоде),
	|	ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.ПоНормативу),
	|	ДанныеДляРасчета.ДокументНачисления,
	|	ДанныеДляРасчета.ДокументНачисленияПометкаУдаления,
	|	ДанныеДляРасчета.Поставщик,
	|	0,
	|	0,
	|	ДанныеДляРасчета.ЗначениеПлощади,
	|	ДанныеДляРасчета.НормаПотребления * ДанныеДляРасчета.КоэффициентНорматива,
	|	ДанныеДляРасчета.ВидПлощади,
	|	ДанныеДляРасчета.ПоказанияВСрок,
	|	ДанныеДляРасчета.ФормулаРасчета,
	|	ДанныеДляРасчета.РасчетПоФормуле,
	|	ДанныеДляРасчета.СоставнаяУслуга,
	|	ДанныеДляРасчета.НеПрименятьСезонность,
	|	ДанныеДляРасчета.ОбъемЗаПрошлыйГод,
	|	ДанныеДляРасчета.ЗависитОтУслуги,
	|	ДанныеДляРасчета.ПривязанаКШкале,
	|	ДанныеДляРасчета.ВидБлагоустройства,
	|	ДанныеДляРасчета.НеРаспределятьНаАбонентов,
	|	ДанныеДляРасчета.ЗакрытаяСхемаГВС,
	|	НЕ ДанныеДляРасчета.ОбъемЗаПрошлыйГод,
	|	ДанныеДляРасчета.ПлощадьМОП,
	|	ДанныеДляРасчета.ПлощадьАбонентов,
	|	ДанныеДляРасчета.ПлощадьСобственнаяПоставка,
	|	ДанныеДляРасчета.ОбъемПоНорме,
	|	ДанныеДляРасчета.КоэффициентНорматива,
	|	ДанныеДляРасчета.КоэффициентСезоности,
	|	ДанныеДляРасчета.ЗавершениеОП,
	|	ЗНАЧЕНИЕ(Справочник.энргПриборыУчетаАбонента.ПУстаяСсылка),
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.ПоказанияПредоставлены
	|			ТОГДА 1
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|				И ДанныеДляРасчета.СреднийОбъем >= 0
	|			ТОГДА 1
	|		КОГДА НЕ ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|			ТОГДА ВЫБОР
	|					КОГДА ДанныеДляРасчета.ПоказанияПредоставлены
	|						ТОГДА 1
	|					ИНАЧЕ 0
	|				КОНЕЦ
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	ДанныеДляРасчета.РаспределятьНаТочку
	|ИЗ
	|	ДанныеДляРасчета КАК ДанныеДляРасчета
	|ГДЕ
	|	НЕ ДанныеДляРасчета.ПриборВведен
	|	И ДанныеДляРасчета.НачислятьНорму
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ДанныеДляРасчета.Организация,
	|	ДанныеДляРасчета.ПериодНачисления,
	|	ДанныеДляРасчета.НачалоПериода,
	|	ДанныеДляРасчета.КонецПериода,
	|	ДанныеДляРасчета.Район,
	|	ДанныеДляРасчета.МКД,
	|	ДанныеДляРасчета.Услуга,
	|	ДанныеДляРасчета.ТочкаУчета,
	|	ДанныеДляРасчета.УзелПриборУчета,
	|	ДанныеДляРасчета.ЧастьУзлаПриборУчета,
	|	ДанныеДляРасчета.Шкала,
	|	ДанныеДляРасчета.ТарифнаяЗона,
	|	ДанныеДляРасчета.ПриборВведен,
	|	ДанныеДляРасчета.ЧастьУзлаПриборВведен,
	|	ВЫРАЗИТЬ(ДанныеДляРасчета.КоэффициентСезоности * ДанныеДляРасчета.СреднийОбъем * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ДанныеДляРасчета.ДнейВПериоде) КАК ЧИСЛО(15, 6)),
	|	ВЫРАЗИТЬ(ВЫБОР
	|			КОГДА ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|				ТОГДА 0
	|			ИНАЧЕ ДанныеДляРасчета.КоэффициентСезоности * ДанныеДляРасчета.СреднийОбъем * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ДанныеДляРасчета.ДнейВПериоде)
	|		КОНЕЦ КАК ЧИСЛО(15, 6)),
	|	ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.НачислениеПоСреднему),
	|	ДанныеДляРасчета.ДокументНачисления,
	|	ДанныеДляРасчета.ДокументНачисленияПометкаУдаления,
	|	ДанныеДляРасчета.Поставщик,
	|	0,
	|	0,
	|	ДанныеДляРасчета.ЗначениеПлощади,
	|	ДанныеДляРасчета.НормаПотребления * ДанныеДляРасчета.КоэффициентНорматива,
	|	ДанныеДляРасчета.ВидПлощади,
	|	ДанныеДляРасчета.ПоказанияВСрок,
	|	ДанныеДляРасчета.ФормулаРасчета,
	|	ДанныеДляРасчета.РасчетПоФормуле,
	|	ДанныеДляРасчета.СоставнаяУслуга,
	|	ДанныеДляРасчета.НеПрименятьСезонность,
	|	ДанныеДляРасчета.ОбъемЗаПрошлыйГод,
	|	ДанныеДляРасчета.ЗависитОтУслуги,
	|	ДанныеДляРасчета.ПривязанаКШкале,
	|	ДанныеДляРасчета.ВидБлагоустройства,
	|	ДанныеДляРасчета.НеРаспределятьНаАбонентов,
	|	ДанныеДляРасчета.ЗакрытаяСхемаГВС,
	|	НЕ ДанныеДляРасчета.ОбъемЗаПрошлыйГод,
	|	ДанныеДляРасчета.ПлощадьМОП,
	|	ДанныеДляРасчета.ПлощадьАбонентов,
	|	ДанныеДляРасчета.ПлощадьСобственнаяПоставка,
	|	ДанныеДляРасчета.ОбъемПоНорме,
	|	ДанныеДляРасчета.КоэффициентНорматива,
	|	ДанныеДляРасчета.КоэффициентСезоности,
	|	ДанныеДляРасчета.ЗавершениеОП,
	|	ДанныеДляРасчета.УзелПриборУчета,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.ПоказанияПредоставлены
	|			ТОГДА 1
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|				И ДанныеДляРасчета.СреднийОбъем >= 0
	|			ТОГДА 1
	|		КОГДА НЕ ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|			ТОГДА ВЫБОР
	|					КОГДА ДанныеДляРасчета.ПоказанияПредоставлены
	|						ТОГДА 1
	|					ИНАЧЕ 0
	|				КОНЕЦ
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	ДанныеДляРасчета.РаспределятьНаТочку
	|ИЗ
	|	ДанныеДляРасчета КАК ДанныеДляРасчета
	|ГДЕ
	|	НЕ ДанныеДляРасчета.ПоказанияВСрок
	|	И НЕ ДанныеДляРасчета.ВыводПрибораУчета
	|	И ДанныеДляРасчета.СреднийОбъем >= 0
	|	И ДанныеДляРасчета.ПриборВведен
	|	И НЕ ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ДанныеДляРасчета.Организация,
	|	ДанныеДляРасчета.ПериодНачисления,
	|	ДанныеДляРасчета.НачалоПериода,
	|	ДанныеДляРасчета.КонецПериода,
	|	ДанныеДляРасчета.Район,
	|	ДанныеДляРасчета.МКД,
	|	ДанныеДляРасчета.Услуга,
	|	ДанныеДляРасчета.ТочкаУчета,
	|	ДанныеДляРасчета.УзелПриборУчета,
	|	ДанныеДляРасчета.ЧастьУзлаПриборУчета,
	|	ДанныеДляРасчета.Шкала,
	|	ДанныеДляРасчета.ТарифнаяЗона,
	|	ДанныеДляРасчета.ПриборВведен,
	|	ДанныеДляРасчета.ЧастьУзлаПриборВведен,
	|	ВЫРАЗИТЬ(ДанныеДляРасчета.КоэффициентСезоности * ДанныеДляРасчета.НормаПотребления * ДанныеДляРасчета.КоэффициентНорматива * ВЫБОР
	|			КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|				ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|			ИНАЧЕ 1
	|		КОНЕЦ * ВЫБОР
	|			КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|				ТОГДА ВЫБОР
	|						КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|							ТОГДА 0
	|						ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|					КОНЕЦ
	|			ИНАЧЕ 1
	|		КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ДанныеДляРасчета.ДнейВПериоде) КАК ЧИСЛО(15, 6)),
	|	ВЫРАЗИТЬ(ВЫБОР
	|			КОГДА ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|				ТОГДА 0
	|			ИНАЧЕ ДанныеДляРасчета.КоэффициентСезоности * ДанныеДляРасчета.НормаПотребления * ДанныеДляРасчета.КоэффициентНорматива * ВЫБОР
	|					КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|						ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|					ИНАЧЕ 1
	|				КОНЕЦ * ВЫБОР
	|					КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|						ТОГДА ВЫБОР
	|								КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|									ТОГДА 0
	|								ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|							КОНЕЦ
	|					ИНАЧЕ 1
	|				КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ДанныеДляРасчета.ДнейВПериоде)
	|		КОНЕЦ КАК ЧИСЛО(15, 6)),
	|	ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.СреднееПоНормативу),
	|	ДанныеДляРасчета.ДокументНачисления,
	|	ДанныеДляРасчета.ДокументНачисленияПометкаУдаления,
	|	ДанныеДляРасчета.Поставщик,
	|	0,
	|	0,
	|	ДанныеДляРасчета.ЗначениеПлощади,
	|	ДанныеДляРасчета.НормаПотребления * ДанныеДляРасчета.КоэффициентНорматива,
	|	ДанныеДляРасчета.ВидПлощади,
	|	ДанныеДляРасчета.ПоказанияВСрок,
	|	ДанныеДляРасчета.ФормулаРасчета,
	|	ДанныеДляРасчета.РасчетПоФормуле,
	|	ДанныеДляРасчета.СоставнаяУслуга,
	|	ДанныеДляРасчета.НеПрименятьСезонность,
	|	ДанныеДляРасчета.ОбъемЗаПрошлыйГод,
	|	ДанныеДляРасчета.ЗависитОтУслуги,
	|	ДанныеДляРасчета.ПривязанаКШкале,
	|	ДанныеДляРасчета.ВидБлагоустройства,
	|	ДанныеДляРасчета.НеРаспределятьНаАбонентов,
	|	ДанныеДляРасчета.ЗакрытаяСхемаГВС,
	|	НЕ ДанныеДляРасчета.ОбъемЗаПрошлыйГод,
	|	ДанныеДляРасчета.ПлощадьМОП,
	|	ДанныеДляРасчета.ПлощадьАбонентов,
	|	ДанныеДляРасчета.ПлощадьСобственнаяПоставка,
	|	ДанныеДляРасчета.ОбъемПоНорме,
	|	ДанныеДляРасчета.КоэффициентНорматива,
	|	ДанныеДляРасчета.КоэффициентСезоности,
	|	ДанныеДляРасчета.ЗавершениеОП,
	|	ДанныеДляРасчета.УзелПриборУчета,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.ПоказанияПредоставлены
	|			ТОГДА 1
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|				И ДанныеДляРасчета.СреднийОбъем >= 0
	|			ТОГДА 1
	|		КОГДА НЕ ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|			ТОГДА ВЫБОР
	|					КОГДА ДанныеДляРасчета.ПоказанияПредоставлены
	|						ТОГДА 1
	|					ИНАЧЕ 0
	|				КОНЕЦ
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	ДанныеДляРасчета.РаспределятьНаТочку
	|ИЗ
	|	ДанныеДляРасчета КАК ДанныеДляРасчета
	|ГДЕ
	|	НЕ ДанныеДляРасчета.ПоказанияВСрок
	|	И НЕ ДанныеДляРасчета.ВыводПрибораУчета
	|	И ДанныеДляРасчета.СреднийОбъем < 0
	|	И ДанныеДляРасчета.ЧастьУзлаПриборВведен
	|	И ДанныеДляРасчета.НачислятьНорму
	|	И НЕ ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ДанныеДляРасчета.Организация,
	|	ДанныеДляРасчета.ПериодНачисления,
	|	ДанныеДляРасчета.НачалоПериода,
	|	ДанныеДляРасчета.КонецПериода,
	|	ДанныеДляРасчета.Район,
	|	ДанныеДляРасчета.МКД,
	|	ДанныеДляРасчета.Услуга,
	|	ДанныеДляРасчета.ТочкаУчета,
	|	ДанныеДляРасчета.УзелПриборУчета,
	|	ДанныеДляРасчета.ЧастьУзлаПриборУчета,
	|	ДанныеДляРасчета.Шкала,
	|	ДанныеДляРасчета.ТарифнаяЗона,
	|	ДанныеДляРасчета.ПриборВведен,
	|	ДанныеДляРасчета.ЧастьУзлаПриборВведен,
	|	0,
	|	ВЫРАЗИТЬ(ДанныеДляРасчета.КоэффициентСезоности * ДанныеДляРасчета.СреднийОбъем * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ДанныеДляРасчета.ДнейВПериоде) КАК ЧИСЛО(15, 6)),
	|	ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.НачислениеПоСреднему),
	|	ДанныеДляРасчета.ДокументНачисления,
	|	ДанныеДляРасчета.ДокументНачисленияПометкаУдаления,
	|	ДанныеДляРасчета.Поставщик,
	|	0,
	|	0,
	|	ДанныеДляРасчета.ЗначениеПлощади,
	|	ДанныеДляРасчета.НормаПотребления * ДанныеДляРасчета.КоэффициентНорматива,
	|	ДанныеДляРасчета.ВидПлощади,
	|	ДанныеДляРасчета.ПоказанияВСрок,
	|	ДанныеДляРасчета.ФормулаРасчета,
	|	ДанныеДляРасчета.РасчетПоФормуле,
	|	ДанныеДляРасчета.СоставнаяУслуга,
	|	ДанныеДляРасчета.НеПрименятьСезонность,
	|	ДанныеДляРасчета.ОбъемЗаПрошлыйГод,
	|	ДанныеДляРасчета.ЗависитОтУслуги,
	|	ДанныеДляРасчета.ПривязанаКШкале,
	|	ДанныеДляРасчета.ВидБлагоустройства,
	|	ДанныеДляРасчета.НеРаспределятьНаАбонентов,
	|	ДанныеДляРасчета.ЗакрытаяСхемаГВС,
	|	НЕ ДанныеДляРасчета.ОбъемЗаПрошлыйГод,
	|	ДанныеДляРасчета.ПлощадьМОП,
	|	ДанныеДляРасчета.ПлощадьАбонентов,
	|	ДанныеДляРасчета.ПлощадьСобственнаяПоставка,
	|	0,
	|	ДанныеДляРасчета.КоэффициентНорматива,
	|	ДанныеДляРасчета.КоэффициентСезоности,
	|	ДанныеДляРасчета.ЗавершениеОП,
	|	ДанныеДляРасчета.УзелПриборУчета,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.ПоказанияПредоставлены
	|			ТОГДА 1
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|				И ДанныеДляРасчета.СреднийОбъем >= 0
	|			ТОГДА 1
	|		КОГДА НЕ ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|			ТОГДА ВЫБОР
	|					КОГДА ДанныеДляРасчета.ПоказанияПредоставлены
	|						ТОГДА 1
	|					ИНАЧЕ 0
	|				КОНЕЦ
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	ДанныеДляРасчета.РаспределятьНаТочку
	|ИЗ
	|	ДанныеДляРасчета КАК ДанныеДляРасчета
	|ГДЕ
	|	НЕ ДанныеДляРасчета.ВыводПрибораУчета
	|	И ДанныеДляРасчета.СреднийОбъем >= 0
	|	И ДанныеДляРасчета.ЧастьУзлаПриборВведен
	|	И ДанныеДляРасчета.НеПрименятьСезонность
	|	И ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ДанныеДляРасчета.Организация,
	|	ДанныеДляРасчета.ПериодНачисления,
	|	ДанныеДляРасчета.НачалоПериода,
	|	ДанныеДляРасчета.КонецПериода,
	|	ДанныеДляРасчета.Район,
	|	ДанныеДляРасчета.МКД,
	|	ДанныеДляРасчета.Услуга,
	|	ДанныеДляРасчета.ТочкаУчета,
	|	ДанныеДляРасчета.УзелПриборУчета,
	|	ДанныеДляРасчета.ЧастьУзлаПриборУчета,
	|	ДанныеДляРасчета.Шкала,
	|	ДанныеДляРасчета.ТарифнаяЗона,
	|	ДанныеДляРасчета.ПриборВведен,
	|	ДанныеДляРасчета.ЧастьУзлаПриборВведен,
	|	0,
	|	ВЫРАЗИТЬ(ДанныеДляРасчета.КоэффициентСезоности * ДанныеДляРасчета.НормаПотребления * ДанныеДляРасчета.КоэффициентНорматива * ВЫБОР
	|			КОГДА НЕ ДанныеДляРасчета.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|				ТОГДА ДанныеДляРасчета.ЗначениеПлощади
	|			ИНАЧЕ 1
	|		КОНЕЦ * ВЫБОР
	|			КОГДА ДанныеДляРасчета.ИспользоватьКоэффициентСдерживанияРостаПлаты
	|				ТОГДА ВЫБОР
	|						КОГДА ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП = 0
	|							ТОГДА 0
	|						ИНАЧЕ (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка) / (ДанныеДляРасчета.ПлощадьАбонентов - ДанныеДляРасчета.ПлощадьСобственнаяПоставка + ДанныеДляРасчета.ПлощадьМОП)
	|					КОНЕЦ
	|			ИНАЧЕ 1
	|		КОНЕЦ * (РАЗНОСТЬДАТ(НАЧАЛОПЕРИОДА(ДанныеДляРасчета.НачалоПериода, ДЕНЬ), НАЧАЛОПЕРИОДА(ДанныеДляРасчета.КонецПериода, ДЕНЬ), ДЕНЬ) / ДанныеДляРасчета.ДнейВПериоде) КАК ЧИСЛО(15, 6)),
	|	ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.СреднееПоНормативу),
	|	ДанныеДляРасчета.ДокументНачисления,
	|	ДанныеДляРасчета.ДокументНачисленияПометкаУдаления,
	|	ДанныеДляРасчета.Поставщик,
	|	0,
	|	0,
	|	ДанныеДляРасчета.ЗначениеПлощади,
	|	ДанныеДляРасчета.НормаПотребления * ДанныеДляРасчета.КоэффициентНорматива,
	|	ДанныеДляРасчета.ВидПлощади,
	|	ДанныеДляРасчета.ПоказанияВСрок,
	|	ДанныеДляРасчета.ФормулаРасчета,
	|	ДанныеДляРасчета.РасчетПоФормуле,
	|	ДанныеДляРасчета.СоставнаяУслуга,
	|	ДанныеДляРасчета.НеПрименятьСезонность,
	|	ДанныеДляРасчета.ОбъемЗаПрошлыйГод,
	|	ДанныеДляРасчета.ЗависитОтУслуги,
	|	ДанныеДляРасчета.ПривязанаКШкале,
	|	ДанныеДляРасчета.ВидБлагоустройства,
	|	ДанныеДляРасчета.НеРаспределятьНаАбонентов,
	|	ДанныеДляРасчета.ЗакрытаяСхемаГВС,
	|	НЕ ДанныеДляРасчета.ОбъемЗаПрошлыйГод,
	|	ДанныеДляРасчета.ПлощадьМОП,
	|	ДанныеДляРасчета.ПлощадьАбонентов,
	|	ДанныеДляРасчета.ПлощадьСобственнаяПоставка,
	|	0,
	|	ДанныеДляРасчета.КоэффициентНорматива,
	|	ДанныеДляРасчета.КоэффициентСезоности,
	|	ДанныеДляРасчета.ЗавершениеОП,
	|	ДанныеДляРасчета.УзелПриборУчета,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.ПоказанияПредоставлены
	|			ТОГДА 1
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|				И ДанныеДляРасчета.СреднийОбъем >= 0
	|			ТОГДА 1
	|		КОГДА НЕ ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|			ТОГДА ВЫБОР
	|					КОГДА ДанныеДляРасчета.ПоказанияПредоставлены
	|						ТОГДА 1
	|					ИНАЧЕ 0
	|				КОНЕЦ
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	ДанныеДляРасчета.РаспределятьНаТочку
	|ИЗ
	|	ДанныеДляРасчета КАК ДанныеДляРасчета
	|ГДЕ
	|	ДанныеДляРасчета.СреднийОбъем <= 0
	|	И ДанныеДляРасчета.ЧастьУзлаПриборВведен
	|	И ДанныеДляРасчета.НачислятьНорму
	|	И ДанныеДляРасчета.ОбъемЗаПрошлыйГод
	|
	|УПОРЯДОЧИТЬ ПО
	|	Организация,
	|	ПериодНачисления,
	|	Район,
	|	МКД,
	|	ТочкаУчета,
	|	НачалоПериода,
	|	СоставнаяУслуга,
	|	Услуга";
			
	Возврат Текст;
	
КонецФункции

#КонецОбласти

#Область НачислениеЛьгот

Функция ПолучитьТекстЗапросаДляЛьготников()
	Возврат
	
	"ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.ЧастныйСектор КАК ЧастныйСектор,
	|	ВложенныйЗапрос.Строение КАК Строение,
	|	ВложенныйЗапрос.Помещение КАК Помещение,
	|	ВложенныйЗапрос.Абонент КАК Абонент,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	ВложенныйЗапрос.Поставщик КАК Поставщик,
	|	ВложенныйЗапрос.ЗначениеТарифа КАК ЗначениеТарифа,
	|	ВложенныйЗапрос.НачалоПериода КАК НачалоПериода,
	|	ВложенныйЗапрос.КонецПериода КАК КонецПериода,
	|	ВложенныйЗапрос.КолвоЖильцов КАК КолвоЖильцов,
	|	ВложенныйЗапрос.НормаПотребления КАК НормаПотребления,
	|	ВложенныйЗапрос.ОбъемУслуги КАК ОбъемУслуги,
	|	энргВидыУслуг.ВидПлощади <> ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.пустаяссылка) КАК РасчетПоПлощади
	|ПОМЕСТИТЬ энргОбъемНачислений
	|ИЗ
	|	(ВЫБРАТЬ
	|		&Организация КАК Организация,
	|		&Район КАК Район,
	|		энргОбъемНачислений.ЧастныйСектор КАК ЧастныйСектор,
	|		энргОбъемНачислений.Строение КАК Строение,
	|		энргОбъемНачислений.Помещение КАК Помещение,
	|		энргОбъемНачислений.Абонент КАК Абонент,
	|		энргОбъемНачислений.Услуга КАК Услуга,
	|		энргОбъемНачислений.Поставщик КАК Поставщик,
	|		энргОбъемНачислений.ЗначениеТарифа КАК ЗначениеТарифа,
	|		энргОбъемНачислений.НачалоПериода КАК НачалоПериода,
	|		энргОбъемНачислений.КонецПериода КАК КонецПериода,
	|		ВЫБОР
	|			КОГДА энргОбъемНачислений.КоличествоПроживающих <> 0
	|				ТОГДА энргОбъемНачислений.КоличествоПроживающих
	|			КОГДА энргОбъемНачислений.КоличествоПрописанных <> 0
	|				ТОГДА энргОбъемНачислений.КоличествоПрописанных
	|			КОГДА энргОбъемНачислений.КоличествоСобственников <> 0
	|				ТОГДА энргОбъемНачислений.КоличествоСобственников
	|		КОНЕЦ КАК КолвоЖильцов,
	|		энргОбъемНачислений.НормаПотребления КАК НормаПотребления,
	|		ВЫБОР
	|			КОГДА энргОбъемНачислений.Услуга.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.пустаяссылка)
	|				ТОГДА энргОбъемНачислений.ОбъемУслуги
	|			ИНАЧЕ энргОбъемНачислений.ЗначениеПлощади
	|		КОНЕЦ КАК ОбъемУслуги
	|	ИЗ
	|		(ВЫБРАТЬ
	|			энргОбъемНачисленийОбороты.Период КАК Период,
	|			энргОбъемНачисленийОбороты.Регистратор КАК Регистратор,
	|			энргОбъемНачисленийОбороты.НомерСтроки КАК НомерСтроки
	|		ИЗ
	|			РегистрНакопления.энргОбъемНачислений.Обороты(
	|					&НачалоПериода,
	|					&КонецПериода,
	|					Запись,
	|					Организация = &Организация
	|						И Район = &Район
	|						И ЧастныйСектор = &ЧастныйСектор
	|						И Строение = &Строение) КАК энргОбъемНачисленийОбороты) КАК ВложенныйЗапрос
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.энргОбъемНачислений КАК энргОбъемНачислений
	|			ПО ВложенныйЗапрос.Период = энргОбъемНачислений.Период
	|				И ВложенныйЗапрос.Регистратор = энргОбъемНачислений.Регистратор
	|				И ВложенныйЗапрос.НомерСтроки = энргОбъемНачислений.НомерСтроки) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.энргВидыУслуг КАК энргВидыУслуг
	|		ПО ВложенныйЗапрос.Услуга = энргВидыУслуг.Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргВзаиморасчетыПоМесяцамОстатки.Организация КАК Организация,
	|	энргВзаиморасчетыПоМесяцамОстатки.Район КАК Район,
	|	энргВзаиморасчетыПоМесяцамОстатки.МКД КАК МКД,
	|	энргВзаиморасчетыПоМесяцамОстатки.Услуга КАК Услуга,
	|	энргВзаиморасчетыПоМесяцамОстатки.Абонент КАК Абонент,
	|	энргВзаиморасчетыПоМесяцамОстатки.Поставщик КАК Поставщик
	|ПОМЕСТИТЬ энргВзаиморасчетыПоМесяцамОстатки
	|ИЗ
	|	РегистрНакопления.энргВзаиморасчетыПоМесяцам.Остатки(
	|			&МесяцЗадолженности,
	|			Организация = &Организация
	|				И Район = &Район
	|				И МКД = &Строение
	|				И ПериодНачисления <= &МесяцЗадолженности) КАК энргВзаиморасчетыПоМесяцамОстатки
	|ГДЕ
	|	энргВзаиморасчетыПоМесяцамОстатки.СуммаОстаток > 0
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргОбъемНачислений.Абонент КАК Абонент,
	|	энргОбъемНачислений.Район КАК Район,
	|	энргОбъемНачислений.Организация КАК Организация,
	|	энргОбъемНачислений.Строение КАК Строение,
	|	энргОбъемНачислений.ЗначениеТарифа КАК ЗначениеТарифа,
	|	энргОбъемНачислений.НачалоПериода КАК НачалоПериода,
	|	энргОбъемНачислений.КонецПериода КАК КонецПериода,
	|	энргОбъемНачислений.КолвоЖильцов КАК КолвоЖильцов,
	|	энргОбъемНачислений.НормаПотребления КАК НормаПотребления,
	|	энргОбъемНачислений.ОбъемУслуги КАК ОбъемУслуги,
	|	энргОбъемНачислений.Услуга КАК Услуга,
	|	энргОбъемНачислений.Поставщик КАК Поставщик,
	|	энргОбъемНачислений.РасчетПоПлощади КАК РасчетПоПлощади
	|ПОМЕСТИТЬ ВТ_ТолькоПоОтборам
	|ИЗ
	|	энргОбъемНачислений КАК энргОбъемНачислений
	|		ЛЕВОЕ СОЕДИНЕНИЕ энргВзаиморасчетыПоМесяцамОстатки КАК энргВзаиморасчетыПоМесяцамОстатки
	|		ПО энргОбъемНачислений.Организация = энргВзаиморасчетыПоМесяцамОстатки.Организация
	|			И энргОбъемНачислений.Район = энргВзаиморасчетыПоМесяцамОстатки.Район
	|			И энргОбъемНачислений.Строение = энргВзаиморасчетыПоМесяцамОстатки.МКД
	|			И энргОбъемНачислений.Услуга = энргВзаиморасчетыПоМесяцамОстатки.Услуга
	|			И энргОбъемНачислений.Абонент = энргВзаиморасчетыПоМесяцамОстатки.Абонент
	|			И энргОбъемНачислений.Поставщик = энргВзаиморасчетыПоМесяцамОстатки.Поставщик
	|ГДЕ
	|	энргВзаиморасчетыПоМесяцамОстатки.Организация ЕСТЬ NULL
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&Начало КАК Период,
	|	энргПроживаниеЖильцовСрезПоследних.Жилец КАК Жилец,
	|	энргПроживаниеЖильцовСрезПоследних.Состояние КАК Состояние,
	|	ВТ_ТолькоПоОтборам.Абонент КАК Абонент
	|ПОМЕСТИТЬ ВТ_Жильцы
	|ИЗ
	|	РегистрСведений.энргПроживаниеЖильцов.СрезПоследних(&Начало, ) КАК энргПроживаниеЖильцовСрезПоследних
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_ТолькоПоОтборам КАК ВТ_ТолькоПоОтборам
	|		ПО энргПроживаниеЖильцовСрезПоследних.Организация = ВТ_ТолькоПоОтборам.Организация
	|			И энргПроживаниеЖильцовСрезПоследних.Район = ВТ_ТолькоПоОтборам.Район
	|			И энргПроживаниеЖильцовСрезПоследних.Абонент = ВТ_ТолькоПоОтборам.Абонент
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	НАЧАЛОПЕРИОДА(энргПроживаниеЖильцов.Период, ДЕНЬ),
	|	энргПроживаниеЖильцов.Жилец,
	|	энргПроживаниеЖильцов.Состояние,
	|	ВТ_ТолькоПоОтборам.Абонент
	|ИЗ
	|	РегистрСведений.энргПроживаниеЖильцов КАК энргПроживаниеЖильцов
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_ТолькоПоОтборам КАК ВТ_ТолькоПоОтборам
	|		ПО энргПроживаниеЖильцов.Организация = ВТ_ТолькоПоОтборам.Организация
	|			И энргПроживаниеЖильцов.Район = ВТ_ТолькоПоОтборам.Район
	|			И энргПроживаниеЖильцов.Абонент = ВТ_ТолькоПоОтборам.Абонент
	|ГДЕ
	|	энргПроживаниеЖильцов.Период МЕЖДУ &Начало И &Конец
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Жильцы.Период КАК ПериодС,
	|	Жильцы.Жилец КАК Жилец,
	|	Жильцы.Состояние КАК Состояние,
	|	ЕСТЬNULL(Жильцы1.Период, &Конец) КАК ПериодПо,
	|	Жильцы.Абонент КАК Абонент
	|ПОМЕСТИТЬ СтабильныеТолькоДляЖильцов
	|ИЗ
	|	ВТ_Жильцы КАК Жильцы
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_Жильцы КАК Жильцы1
	|		ПО Жильцы.Период < Жильцы1.Период
	|			И Жильцы.Жилец = Жильцы1.Жилец
	|ГДЕ
	|	Жильцы.Период <> &Конец
	|;
	|
	|ВЫБРАТЬ
	|	энргЖильцыЛьготныхКатегорийСрезПоследних.Жилец КАК Жилец,
	|	ВЫБОР
	|		КОГДА энргЖильцыЛьготныхКатегорийСрезПоследних.Состояние
	|			ТОГДА энргЖильцыЛьготныхКатегорийСрезПоследних.ЛьготнаяКатегория
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.энргЛьготныеКатегории.пустаяссылка)
	|	КОНЕЦ КАК Льгота,
	|	&Начало КАК Период,
	|	ВТ_ТолькоПоОтборам.Абонент КАК Абонент
	|ПОМЕСТИТЬ ВТ_Льготы
	|ИЗ
	|	ВТ_ТолькоПоОтборам КАК ВТ_ТолькоПоОтборам
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЖильцыЛьготныхКатегорий.СрезПоследних(&Начало, ) КАК энргЖильцыЛьготныхКатегорийСрезПоследних
	|		ПО ВТ_ТолькоПоОтборам.Абонент = энргЖильцыЛьготныхКатегорийСрезПоследних.Абонент
	|			И ВТ_ТолькоПоОтборам.Район = энргЖильцыЛьготныхКатегорийСрезПоследних.Район
	|			И ВТ_ТолькоПоОтборам.Организация = энргЖильцыЛьготныхКатегорийСрезПоследних.Организация
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	энргЖильцыЛьготныхКатегорий.Жилец,
	|	ВЫБОР
	|		КОГДА энргЖильцыЛьготныхКатегорий.Состояние
	|			ТОГДА энргЖильцыЛьготныхКатегорий.ЛьготнаяКатегория
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.энргЛьготныеКатегории.пустаяссылка)
	|	КОНЕЦ,
	|	НАЧАЛОПЕРИОДА(энргЖильцыЛьготныхКатегорий.Период, ДЕНЬ),
	|	ВТ_ТолькоПоОтборам.Абонент
	|ИЗ
	|	РегистрСведений.энргЖильцыЛьготныхКатегорий КАК энргЖильцыЛьготныхКатегорий
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_ТолькоПоОтборам КАК ВТ_ТолькоПоОтборам
	|		ПО энргЖильцыЛьготныхКатегорий.Организация = ВТ_ТолькоПоОтборам.Организация
	|			И энргЖильцыЛьготныхКатегорий.Район = ВТ_ТолькоПоОтборам.Район
	|			И энргЖильцыЛьготныхКатегорий.Абонент = ВТ_ТолькоПоОтборам.Абонент
	|ГДЕ
	|	энргЖильцыЛьготныхКатегорий.Период МЕЖДУ &Начало И &Конец
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_Жильцы.Период КАК Период,
	|	ВТ_Жильцы.Жилец КАК Жилец
	|ПОМЕСТИТЬ ПериодыЖильцыЛьготы
	|ИЗ
	|	ВТ_Жильцы КАК ВТ_Жильцы
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ВТ_Льготы.Период,
	|	ВТ_Льготы.Жилец
	|ИЗ
	|	ВТ_Льготы КАК ВТ_Льготы
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ПериодыЖильцыЛьготы.Период КАК Период,
	|	ПериодыЖильцыЛьготы.Жилец КАК Жилец
	|ПОМЕСТИТЬ ПериодЖЛБезПовт
	|ИЗ
	|	ПериодыЖильцыЛьготы КАК ПериодыЖильцыЛьготы
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПериодЖЛБезПовт.Период КАК ПериодС,
	|	ПериодЖЛБезПовт.Жилец КАК Жилец,
	|	МИНИМУМ(ЕСТЬNULL(ПериодЖЛБезПовт1.Период, &Конец)) КАК ПериодПо
	|ПОМЕСТИТЬ СтабильныеПериодыДляВсехБезРесурсов
	|ИЗ
	|	ПериодЖЛБезПовт КАК ПериодЖЛБезПовт
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПериодЖЛБезПовт КАК ПериодЖЛБезПовт1
	|		ПО ПериодЖЛБезПовт.Жилец = ПериодЖЛБезПовт1.Жилец
	|			И ПериодЖЛБезПовт.Период < ПериодЖЛБезПовт1.Период
	|ГДЕ
	|	ПериодЖЛБезПовт.Период <> &Конец
	|
	|СГРУППИРОВАТЬ ПО
	|	ПериодЖЛБезПовт.Период,
	|	ПериодЖЛБезПовт.Жилец
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_Льготы.Жилец КАК Жилец,
	|	ВТ_Льготы.Период КАК ПериодС,
	|	ЕСТЬNULL(ВТ_Льготы1.Период, &Конец) КАК ПериодПо,
	|	ВТ_Льготы.Льгота КАК Льгота
	|ПОМЕСТИТЬ СтабильныеПериодыТолькоДляЛьгот
	|ИЗ
	|	ВТ_Льготы КАК ВТ_Льготы
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_Льготы КАК ВТ_Льготы1
	|		ПО ВТ_Льготы.Жилец = ВТ_Льготы1.Жилец
	|			И ВТ_Льготы.Период < ВТ_Льготы1.Период
	|ГДЕ
	|	ВТ_Льготы.Период <> &Конец
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	СтабильныеПериодыДляВсехБезРесурсов.ПериодС КАК ПериодС,
	|	СтабильныеПериодыДляВсехБезРесурсов.ПериодПо КАК ПериодПо,
	|	СтабильныеПериодыДляВсехБезРесурсов.Жилец КАК Жилец,
	|	СтабильныеПериодыТолькоДляЛьгот.Льгота КАК Льгота,
	|	СтабильныеТолькоДляЖильцов.Состояние КАК Состояние,
	|	СтабильныеТолькоДляЖильцов.Абонент КАК Абонент
	|ПОМЕСТИТЬ ОбъединенныеСтабильныеПериоды
	|ИЗ
	|	СтабильныеПериодыДляВсехБезРесурсов КАК СтабильныеПериодыДляВсехБезРесурсов
	|		ЛЕВОЕ СОЕДИНЕНИЕ СтабильныеТолькоДляЖильцов КАК СтабильныеТолькоДляЖильцов
	|		ПО СтабильныеПериодыДляВсехБезРесурсов.Жилец = СтабильныеТолькоДляЖильцов.Жилец
	|			И СтабильныеПериодыДляВсехБезРесурсов.ПериодС >= СтабильныеТолькоДляЖильцов.ПериодС
	|			И СтабильныеПериодыДляВсехБезРесурсов.ПериодПо <= СтабильныеТолькоДляЖильцов.ПериодПо
	|		ЛЕВОЕ СОЕДИНЕНИЕ СтабильныеПериодыТолькоДляЛьгот КАК СтабильныеПериодыТолькоДляЛьгот
	|		ПО СтабильныеПериодыДляВсехБезРесурсов.Жилец = СтабильныеПериодыТолькоДляЛьгот.Жилец
	|			И СтабильныеПериодыДляВсехБезРесурсов.ПериодС >= СтабильныеПериодыТолькоДляЛьгот.ПериодС
	|			И СтабильныеПериодыДляВсехБезРесурсов.ПериодПо <= СтабильныеПериодыТолькоДляЛьгот.ПериодПо
	|ГДЕ
	|	СтабильныеТолькоДляЖильцов.Состояние = ЗНАЧЕНИЕ(Перечисление.энргСостояниеЖильцов.регистрация)
	|	И СтабильныеПериодыТолькоДляЛьгот.Льгота <> ЗНАЧЕНИЕ(Справочник.энргЛьготныеКатегории.Пустаяссылка)
	|;
	|
	|ВЫБРАТЬ
	|	ВТ_ТолькоПоОтборам.НачалоПериода КАК Период,
	|	ВТ_ТолькоПоОтборам.Абонент КАК Абонент
	|ПОМЕСТИТЬ ОбъединениеПериодовСНачислениями
	|ИЗ
	|	ВТ_ТолькоПоОтборам КАК ВТ_ТолькоПоОтборам
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ВТ_ТолькоПоОтборам.КонецПериода,
	|	ВТ_ТолькоПоОтборам.Абонент
	|ИЗ
	|	ВТ_ТолькоПоОтборам КАК ВТ_ТолькоПоОтборам
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ОбъединенныеСтабильныеПериоды.ПериодС,
	|	ОбъединенныеСтабильныеПериоды.Абонент
	|ИЗ
	|	ОбъединенныеСтабильныеПериоды КАК ОбъединенныеСтабильныеПериоды
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ОбъединенныеСтабильныеПериоды.ПериодПо,
	|	ОбъединенныеСтабильныеПериоды.Абонент
	|ИЗ
	|	ОбъединенныеСтабильныеПериоды КАК ОбъединенныеСтабильныеПериоды
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ОбъединениеПериодовСНачислениями.Период КАК Период,
	|	ОбъединениеПериодовСНачислениями.Абонент КАК Абонент
	|ПОМЕСТИТЬ ОбъединениеПериодовСНачислениямиБезПовт
	|ИЗ
	|	ОбъединениеПериодовСНачислениями КАК ОбъединениеПериодовСНачислениями
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ОбъединениеПериодовСНачислениямиБезПовт.Абонент КАК Абонент,
	|	ОбъединениеПериодовСНачислениямиБезПовт.Период КАК ПериодC,
	|	МИНИМУМ(ЕСТЬNULL(ОбъединениеПериодовСНачислениямиБезПовт1.Период, &Конец)) КАК ПериодПо
	|ПОМЕСТИТЬ СтабльныеПериодыБезРесурсовОбъединение
	|ИЗ
	|	ОбъединениеПериодовСНачислениямиБезПовт КАК ОбъединениеПериодовСНачислениямиБезПовт
	|		ЛЕВОЕ СОЕДИНЕНИЕ ОбъединениеПериодовСНачислениямиБезПовт КАК ОбъединениеПериодовСНачислениямиБезПовт1
	|		ПО ОбъединениеПериодовСНачислениямиБезПовт.Период < ОбъединениеПериодовСНачислениямиБезПовт1.Период
	|			И ОбъединениеПериодовСНачислениямиБезПовт.Абонент = ОбъединениеПериодовСНачислениямиБезПовт1.Абонент
	|ГДЕ
	|	ОбъединениеПериодовСНачислениямиБезПовт.Период <> &Конец
	|
	|СГРУППИРОВАТЬ ПО
	|	ОбъединениеПериодовСНачислениямиБезПовт.Период,
	|	ОбъединениеПериодовСНачислениямиБезПовт.Абонент
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ВТ_ТолькоПоОтборам.Абонент КАК Абонент,
	|	ВТ_ТолькоПоОтборам.Район КАК Район,
	|	ВТ_ТолькоПоОтборам.Организация КАК Организация,
	|	ВТ_ТолькоПоОтборам.Строение КАК Строение,
	|	ВТ_ТолькоПоОтборам.ЗначениеТарифа КАК ЗначениеТарифа,
	|	СтабльныеПериодыБезРесурсовОбъединение.ПериодC КАК ПериодC,
	|	СтабльныеПериодыБезРесурсовОбъединение.ПериодПо КАК ПериодПо,
	|	ВТ_ТолькоПоОтборам.КолвоЖильцов КАК КолвоЖильцов,
	|	ВТ_ТолькоПоОтборам.НормаПотребления КАК НормаПотребления,
	|	ВТ_ТолькоПоОтборам.ОбъемУслуги КАК ОбъемУслуги,
	|	ОбъединенныеСтабильныеПериоды.Жилец КАК Жилец,
	|	ОбъединенныеСтабильныеПериоды.Льгота КАК Льгота,
	|	ВТ_ТолькоПоОтборам.Услуга КАК Услуга,
	|	ВТ_ТолькоПоОтборам.РасчетПоПлощади КАК РасчетПоПлощади,
	|	ВТ_ТолькоПоОтборам.Поставщик КАК Поставщик,
	|	РАЗНОСТЬДАТ(ВТ_ТолькоПоОтборам.НачалоПериода, ВТ_ТолькоПоОтборам.КонецПериода, ДЕНЬ) КАК РазностьДатПоНачислениям
	|ПОМЕСТИТЬ ПакетДляРасчетаПодготовка
	|ИЗ
	|	СтабльныеПериодыБезРесурсовОбъединение КАК СтабльныеПериодыБезРесурсовОбъединение
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ОбъединенныеСтабильныеПериоды КАК ОбъединенныеСтабильныеПериоды
	|		ПО СтабльныеПериодыБезРесурсовОбъединение.Абонент = ОбъединенныеСтабильныеПериоды.Абонент
	|			И СтабльныеПериодыБезРесурсовОбъединение.ПериодC >= ОбъединенныеСтабильныеПериоды.ПериодС
	|			И СтабльныеПериодыБезРесурсовОбъединение.ПериодПо <= ОбъединенныеСтабильныеПериоды.ПериодПо
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_ТолькоПоОтборам КАК ВТ_ТолькоПоОтборам
	|		ПО СтабльныеПериодыБезРесурсовОбъединение.Абонент = ВТ_ТолькоПоОтборам.Абонент
	|			И СтабльныеПериодыБезРесурсовОбъединение.ПериодC >= ВТ_ТолькоПоОтборам.НачалоПериода
	|			И СтабльныеПериодыБезРесурсовОбъединение.ПериодПо <= ВТ_ТолькоПоОтборам.КонецПериода
	|ГДЕ
	|	ВТ_ТолькоПоОтборам.КолвоЖильцов <> 0
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПакетДляРасчетаПодготовка.Абонент КАК Абонент,
	|	ПакетДляРасчетаПодготовка.Район КАК Район,
	|	ПакетДляРасчетаПодготовка.Организация КАК Организация,
	|	ПакетДляРасчетаПодготовка.Строение КАК Строение,
	|	ПакетДляРасчетаПодготовка.ЗначениеТарифа КАК ЗначениеТарифа,
	|	ПакетДляРасчетаПодготовка.ПериодC КАК ПериодC,
	|	ПакетДляРасчетаПодготовка.ПериодПо КАК ПериодПо,
	|	ПакетДляРасчетаПодготовка.КолвоЖильцов КАК КолвоЖильцов,
	|	ПакетДляРасчетаПодготовка.НормаПотребления КАК НормаПотребления,
	|	ПакетДляРасчетаПодготовка.ОбъемУслуги КАК ОбъемУслуги,
	|	ПакетДляРасчетаПодготовка.Жилец КАК Жилец,
	|	ПакетДляРасчетаПодготовка.Льгота КАК Льгота,
	|	ПакетДляРасчетаПодготовка.Услуга КАК Услуга,
	|	энргЗначенияСоциальныхНормативовДляЛьгот.ЗначениеНорматива КАК ЗначениеНорматива,
	|	ПакетДляРасчетаПодготовка.РасчетПоПлощади КАК РасчетПоПлощади,
	|	ЕСТЬNULL(энргЗначенияЛьготныхКатегорий.ПроцентОтНачислений, 0) КАК ПроцентЛьготы,
	|	ПакетДляРасчетаПодготовка.Поставщик КАК Поставщик,
	|	ПакетДляРасчетаПодготовка.РазностьДатПоНачислениям КАК РазностьДатПоНачислениям
	|ПОМЕСТИТЬ ПакетДляРасчета
	|ИЗ
	|	ПакетДляРасчетаПодготовка КАК ПакетДляРасчетаПодготовка
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.энргИспользованиеСоцНормативовВУслугах.СрезПоследних(&Конец, ) КАК энргИспользованиеСоцНормативовВУслугахСрезПоследних
	|		ПО ПакетДляРасчетаПодготовка.Услуга = энргИспользованиеСоцНормативовВУслугахСрезПоследних.Услуга
	|			И ПакетДляРасчетаПодготовка.Район = энргИспользованиеСоцНормативовВУслугахСрезПоследних.Район
	|			И ПакетДляРасчетаПодготовка.Организация = энргИспользованиеСоцНормативовВУслугахСрезПоследних.Организация
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначенияСоциальныхНормативовДляЛьгот.СрезПоследних(&Конец, ) КАК энргЗначенияСоциальныхНормативовДляЛьгот
	|		ПО (энргИспользованиеСоцНормативовВУслугахСрезПоследних.Использование)
	|			И ПакетДляРасчетаПодготовка.Организация = энргЗначенияСоциальныхНормативовДляЛьгот.Организация
	|			И ПакетДляРасчетаПодготовка.Район = энргЗначенияСоциальныхНормативовДляЛьгот.Район
	|			И ПакетДляРасчетаПодготовка.КолвоЖильцов = энргЗначенияСоциальныхНормативовДляЛьгот.КоличествоПрописанных
	|			И ПакетДляРасчетаПодготовка.Услуга = энргЗначенияСоциальныхНормативовДляЛьгот.Услуга
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначенияЛьготныхКатегорий.СрезПоследних(&Конец, ) КАК энргЗначенияЛьготныхКатегорий
	|		ПО ПакетДляРасчетаПодготовка.Организация = энргЗначенияЛьготныхКатегорий.Организация
	|			И ПакетДляРасчетаПодготовка.Район = энргЗначенияЛьготныхКатегорий.Район
	|			И ПакетДляРасчетаПодготовка.Льгота = энргЗначенияЛьготныхКатегорий.ЛьготнаяКатегория
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПакетДляРасчета.Абонент КАК Абонент,
	|	ПакетДляРасчета.Район КАК Район,
	|	ПакетДляРасчета.Организация КАК Организация,
	|	ПакетДляРасчета.Строение КАК Строение,
	|	ПакетДляРасчета.ЗначениеТарифа КАК ЗначениеТарифа,
	|	МИНИМУМ(ПакетДляРасчета.ПериодC) КАК НачалоПериода,
	|	МАКСИМУМ(ПакетДляРасчета.ПериодПо) КАК КонецПериода,
	|	ПакетДляРасчета.Жилец КАК Жилец,
	|	ПакетДляРасчета.Льгота КАК ЛьготнаяКатегория,
	|	ПакетДляРасчета.ПроцентЛьготы КАК ПроцентЛьготы,
	|	ПакетДляРасчета.Услуга КАК Услуга,
	|	энргНачислениеДляЛьготныхЛиц.Ссылка КАК СсылкаНаСущДок,
	|	энргНачислениеДляЛьготныхЛиц.ПометкаУдаления КАК ПометкаУдаления,
	|	ПакетДляРасчета.Поставщик КАК Поставщик,
	|	СУММА(ВЫБОР
	|			КОГДА ПакетДляРасчета.РасчетПоПлощади
	|				ТОГДА ВЫБОР
	|						КОГДА ПакетДляРасчета.ОбъемУслуги / ПакетДляРасчета.КолвоЖильцов < ПакетДляРасчета.ЗначениеНорматива
	|							ТОГДА ПакетДляРасчета.ОбъемУслуги / ПакетДляРасчета.КолвоЖильцов
	|						ИНАЧЕ ПакетДляРасчета.ЗначениеНорматива
	|					КОНЕЦ * ПакетДляРасчета.ПроцентЛьготы * 0.01 * ПакетДляРасчета.ЗначениеТарифа * ПакетДляРасчета.НормаПотребления * (РАЗНОСТЬДАТ(ПакетДляРасчета.ПериодC, ПакетДляРасчета.ПериодПо, ДЕНЬ) / ПакетДляРасчета.РазностьДатПоНачислениям)
	|			ИНАЧЕ ВЫБОР
	|					КОГДА ПакетДляРасчета.ОбъемУслуги / ПакетДляРасчета.КолвоЖильцов < ПакетДляРасчета.НормаПотребления
	|						ТОГДА ПакетДляРасчета.ОбъемУслуги / ПакетДляРасчета.КолвоЖильцов
	|					ИНАЧЕ ПакетДляРасчета.НормаПотребления
	|				КОНЕЦ * ПакетДляРасчета.ПроцентЛьготы * 0.01 * ПакетДляРасчета.ЗначениеТарифа * (РАЗНОСТЬДАТ(ПакетДляРасчета.ПериодC, ПакетДляРасчета.ПериодПо, ДЕНЬ) / ПакетДляРасчета.РазностьДатПоНачислениям)
	|		КОНЕЦ) КАК СуммаЛьготы
	|ИЗ
	|	ПакетДляРасчета КАК ПакетДляРасчета
	|		ПОЛНОЕ СОЕДИНЕНИЕ Документ.энргНачислениеДляЛьготныхЛиц КАК энргНачислениеДляЛьготныхЛиц
	|		ПО ПакетДляРасчета.Район = энргНачислениеДляЛьготныхЛиц.Район
	|			И ПакетДляРасчета.Организация = энргНачислениеДляЛьготныхЛиц.Организация
	|			И ПакетДляРасчета.Строение = энргНачислениеДляЛьготныхЛиц.МКД
	|			И (энргНачислениеДляЛьготныхЛиц.Дата = &КонецМинусСекунда)
	|
	|СГРУППИРОВАТЬ ПО
	|	ПакетДляРасчета.Абонент,
	|	ПакетДляРасчета.Район,
	|	ПакетДляРасчета.Организация,
	|	ПакетДляРасчета.Строение,
	|	ПакетДляРасчета.ЗначениеТарифа,
	|	ПакетДляРасчета.Жилец,
	|	ПакетДляРасчета.Льгота,
	|	ПакетДляРасчета.ПроцентЛьготы,
	|	ПакетДляРасчета.Услуга,
	|	энргНачислениеДляЛьготныхЛиц.Ссылка,
	|	энргНачислениеДляЛьготныхЛиц.ПометкаУдаления,
	|	ПакетДляРасчета.Поставщик
	|
	|УПОРЯДОЧИТЬ ПО
	|	Строение";
КонецФункции 

#КонецОбласти

#Область РаспределениеМКД

Функция ТекстЗапросаВспомогательныеДанныеРаспределениеМКД(Строение)
	
	Текст 							=
	"ВЫБРАТЬ
	|	энргСтабильныеПериодыМКД.Организация КАК Организация,
	|	энргСтабильныеПериодыМКД.ПериодНачисления КАК ПериодНачисления,
	|	энргСтабильныеПериодыМКД.Район КАК Район,
	|	энргСтабильныеПериодыМКД.МКД КАК МКД,
	|	энргСтабильныеПериодыМКД.Услуга КАК Услуга,
	|	энргСтабильныеПериодыМКД.ТочкаУчета КАК ТочкаУчета,
	|	энргСтабильныеПериодыМКД.ЗначениеПлощади КАК ПлощадьМОП,
	|	энргСтабильныеПериодыМКД.ТипСхемы КАК ТипСхемы,
	|	энргСтабильныеПериодыМКД.ВидТепловогоПункта КАК ВидТепловогоПункта,
	|	энргСтабильныеПериодыМКД.СоставнаяУслуга КАК СоставнаяУслуга,
	|	энргСтабильныеПериодыМКД.КлючНорматива КАК КлючНорматива,
	|	ДокументыДляРаспределения.ЗавершениеОП КАК ЗавершениеОП
	|ПОМЕСТИТЬ УслугиМКДРаспределять
	|ИЗ
	|	ДокументыДляРаспределения КАК ДокументыДляРаспределения
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргСтабильныеПериодыМКД КАК энргСтабильныеПериодыМКД
	|		ПО ДокументыДляРаспределения.Организация = энргСтабильныеПериодыМКД.Организация
	|			И ДокументыДляРаспределения.ПериодНачисления = энргСтабильныеПериодыМКД.ПериодНачисления
	|			И ДокументыДляРаспределения.Район = энргСтабильныеПериодыМКД.Район
	|			И ДокументыДляРаспределения.Строение = энргСтабильныеПериодыМКД.МКД
	|			И (энргСтабильныеПериодыМКД.НомерПозиции = 0)
	|			И (НЕ энргСтабильныеПериодыМКД.НеРаспределятьНаАбонентов)
	|			И (энргСтабильныеПериодыМКД.Организация = &Организация)
	|			И (энргСтабильныеПериодыМКД.Район = &Район)
	|			И (энргСтабильныеПериодыМКД.МКД = &Строение)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	УслугиМКД.Организация КАК Организация,
	|	УслугиМКД.ПериодНачисления КАК ПериодНачисления,
	|	УслугиМКД.Район КАК Район,
	|	УслугиМКД.МКД КАК МКД,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	ВложенныйЗапрос.ФормулаРасчетаНорматива КАК ФормулаРасчетаНорматива,
	|	СУММА(1) КАК КоличествоСовпадений
	|ПОМЕСТИТЬ ВозможныеФормулыРасчетаНорматива
	|ИЗ
	|	(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		УслугиМКДРаспределять.Организация КАК Организация,
	|		УслугиМКДРаспределять.ПериодНачисления КАК ПериодНачисления,
	|		УслугиМКДРаспределять.Район КАК Район,
	|		УслугиМКДРаспределять.МКД КАК МКД,
	|		УслугиМКДРаспределять.Услуга КАК Услуга
	|	ИЗ
	|		УслугиМКДРаспределять КАК УслугиМКДРаспределять) КАК УслугиМКД
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	|			ВложенныйЗапрос.Организация КАК Организация,
	|			ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|			ВложенныйЗапрос.Район КАК Район,
	|			ВложенныйЗапрос.МКД КАК МКД,
	|			ВложенныйЗапрос.Услуга КАК Услуга,
	|			ВложенныйЗапрос.ФормулаРасчетаНорматива КАК ФормулаРасчетаНорматива,
	|			энргФормулыРасчетаНормативаУслуги.Услуга КАК УслугаПараметр
	|		ИЗ
	|			(ВЫБРАТЬ
	|				УслугиМКДРаспределять.Организация КАК Организация,
	|				УслугиМКДРаспределять.ПериодНачисления КАК ПериодНачисления,
	|				УслугиМКДРаспределять.Район КАК Район,
	|				УслугиМКДРаспределять.МКД КАК МКД,
	|				УслугиМКДРаспределять.Услуга КАК Услуга,
	|				энргФормулыРасчетаНорматива.Ссылка КАК ФормулаРасчетаНорматива
	|			ИЗ
	|				УслугиМКДРаспределять КАК УслугиМКДРаспределять
	|					ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.энргФормулыРасчетаНорматива КАК энргФормулыРасчетаНорматива
	|					ПО УслугиМКДРаспределять.Услуга = энргФормулыРасчетаНорматива.Услуга
	|						И УслугиМКДРаспределять.ТипСхемы = энргФормулыРасчетаНорматива.ТипСхемы
	|						И УслугиМКДРаспределять.ВидТепловогоПункта = энргФормулыРасчетаНорматива.ВидТепловогоПункта) КАК ВложенныйЗапрос
	|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.энргФормулыРасчетаНорматива.Услуги КАК энргФормулыРасчетаНормативаУслуги
	|				ПО ВложенныйЗапрос.ФормулаРасчетаНорматива = энргФормулыРасчетаНормативаУслуги.Ссылка) КАК ВложенныйЗапрос
	|		ПО УслугиМКД.Организация = ВложенныйЗапрос.Организация
	|			И УслугиМКД.ПериодНачисления = ВложенныйЗапрос.ПериодНачисления
	|			И УслугиМКД.Район = ВложенныйЗапрос.Район
	|			И УслугиМКД.МКД = ВложенныйЗапрос.МКД
	|			И УслугиМКД.Услуга = ВложенныйЗапрос.УслугаПараметр
	|
	|СГРУППИРОВАТЬ ПО
	|	УслугиМКД.Организация,
	|	УслугиМКД.ПериодНачисления,
	|	УслугиМКД.Район,
	|	УслугиМКД.МКД,
	|	ВложенныйЗапрос.Услуга,
	|	ВложенныйЗапрос.ФормулаРасчетаНорматива
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.МКД КАК МКД,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	энргФормулыРасчетаНорматива.ФормулаРасчетаНормативаПотребления КАК ФормулаРасчетаНормативаПотребления
	|ПОМЕСТИТЬ ФормулыРасчетаНорматива
	|ИЗ
	|	(ВЫБРАТЬ
	|		ВозможныеФормулыРасчетаНорматива.Организация КАК Организация,
	|		ВозможныеФормулыРасчетаНорматива.ПериодНачисления КАК ПериодНачисления,
	|		ВозможныеФормулыРасчетаНорматива.Район КАК Район,
	|		ВозможныеФормулыРасчетаНорматива.МКД КАК МКД,
	|		ВозможныеФормулыРасчетаНорматива.Услуга КАК Услуга,
	|		МАКСИМУМ(ВозможныеФормулыРасчетаНорматива.ФормулаРасчетаНорматива) КАК ФормулаРасчетаНорматива
	|	ИЗ
	|		ВозможныеФормулыРасчетаНорматива КАК ВозможныеФормулыРасчетаНорматива
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	|				ВозможныеФормулыРасчетаНорматива.Организация КАК Организация,
	|				ВозможныеФормулыРасчетаНорматива.ПериодНачисления КАК ПериодНачисления,
	|				ВозможныеФормулыРасчетаНорматива.Район КАК Район,
	|				ВозможныеФормулыРасчетаНорматива.МКД КАК МКД,
	|				ВозможныеФормулыРасчетаНорматива.Услуга КАК Услуга,
	|				МАКСИМУМ(ВозможныеФормулыРасчетаНорматива.КоличествоСовпадений) КАК КоличествоСовпадений
	|			ИЗ
	|				ВозможныеФормулыРасчетаНорматива КАК ВозможныеФормулыРасчетаНорматива
	|			
	|			СГРУППИРОВАТЬ ПО
	|				ВозможныеФормулыРасчетаНорматива.Организация,
	|				ВозможныеФормулыРасчетаНорматива.ПериодНачисления,
	|				ВозможныеФормулыРасчетаНорматива.Район,
	|				ВозможныеФормулыРасчетаНорматива.МКД,
	|				ВозможныеФормулыРасчетаНорматива.Услуга) КАК ВложенныйЗапрос
	|			ПО ВозможныеФормулыРасчетаНорматива.Организация = ВложенныйЗапрос.Организация
	|				И ВозможныеФормулыРасчетаНорматива.ПериодНачисления = ВложенныйЗапрос.ПериодНачисления
	|				И ВозможныеФормулыРасчетаНорматива.Район = ВложенныйЗапрос.Район
	|				И ВозможныеФормулыРасчетаНорматива.МКД = ВложенныйЗапрос.МКД
	|				И ВозможныеФормулыРасчетаНорматива.Услуга = ВложенныйЗапрос.Услуга
	|				И ВозможныеФормулыРасчетаНорматива.КоличествоСовпадений = ВложенныйЗапрос.КоличествоСовпадений
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ВозможныеФормулыРасчетаНорматива.Организация,
	|		ВозможныеФормулыРасчетаНорматива.ПериодНачисления,
	|		ВозможныеФормулыРасчетаНорматива.Район,
	|		ВозможныеФормулыРасчетаНорматива.МКД,
	|		ВозможныеФормулыРасчетаНорматива.Услуга) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.энргФормулыРасчетаНорматива КАК энргФормулыРасчетаНорматива
	|		ПО ВложенныйЗапрос.ФормулаРасчетаНорматива = энргФормулыРасчетаНорматива.Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	УслугиМКДРаспределять.Организация КАК Организация,
	|	УслугиМКДРаспределять.ПериодНачисления КАК ПериодНачисления,
	|	УслугиМКДРаспределять.Район КАК Район,
	|	УслугиМКДРаспределять.МКД КАК МКД,
	|	УслугиМКДРаспределять.Услуга КАК Услуга,
	|	УслугиМКДРаспределять.ПлощадьМОП КАК ПлощадьМОП,
	|	ЕСТЬNULL(ВЫРАЗИТЬ(ФормулыРасчетаНорматива.ФормулаРасчетаНормативаПотребления КАК СТРОКА(1000)), """") КАК ФормулаРасчетаНормативаПотребления,
	|	ЕСТЬNULL(ЗначенияТекущихНормПотребления.ЗначениеНорматива, 0) КАК ЗначениеНорматива,
	|	энргВидыУслуг.ВидПлощади КАК ВидПлощади,
	|	энргВидыУслуг.ЗависитОтУслуги КАК ЗависитОтУслуги,
	|	ЕСТЬNULL(МКДНеНачислятьТЭ.НеНачислять, ЛОЖЬ) КАК НеНачислятьУслугуАбонентам,
	|	УслугиМКДРаспределять.ЗавершениеОП КАК ЗавершениеОП
	|ПОМЕСТИТЬ УслугиМКДРаспределятьВспомогательныеДанные
	|ИЗ
	|	УслугиМКДРаспределять КАК УслугиМКДРаспределять
	|		ЛЕВОЕ СОЕДИНЕНИЕ ФормулыРасчетаНорматива КАК ФормулыРасчетаНорматива
	|		ПО УслугиМКДРаспределять.Организация = ФормулыРасчетаНорматива.Организация
	|			И УслугиМКДРаспределять.ПериодНачисления = ФормулыРасчетаНорматива.ПериодНачисления
	|			И УслугиМКДРаспределять.Район = ФормулыРасчетаНорматива.Район
	|			И УслугиМКДРаспределять.МКД = ФормулыРасчетаНорматива.МКД
	|			И УслугиМКДРаспределять.Услуга = ФормулыРасчетаНорматива.Услуга
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.энргВидыУслуг КАК энргВидыУслуг
	|		ПО УслугиМКДРаспределять.Услуга = энргВидыУслуг.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ ЗначенияТекущихНормПотребления КАК ЗначенияТекущихНормПотребления
	|		ПО УслугиМКДРаспределять.Организация = ЗначенияТекущихНормПотребления.Организация
	|			И УслугиМКДРаспределять.ПериодНачисления = ЗначенияТекущихНормПотребления.ПериодНачисления
	|			И УслугиМКДРаспределять.Район = ЗначенияТекущихНормПотребления.Район
	|			И УслугиМКДРаспределять.КлючНорматива = ЗначенияТекущихНормПотребления.КлючНорматива
	|			И УслугиМКДРаспределять.Услуга = ЗначенияТекущихНормПотребления.Услуга
	|		ЛЕВОЕ СОЕДИНЕНИЕ МКДНеНачислятьТЭ КАК МКДНеНачислятьТЭ
	|		ПО УслугиМКДРаспределять.Организация = МКДНеНачислятьТЭ.Организация
	|			И УслугиМКДРаспределять.ПериодНачисления = МКДНеНачислятьТЭ.ПериодНачисления
	|			И УслугиМКДРаспределять.Район = МКДНеНачислятьТЭ.Район
	|			И УслугиМКДРаспределять.МКД = МКДНеНачислятьТЭ.МКД
	|			И УслугиМКДРаспределять.Услуга = МКДНеНачислятьТЭ.Услуга
	|			И УслугиМКДРаспределять.ТипСхемы = МКДНеНачислятьТЭ.ТипСхемы
	|			И УслугиМКДРаспределять.ВидТепловогоПункта = МКДНеНачислятьТЭ.ПринадлежностьКТепловомуПункту
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.Строение КАК Строение,
	|	ВложенныйЗапрос.Помещение КАК Помещение,
	|	ВложенныйЗапрос.ОбъектРасчета КАК ОбъектРасчета,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	ВложенныйЗапрос.ТочкаУчета КАК ТочкаУчета,
	|	ВложенныйЗапрос.НомерПозиции КАК НомерПозиции,
	|	энргВидыУслуг.НачислятьПоСостояниюНаНачалоРасчетногоПериода КАК НачислятьПоСостояниюНаНачалоРасчетногоПериода
	|ПОМЕСТИТЬ ПоследниеНомераСтрока
	|ИЗ
	|	(ВЫБРАТЬ
	|		ДокументыДляРаспределения.Организация КАК Организация,
	|		ДокументыДляРаспределения.ПериодНачисления КАК ПериодНачисления,
	|		ДокументыДляРаспределения.Район КАК Район,
	|		ДокументыДляРаспределения.Строение КАК Строение,
	|		энргСтабильныеПериоды.Помещение КАК Помещение,
	|		NULL КАК ОбъектРасчета,
	|		энргСтабильныеПериоды.Услуга КАК Услуга,
	|		энргСтабильныеПериоды.ТочкаУчета КАК ТочкаУчета,
	|		МАКСИМУМ(энргСтабильныеПериоды.НомерПозиции) КАК НомерПозиции
	|	ИЗ
	|		ДокументыДляРаспределения КАК ДокументыДляРаспределения
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргСтабильныеПериоды КАК энргСтабильныеПериоды
	|			ПО ДокументыДляРаспределения.Организация = энргСтабильныеПериоды.Организация
	|				И ДокументыДляРаспределения.ПериодНачисления = энргСтабильныеПериоды.ПериодНачисления
	|				И ДокументыДляРаспределения.Район = энргСтабильныеПериоды.Район
	|				И ДокументыДляРаспределения.Строение = энргСтабильныеПериоды.Строение
	|				И (энргСтабильныеПериоды.Организация = &Организация)
	|				И (энргСтабильныеПериоды.Район = &Район)
	|				И (НЕ энргСтабильныеПериоды.ЧастныйСектор)
	|				И (энргСтабильныеПериоды.Строение = &Строение)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ДокументыДляРаспределения.Организация,
	|		ДокументыДляРаспределения.ПериодНачисления,
	|		ДокументыДляРаспределения.Район,
	|		ДокументыДляРаспределения.Строение,
	|		энргСтабильныеПериоды.Помещение,
	|		энргСтабильныеПериоды.Услуга,
	|		энргСтабильныеПериоды.ТочкаУчета
	|	
	|	ОБЪЕДИНИТЬ
	|	
	|	ВЫБРАТЬ
	|		ДокументыДляРаспределения.Организация,
	|		ДокументыДляРаспределения.ПериодНачисления,
	|		ДокументыДляРаспределения.Район,
	|		энргНомераСтрокСтабильногоПериода.МКД,
	|		энргНомераСтрокСтабильногоПериода.Договор,
	|		энргНомераСтрокСтабильногоПериода.ОбъектРасчета,
	|		энргНомераСтрокСтабильногоПериода.Услуга,
	|		энргНомераСтрокСтабильногоПериода.ТочкаУчета,
	|		МАКСИМУМ(энргНомераСтрокСтабильногоПериода.НомерПозиции)
	|	ИЗ
	|		ДокументыДляРаспределения КАК ДокументыДляРаспределения
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.бестНомераСтрокСтабильногоПериодаНП КАК энргНомераСтрокСтабильногоПериода
	|			ПО ДокументыДляРаспределения.Организация = энргНомераСтрокСтабильногоПериода.Организация
	|				И ДокументыДляРаспределения.ПериодНачисления = энргНомераСтрокСтабильногоПериода.ПериодНачисления
	|				И ДокументыДляРаспределения.Район = энргНомераСтрокСтабильногоПериода.Район
	|				И (энргНомераСтрокСтабильногоПериода.Организация = &Организация)
	|				И (энргНомераСтрокСтабильногоПериода.Район = &Район)
	|				И (энргНомераСтрокСтабильногоПериода.МКД = &Строение)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ДокументыДляРаспределения.Организация,
	|		ДокументыДляРаспределения.ПериодНачисления,
	|		ДокументыДляРаспределения.Район,
	|		энргНомераСтрокСтабильногоПериода.Договор,
	|		энргНомераСтрокСтабильногоПериода.ОбъектРасчета,
	|		энргНомераСтрокСтабильногоПериода.Услуга,
	|		энргНомераСтрокСтабильногоПериода.ТочкаУчета,
	|		энргНомераСтрокСтабильногоПериода.МКД) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.энргВидыУслуг КАК энргВидыУслуг
	|		ПО ВложенныйЗапрос.Услуга = энргВидыУслуг.Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПоследниеНомераСтрока.Организация КАК Организация,
	|	ПоследниеНомераСтрока.ПериодНачисления КАК ПериодНачисления,
	|	ПоследниеНомераСтрока.Район КАК Район,
	|	ПоследниеНомераСтрока.Строение КАК Строение,
	|	энргСтабильныеПериоды.Помещение КАК Помещение,
	|	энргСтабильныеПериоды.Абонент КАК Абонент,
	|	ПоследниеНомераСтрока.Услуга КАК Услуга,
	|	МИНИМУМ(ВЫБОР
	|			КОГДА энргСтабильныеПериоды.ПриборВведен
	|				ТОГДА 1
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК КоличествоПриборов,
	|	МАКСИМУМ(энргСтабильныеПериоды.ЗначениеПлощади) КАК ЗначениеПлощади,
	|	МАКСИМУМ(энргСтабильныеПериоды.КоличествоЖильцов) КАК КоличествоЖильцов,
	|	МАКСИМУМ(ВЫБОР
	|			КОГДА энргСтабильныеПериоды.Абонент.ФизЛицо = энргСтабильныеПериоды.Поставщик
	|					ИЛИ энргСтабильныеПериоды.Поставщик = ЗНАЧЕНИЕ(Справочник.энргКонтрагенты.ПустаяСсылка)
	|				ТОГДА энргСтабильныеПериоды.ЗначениеПлощади
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПлощадьСобственнаяПоставка,
	|	МАКСИМУМ(энргСтабильныеПериоды.ТарифнаяГруппа) КАК ТарифнаяГруппа,
	|	энргСтабильныеПериоды.Поставщик КАК Поставщик,
	|	NULL КАК Договор
	|ПОМЕСТИТЬ АбонентыДляРаспределения
	|ИЗ
	|	ПоследниеНомераСтрока КАК ПоследниеНомераСтрока
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргСтабильныеПериоды КАК энргСтабильныеПериоды
	|		ПО ПоследниеНомераСтрока.Организация = энргСтабильныеПериоды.Организация
	|			И ПоследниеНомераСтрока.ПериодНачисления = энргСтабильныеПериоды.ПериодНачисления
	|			И (энргСтабильныеПериоды.Организация = &Организация)
	|			И (энргСтабильныеПериоды.Район = &Район)
	|			И (НЕ энргСтабильныеПериоды.ЧастныйСектор)
	|			И (энргСтабильныеПериоды.Строение = &Строение)
	|			И ПоследниеНомераСтрока.Район = энргСтабильныеПериоды.Район
	|			И ПоследниеНомераСтрока.Строение = энргСтабильныеПериоды.Строение
	|			И ПоследниеНомераСтрока.Помещение = энргСтабильныеПериоды.Помещение
	|			И ПоследниеНомераСтрока.Услуга = энргСтабильныеПериоды.Услуга
	|			И ПоследниеНомераСтрока.ТочкаУчета = энргСтабильныеПериоды.ТочкаУчета
	|			И (ВЫБОР
	|				КОГДА ПоследниеНомераСтрока.НачислятьПоСостояниюНаНачалоРасчетногоПериода
	|					ТОГДА энргСтабильныеПериоды.НомерПозиции = 0
	|				ИНАЧЕ ПоследниеНомераСтрока.НомерПозиции = энргСтабильныеПериоды.НомерПозиции
	|			КОНЕЦ)
	|			И (энргСтабильныеПериоды.УслугаПодключена)
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.энргПомещения КАК энргПомещения
	|		ПО ПоследниеНомераСтрока.Помещение = энргПомещения.Ссылка
	|			И (энргПомещения.Родитель = ЗНАЧЕНИЕ(Справочник.энргПомещения.ПустаяСсылка))
	|
	|СГРУППИРОВАТЬ ПО
	|	ПоследниеНомераСтрока.Организация,
	|	ПоследниеНомераСтрока.ПериодНачисления,
	|	ПоследниеНомераСтрока.Район,
	|	ПоследниеНомераСтрока.Строение,
	|	энргСтабильныеПериоды.Помещение,
	|	энргСтабильныеПериоды.Абонент,
	|	ПоследниеНомераСтрока.Услуга,
	|	энргСтабильныеПериоды.Поставщик,
	|	энргСтабильныеПериоды.ЗначениеПлощади
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ
	|	ПоследниеНомераСтрока.Организация,
	|	ПоследниеНомераСтрока.ПериодНачисления,
	|	ПоследниеНомераСтрока.Район,
	|	ПоследниеНомераСтрока.Строение,
	|	энргСтабильныеПериоды.ОбъектРасчета,
	|	энргСтабильныеПериоды.ОбъектРасчета,
	|	ПоследниеНомераСтрока.Услуга,
	|	МИНИМУМ(ВЫБОР
	|			КОГДА энргСтабильныеПериоды.ПриборВведен
	|				ТОГДА 1
	|			ИНАЧЕ 0
	|		КОНЕЦ),
	|	МАКСИМУМ(энргСтабильныеПериоды.ЗначениеПлощади),
	|	МАКСИМУМ(0),
	|	МАКСИМУМ(ВЫБОР
	|			КОГДА энргСтабильныеПериоды.Договор.Контрагент = энргСтабильныеПериоды.Поставщик
	|					ИЛИ энргСтабильныеПериоды.Поставщик = ЗНАЧЕНИЕ(Справочник.энргКонтрагенты.ПустаяСсылка)
	|				ТОГДА энргСтабильныеПериоды.ЗначениеПлощади
	|			ИНАЧЕ 0
	|		КОНЕЦ),
	|	МАКСИМУМ(энргСтабильныеПериоды.ТарифнаяГруппа),
	|	&Поставщик,
	|	энргСтабильныеПериоды.Договор
	|ИЗ
	|	ПоследниеНомераСтрока КАК ПоследниеНомераСтрока
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.бестСтабильныеПериодыНП КАК энргСтабильныеПериоды
	|		ПО ПоследниеНомераСтрока.Организация = энргСтабильныеПериоды.Организация
	|			И ПоследниеНомераСтрока.ПериодНачисления = энргСтабильныеПериоды.ПериодНачисления
	|			И (энргСтабильныеПериоды.Организация = &Организация)
	|			И (энргСтабильныеПериоды.Район = &Район)
	|			И (энргСтабильныеПериоды.МКД = &Строение)
	|			И ПоследниеНомераСтрока.Район = энргСтабильныеПериоды.Район
	|			И ПоследниеНомераСтрока.Строение = энргСтабильныеПериоды.МКД
	|			И ПоследниеНомераСтрока.Помещение = энргСтабильныеПериоды.Договор
	|			И ПоследниеНомераСтрока.ОбъектРасчета = энргСтабильныеПериоды.ОбъектРасчета
	|			И ПоследниеНомераСтрока.Услуга = энргСтабильныеПериоды.Услуга
	|			И ПоследниеНомераСтрока.ТочкаУчета = энргСтабильныеПериоды.ТочкаУчета
	|			И (ВЫБОР
	|				КОГДА ПоследниеНомераСтрока.НачислятьПоСостояниюНаНачалоРасчетногоПериода
	|					ТОГДА энргСтабильныеПериоды.НомерПозиции = 0
	|				ИНАЧЕ ПоследниеНомераСтрока.НомерПозиции = энргСтабильныеПериоды.НомерПозиции
	|			КОНЕЦ)
	|			И (энргСтабильныеПериоды.ДоговорЗаключен)
	|			И (энргСтабильныеПериоды.ОбъектРасчетаПодключен)
	|			И (энргСтабильныеПериоды.УслугаПодключена)
	|			И (энргСтабильныеПериоды.Договор.ТипДоговора <> ЗНАЧЕНИЕ(Перечисление.бестТипыДоговоров.УправляющаяКомпания))
	|
	|СГРУППИРОВАТЬ ПО
	|	ПоследниеНомераСтрока.Организация,
	|	ПоследниеНомераСтрока.ПериодНачисления,
	|	ПоследниеНомераСтрока.Район,
	|	ПоследниеНомераСтрока.Строение,
	|	энргСтабильныеПериоды.Договор,
	|	энргСтабильныеПериоды.ОбъектРасчета,
	|	ПоследниеНомераСтрока.Услуга,
	|	энргСтабильныеПериоды.ЗначениеПлощади,
	|	энргСтабильныеПериоды.ОбъектРасчета
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПоследниеНомераСтрока.Организация КАК Организация,
	|	ПоследниеНомераСтрока.ПериодНачисления КАК ПериодНачисления,
	|	ПоследниеНомераСтрока.Район КАК Район,
	|	ПоследниеНомераСтрока.Строение КАК Строение,
	|	энргПомещения.Родитель КАК ПомещениеРодитель,
	|	энргСтабильныеПериоды.Помещение КАК Помещение,
	|	энргСтабильныеПериоды.Абонент КАК Абонент,
	|	ПоследниеНомераСтрока.Услуга КАК Услуга,
	|	МАКСИМУМ(энргСтабильныеПериоды.СпособРаспределенияОбъемаПомещения) КАК СпособРаспределенияОбъемаПомещения,
	|	МАКСИМУМ(энргСтабильныеПериоды.ФиксированныйОбъемПотребления) КАК ФиксированныйОбъемПотребления,
	|	МАКСИМУМ(энргСтабильныеПериоды.ДоляПотребленияЧислитель) КАК ДоляПотребленияЧислитель,
	|	МАКСИМУМ(энргСтабильныеПериоды.ДоляПотребленияЗнаменатель) КАК ДоляПотребленияЗнаменатель,
	|	МАКСИМУМ(энргСтабильныеПериоды.ЗначениеПлощади) КАК ЗначениеПлощади,
	|	МАКСИМУМ(энргСтабильныеПериоды.КоличествоПроживающих) КАК КоличествоПроживающих,
	|	МАКСИМУМ(энргСтабильныеПериоды.ТарифнаяГруппа) КАК ТарифнаяГруппа,
	|	МАКСИМУМ(энргСтабильныеПериоды.Поставщик) КАК Поставщик
	|ПОМЕСТИТЬ АбонентыРазделенныеЛицевыеСчета
	|ИЗ
	|	ПоследниеНомераСтрока КАК ПоследниеНомераСтрока
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргСтабильныеПериоды КАК энргСтабильныеПериоды
	|		ПО ПоследниеНомераСтрока.Организация = энргСтабильныеПериоды.Организация
	|			И ПоследниеНомераСтрока.ПериодНачисления = энргСтабильныеПериоды.ПериодНачисления
	|			И (энргСтабильныеПериоды.Организация = &Организация)
	|			И (энргСтабильныеПериоды.Район = &Район)
	|			И (НЕ энргСтабильныеПериоды.ЧастныйСектор)
	|			И (энргСтабильныеПериоды.Строение = &Строение)
	|			И ПоследниеНомераСтрока.Район = энргСтабильныеПериоды.Район
	|			И ПоследниеНомераСтрока.Строение = энргСтабильныеПериоды.Строение
	|			И ПоследниеНомераСтрока.Помещение = энргСтабильныеПериоды.Помещение
	|			И ПоследниеНомераСтрока.Услуга = энргСтабильныеПериоды.Услуга
	|			И ПоследниеНомераСтрока.ТочкаУчета = энргСтабильныеПериоды.ТочкаУчета
	|			И (ВЫБОР
	|				КОГДА ПоследниеНомераСтрока.НачислятьПоСостояниюНаНачалоРасчетногоПериода
	|					ТОГДА энргСтабильныеПериоды.НомерПозиции = 0
	|				ИНАЧЕ ПоследниеНомераСтрока.НомерПозиции = энргСтабильныеПериоды.НомерПозиции
	|			КОНЕЦ)
	|			И (энргСтабильныеПериоды.УслугаПодключена)
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.энргПомещения КАК энргПомещения
	|		ПО ПоследниеНомераСтрока.Помещение = энргПомещения.Ссылка
	|			И (НЕ энргПомещения.Родитель = ЗНАЧЕНИЕ(Справочник.энргПомещения.ПустаяСсылка))
	|
	|СГРУППИРОВАТЬ ПО
	|	ПоследниеНомераСтрока.Организация,
	|	ПоследниеНомераСтрока.ПериодНачисления,
	|	ПоследниеНомераСтрока.Район,
	|	ПоследниеНомераСтрока.Строение,
	|	энргСтабильныеПериоды.Помещение,
	|	энргПомещения.Родитель,
	|	энргСтабильныеПериоды.Абонент,
	|	ПоследниеНомераСтрока.Услуга
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.Строение КАК Строение,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	ВложенныйЗапрос.ВсегоАбонентов КАК ВсегоАбонентов,
	|	ВложенныйЗапрос.ВсегоСУстановелннымПриборомУчета КАК ВсегоСУстановелннымПриборомУчета,
	|	ВложенныйЗапрос.ВсегоПлощадьАбонентов КАК ВсегоПлощадьАбонентов,
	|	ВложенныйЗапрос.ВсегоПлощадьАбонентовСобственнаяПоставка КАК ВсегоПлощадьАбонентовСобственнаяПоставка,
	|	ЕСТЬNULL(ДокументыРаспределенияМКД.ДокументНачисления, ЗНАЧЕНИЕ(Документ.энргРаспределениеМКД.ПустаяСсылка)) КАК ДокументРаспределения,
	|	ВЫБОР
	|		КОГДА энргВидыУслуг.ВидПлощадиМКД = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ ИСТИНА
	|	КОНЕЦ КАК ПлощадьМОПУказана,
	|	энргВидыУслуг.КорректироватьИндивидуальныйОбъемСУчетомОДПУ КАК КорректироватьИндивидуальныйОбъемСУчетомОДПУ,
	|	энргВидыУслуг.ЗависитОтУслуги КАК ЗависитОтУслуги
	|ПОМЕСТИТЬ ДанныеМКДПоУслугам
	|ИЗ
	|	(ВЫБРАТЬ
	|		АбонентыДляРаспределения.Организация КАК Организация,
	|		АбонентыДляРаспределения.ПериодНачисления КАК ПериодНачисления,
	|		АбонентыДляРаспределения.Район КАК Район,
	|		АбонентыДляРаспределения.Строение КАК Строение,
	|		АбонентыДляРаспределения.Услуга КАК Услуга,
	|		КОЛИЧЕСТВО(РАЗЛИЧНЫЕ АбонентыДляРаспределения.Помещение) КАК ВсегоАбонентов,
	|		СУММА(АбонентыДляРаспределения.КоличествоПриборов) КАК ВсегоСУстановелннымПриборомУчета,
	|		СУММА(АбонентыДляРаспределения.ЗначениеПлощади) КАК ВсегоПлощадьАбонентов,
	|		СУММА(АбонентыДляРаспределения.ПлощадьСобственнаяПоставка) КАК ВсегоПлощадьАбонентовСобственнаяПоставка
	|	ИЗ
	|		АбонентыДляРаспределения КАК АбонентыДляРаспределения
	|	
	|	СГРУППИРОВАТЬ ПО
	|		АбонентыДляРаспределения.Организация,
	|		АбонентыДляРаспределения.ПериодНачисления,
	|		АбонентыДляРаспределения.Район,
	|		АбонентыДляРаспределения.Строение,
	|		АбонентыДляРаспределения.Услуга) КАК ВложенныйЗапрос
	|		ЛЕВОЕ СОЕДИНЕНИЕ ДокументыРаспределенияМКД КАК ДокументыРаспределенияМКД
	|		ПО ВложенныйЗапрос.Организация = ДокументыРаспределенияМКД.Организация
	|			И ВложенныйЗапрос.ПериодНачисления = ДокументыРаспределенияМКД.ПериодНачисления
	|			И ВложенныйЗапрос.Район = ДокументыРаспределенияМКД.Район
	|			И ВложенныйЗапрос.Строение = ДокументыРаспределенияМКД.МКД
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.энргВидыУслуг КАК энргВидыУслуг
	|		ПО ВложенныйЗапрос.Услуга = энргВидыУслуг.Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	УслугиМКДРаспределятьВспомогательныеДанные.Район КАК Район,
	|	УслугиМКДРаспределятьВспомогательныеДанные.МКД КАК Строение,
	|	УслугиМКДРаспределятьВспомогательныеДанные.Услуга КАК Услуга,
	|	УслугиМКДРаспределятьВспомогательныеДанные.ПлощадьМОП КАК ПлощадьМОП,
	|	УслугиМКДРаспределятьВспомогательныеДанные.ВидПлощади КАК ВидПлощади,
	|	УслугиМКДРаспределятьВспомогательныеДанные.ЗависитОтУслуги КАК ЗависитОтУслуги,
	|	УслугиМКДРаспределятьВспомогательныеДанные.ЗначениеНорматива КАК ЗначениеНорматива,
	|	УслугиМКДРаспределятьВспомогательныеДанные.ФормулаРасчетаНормативаПотребления КАК ФормулаРасчетаНорматива,
	|	УслугиМКДРаспределятьВспомогательныеДанные.НеНачислятьУслугуАбонентам КАК НеНачислятьУслугуАбонентам,
	|	ЕСТЬNULL(НачисленныйОбъемМКД.ОбъемУслугиНормативОборот, 0) КАК ОбъемУслугиНормативОборот,
	|	ЕСТЬNULL(НачисленныйОбъемМКД.ТарифнаяЗона, ЗНАЧЕНИЕ(Справочник.энргТарифныеЗоны.БезРазбивки)) КАК ТарифнаяЗона,
	|	ЕСТЬNULL(НачисленныйОбъемМКД.СпособНачисления, ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.ПустаяСсылка)) КАК СпособНачисления,
	|	ЕСТЬNULL(НачисленныйОбъемМКД.ОбъемУслугиОборот, 0) КАК ОбъемУслугиОборот,
	|	ЕСТЬNULL(НачисленныйОбъемМКД.ОбъемУслугиПотребленныйОборот, 0) КАК ОбъемУслугиПотребленныйОборот,
	|	ЕСТЬNULL(НачисленныйОбъемМКД.ПоказанияПредоставленыОборот, 0) КАК ПоказанияПредоставлены,
	|	ЕСТЬNULL(НачисленныйОбъемМКД.ПоказанияПредоставленыПотребленныйОборот, 0) КАК ПоказанияПредоставленыПотребленный,
	|	ЕСТЬNULL(ИсторияСоглашенийОРаспределенииСверхнормативногоОДН.РаспределятьПолностью, ЛОЖЬ) КАК РаспределятьПолностью,
	|	УслугиМКДРаспределятьВспомогательныеДанные.ЗавершениеОП КАК ЗавершениеОП
	|ПОМЕСТИТЬ ОбъемыДляРаспределения
	|ИЗ
	|	УслугиМКДРаспределятьВспомогательныеДанные КАК УслугиМКДРаспределятьВспомогательныеДанные
	|		ЛЕВОЕ СОЕДИНЕНИЕ НачисленныйОбъемМКД КАК НачисленныйОбъемМКД
	|		ПО УслугиМКДРаспределятьВспомогательныеДанные.Организация = НачисленныйОбъемМКД.Организация
	|			И УслугиМКДРаспределятьВспомогательныеДанные.ПериодНачисления = НачисленныйОбъемМКД.ПериодНачисления
	|			И УслугиМКДРаспределятьВспомогательныеДанные.Район = НачисленныйОбъемМКД.Район
	|			И УслугиМКДРаспределятьВспомогательныеДанные.МКД = НачисленныйОбъемМКД.МКД
	|			И УслугиМКДРаспределятьВспомогательныеДанные.Услуга = НачисленныйОбъемМКД.Услуга
	|		ЛЕВОЕ СОЕДИНЕНИЕ ИсторияСоглашенийОРаспределенииСверхнормативногоОДН КАК ИсторияСоглашенийОРаспределенииСверхнормативногоОДН
	|		ПО УслугиМКДРаспределятьВспомогательныеДанные.Организация = ИсторияСоглашенийОРаспределенииСверхнормативногоОДН.Организация
	|			И УслугиМКДРаспределятьВспомогательныеДанные.ПериодНачисления = ИсторияСоглашенийОРаспределенииСверхнормативногоОДН.ПериодНачисления
	|			И УслугиМКДРаспределятьВспомогательныеДанные.Район = ИсторияСоглашенийОРаспределенииСверхнормативногоОДН.Район
	|			И УслугиМКДРаспределятьВспомогательныеДанные.МКД = ИсторияСоглашенийОРаспределенииСверхнормативногоОДН.МКД
	|			И УслугиМКДРаспределятьВспомогательныеДанные.Услуга = ИсторияСоглашенийОРаспределенииСверхнормативногоОДН.Услуга
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргОбъемНачисленийОбороты.Организация КАК Организация,
	|	энргОбъемНачисленийОбороты.Район КАК Район,
	|	энргОбъемНачисленийОбороты.Распределение КАК Распределение,
	|	энргОбъемНачисленийОбороты.Строение КАК Строение,
	|	энргОбъемНачисленийОбороты.Помещение КАК Помещение,
	|	энргОбъемНачисленийОбороты.Абонент КАК Абонент,
	|	энргОбъемНачисленийОбороты.Услуга КАК Услуга,
	|	энргОбъемНачисленийОбороты.ТочкаУчета КАК ТочкаУчета,
	|	энргОбъемНачисленийОбороты.ВидНачисления КАК ВидНачисления,
	|	энргОбъемНачисленийОбороты.СпособНачисления КАК СпособНачисления,
	|	энргОбъемНачисленийОбороты.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	энргОбъемНачисленийОбороты.Измеритель КАК Измеритель,
	|	энргОбъемНачисленийОбороты.ПриборУчета КАК ПриборУчета,
	|	энргОбъемНачисленийОбороты.Шкала КАК Шкала,
	|	энргОбъемНачисленийОбороты.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргОбъемНачисленийОбороты.ЗначениеТарифа КАК ЗначениеТарифа,
	|	энргОбъемНачисленийОбороты.Поставщик КАК Поставщик,
	|	энргОбъемНачисленийОбороты.ПериодРасчета КАК ПериодРасчета,
	|	энргОбъемНачисленийОбороты.ПериодНачисления КАК ПериодНачисления,
	|	энргОбъемНачисленийОбороты.ЧастныйСектор КАК ЧастныйСектор,
	|	энргОбъемНачисленийОбороты.СверхНорматива КАК СверхНорматива,
	|	энргОбъемНачисленийОбороты.Сумма КАК Сумма,
	|	энргОбъемНачисленийОбороты.ОбъемУслуги КАК ОбъемУслуги,
	|	энргОбъемНачисленийОбороты.ОбъемУслугиПотребленный КАК ОбъемУслугиПотребленный,
	|	энргОбъемНачисленийОбороты.ОбъемУслугиСоцНорма КАК ОбъемУслугиСоцНорма,
	|	энргОбъемНачисленийОбороты.СуммаПоПовышенномуКоэффициенту КАК СуммаПоПовышенномуКоэффициенту,
	|	энргОбъемНачисленийОбороты.НачалоПериода КАК НачалоПериода,
	|	энргОбъемНачисленийОбороты.КонецПериода КАК КонецПериода,
	|	энргОбъемНачисленийОбороты.НачальныеПоказания КАК НачальныеПоказания,
	|	энргОбъемНачисленийОбороты.КонечныеПоказания КАК КонечныеПоказания,
	|	энргОбъемНачисленийОбороты.КоличествоКомнат КАК КоличествоКомнат,
	|	энргОбъемНачисленийОбороты.КоличествоПрописанных КАК КоличествоПрописанных,
	|	0 КАК КоличествоЖильцов,
	|	энргОбъемНачисленийОбороты.ЗначениеПлощади КАК ЗначениеПлощади,
	|	энргОбъемНачисленийОбороты.НормаПотребления КАК НормаПотребления,
	|	энргОбъемНачисленийОбороты.КоэффициентПУ КАК КоэффициентПУ,
	|	энргОбъемНачисленийОбороты.РасчетПоФормуле КАК РасчетПоФормуле,
	|	энргОбъемНачисленийОбороты.ВидБлагоустройства КАК ВидБлагоустройства,
	|	энргОбъемНачисленийОбороты.ТарифнаяГруппа КАК ТарифнаяГруппа,
	|	энргОбъемНачисленийОбороты.ДатаПоверки КАК ДатаПоверки,
	|	энргОбъемНачисленийОбороты.ОтключатьВНеполивнойСезон КАК ОтключатьВНеполивнойСезон,
	|	энргОбъемНачисленийОбороты.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|	энргОбъемНачисленийОбороты.КоэффициентФормула КАК КоэффициентФормула,
	|	энргОбъемНачисленийОбороты.ВидДифференцированности КАК ВидДифференцированности,
	|	энргОбъемНачисленийОбороты.ОснованиеПерерасчета КАК ОснованиеПерерасчета,
	|	энргОбъемНачисленийОбороты.ОснованиеПерерасчетаДата КАК ОснованиеПерерасчетаДата,
	|	энргОбъемНачисленийОбороты.ПриборЗависимой КАК ПриборЗависимой,
	|	энргОбъемНачисленийОбороты.СписатьИзНормы КАК СписатьИзНормы,
	|	энргОбъемНачисленийОбороты.ПовыщающийКоэффициент КАК ПовыщающийКоэффициент,
	|	энргОбъемНачисленийОбороты.КоличествоСобственников КАК КоличествоСобственников,
	|	энргОбъемНачисленийОбороты.КоличествоПроживающих КАК КоличествоПроживающих,
	|	энргОбъемНачисленийОбороты.СниматьНачисленныйСредний КАК СниматьНачисленныйСредний,
	|	энргОбъемНачисленийОбороты.ПлощадьМОП КАК ПлощадьМОП,
	|	энргОбъемНачисленийОбороты.ПлощадьАбонентов КАК ПлощадьАбонентов,
	|	энргОбъемНачисленийОбороты.ПлощадьСобственнаяПоставка КАК ПлощадьСобственнаяПоставка,
	|	энргОбъемНачисленийОбороты.КоэффициентРаспределенияОстатка КАК КоэффициентРаспределенияОстатка,
	|	энргОбъемНачисленийОбороты.ЗначениеСоциальнойНормы КАК ЗначениеСоциальнойНормы,
	|	энргОбъемНачисленийОбороты.СоставнаяУслуга КАК СоставнаяУслуга,
	|	энргОбъемНачисленийОбороты.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	энргОбъемНачисленийОбороты.ПомещениеРодитель КАК ПомещениеРодитель
	|ПОМЕСТИТЬ ОбъемНачислений
	|ИЗ
	|	РегистрНакопления.энргОбъемНачислений КАК энргОбъемНачисленийОбороты
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДокументыНачислений КАК ДокументыНачислений
	|		ПО (НАЧАЛОПЕРИОДА(энргОбъемНачисленийОбороты.Период, МЕСЯЦ) = ДокументыНачислений.ПериодНачисления)
	|			И энргОбъемНачисленийОбороты.Регистратор = ДокументыНачислений.ДокументНачисления
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	энргОбъемНачисленийОбороты.Организация,
	|	энргОбъемНачисленийОбороты.Район,
	|	энргОбъемНачисленийОбороты.Распределение,
	|	энргОбъемНачисленийОбороты.Строение,
	|	энргОбъемНачисленийОбороты.Помещение,
	|	ЗНАЧЕНИЕ(Справочник.энргАбоненты.ПустаяСсылка),
	|	энргОбъемНачисленийОбороты.Услуга,
	|	энргОбъемНачисленийОбороты.ТочкаУчета,
	|	энргОбъемНачисленийОбороты.ВидНачисления,
	|	энргОбъемНачисленийОбороты.СпособНачисления,
	|	ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление),
	|	ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ПустаяСсылка),
	|	энргОбъемНачисленийОбороты.ПриборУчета,
	|	энргОбъемНачисленийОбороты.Шкала,
	|	энргОбъемНачисленийОбороты.ТарифнаяЗона,
	|	0,
	|	энргОбъемНачисленийОбороты.Поставщик,
	|	энргОбъемНачисленийОбороты.ПериодРасчета,
	|	энргОбъемНачисленийОбороты.ПериодНачисления,
	|	энргОбъемНачисленийОбороты.ЧастныйСектор,
	|	энргОбъемНачисленийОбороты.СверхНорматива,
	|	0,
	|	энргОбъемНачисленийОбороты.ОбъемУслуги,
	|	энргОбъемНачисленийОбороты.ОбъемУслугиПотребленный,
	|	0,
	|	0,
	|	энргОбъемНачисленийОбороты.НачалоПериода,
	|	энргОбъемНачисленийОбороты.КонецПериода,
	|	энргОбъемНачисленийОбороты.НачальныеПоказания,
	|	энргОбъемНачисленийОбороты.КонечныеПоказания,
	|	энргОбъемНачисленийОбороты.КоличествоКомнат,
	|	0,
	|	энргОбъемНачисленийОбороты.КоличествоЖильцов,
	|	энргОбъемНачисленийОбороты.ЗначениеПлощади,
	|	энргОбъемНачисленийОбороты.НормаПотребления,
	|	энргОбъемНачисленийОбороты.КоэффициентПУ,
	|	энргОбъемНачисленийОбороты.РасчетПоФормуле,
	|	энргОбъемНачисленийОбороты.ВидБлагоустройства,
	|	энргОбъемНачисленийОбороты.ТарифнаяГруппа,
	|	энргОбъемНачисленийОбороты.ДатаПоверки,
	|	энргОбъемНачисленийОбороты.ОтключатьВНеполивнойСезон,
	|	энргОбъемНачисленийОбороты.ЗависимаяТочкаУчета,
	|	энргОбъемНачисленийОбороты.КоэффициентРасчета,
	|	энргОбъемНачисленийОбороты.ВидДифференцированности,
	|	энргОбъемНачисленийОбороты.ОснованиеПерерасчета,
	|	энргОбъемНачисленийОбороты.ОснованиеПерерасчетаДата,
	|	энргОбъемНачисленийОбороты.ПриборЗависимой,
	|	энргОбъемНачисленийОбороты.СписатьИзНормы,
	|	энргОбъемНачисленийОбороты.ПовыщающийКоэффициент,
	|	0,
	|	0,
	|	энргОбъемНачисленийОбороты.СниматьНачисленныйСредний,
	|	энргОбъемНачисленийОбороты.ПлощадьМОП,
	|	0,
	|	энргОбъемНачисленийОбороты.ПлощадьСобственнаяПоставка,
	|	0,
	|	0,
	|	ЗНАЧЕНИЕ(Справочник.энргВидыУслуг.ПустаяСсылка),
	|	ЛОЖЬ,
	|	ЗНАЧЕНИЕ(Справочник.энргПомещения.Пустаяссылка)
	|ИЗ
	|	РегистрНакопления.энргОбъемНачисленийПомещенийСРазделеннымиЛС КАК энргОбъемНачисленийОбороты
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДокументыНачислений КАК ДокументыНачислений
	|		ПО (НАЧАЛОПЕРИОДА(энргОбъемНачисленийОбороты.Период, МЕСЯЦ) = ДокументыНачислений.ПериодНачисления)
	|			И энргОбъемНачисленийОбороты.Регистратор = ДокументыНачислений.ДокументНачисления";
	
	Если Строение = Неопределено Тогда		
		Текст 						= СтрЗаменить(Текст,"И (энргРаспределениеМКД.МКД = &Строение)","");
		Текст 						= СтрЗаменить(Текст,"И (энргНомераСтрокСтабильногоПериода.Строение = &Строение)","");
		Текст 						= СтрЗаменить(Текст,"И (энргСтабильныеПериодыМКД.Строение = &Строение)","");
		Текст 						= СтрЗаменить(Текст,"И (энргСтабильныеПериоды.Строение = &Строение)","");		
		Текст 						= СтрЗаменить(Текст,"И Строение = &Строение","");
		Текст 						= СтрЗаменить(Текст,"И (бестОбъектыРасчета.МКД = &Строение)","");
		Текст 						= СтрЗаменить(Текст,"И МКД = &Строение","");
		Текст 						= СтрЗаменить(Текст,"И (энргСтабильныеПериоды.МКД = &Строение)","");
		Текст 						= СтрЗаменить(Текст,"И (энргНомераСтрокСтабильногоПериода.МКД = &Строение)","");
		Текст 						= СтрЗаменить(Текст,"И (энргСтабильныеПериодыМКД.МКД = &Строение)","");
		Текст 						= СтрЗаменить(Текст,"И (энргДокументыНачислений.МКД = &Строение)","");		
	КонецЕсли;
	
	Возврат Текст;
	
КонецФункции

Функция ТекстЗапросаДанныеДляРаспределения(Строение)
	Текст 							= 
	"ВЫБРАТЬ
	|	ЗначенияТекущихТарифов.ПериодНачисления КАК ПериодНачисления,
	|	ЗначенияТекущихТарифов.ГруппаПотребителей КАК ГруппаПотребителей,
	|	ЗначенияТекущихТарифов.Услуга КАК Услуга,
	|	ЗначенияТекущихТарифов.Поставщик КАК Поставщик,
	|	ЗначенияТекущихТарифов.ТарифнаяЗона КАК ТарифнаяЗона,
	|	ЗначенияТекущихТарифов.Значение КАК Значение,
	|	ЗначенияТекущихТарифов.ЗначениеТарифаРЭК КАК ЗначениеТарифаРЭК,
	|	ЗначенияТекущихТарифов.ЗначениеСверхНорматива КАК ЗначениеСверхНорматива,
	|	ЗначенияТекущихТарифов.СтавкаНДС КАК СтавкаНДС,
	|	ЗначенияТекущихТарифов.НДСВнутри КАК НДСВнутри
	|ИЗ
	|	ЗначенияТекущихТарифов КАК ЗначенияТекущихТарифов
	|ГДЕ
	|	(ЗначенияТекущихТарифов.ГруппаПотребителей, ЗначенияТекущихТарифов.Услуга, ЗначенияТекущихТарифов.Поставщик) В
	|			(ВЫБРАТЬ
	|				АбонентыДляРаспределения.ТарифнаяГруппа,
	|				АбонентыДляРаспределения.Услуга,
	|				АбонентыДляРаспределения.Поставщик
	|			ИЗ
	|				АбонентыДляРаспределения КАК АбонентыДляРаспределения)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Строение КАК Строение,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	ВложенныйЗапрос.ВсегоАбонентов КАК ВсегоАбонентов,
	|	ВложенныйЗапрос.ПлощадьМОП КАК ПлощадьМОП,
	|	ВложенныйЗапрос.ВсегоСУстановелннымПриборомУчета КАК ВсегоСУстановелннымПриборомУчета,
	|	ВложенныйЗапрос.ВсегоПлощадьАбонентов КАК ВсегоПлощадьАбонентов,
	|	ВложенныйЗапрос.ВсегоПлощадьАбонентовСобственнаяПоставка КАК ВсегоПлощадьАбонентовСобственнаяПоставка,
	|	ВложенныйЗапрос.КорректироватьИндивидуальныйОбъемСУчетомОДПУ КАК КорректироватьИндивидуальныйОбъемСУчетомОДПУ,
	|	ВложенныйЗапрос.ОбъемУслуги КАК ОбъемУслуги,
	|	ВложенныйЗапрос.ОбъемУслугиПотребленный КАК ОбъемУслугиПотребленный,
	|	ВложенныйЗапрос.ОбъемУслугиНорматив КАК ОбъемУслугиНорматив,
	|	ВложенныйЗапрос.РаспределятьПолностью КАК РаспределятьПолностью,
	|	ВложенныйЗапрос.НачисленаТолькоНорма КАК НачисленаТолькоНорма,
	|	ВложенныйЗапрос.ДокументРаспределения КАК ДокументРаспределения,
	|	ВложенныйЗапрос.ЕстьНачислениеПоПриборам КАК ЕстьНачислениеПоПриборам,
	|	ВложенныйЗапрос.СпособНачисления КАК СпособНачисления,
	|	ВложенныйЗапрос.ТарифнаяЗона КАК ТарифнаяЗона,
	|	ВложенныйЗапрос.ПлощадьМОПУказана КАК ПлощадьМОПУказана,
	|	ВложенныйЗапрос.ВидПлощади КАК ВидПлощади,
	|	ВложенныйЗапрос.ЗависитОтУслуги КАК ЗависитОтУслуги,
	|	ВложенныйЗапрос.ЗначениеНорматива КАК ЗначениеНорматива,
	|	ВложенныйЗапрос.ФормулаРасчетаНорматива КАК ФормулаРасчетаНорматива,
	|	ВложенныйЗапрос.НеРаспределятьСверхнорматив КАК НеРаспределятьСверхнорматив,
	|	ВложенныйЗапрос.НеНачислятьУслугуАбонентам КАК НеНачислятьУслугуАбонентам,
	|	ВложенныйЗапрос.ПоказанияПредоставлены КАК ПоказанияПредоставлены,
	|	ВложенныйЗапрос.ПоказанияПредоставленыПотребленный КАК ПоказанияПредоставленыПотребленный,
	|	ВложенныйЗапрос.ЗавершениеОП КАК ЗавершениеОП
	|ИЗ
	|	(ВЫБРАТЬ
	|		ДанныеМКДПоУслугам.Организация КАК Организация,
	|		ДанныеМКДПоУслугам.Район КАК Район,
	|		ДанныеМКДПоУслугам.ПериодНачисления КАК ПериодНачисления,
	|		ДанныеМКДПоУслугам.Строение КАК Строение,
	|		ДанныеМКДПоУслугам.Услуга КАК Услуга,
	|		ДанныеМКДПоУслугам.ВсегоАбонентов КАК ВсегоАбонентов,
	|		ДанныеМКДПоУслугам.ВсегоСУстановелннымПриборомУчета КАК ВсегоСУстановелннымПриборомУчета,
	|		ДанныеМКДПоУслугам.ВсегоПлощадьАбонентов КАК ВсегоПлощадьАбонентов,
	|		ДанныеМКДПоУслугам.ВсегоПлощадьАбонентовСобственнаяПоставка КАК ВсегоПлощадьАбонентовСобственнаяПоставка,
	|		ДанныеМКДПоУслугам.ПлощадьМОПУказана КАК ПлощадьМОПУказана,
	|		ДанныеМКДПоУслугам.КорректироватьИндивидуальныйОбъемСУчетомОДПУ КАК КорректироватьИндивидуальныйОбъемСУчетомОДПУ,
	|		СУММА(ОбъемыДляРаспределения.ОбъемУслугиОборот) КАК ОбъемУслуги,
	|		СУММА(ОбъемыДляРаспределения.ОбъемУслугиПотребленныйОборот) КАК ОбъемУслугиПотребленный,
	|		СУММА(ОбъемыДляРаспределения.ОбъемУслугиНормативОборот) КАК ОбъемУслугиНорматив,
	|		МАКСИМУМ(ОбъемыДляРаспределения.РаспределятьПолностью) КАК РаспределятьПолностью,
	|		МАКСИМУМ(ВЫБОР
	|				КОГДА ОбъемыДляРаспределения.СпособНачисления = ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.ПоНормативу)
	|					ТОГДА ЛОЖЬ
	|				ИНАЧЕ ИСТИНА
	|			КОНЕЦ) КАК НачисленаТолькоНорма,
	|		МАКСИМУМ(ОбъемыДляРаспределения.ПлощадьМОП) КАК ПлощадьМОП,
	|		ДанныеМКДПоУслугам.ДокументРаспределения КАК ДокументРаспределения,
	|		МАКСИМУМ(ВЫБОР
	|				КОГДА ОбъемыДляРаспределения.СпособНачисления = ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.ПоПриборам)
	|					ТОГДА ЛОЖЬ
	|				ИНАЧЕ ИСТИНА
	|			КОНЕЦ) КАК ЕстьНачислениеПоПриборам,
	|		ОбъемыДляРаспределения.ТарифнаяЗона КАК ТарифнаяЗона,
	|		ОбъемыДляРаспределения.СпособНачисления КАК СпособНачисления,
	|		ОбъемыДляРаспределения.ВидПлощади КАК ВидПлощади,
	|		ОбъемыДляРаспределения.ЗависитОтУслуги КАК ЗависитОтУслуги,
	|		ОбъемыДляРаспределения.НеНачислятьУслугуАбонентам КАК НеНачислятьУслугуАбонентам,
	|		ВЫРАЗИТЬ(ОбъемыДляРаспределения.ФормулаРасчетаНорматива КАК СТРОКА(1000)) КАК ФормулаРасчетаНорматива,
	|		ОбъемыДляРаспределения.ЗначениеНорматива КАК ЗначениеНорматива,
	|		ВЫРАЗИТЬ(ДанныеМКДПоУслугам.Услуга КАК Справочник.энргВидыУслуг).НормативДляИндивидуальных
	|			И ВЫРАЗИТЬ(ДанныеМКДПоУслугам.Услуга КАК Справочник.энргВидыУслуг).КорректироватьИндивидуальныйОбъемСУчетомОДПУ КАК НеРаспределятьСверхнорматив,
	|		МАКСИМУМ(ОбъемыДляРаспределения.ПоказанияПредоставлены) КАК ПоказанияПредоставлены,
	|		МАКСИМУМ(ОбъемыДляРаспределения.ПоказанияПредоставленыПотребленный) КАК ПоказанияПредоставленыПотребленный,
	|		ОбъемыДляРаспределения.ЗавершениеОП
	|	ИЗ
	|		ДанныеМКДПоУслугам КАК ДанныеМКДПоУслугам
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ОбъемыДляРаспределения КАК ОбъемыДляРаспределения
	|			ПО ДанныеМКДПоУслугам.Район = ОбъемыДляРаспределения.Район
	|				И ДанныеМКДПоУслугам.Строение = ОбъемыДляРаспределения.Строение
	|				И ДанныеМКДПоУслугам.Услуга = ОбъемыДляРаспределения.Услуга
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ДанныеМКДПоУслугам.Организация,
	|		ДанныеМКДПоУслугам.Район,
	|		ДанныеМКДПоУслугам.ПериодНачисления,
	|		ДанныеМКДПоУслугам.Строение,
	|		ДанныеМКДПоУслугам.Услуга,
	|		ДанныеМКДПоУслугам.ВсегоАбонентов,
	|		ДанныеМКДПоУслугам.ВсегоСУстановелннымПриборомУчета,
	|		ДанныеМКДПоУслугам.ВсегоПлощадьАбонентов,
	|		ДанныеМКДПоУслугам.ВсегоПлощадьАбонентовСобственнаяПоставка,
	|		ДанныеМКДПоУслугам.КорректироватьИндивидуальныйОбъемСУчетомОДПУ,
	|		ДанныеМКДПоУслугам.ПлощадьМОПУказана,
	|		ОбъемыДляРаспределения.ТарифнаяЗона,
	|		ОбъемыДляРаспределения.СпособНачисления,
	|		ДанныеМКДПоУслугам.ДокументРаспределения,
	|		ОбъемыДляРаспределения.ВидПлощади,
	|		ОбъемыДляРаспределения.ЗависитОтУслуги,
	|		ВЫРАЗИТЬ(ОбъемыДляРаспределения.ФормулаРасчетаНорматива КАК СТРОКА(1000)),
	|		ОбъемыДляРаспределения.ЗначениеНорматива,
	|		ОбъемыДляРаспределения.НеНачислятьУслугуАбонентам,
	|		ОбъемыДляРаспределения.ЗавершениеОП) КАК ВложенныйЗапрос
	|
	|УПОРЯДОЧИТЬ ПО
	|	ВложенныйЗапрос.Организация,
	|	ВложенныйЗапрос.Район,
	|	ВложенныйЗапрос.ПериодНачисления,
	|	ВложенныйЗапрос.Строение,
	|	ВложенныйЗапрос.Услуга
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	АбонентыДляРаспределения.Организация КАК Организация,
	|	АбонентыДляРаспределения.Район КАК Район,
	|	АбонентыДляРаспределения.Строение КАК Строение,
	|	АбонентыДляРаспределения.Помещение КАК Помещение,
	|	АбонентыДляРаспределения.Абонент КАК Абонент,
	|	АбонентыДляРаспределения.Услуга КАК Услуга,
	|	АбонентыДляРаспределения.ЗначениеПлощади КАК ЗначениеПлощадиДляРаспределения,
	|	АбонентыДляРаспределения.ТарифнаяГруппа КАК ТарифнаяГруппаДляРаспределения,
	|	АбонентыДляРаспределения.Поставщик КАК ПоставщикДляРаспределения,
	|	АбонентыДляРаспределения.КоличествоЖильцов КАК КоличествоЖильцов,
	|	ОбъемНачислений.ТочкаУчета КАК ТочкаУчета,
	|	ОбъемНачислений.ВидНачисления КАК ВидНачисления,
	|	ОбъемНачислений.СпособНачисления КАК СпособНачисления,
	|	ОбъемНачислений.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	ОбъемНачислений.Измеритель КАК Измеритель,
	|	ОбъемНачислений.ПриборУчета КАК ПриборУчета,
	|	ОбъемНачислений.Шкала КАК Шкала,
	|	ОбъемНачислений.ТарифнаяЗона КАК ТарифнаяЗона,
	|	ОбъемНачислений.ЗначениеТарифа КАК ЗначениеТарифа,
	|	ОбъемНачислений.Поставщик КАК Поставщик,
	|	ОбъемНачислений.ПериодРасчета КАК ПериодРасчета,
	|	ОбъемНачислений.ПериодНачисления КАК ПериодНачисления,
	|	ОбъемНачислений.ЧастныйСектор КАК ЧастныйСектор,
	|	ОбъемНачислений.СверхНорматива КАК СверхНорматива,
	|	ОбъемНачислений.Сумма КАК Сумма,
	|	ЕСТЬNULL(ОбъемНачислений.ОбъемУслуги, 0) КАК ОбъемУслуги,
	|	ЕСТЬNULL(ОбъемНачислений.ОбъемУслугиПотребленный, 0) КАК ОбъемУслугиПотребленный,
	|	ОбъемНачислений.СуммаПоПовышенномуКоэффициенту КАК СуммаПоПовышенномуКоэффициенту,
	|	ЕСТЬNULL(ОбъемНачислений.ОбъемУслугиСоцНорма, 0) КАК ОбъемУслугиСоцНорма,
	|	ОбъемНачислений.НачалоПериода КАК НачалоПериода,
	|	ОбъемНачислений.КонецПериода КАК КонецПериода,
	|	ОбъемНачислений.НачальныеПоказания КАК НачальныеПоказания,
	|	ОбъемНачислений.КонечныеПоказания КАК КонечныеПоказания,
	|	ОбъемНачислений.КоличествоКомнат КАК КоличествоКомнат,
	|	ОбъемНачислений.КоличествоПрописанных КАК КоличествоПрописанных,
	|	ОбъемНачислений.ЗначениеПлощади КАК ЗначениеПлощади,
	|	ОбъемНачислений.НормаПотребления КАК НормаПотребления,
	|	ОбъемНачислений.КоэффициентПУ КАК КоэффициентПУ,
	|	ОбъемНачислений.РасчетПоФормуле КАК РасчетПоФормуле,
	|	ОбъемНачислений.ВидБлагоустройства КАК ВидБлагоустройства,
	|	ОбъемНачислений.ТарифнаяГруппа КАК ТарифнаяГруппа,
	|	ОбъемНачислений.ДатаПоверки КАК ДатаПоверки,
	|	ОбъемНачислений.ОтключатьВНеполивнойСезон КАК ОтключатьВНеполивнойСезон,
	|	ОбъемНачислений.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|	ОбъемНачислений.КоэффициентФормула КАК КоэффициентФормула,
	|	ОбъемНачислений.ВидДифференцированности КАК ВидДифференцированности,
	|	ОбъемНачислений.ОснованиеПерерасчета КАК ОснованиеПерерасчета,
	|	ОбъемНачислений.ОснованиеПерерасчетаДата КАК ОснованиеПерерасчетаДата,
	|	ОбъемНачислений.ПриборЗависимой КАК ПриборЗависимой,
	|	ОбъемНачислений.СписатьИзНормы КАК СписатьИзНормы,
	|	ОбъемНачислений.ПовыщающийКоэффициент КАК ПовыщающийКоэффициент,
	|	ОбъемНачислений.КоличествоСобственников КАК КоличествоСобственников,
	|	ОбъемНачислений.КоличествоПроживающих КАК КоличествоПроживающих,
	|	ОбъемНачислений.СниматьНачисленныйСредний КАК СниматьНачисленныйСредний,
	|	ОбъемНачислений.ПлощадьМОП КАК ПлощадьМОП,
	|	ОбъемНачислений.ПлощадьАбонентов КАК ПлощадьАбонентов,
	|	ОбъемНачислений.ПлощадьСобственнаяПоставка КАК ПлощадьСобственнаяПоставка,
	|	ОбъемНачислений.КоэффициентРаспределенияОстатка КАК КоэффициентРаспределенияОстатка,
	|	ОбъемНачислений.ЗначениеСоциальнойНормы КАК ЗначениеСоциальнойНормы,
	|	ОбъемНачислений.СоставнаяУслуга КАК СоставнаяУслуга,
	|	ОбъемНачислений.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	ВЫБОР
	|		КОГДА ОбъемНачислений.Абонент ЕСТЬ NULL
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ ИСТИНА
	|	КОНЕЦ КАК ЕстьИндивидуальныеНачисления,
	|	ЛОЖЬ КАК НП,
	|	ЛОЖЬ КАК ПомещениеСРазделенными,
	|	АбонентыДляРаспределения.Помещение КАК ПомещениеРодитель,
	|	NULL КАК Договор
	|ИЗ
	|	АбонентыДляРаспределения КАК АбонентыДляРаспределения
	|		ЛЕВОЕ СОЕДИНЕНИЕ ОбъемНачислений КАК ОбъемНачислений
	|		ПО АбонентыДляРаспределения.Район = ОбъемНачислений.Район
	|			И АбонентыДляРаспределения.Строение = ОбъемНачислений.Строение
	|			И АбонентыДляРаспределения.Услуга = ОбъемНачислений.Услуга
	|			И АбонентыДляРаспределения.Помещение = ОбъемНачислений.Помещение
	|ГДЕ
	|	АбонентыДляРаспределения.Помещение ССЫЛКА Справочник.энргПомещения
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ
	|	АбонентыДляРаспределения.Организация,
	|	АбонентыДляРаспределения.Район,
	|	АбонентыДляРаспределения.Строение,
	|	АбонентыДляРаспределения.Помещение,
	|	АбонентыДляРаспределения.Абонент,
	|	АбонентыДляРаспределения.Услуга,
	|	АбонентыДляРаспределения.ЗначениеПлощади,
	|	АбонентыДляРаспределения.ТарифнаяГруппа,
	|	АбонентыДляРаспределения.Поставщик,
	|	0,
	|	ОбъемНачислений.ТочкаУчета,
	|	ОбъемНачислений.ВидНачисления,
	|	ОбъемНачислений.СпособНачисления,
	|	ОбъемНачислений.НаправлениеИспользованияТУ,
	|	ОбъемНачислений.Измеритель,
	|	ОбъемНачислений.ПриборУчета,
	|	ОбъемНачислений.Шкала,
	|	ОбъемНачислений.ТарифнаяЗона,
	|	ОбъемНачислений.ЗначениеТарифа,
	|	ОбъемНачислений.Поставщик,
	|	ОбъемНачислений.ПериодРасчета,
	|	ОбъемНачислений.ПериодНачисления,
	|	ОбъемНачислений.ЧастныйСектор,
	|	ОбъемНачислений.СверхНорматива,
	|	ОбъемНачислений.Сумма,
	|	ЕСТЬNULL(ОбъемНачислений.ОбъемУслуги, 0),
	|	ЕСТЬNULL(ОбъемНачислений.ОбъемУслугиПотребленный, 0),
	|	ОбъемНачислений.СуммаПоПовышенномуКоэффициенту,
	|	ЕСТЬNULL(ОбъемНачислений.ОбъемУслугиСоцНорма, 0),
	|	ОбъемНачислений.НачалоПериода,
	|	ОбъемНачислений.КонецПериода,
	|	ОбъемНачислений.НачальныеПоказания,
	|	ОбъемНачислений.КонечныеПоказания,
	|	ОбъемНачислений.КоличествоКомнат,
	|	ОбъемНачислений.КоличествоПрописанных,
	|	ОбъемНачислений.ЗначениеПлощади,
	|	ОбъемНачислений.НормаПотребления,
	|	ОбъемНачислений.КоэффициентПУ,
	|	ОбъемНачислений.РасчетПоФормуле,
	|	ОбъемНачислений.ВидБлагоустройства,
	|	ОбъемНачислений.ТарифнаяГруппа,
	|	ОбъемНачислений.ДатаПоверки,
	|	ОбъемНачислений.ОтключатьВНеполивнойСезон,
	|	ОбъемНачислений.ЗависимаяТочкаУчета,
	|	ОбъемНачислений.КоэффициентФормула,
	|	ОбъемНачислений.ВидДифференцированности,
	|	ОбъемНачислений.ОснованиеПерерасчета,
	|	ОбъемНачислений.ОснованиеПерерасчетаДата,
	|	ОбъемНачислений.ПриборЗависимой,
	|	ОбъемНачислений.СписатьИзНормы,
	|	ОбъемНачислений.ПовыщающийКоэффициент,
	|	ОбъемНачислений.КоличествоСобственников,
	|	ОбъемНачислений.КоличествоПроживающих,
	|	ОбъемНачислений.СниматьНачисленныйСредний,
	|	ОбъемНачислений.ПлощадьМОП,
	|	ОбъемНачислений.ПлощадьАбонентов,
	|	ОбъемНачислений.ПлощадьСобственнаяПоставка,
	|	ОбъемНачислений.КоэффициентРаспределенияОстатка,
	|	0,
	|	ОбъемНачислений.СоставнаяУслуга,
	|	ОбъемНачислений.НеПрименятьСезонность,
	|	ВЫБОР
	|		КОГДА ОбъемНачислений.Абонент ЕСТЬ NULL
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ ИСТИНА
	|	КОНЕЦ,
	|	ИСТИНА,
	|	ЛОЖЬ,
	|	АбонентыДляРаспределения.Помещение,
	|	ОбъемНачислений.Договор
	|ИЗ
	|	АбонентыДляРаспределения КАК АбонентыДляРаспределения
	|		ЛЕВОЕ СОЕДИНЕНИЕ ОбъемНачисленийНП КАК ОбъемНачислений
	|		ПО АбонентыДляРаспределения.Район = ОбъемНачислений.Район
	|			И АбонентыДляРаспределения.Строение = ОбъемНачислений.Строение
	|			И АбонентыДляРаспределения.Услуга = ОбъемНачислений.Услуга
	|			И АбонентыДляРаспределения.Абонент = ОбъемНачислений.Абонент
	|			И АбонентыДляРаспределения.Договор = ОбъемНачислений.Договор
	|ГДЕ
	|	АбонентыДляРаспределения.Абонент ССЫЛКА Справочник.бестОбъектыРасчета
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	АбонентыРазделенныеЛицевыеСчета.Организация,
	|	АбонентыРазделенныеЛицевыеСчета.Район,
	|	АбонентыРазделенныеЛицевыеСчета.Строение,
	|	АбонентыРазделенныеЛицевыеСчета.Помещение,
	|	АбонентыРазделенныеЛицевыеСчета.Абонент,
	|	АбонентыРазделенныеЛицевыеСчета.Услуга,
	|	АбонентыРазделенныеЛицевыеСчета.ЗначениеПлощади,
	|	АбонентыРазделенныеЛицевыеСчета.ТарифнаяГруппа,
	|	АбонентыРазделенныеЛицевыеСчета.Поставщик,
	|	0,
	|	ОбъемНачислений.ТочкаУчета,
	|	ОбъемНачислений.ВидНачисления,
	|	ОбъемНачислений.СпособНачисления,
	|	ОбъемНачислений.НаправлениеИспользованияТУ,
	|	ОбъемНачислений.Измеритель,
	|	ОбъемНачислений.ПриборУчета,
	|	ОбъемНачислений.Шкала,
	|	ОбъемНачислений.ТарифнаяЗона,
	|	ОбъемНачислений.ЗначениеТарифа,
	|	ОбъемНачислений.Поставщик,
	|	ОбъемНачислений.ПериодРасчета,
	|	ОбъемНачислений.ПериодНачисления,
	|	ОбъемНачислений.ЧастныйСектор,
	|	ОбъемНачислений.СверхНорматива,
	|	ОбъемНачислений.Сумма,
	|	ЕСТЬNULL(ОбъемНачислений.ОбъемУслуги, 0),
	|	ЕСТЬNULL(ОбъемНачислений.ОбъемУслугиПотребленный, 0),
	|	ОбъемНачислений.СуммаПоПовышенномуКоэффициенту,
	|	ЕСТЬNULL(ОбъемНачислений.ОбъемУслугиСоцНорма, 0),
	|	ОбъемНачислений.НачалоПериода,
	|	ОбъемНачислений.КонецПериода,
	|	ОбъемНачислений.НачальныеПоказания,
	|	ОбъемНачислений.КонечныеПоказания,
	|	ОбъемНачислений.КоличествоКомнат,
	|	ОбъемНачислений.КоличествоПрописанных,
	|	ОбъемНачислений.ЗначениеПлощади,
	|	ОбъемНачислений.НормаПотребления,
	|	ОбъемНачислений.КоэффициентПУ,
	|	ОбъемНачислений.РасчетПоФормуле,
	|	ОбъемНачислений.ВидБлагоустройства,
	|	ОбъемНачислений.ТарифнаяГруппа,
	|	ОбъемНачислений.ДатаПоверки,
	|	ОбъемНачислений.ОтключатьВНеполивнойСезон,
	|	ОбъемНачислений.ЗависимаяТочкаУчета,
	|	ОбъемНачислений.КоэффициентФормула,
	|	ОбъемНачислений.ВидДифференцированности,
	|	ОбъемНачислений.ОснованиеПерерасчета,
	|	ОбъемНачислений.ОснованиеПерерасчетаДата,
	|	ОбъемНачислений.ПриборЗависимой,
	|	ОбъемНачислений.СписатьИзНормы,
	|	ОбъемНачислений.ПовыщающийКоэффициент,
	|	ОбъемНачислений.КоличествоСобственников,
	|	ОбъемНачислений.КоличествоПроживающих,
	|	ОбъемНачислений.СниматьНачисленныйСредний,
	|	ОбъемНачислений.ПлощадьМОП,
	|	ОбъемНачислений.ПлощадьАбонентов,
	|	ОбъемНачислений.ПлощадьСобственнаяПоставка,
	|	ОбъемНачислений.КоэффициентРаспределенияОстатка,
	|	ОбъемНачислений.ЗначениеСоциальнойНормы,
	|	ОбъемНачислений.СоставнаяУслуга,
	|	ОбъемНачислений.НеПрименятьСезонность,
	|	ЛОЖЬ,
	|	ЛОЖЬ,
	|	ИСТИНА,
	|	АбонентыРазделенныеЛицевыеСчета.ПомещениеРодитель,
	|	NULL
	|ИЗ
	|	АбонентыРазделенныеЛицевыеСчета КАК АбонентыРазделенныеЛицевыеСчета
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ОбъемНачислений КАК ОбъемНачислений
	|		ПО АбонентыРазделенныеЛицевыеСчета.Район = ОбъемНачислений.Район
	|			И АбонентыРазделенныеЛицевыеСчета.Строение = ОбъемНачислений.Строение
	|			И АбонентыРазделенныеЛицевыеСчета.Услуга = ОбъемНачислений.Услуга
	|			И АбонентыРазделенныеЛицевыеСчета.Помещение = ОбъемНачислений.Помещение
	|
	|УПОРЯДОЧИТЬ ПО
	|	Организация,
	|	ПериодНачисления,
	|	Район,
	|	Строение,
	|	Услуга,
	|	Помещение
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеМКДПоУслугам.Организация КАК Организация,
	|	ДанныеМКДПоУслугам.Район КАК Район,
	|	ДанныеМКДПоУслугам.Строение КАК Строение,
	|	ДанныеМКДПоУслугам.Услуга КАК Услуга,
	|	энргОбъемНачислений.Период КАК Период,
	|	энргОбъемНачислений.Регистратор КАК Регистратор,
	|	энргОбъемНачислений.НомерСтроки КАК НомерСтроки,
	|	энргОбъемНачислений.Активность КАК Активность,
	|	энргОбъемНачислений.Распределение КАК Распределение,
	|	энргОбъемНачислений.Помещение КАК Помещение,
	|	энргОбъемНачислений.Абонент КАК Абонент,
	|	энргОбъемНачислений.ТочкаУчета КАК ТочкаУчета,
	|	энргОбъемНачислений.ВидНачисления КАК ВидНачисления,
	|	энргОбъемНачислений.СпособНачисления КАК СпособНачисления,
	|	энргОбъемНачислений.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	энргОбъемНачислений.Измеритель КАК Измеритель,
	|	энргОбъемНачислений.ПриборУчета КАК ПриборУчета,
	|	энргОбъемНачислений.Шкала КАК Шкала,
	|	энргОбъемНачислений.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргОбъемНачислений.ЗначениеТарифа КАК ЗначениеТарифа,
	|	энргОбъемНачислений.Поставщик КАК Поставщик,
	|	энргОбъемНачислений.ПериодРасчета КАК ПериодРасчета,
	|	энргОбъемНачислений.ПериодНачисления КАК ПериодНачисления,
	|	энргОбъемНачислений.ЧастныйСектор КАК ЧастныйСектор,
	|	энргОбъемНачислений.СверхНорматива КАК СверхНорматива,
	|	энргОбъемНачислений.Сумма КАК Сумма,
	|	энргОбъемНачислений.ОбъемУслуги КАК ОбъемУслуги,
	|	энргОбъемНачислений.ОбъемУслугиПотребленный КАК ОбъемУслугиПотребленный,
	|	энргОбъемНачислений.НачалоПериода КАК НачалоПериода,
	|	энргОбъемНачислений.КонецПериода КАК КонецПериода,
	|	энргОбъемНачислений.НачальныеПоказания КАК НачальныеПоказания,
	|	энргОбъемНачислений.КонечныеПоказания КАК КонечныеПоказания,
	|	энргОбъемНачислений.КоличествоКомнат КАК КоличествоКомнат,
	|	энргОбъемНачислений.КоличествоПрописанных КАК КоличествоПрописанных,
	|	энргОбъемНачислений.ЗначениеПлощади КАК ЗначениеПлощади,
	|	энргОбъемНачислений.НормаПотребления КАК НормаПотребления,
	|	энргОбъемНачислений.КоэффициентПУ КАК КоэффициентПУ,
	|	энргОбъемНачислений.РасчетПоФормуле КАК РасчетПоФормуле,
	|	энргОбъемНачислений.ВидБлагоустройства КАК ВидБлагоустройства,
	|	энргОбъемНачислений.ТарифнаяГруппа КАК ТарифнаяГруппа,
	|	энргОбъемНачислений.ДатаПоверки КАК ДатаПоверки,
	|	энргОбъемНачислений.ОтключатьВНеполивнойСезон КАК ОтключатьВНеполивнойСезон,
	|	энргОбъемНачислений.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|	энргОбъемНачислений.КоэффициентФормула КАК КоэффициентФормула,
	|	энргОбъемНачислений.ВидДифференцированности КАК ВидДифференцированности,
	|	энргОбъемНачислений.ОснованиеПерерасчета КАК ОснованиеПерерасчета,
	|	энргОбъемНачислений.ОснованиеПерерасчетаДата КАК ОснованиеПерерасчетаДата,
	|	энргОбъемНачислений.ПриборЗависимой КАК ПриборЗависимой,
	|	энргОбъемНачислений.СписатьИзНормы КАК СписатьИзНормы,
	|	энргОбъемНачислений.ПовыщающийКоэффициент КАК ПовыщающийКоэффициент,
	|	энргОбъемНачислений.КоличествоСобственников КАК КоличествоСобственников,
	|	энргОбъемНачислений.КоличествоПроживающих КАК КоличествоПроживающих,
	|	энргОбъемНачислений.СниматьНачисленныйСредний КАК СниматьНачисленныйСредний,
	|	энргОбъемНачислений.ПлощадьМОП КАК ПлощадьМОП,
	|	энргОбъемНачислений.ПлощадьАбонентов КАК ПлощадьАбонентов,
	|	энргОбъемНачислений.ПлощадьСобственнаяПоставка КАК ПлощадьСобственнаяПоставка,
	|	энргОбъемНачислений.КоэффициентРаспределенияОстатка КАК КоэффициентРаспределенияОстатка,
	|	энргОбъемНачислений.ОбъемУслугиСоцНорма КАК ОбъемУслугиСоцНорма,
	|	энргОбъемНачислений.СоставнаяУслуга КАК СоставнаяУслуга,
	|	энргОбъемНачислений.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	энргОбъемНачислений.ПомещениеРодитель КАК ПомещениеРодитель
	|ИЗ
	|	ДанныеМКДПоУслугам КАК ДанныеМКДПоУслугам
	|		ЛЕВОЕ СОЕДИНЕНИЕ ОбъемНачисленийПоПриборуУчетаКорректироватьИндивидуальныйОбъем КАК энргОбъемНачислений
	|		ПО ДанныеМКДПоУслугам.Организация = энргОбъемНачислений.Организация
	|			И ДанныеМКДПоУслугам.ПериодНачисления = энргОбъемНачислений.ПериодНачисления
	|			И ДанныеМКДПоУслугам.Район = энргОбъемНачислений.Район
	|			И ДанныеМКДПоУслугам.Строение = энргОбъемНачислений.Строение
	|			И ДанныеМКДПоУслугам.Услуга = энргОбъемНачислений.Услуга
	|
	|УПОРЯДОЧИТЬ ПО
	|	Организация,
	|	ПериодНачисления,
	|	Район,
	|	Строение,
	|	Услуга
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	РазличныеМКД.Организация КАК Организация,
	|	РазличныеМКД.ПериодНачисления КАК ПериодНачисления,
	|	РазличныеМКД.Район КАК Район,
	|	РазличныеМКД.Строение КАК Строение,
	|	АбонентыРазделенныеЛицевыеСчета.ПомещениеРодитель КАК ПомещениеРодитель,
	|	АбонентыРазделенныеЛицевыеСчета.Помещение КАК Помещение,
	|	АбонентыРазделенныеЛицевыеСчета.Абонент КАК Абонент,
	|	АбонентыРазделенныеЛицевыеСчета.Услуга КАК Услуга,
	|	АбонентыРазделенныеЛицевыеСчета.СпособРаспределенияОбъемаПомещения КАК СпособРаспределенияОбъемаПомещения,
	|	АбонентыРазделенныеЛицевыеСчета.ФиксированныйОбъемПотребления КАК ФиксированныйОбъемПотребления,
	|	АбонентыРазделенныеЛицевыеСчета.ДоляПотребленияЧислитель КАК ДоляПотребленияЧислитель,
	|	АбонентыРазделенныеЛицевыеСчета.ДоляПотребленияЗнаменатель КАК ДоляПотребленияЗнаменатель,
	|	АбонентыРазделенныеЛицевыеСчета.ЗначениеПлощади КАК ЗначениеПлощади,
	|	АбонентыРазделенныеЛицевыеСчета.КоличествоПроживающих КАК КоличествоПроживающих,
	|	АбонентыРазделенныеЛицевыеСчета.ТарифнаяГруппа КАК ТарифнаяГруппа,
	|	АбонентыРазделенныеЛицевыеСчета.Поставщик КАК Поставщик
	|ИЗ
	|	(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеМКДПоУслугам.Организация КАК Организация,
	|		ДанныеМКДПоУслугам.ПериодНачисления КАК ПериодНачисления,
	|		ДанныеМКДПоУслугам.Район КАК Район,
	|		ДанныеМКДПоУслугам.Строение КАК Строение
	|	ИЗ
	|		ДанныеМКДПоУслугам КАК ДанныеМКДПоУслугам) КАК РазличныеМКД
	|		ЛЕВОЕ СОЕДИНЕНИЕ АбонентыРазделенныеЛицевыеСчета КАК АбонентыРазделенныеЛицевыеСчета
	|		ПО РазличныеМКД.Организация = АбонентыРазделенныеЛицевыеСчета.Организация
	|			И РазличныеМКД.ПериодНачисления = АбонентыРазделенныеЛицевыеСчета.ПериодНачисления
	|			И РазличныеМКД.Район = АбонентыРазделенныеЛицевыеСчета.Район
	|			И РазличныеМКД.Строение = АбонентыРазделенныеЛицевыеСчета.Строение
	|
	|УПОРЯДОЧИТЬ ПО
	|	Организация,
	|	ПериодНачисления,
	|	Район,
	|	Строение,
	|	ПомещениеРодитель,
	|	Помещение
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеМКДПоУслугам.Организация КАК Организация,
	|	ДанныеМКДПоУслугам.Район КАК Район,
	|	ДанныеМКДПоУслугам.Строение КАК Строение,
	|	ДанныеМКДПоУслугам.Услуга КАК Услуга,
	|	бестОбъемНачисленийНП.Период КАК Период,
	|	бестОбъемНачисленийНП.Регистратор КАК Регистратор,
	|	бестОбъемНачисленийНП.НомерСтроки КАК НомерСтроки,
	|	бестОбъемНачисленийНП.Активность КАК Активность,
	|	бестОбъемНачисленийНП.Распределение КАК Распределение,
	|	бестОбъемНачисленийНП.ТочкаУчета КАК ТочкаУчета,
	|	бестОбъемНачисленийНП.ВидНачисления КАК ВидНачисления,
	|	бестОбъемНачисленийНП.СпособНачисления КАК СпособНачисления,
	|	бестОбъемНачисленийНП.ПриборУчета КАК ПриборУчета,
	|	бестОбъемНачисленийНП.Шкала КАК Шкала,
	|	бестОбъемНачисленийНП.ТарифнаяЗона КАК ТарифнаяЗона,
	|	бестОбъемНачисленийНП.Поставщик КАК Поставщик,
	|	бестОбъемНачисленийНП.ПериодРасчета КАК ПериодРасчета,
	|	бестОбъемНачисленийНП.ПериодНачисления КАК ПериодНачисления,
	|	бестОбъемНачисленийНП.ОбъемУслуги КАК ОбъемУслуги,
	|	бестОбъемНачисленийНП.ОбъемУслугиПотребленный КАК ОбъемУслугиПотребленный,
	|	бестОбъемНачисленийНП.НачалоПериода КАК НачалоПериода,
	|	бестОбъемНачисленийНП.КонецПериода КАК КонецПериода,
	|	бестОбъемНачисленийНП.НачальныеПоказания КАК НачальныеПоказания,
	|	бестОбъемНачисленийНП.КонечныеПоказания КАК КонечныеПоказания,
	|	бестОбъемНачисленийНП.ЗначениеПлощади КАК ЗначениеПлощади,
	|	бестОбъемНачисленийНП.НормаПотребления КАК НормаПотребления,
	|	бестОбъемНачисленийНП.РасчетПоФормуле КАК РасчетПоФормуле,
	|	бестОбъемНачисленийНП.ДатаПоверки КАК ДатаПоверки,
	|	бестОбъемНачисленийНП.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|	бестОбъемНачисленийНП.КоэффициентФормула КАК КоэффициентФормула,
	|	бестОбъемНачисленийНП.ВидДифференцированности КАК ВидДифференцированности,
	|	бестОбъемНачисленийНП.СписатьИзНормы КАК СписатьИзНормы,
	|	бестОбъемНачисленийНП.ПовыщающийКоэффициент КАК ПовыщающийКоэффициент,
	|	бестОбъемНачисленийНП.СоставнаяУслуга КАК СоставнаяУслуга,
	|	бестОбъемНачисленийНП.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	бестОбъемНачисленийНП.Договор КАК Договор,
	|	бестОбъемНачисленийНП.МКД КАК МКД,
	|	бестОбъемНачисленийНП.ОбъектРасчета КАК ОбъектРасчета,
	|	бестОбъемНачисленийНП.ПлощадьМОП КАК ПлощадьМОП,
	|	бестОбъемНачисленийНП.ПлощадьАбонентов КАК ПлощадьАбонентов,
	|	бестОбъемНачисленийНП.ПлощадьСобственнаяПоставка КАК ПлощадьСобственнаяПоставка,
	|	бестОбъемНачисленийНП.ДолевоеРаспределение КАК ДолевоеРаспределение,
	|	бестОбъемНачисленийНП.ОбъемПоПрибору КАК ОбъемПоПрибору,
	|	бестОбъемНачисленийНП.КоличествоЧасовШтатнойРаботыПУ КАК КоличествоЧасовШтатнойРаботыПУ,
	|	бестОбъемНачисленийНП.ОбъемДосчитанный КАК ОбъемДосчитанный,
	|	бестОбъемНачисленийНП.ЗначениеНагрузки КАК ЗначениеНагрузки,
	|	бестОбъемНачисленийНП.ЗначениеНормативаЗаДень КАК ЗначениеНормативаЗаДень,
	|	бестОбъемНачисленийНП.ОбъектУчаствуетВРаспределенииМКД КАК ОбъектУчаствуетВРаспределенииМКД,
	|	бестОбъемНачисленийНП.СпособРасчетаНорматива КАК СпособРасчетаНорматива,
	|	бестОбъемНачисленийНП.ТемператураВнутриПомещения КАК ТемператураВнутриПомещения
	|ИЗ
	|	ДанныеМКДПоУслугам КАК ДанныеМКДПоУслугам
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ОбъемНачисленийНППоПриборуУчетаКорректироватьИндивидуальныйОбъем КАК бестОбъемНачисленийНП
	|		ПО ДанныеМКДПоУслугам.Организация = бестОбъемНачисленийНП.Организация
	|			И ДанныеМКДПоУслугам.ПериодНачисления = бестОбъемНачисленийНП.ПериодНачисления
	|			И ДанныеМКДПоУслугам.Район = бестОбъемНачисленийНП.Район
	|			И ДанныеМКДПоУслугам.Услуга = бестОбъемНачисленийНП.Услуга
	|			И ДанныеМКДПоУслугам.Строение = бестОбъемНачисленийНП.МКД
	|
	|УПОРЯДОЧИТЬ ПО
	|	Организация,
	|	ПериодНачисления,
	|	Район,
	|	Строение,
	|	Услуга";
	
	Возврат Текст;
	
КонецФункции

Функция ТекстЗапросаНормативныеДанныеРаспределения()
	Текст  = 
	"ВЫБРАТЬ
	|	энргЗначенияНормативовПотребленияСрезПоследних.Организация КАК Организация,
	|	&ПериодНачисления КАК ПериодНачисления,
	|	энргЗначенияНормативовПотребленияСрезПоследних.Район КАК Район,
	|	энргЗначенияНормативовПотребленияСрезПоследних.КлючНорматива КАК КлючНорматива,
	|	энргЗначенияНормативовПотребленияСрезПоследних.Услуга КАК Услуга,
	|	энргЗначенияНормативовПотребленияСрезПоследних.ЗначениеНорматива КАК ЗначениеНорматива
	|ПОМЕСТИТЬ ЗначенияТекущихНормПотребления
	|ИЗ
	|	РегистрСведений.энргЗначенияНормативовПотребления.СрезПоследних(
	|			&Период,
	|			Организация = &Организация
	|				И Район = &Район
	|				И ТипНачисления = ЗНАЧЕНИЕ(Перечисление.энргТипыНачислений.ОбщедомовыеНачисления)
	|				И НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)) КАК энргЗначенияНормативовПотребленияСрезПоследних
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	энргЗначенияНормативовПотребленияСрезПоследних.Организация,
	|	&ПериодНачисления,
	|	энргЗначенияНормативовПотребленияСрезПоследних.Район,
	|	энргЗначенияНормативовПотребленияСрезПоследних.КлючНорматива,
	|	энргЗначенияНормативовПотребленияСрезПоследних.Услуга,
	|	энргЗначенияНормативовПотребленияСрезПоследних.ЗначениеНорматива
	|ИЗ
	|	РегистрСведений.энргЗначенияНормативовПотребления.СрезПоследних(
	|			&Период,
	|			Организация = &Организация
	|				И Район = &Район
	|				И ТипНачисления = ЗНАЧЕНИЕ(Перечисление.энргТипыНачислений.ИндивидуальныеНачисления)
	|				И НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)) КАК энргЗначенияНормативовПотребленияСрезПоследних
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.энргВидыУслуг КАК энргВидыУслуг
	|		ПО энргЗначенияНормативовПотребленияСрезПоследних.Услуга = энргВидыУслуг.Ссылка
	|			И (энргВидыУслуг.НормативДляИндивидуальных)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргЗначенияТарифовСрезПоследних.Организация КАК Организация,
	|	&ПериодНачисления КАК ПериодНачисления,
	|	энргЗначенияТарифовСрезПоследних.Район КАК Район,
	|	энргЗначенияТарифовСрезПоследних.ГруппаПотребителей КАК ГруппаПотребителей,
	|	энргЗначенияТарифовСрезПоследних.Услуга КАК Услуга,
	|	энргЗначенияТарифовСрезПоследних.Поставщик КАК Поставщик,
	|	энргЗначенияТарифовСрезПоследних.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргЗначенияТарифовСрезПоследних.Значение КАК Значение,
	|	энргЗначенияТарифовСрезПоследних.ЗначениеСверхНорматива КАК ЗначениеСверхНорматива,
	|	энргЗначенияТарифовСрезПоследних.ЗначениеРЭК КАК ЗначениеТарифаРЭК,
	|	энргЗначенияТарифовСрезПоследних.СтавкаНДС КАК СтавкаНДС,
	|	энргЗначенияТарифовСрезПоследних.НДСВнутри КАК НДСВнутри
	|ПОМЕСТИТЬ ЗначенияТекущихТарифов
	|ИЗ
	|	РегистрСведений.энргЗначенияТарифов.СрезПоследних(
	|			&Период,
	|			Организация = &Организация
	|				И Район = &Район) КАК энргЗначенияТарифовСрезПоследних
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргНастройкаНачисленияГВСМКДСрезПоследних.Организация КАК Организация,
	|	&ПериодНачисления КАК ПериодНачисления,
	|	энргНастройкаНачисленияГВСМКДСрезПоследних.Район КАК Район,
	|	энргНастройкаНачисленияГВСМКДСрезПоследних.МКД КАК МКД,
	|	энргНастройкаНачисленияГВСМКДСрезПоследних.Услуга КАК Услуга,
	|	энргНастройкаНачисленияГВСМКДСрезПоследних.ТипСхемы КАК ТипСхемы,
	|	энргНастройкаНачисленияГВСМКДСрезПоследних.ПринадлежностьКТепловомуПункту КАК ПринадлежностьКТепловомуПункту,
	|	энргНастройкаНачисленияГВСМКДСрезПоследних.НеНачислять КАК НеНачислять
	|ПОМЕСТИТЬ МКДНеНачислятьТЭ
	|ИЗ
	|	РегистрСведений.энргНастройкаНачисленияГВСМКД.СрезПоследних(
	|			&Период,
	|			Организация = &Организация
	|				И Район = &Район) КАК энргНастройкаНачисленияГВСМКДСрезПоследних";
	
	Возврат Текст;
	
КонецФункции

Функция ТекстЗапросаДокументыДляРаспределенияМКД() 
	
	Текст  = 
	"ВЫБРАТЬ
	|	энргОтложенныеДвиженияДокументов.Организация КАК Организация,
	|	энргОтложенныеДвиженияДокументов.ПериодНачисления КАК ПериодНачисления,
	|	энргОтложенныеДвиженияДокументов.Район КАК Район,
	|	энргОтложенныеДвиженияДокументов.Строение КАК Строение,
	|	&ЗавершениеОП
	|ПОМЕСТИТЬ ДокументыДляРаспределения
	|ИЗ
	|	РегистрСведений.энргОтложенныеДвиженияДокументов КАК энргОтложенныеДвиженияДокументов
	|ГДЕ
	|	энргОтложенныеДвиженияДокументов.Организация = &Организация
	|	И энргОтложенныеДвиженияДокументов.ПериодНачисления = &ПериодНачисления
	|	И энргОтложенныеДвиженияДокументов.Район = &Район
	|	И энргОтложенныеДвиженияДокументов.РазделЗаписи = ЗНАЧЕНИЕ(Перечисление.энргРазделыЗаписи.РаспределениеМКД)
	|	И НЕ энргОтложенныеДвиженияДокументов.ЧастныйСектор
	|	И энргОтложенныеДвиженияДокументов.Строение = &Строение";
	
	Возврат Текст
	
КонецФункции

Функция ТекстЗапросаСозданныеДокументыРаспределения()
	
	Текст = 
	"ВЫБРАТЬ
	|	энргДокументыНачислений.ПериодНачисления КАК ПериодНачисления,
	|	энргДокументыНачислений.ДокументНачисления КАК ДокументНачисления
	|ПОМЕСТИТЬ ДокументыНачислений
	|ИЗ
	|	РегистрСведений.энргДокументыНачислений КАК энргДокументыНачислений
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДокументыДляРаспределения КАК ДокументыДляРаспределения
	|		ПО энргДокументыНачислений.Организация = ДокументыДляРаспределения.Организация
	|			И энргДокументыНачислений.ПериодНачисления = ДокументыДляРаспределения.ПериодНачисления
	|			И энргДокументыНачислений.Район = ДокументыДляРаспределения.Район
	|			И (энргДокументыНачислений.ВидОперацийНачисления = ЗНАЧЕНИЕ(Перечисление.энргВидыОперацийНачисления.Индивидуальные))
	|			И энргДокументыНачислений.МКД = ДокументыДляРаспределения.Строение
	|			И (энргДокументыНачислений.Организация = &Организация)
	|			И (энргДокументыНачислений.ПериодНачисления = &ПериодНачисления)
	|			И (энргДокументыНачислений.МКД = &Строение)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////	
	|ВЫБРАТЬ
	|	энргДокументыНачислений.Организация КАК Организация,
	|	энргДокументыНачислений.ПериодНачисления КАК ПериодНачисления,	
	|	энргДокументыНачислений.Район КАК Район,
	|	энргДокументыНачислений.МКД КАК МКД, 	
	|	энргДокументыНачислений.ДокументНачисления КАК ДокументНачисления
	|ПОМЕСТИТЬ ДокументыРаспределенияМКД
	|ИЗ
	|	РегистрСведений.энргДокументыНачислений КАК энргДокументыНачислений
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДокументыДляРаспределения КАК ДокументыДляРаспределения
	|		ПО энргДокументыНачислений.Организация = ДокументыДляРаспределения.Организация
	|			И энргДокументыНачислений.ПериодНачисления = ДокументыДляРаспределения.ПериодНачисления
	|			И энргДокументыНачислений.Район = ДокументыДляРаспределения.Район
	|			И (энргДокументыНачислений.ВидОперацийНачисления = ЗНАЧЕНИЕ(Перечисление.энргВидыОперацийНачисления.РаспределениеМКД))
	|			И энргДокументыНачислений.МКД = ДокументыДляРаспределения.Строение
	|			И (энргДокументыНачислений.Организация = &Организация)
	|			И (энргДокументыНачислений.ПериодНачисления = &ПериодНачисления)
	|			И (энргДокументыНачислений.МКД = &Строение)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргИсторияСоглашенийОРаспределенииСверхнормативногоОДНСрезПоследних.Организация КАК Организация,
	|	&ПериодНачисления КАК ПериодНачисления,
	|	энргИсторияСоглашенийОРаспределенииСверхнормативногоОДНСрезПоследних.Район КАК Район,
	|	энргИсторияСоглашенийОРаспределенииСверхнормативногоОДНСрезПоследних.МКД КАК МКД,
	|	энргИсторияСоглашенийОРаспределенииСверхнормативногоОДНСрезПоследних.Услуга КАК Услуга,
	|	энргИсторияСоглашенийОРаспределенииСверхнормативногоОДНСрезПоследних.РаспределятьПолностью КАК РаспределятьПолностью
	|ПОМЕСТИТЬ ИсторияСоглашенийОРаспределенииСверхнормативногоОДН
	|ИЗ
	|	РегистрСведений.энргИсторияСоглашенийОРаспределенииСверхнормативногоОДН.СрезПоследних(
	|			&ПериодНачисления,
	|			Организация = &Организация
	|				И МКД = &Строение
	|				И Район = &Район) КАК энргИсторияСоглашенийОРаспределенииСверхнормативногоОДНСрезПоследних";
	
	Возврат Текст;
	
КонецФункции

Функция ТекстЗапросаОбъемыНачисленийМКДДляРаспределения()
	Текст  = 
	"ВЫБРАТЬ
	|	энргОбъемНачисленийМКДОбороты.Организация КАК Организация,
	|	&ПериодНачисления КАК ПериодНачисления,
	|	энргОбъемНачисленийМКДОбороты.Район КАК Район,
	|	энргОбъемНачисленийМКДОбороты.МКД КАК МКД,
	|	энргОбъемНачисленийМКДОбороты.Услуга КАК Услуга,
	|	энргОбъемНачисленийМКДОбороты.ОбъемУслугиНормативОборот КАК ОбъемУслугиНормативОборот,
	|	энргОбъемНачисленийМКДОбороты.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргОбъемНачисленийМКДОбороты.СпособНачисления КАК СпособНачисления,
	|	энргОбъемНачисленийМКДОбороты.ОбъемУслугиОборот КАК ОбъемУслугиОборот,
	|	энргОбъемНачисленийМКДОбороты.ОбъемУслугиПотребленныйОборот КАК ОбъемУслугиПотребленныйОборот,
	|	энргОбъемНачисленийМКДОбороты.ПоказанияПредоставленыОборот КАК ПоказанияПредоставленыОборот,
	|	энргОбъемНачисленийМКДОбороты.ПоказанияПредоставленыПотребленныйОборот КАК ПоказанияПредоставленыПотребленныйОборот
	|ПОМЕСТИТЬ НачисленныйОбъемМКД
	|ИЗ
	|	РегистрНакопления.энргОбъемНачисленийМКД.Обороты(
	|			&НачалоПериода,
	|			&КонецПериода,
	|			,
	|			Организация = &Организация
	|				И Район = &Район
	|				И МКД = &Строение
	|				И СпособНачисления <> ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.КорректировкаСезонныхУслуг)) КАК энргОбъемНачисленийМКДОбороты
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НАЧАЛОПЕРИОДА(энргОбъемНачислений.Период,МЕСЯЦ) КАК ПериодНачисления,
	|	энргОбъемНачислений.Период КАК Период,
	|	энргОбъемНачислений.Регистратор КАК Регистратор,
	|	энргОбъемНачислений.НомерСтроки КАК НомерСтроки,
	|	энргОбъемНачислений.Активность КАК Активность,
	|	энргОбъемНачислений.Организация КАК Организация,
	|	энргОбъемНачислений.Район КАК Район,
	|	энргОбъемНачислений.Распределение КАК Распределение,
	|	энргОбъемНачислений.Строение КАК Строение,
	|	энргОбъемНачислений.Помещение КАК Помещение,
	|	энргОбъемНачислений.Абонент КАК Абонент,
	|	энргОбъемНачислений.Услуга КАК Услуга,
	|	энргОбъемНачислений.ТочкаУчета КАК ТочкаУчета,
	|	энргОбъемНачислений.ВидНачисления КАК ВидНачисления,
	|	энргОбъемНачислений.СпособНачисления КАК СпособНачисления,
	|	энргОбъемНачислений.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	энргОбъемНачислений.Измеритель КАК Измеритель,
	|	энргОбъемНачислений.ПриборУчета КАК ПриборУчета,
	|	энргОбъемНачислений.Шкала КАК Шкала,
	|	энргОбъемНачислений.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргОбъемНачислений.ЗначениеТарифа КАК ЗначениеТарифа,
	|	энргОбъемНачислений.Поставщик КАК Поставщик,
	|	энргОбъемНачислений.ПериодРасчета КАК ПериодРасчета,
	|	энргОбъемНачислений.ЧастныйСектор КАК ЧастныйСектор,
	|	энргОбъемНачислений.СверхНорматива КАК СверхНорматива,
	|	энргОбъемНачислений.Сумма КАК Сумма,
	|	энргОбъемНачислений.ОбъемУслуги КАК ОбъемУслуги,
	|	энргОбъемНачислений.ОбъемУслугиПотребленный КАК ОбъемУслугиПотребленный,
	|	энргОбъемНачислений.ОбъемУслугиСоцНорма КАК ОбъемУслугиСоцНорма,
	|	энргОбъемНачислений.НачалоПериода КАК НачалоПериода,
	|	энргОбъемНачислений.КонецПериода КАК КонецПериода,
	|	энргОбъемНачислений.НачальныеПоказания КАК НачальныеПоказания,
	|	энргОбъемНачислений.КонечныеПоказания КАК КонечныеПоказания,
	|	энргОбъемНачислений.КоличествоКомнат КАК КоличествоКомнат,
	|	энргОбъемНачислений.КоличествоПрописанных КАК КоличествоПрописанных,
	|	энргОбъемНачислений.ЗначениеПлощади КАК ЗначениеПлощади,
	|	энргОбъемНачислений.НормаПотребления КАК НормаПотребления,
	|	энргОбъемНачислений.КоэффициентПУ КАК КоэффициентПУ,
	|	энргОбъемНачислений.РасчетПоФормуле КАК РасчетПоФормуле,
	|	энргОбъемНачислений.ВидБлагоустройства КАК ВидБлагоустройства,
	|	энргОбъемНачислений.ТарифнаяГруппа КАК ТарифнаяГруппа,
	|	энргОбъемНачислений.ДатаПоверки КАК ДатаПоверки,
	|	энргОбъемНачислений.ОтключатьВНеполивнойСезон КАК ОтключатьВНеполивнойСезон,
	|	энргОбъемНачислений.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|	энргОбъемНачислений.КоэффициентФормула КАК КоэффициентФормула,
	|	энргОбъемНачислений.ВидДифференцированности КАК ВидДифференцированности,
	|	энргОбъемНачислений.ОснованиеПерерасчета КАК ОснованиеПерерасчета,
	|	энргОбъемНачислений.ОснованиеПерерасчетаДата КАК ОснованиеПерерасчетаДата,
	|	энргОбъемНачислений.ПриборЗависимой КАК ПриборЗависимой,
	|	энргОбъемНачислений.СписатьИзНормы КАК СписатьИзНормы,
	|	энргОбъемНачислений.ПовыщающийКоэффициент КАК ПовыщающийКоэффициент,
	|	энргОбъемНачислений.КоличествоСобственников КАК КоличествоСобственников,
	|	энргОбъемНачислений.КоличествоПроживающих КАК КоличествоПроживающих,
	|	энргОбъемНачислений.СниматьНачисленныйСредний КАК СниматьНачисленныйСредний,
	|	энргОбъемНачислений.ПлощадьМОП КАК ПлощадьМОП,
	|	энргОбъемНачислений.ПлощадьАбонентов КАК ПлощадьАбонентов,
	|	энргОбъемНачислений.ПлощадьСобственнаяПоставка КАК ПлощадьСобственнаяПоставка,
	|	энргОбъемНачислений.КоэффициентРаспределенияОстатка КАК КоэффициентРаспределенияОстатка,
	|	энргОбъемНачислений.ЗначениеСоциальнойНормы КАК ЗначениеСоциальнойНормы,
	|	энргОбъемНачислений.СоставнаяУслуга КАК СоставнаяУслуга,
	|	энргОбъемНачислений.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	энргОбъемНачислений.ПомещениеРодитель КАК ПомещениеРодитель
	|ПОМЕСТИТЬ ОбъемНачисленийПоПриборуУчетаКорректироватьИндивидуальныйОбъем
	|ИЗ
	|	РегистрНакопления.энргОбъемНачислений.Обороты(
	|			&НачалоПериода,
	|			&КонецПериода,
	|			Запись,
	|			Организация = &Организация
	|				И Район = &Район
	|				И НЕ Распределение
	|				И НЕ ЧастныйСектор
	|				И Строение = &Строение
	|				И ВидНачисления = ЗНАЧЕНИЕ(Перечисление.энргВидыНачислений.Начисление)
	|				И СпособНачисления В (ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.ПоПриборам), ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.НачислениеПоСреднему))
	|				И Услуга В
	|					(ВЫБРАТЬ
	|						энргВидыУслуг.Ссылка КАК Ссылка
	|					ИЗ
	|						Справочник.энргВидыУслуг КАК энргВидыУслуг
	|					ГДЕ
	|						энргВидыУслуг.КорректироватьИндивидуальныйОбъемСУчетомОДПУ)) КАК энргОбъемНачисленийОбороты
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.энргОбъемНачислений КАК энргОбъемНачислений
	|		ПО энргОбъемНачисленийОбороты.Период = энргОбъемНачислений.Период
	|			И энргОбъемНачисленийОбороты.Регистратор = энргОбъемНачислений.Регистратор
	|			И энргОбъемНачисленийОбороты.НомерСтроки = энргОбъемНачислений.НомерСтроки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НАЧАЛОПЕРИОДА(бестОбъемНачисленийНП.Период,МЕСЯЦ) КАК ПериодНачисления,
	|	бестОбъемНачисленийНП.Период КАК Период,
	|	бестОбъемНачисленийНП.Регистратор КАК Регистратор,
	|	бестОбъемНачисленийНП.НомерСтроки КАК НомерСтроки,
	|	бестОбъемНачисленийНП.Активность КАК Активность,
	|	бестОбъемНачисленийНП.Организация КАК Организация,
	|	бестОбъемНачисленийНП.Район КАК Район,
	|	бестОбъемНачисленийНП.Распределение КАК Распределение,
	|	бестОбъемНачисленийНП.Договор КАК Договор,
	|	бестОбъемНачисленийНП.МКД КАК МКД,
	|	бестОбъемНачисленийНП.ОбъектРасчета КАК ОбъектРасчета,
	|	бестОбъемНачисленийНП.Услуга КАК Услуга,
	|	бестОбъемНачисленийНП.ТочкаУчета КАК ТочкаУчета,
	|	бестОбъемНачисленийНП.ВидНачисления КАК ВидНачисления,
	|	бестОбъемНачисленийНП.СпособНачисления КАК СпособНачисления,
	|	бестОбъемНачисленийНП.ПриборУчета КАК ПриборУчета,
	|	бестОбъемНачисленийНП.Шкала КАК Шкала,
	|	бестОбъемНачисленийНП.ТарифнаяЗона КАК ТарифнаяЗона,
	|	бестОбъемНачисленийНП.Поставщик КАК Поставщик,
	|	бестОбъемНачисленийНП.ПериодРасчета КАК ПериодРасчета,
	|	бестОбъемНачисленийНП.ДолевоеРаспределение КАК ДолевоеРаспределение,
	|	бестОбъемНачисленийНП.ОбъемПоПрибору КАК ОбъемПоПрибору,
	|	бестОбъемНачисленийНП.ОбъемУслуги КАК ОбъемУслуги,
	|	бестОбъемНачисленийНП.ОбъемУслугиПотребленный КАК ОбъемУслугиПотребленный,
	|	бестОбъемНачисленийНП.КоличествоЧасовШтатнойРаботыПУ КАК КоличествоЧасовШтатнойРаботыПУ,
	|	бестОбъемНачисленийНП.ОбъемДосчитанный КАК ОбъемДосчитанный,
	|	бестОбъемНачисленийНП.НачалоПериода КАК НачалоПериода,
	|	бестОбъемНачисленийНП.КонецПериода КАК КонецПериода,
	|	бестОбъемНачисленийНП.НачальныеПоказания КАК НачальныеПоказания,
	|	бестОбъемНачисленийНП.КонечныеПоказания КАК КонечныеПоказания,
	|	бестОбъемНачисленийНП.ЗначениеПлощади КАК ЗначениеПлощади,
	|	бестОбъемНачисленийНП.НормаПотребления КАК НормаПотребления,
	|	бестОбъемНачисленийНП.РасчетПоФормуле КАК РасчетПоФормуле,
	|	бестОбъемНачисленийНП.ДатаПоверки КАК ДатаПоверки,
	|	бестОбъемНачисленийНП.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|	бестОбъемНачисленийНП.КоэффициентРасчета КАК КоэффициентФормула,
	|	бестОбъемНачисленийНП.ВидДифференцированности КАК ВидДифференцированности,
	|	бестОбъемНачисленийНП.СписатьИзНормы КАК СписатьИзНормы,
	|	бестОбъемНачисленийНП.ПовыщающийКоэффициент КАК ПовыщающийКоэффициент,
	|	бестОбъемНачисленийНП.СоставнаяУслуга КАК СоставнаяУслуга,
	|	бестОбъемНачисленийНП.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	бестОбъемНачисленийНП.ЗначениеНагрузки КАК ЗначениеНагрузки,
	|	бестОбъемНачисленийНП.ЗначениеНормативаЗаДень КАК ЗначениеНормативаЗаДень,
	|	бестОбъемНачисленийНП.ОбъектУчаствуетВРаспределенииМКД КАК ОбъектУчаствуетВРаспределенииМКД,
	|	бестОбъемНачисленийНП.СпособРасчетаНорматива КАК СпособРасчетаНорматива,
	|	бестОбъемНачисленийНП.ТемператураВнутриПомещения КАК ТемператураВнутриПомещения,
	|	бестОбъемНачисленийНП.ПлощадьМОП КАК ПлощадьМОП,
	|	бестОбъемНачисленийНП.ПлощадьАбонентов КАК ПлощадьАбонентов,
	|	бестОбъемНачисленийНП.ПлощадьСобственнаяПоставка КАК ПлощадьСобственнаяПоставка
	|ПОМЕСТИТЬ ОбъемНачисленийНППоПриборуУчетаКорректироватьИндивидуальныйОбъем
	|ИЗ
	|	РегистрНакопления.бестОбъемНачисленийНП.Обороты(
	|			&НачалоПериода,
	|			&КонецПериода,
	|			Запись,
	|			Организация = &Организация
	|				И Район = &Район
	|				И НЕ Распределение
	|				И МКД = &Строение
	|				И ВидНачисления = ЗНАЧЕНИЕ(Перечисление.энргВидыНачислений.Начисление)
	|				И СпособНачисления В (ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.ПоПриборам), ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.НачислениеПоСреднему))
	|				И Услуга В
	|					(ВЫБРАТЬ
	|						энргВидыУслуг.Ссылка КАК Ссылка
	|					ИЗ
	|						Справочник.энргВидыУслуг КАК энргВидыУслуг
	|					ГДЕ
	|						энргВидыУслуг.КорректироватьИндивидуальныйОбъемСУчетомОДПУ)) КАК бестОбъемНачисленийНПОбороты
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.бестОбъемНачисленийНП КАК бестОбъемНачисленийНП
	|		ПО бестОбъемНачисленийНПОбороты.Период = бестОбъемНачисленийНП.Период
	|			И бестОбъемНачисленийНПОбороты.Регистратор = бестОбъемНачисленийНП.Регистратор
	|			И бестОбъемНачисленийНПОбороты.НомерСтроки = бестОбъемНачисленийНП.НомерСтроки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НАЧАЛОПЕРИОДА(энргОбъемНачисленийОбороты.Период,МЕСЯЦ) КАК ПериодНачисления,
	|	энргОбъемНачисленийОбороты.Район КАК Район,
	|	энргОбъемНачисленийОбороты.Организация КАК Организация,
	|	энргОбъемНачисленийОбороты.Распределение КАК Распределение,
	|	бестОбъектыРасчета.МКД КАК Строение,
	|	энргОбъемНачисленийОбороты.ОбъектРасчета КАК Абонент,
	|	энргОбъемНачисленийОбороты.ОбъектРасчета КАК Помещение,
	|	энргОбъемНачисленийОбороты.Услуга КАК Услуга,
	|	энргОбъемНачисленийОбороты.ТочкаУчета КАК ТочкаУчета,
	|	энргОбъемНачисленийОбороты.ВидНачисления КАК ВидНачисления,
	|	энргОбъемНачисленийОбороты.СпособНачисления КАК СпособНачисления,
	|	ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление) КАК НаправлениеИспользованияТУ,
	|	ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.Пустаяссылка) КАК Измеритель,
	|	энргОбъемНачисленийОбороты.ПриборУчета КАК ПриборУчета,
	|	энргОбъемНачисленийОбороты.Шкала КАК Шкала,
	|	энргОбъемНачисленийОбороты.ТарифнаяЗона КАК ТарифнаяЗона,
	|	1 КАК ЗначениеТарифа,
	|	энргОбъемНачисленийОбороты.Поставщик КАК Поставщик,
	|	энргОбъемНачисленийОбороты.ПериодРасчета КАК ПериодРасчета,
	|	ЛОЖЬ КАК ЧастныйСектор,
	|	ЛОЖЬ КАК СверхНорматива,
	|	0 КАК Сумма,
	|	энргОбъемНачисленийОбороты.ОбъемУслуги КАК ОбъемУслуги,
	|	энргОбъемНачисленийОбороты.ОбъемУслугиПотребленный КАК ОбъемУслугиПотребленный,
	|	0 КАК СуммаПоПовышенномуКоэффициенту,
	|	энргОбъемНачисленийОбороты.НачалоПериода КАК НачалоПериода,
	|	энргОбъемНачисленийОбороты.КонецПериода КАК КонецПериода,
	|	энргОбъемНачисленийОбороты.НачальныеПоказания КАК НачальныеПоказания,
	|	энргОбъемНачисленийОбороты.КонечныеПоказания КАК КонечныеПоказания,
	|	0 КАК КоличествоКомнат,
	|	0 КАК КоличествоПрописанных,
	|	0 КАК КоличествоЖильцов,
	|	энргОбъемНачисленийОбороты.ЗначениеПлощади КАК ЗначениеПлощади,
	|	энргОбъемНачисленийОбороты.НормаПотребления КАК НормаПотребления,
	|	0 КАК КоэффициентПУ,
	|	энргОбъемНачисленийОбороты.РасчетПоФормуле КАК РасчетПоФормуле,
	|	ЗНАЧЕНИЕ(Справочник.энргВидыБлагоустройств.ПустаяСсылка) КАК ВидБлагоустройства,
	|	ЗНАЧЕНИЕ(Справочник.энргГруппыПотребителей.ПустаяСсылка) КАК ТарифнаяГруппа,
	|	энргОбъемНачисленийОбороты.ДатаПоверки КАК ДатаПоверки,
	|	ЛОЖЬ КАК ОтключатьВНеполивнойСезон,
	|	энргОбъемНачисленийОбороты.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|	энргОбъемНачисленийОбороты.КоэффициентРасчета КАК КоэффициентФормула,
	|	энргОбъемНачисленийОбороты.ВидДифференцированности КАК ВидДифференцированности,
	|	"""" КАК ОснованиеПерерасчета,
	|	ДАТАВРЕМЯ(1, 1, 1) КАК ОснованиеПерерасчетаДата,
	|	ЗНАЧЕНИЕ(Справочник.энргПриборыУчетаАбонента.ПустаяСсылка) КАК ПриборЗависимой,
	|	ЛОЖЬ КАК СписатьИзНормы,
	|	энргОбъемНачисленийОбороты.ПовыщающийКоэффициент КАК ПовыщающийКоэффициент,
	|	0 КАК КоличествоСобственников,
	|	0 КАК КоличествоПроживающих,
	|	ЛОЖЬ КАК СниматьНачисленныйСредний,
	|	энргОбъемНачисленийОбороты.ПлощадьМОП КАК ПлощадьМОП,
	|	энргОбъемНачисленийОбороты.ПлощадьАбонентов КАК ПлощадьАбонентов,
	|	энргОбъемНачисленийОбороты.ПлощадьСобственнаяПоставка КАК ПлощадьСобственнаяПоставка,
	|	0 КАК КоэффициентРаспределенияОстатка,
	|	0 КАК ОбъемУслугиСоцНорма,
	|	энргОбъемНачисленийОбороты.СоставнаяУслуга КАК СоставнаяУслуга,
	|	энргОбъемНачисленийОбороты.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	ЗНАЧЕНИЕ(Справочник.энргПомещения.ПустаяСсылка) КАК ПомещениеРодитель,
	|	энргОбъемНачисленийОбороты.Договор КАК Договор
	|ПОМЕСТИТЬ ОбъемНачисленийНП
	|ИЗ
	|	РегистрНакопления.бестОбъемНачисленийНП КАК энргОбъемНачисленийОбороты
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.бестОбъектыРасчета КАК бестОбъектыРасчета
	|		ПО энргОбъемНачисленийОбороты.ОбъектРасчета = бестОбъектыРасчета.Ссылка
	|			И (бестОбъектыРасчета.МКД = &Строение)
	|			И (энргОбъемНачисленийОбороты.Период = &Период)
	|			И (энргОбъемНачисленийОбороты.Организация = &Организация)
	|			И (энргОбъемНачисленийОбороты.Район = &Район)
	|			И (НЕ энргОбъемНачисленийОбороты.Распределение)
	|			И (НЕ(энргОбъемНачисленийОбороты.Договор.ТипДоговора = ЗНАЧЕНИЕ(Перечисление.бестТипыДоговоров.УправляющаяКомпания)
	|					И энргОбъемНачисленийОбороты.НеПрименятьСезонность))";
	
	Возврат Текст;
	
КонецФункции

#КонецОбласти

#Область КорректировкаПотребленияСезонныхУслуг

Функция ТекстЗапросаВспомогательныеДанныеДляКорректировкиПотребленияСезонныхУслуг()
	
	Текст  =
	"ВЫБРАТЬ
	|	энргНастройкаСезонностиУслуг.МКД КАК Строение,
	|	энргНастройкаСезонностиУслуг.Услуга КАК Услуга,
	|	энргНастройкаСезонностиУслуг.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	энргНастройкаСезонностиУслуг.КорректироватьГодовойОбъем КАК КорректироватьГодовойОбъем,
	|	0 КАК Приоритет
	|ПОМЕСТИТЬ УслугиКорректироватьГодовойОбъемНабор
	|ИЗ
	|	РегистрСведений.энргНастройкаСезонностиУслуг.СрезПоследних(
	|			&ПериодНачисления,
	|			Организация = &Организация
	|				И Район = &Район
	|				И НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|				И НЕ МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка)
	|				И МКД = &МКД) КАК энргНастройкаСезонностиУслуг
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	энргНастройкаСезонностиУслуг.МКД,
	|	энргНастройкаСезонностиУслуг.Услуга,
	|	энргНастройкаСезонностиУслуг.НеПрименятьСезонность,
	|	энргНастройкаСезонностиУслуг.КорректироватьГодовойОбъем,
	|	1
	|ИЗ
	|	РегистрСведений.энргНастройкаСезонностиУслуг.СрезПоследних(
	|			&ПериодНачисления,
	|			Организация = &Организация
	|				И Район = &Район
	|				И НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|				И МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка)) КАК энргНастройкаСезонностиУслуг
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Строение КАК Строение,
	|	ВложенныйЗапрос.Услуга КАК Услуга
	|ПОМЕСТИТЬ УслугиКорректироватьГодовойОбъем
	|ИЗ
	|	(ВЫБРАТЬ
	|		УслугиКорректироватьГодовойОбъемНабор.Строение КАК Строение,
	|		УслугиКорректироватьГодовойОбъемНабор.Услуга КАК Услуга,
	|		МИНИМУМ(УслугиКорректироватьГодовойОбъемНабор.Приоритет) КАК Приоритет
	|	ИЗ
	|		УслугиКорректироватьГодовойОбъемНабор КАК УслугиКорректироватьГодовойОбъемНабор
	|	
	|	СГРУППИРОВАТЬ ПО
	|		УслугиКорректироватьГодовойОбъемНабор.Строение,
	|		УслугиКорректироватьГодовойОбъемНабор.Услуга) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ УслугиКорректироватьГодовойОбъемНабор КАК УслугиКорректироватьГодовойОбъемНабор
	|		ПО ВложенныйЗапрос.Строение = УслугиКорректироватьГодовойОбъемНабор.Строение
	|			И ВложенныйЗапрос.Услуга = УслугиКорректироватьГодовойОбъемНабор.Услуга
	|			И ВложенныйЗапрос.Приоритет = УслугиКорректироватьГодовойОбъемНабор.Приоритет
	|ГДЕ
	|	УслугиКорректироватьГодовойОбъемНабор.НеПрименятьСезонность
	|	И УслугиКорректироватьГодовойОбъемНабор.КорректироватьГодовойОбъем
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.ЧастныйСектор КАК ЧастныйСектор,
	|	ВложенныйЗапрос.Строение КАК Строение,
	|	ВложенныйЗапрос.Помещение КАК Помещение,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	ВложенныйЗапрос.КорректировкаТекущегоПериода КАК КорректировкаТекущегоПериода
	|ПОМЕСТИТЬ ТочкиДляКорректировкиТекущийПериод
	|ИЗ
	|	(ВЫБРАТЬ
	|		энргСтабильныеПериоды.Организация КАК Организация,
	|		энргСтабильныеПериоды.Район КАК Район,
	|		энргСтабильныеПериоды.ЧастныйСектор КАК ЧастныйСектор,
	|		энргСтабильныеПериоды.Строение КАК Строение,
	|		энргСтабильныеПериоды.Помещение КАК Помещение,
	|		энргСтабильныеПериоды.Услуга КАК Услуга,
	|		ИСТИНА КАК КорректировкаТекущегоПериода
	|	ИЗ
	|		РегистрСведений.энргСтабильныеПериоды КАК энргСтабильныеПериоды
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ УслугиКорректироватьГодовойОбъем КАК УслугиКорректироватьГодовойОбъем
	|			ПО энргСтабильныеПериоды.Строение = УслугиКорректироватьГодовойОбъем.Строение
	|				И энргСтабильныеПериоды.Услуга = УслугиКорректироватьГодовойОбъем.Услуга
	|				И (энргСтабильныеПериоды.ПериодНачисления = &ПериодНачисления)
	|				И (энргСтабильныеПериоды.Организация = &Организация)
	|				И (энргСтабильныеПериоды.Район = &Район)
	|				И (энргСтабильныеПериоды.ЧастныйСектор = &ЧастныйСектор)
	|				И (энргСтабильныеПериоды.Строение = &Строение)
	|				И (энргСтабильныеПериоды.Помещение = &Помещение)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		энргСтабильныеПериоды.Организация,
	|		энргСтабильныеПериоды.Район,
	|		энргСтабильныеПериоды.ЧастныйСектор,
	|		энргСтабильныеПериоды.Строение,
	|		энргСтабильныеПериоды.Помещение,
	|		энргСтабильныеПериоды.Услуга
	|	
	|	ИМЕЮЩИЕ
	|		КОЛИЧЕСТВО(РАЗЛИЧНЫЕ энргСтабильныеПериоды.УслугаПодключена) > 1
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ВложенныйЗапрос.Организация,
	|		ВложенныйЗапрос.Район,
	|		ВложенныйЗапрос.ЧастныйСектор,
	|		ВложенныйЗапрос.Строение,
	|		ВложенныйЗапрос.Помещение,
	|		ВложенныйЗапрос.Услуга,
	|		ЛОЖЬ
	|	ИЗ
	|		(ВЫБРАТЬ
	|			энргСтабильныеПериоды.Организация КАК Организация,
	|			энргСтабильныеПериоды.Район КАК Район,
	|			энргСтабильныеПериоды.ЧастныйСектор КАК ЧастныйСектор,
	|			энргСтабильныеПериоды.Строение КАК Строение,
	|			энргСтабильныеПериоды.Помещение КАК Помещение,
	|			энргСтабильныеПериоды.Услуга КАК Услуга
	|		ИЗ
	|			РегистрСведений.энргСтабильныеПериоды КАК энргСтабильныеПериоды
	|				ЛЕВОЕ СОЕДИНЕНИЕ УслугиКорректироватьГодовойОбъемНабор КАК УслугиКорректироватьГодовойОбъемНабор
	|				ПО энргСтабильныеПериоды.Услуга = УслугиКорректироватьГодовойОбъемНабор.Услуга
	|					И энргСтабильныеПериоды.Строение = УслугиКорректироватьГодовойОбъемНабор.Строение
	|		ГДЕ
	|			&ВыполнятьГодовуюКорректировку
	|			И энргСтабильныеПериоды.Организация = &Организация
	|			И энргСтабильныеПериоды.ПериодНачисления = &ПериодНачисления
	|			И энргСтабильныеПериоды.Район = &Район
	|			И энргСтабильныеПериоды.ЧастныйСектор = &ЧастныйСектор
	|			И энргСтабильныеПериоды.Строение = &Строение
	|			И энргСтабильныеПериоды.Помещение = &Помещение
	|			И энргСтабильныеПериоды.НомерПозиции = 0
	|			И УслугиКорректироватьГодовойОбъемНабор.Строение ЕСТЬ NULL) КАК ВложенныйЗапрос
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ УслугиКорректироватьГодовойОбъем КАК УслугиКорректироватьГодовойОбъем
	|			ПО ВложенныйЗапрос.Услуга = УслугиКорректироватьГодовойОбъем.Услуга
	|				И (УслугиКорректироватьГодовойОбъем.Строение = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка))
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		энргСтабильныеПериоды.Организация,
	|		энргСтабильныеПериоды.Район,
	|		энргСтабильныеПериоды.ЧастныйСектор,
	|		энргСтабильныеПериоды.Строение,
	|		энргСтабильныеПериоды.Помещение,
	|		энргСтабильныеПериоды.Услуга,
	|		ЛОЖЬ
	|	ИЗ
	|		РегистрСведений.энргСтабильныеПериоды КАК энргСтабильныеПериоды
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ УслугиКорректироватьГодовойОбъем КАК УслугиКорректироватьГодовойОбъем
	|			ПО (энргСтабильныеПериоды.Организация = &Организация)
	|				И (энргСтабильныеПериоды.ПериодНачисления = НАЧАЛОПЕРИОДА(&ПериодНачисления, ГОД))
	|				И (энргСтабильныеПериоды.Район = &Район)
	|				И (энргСтабильныеПериоды.ЧастныйСектор = &ЧастныйСектор)
	|				И (энргСтабильныеПериоды.Строение = &Строение)
	|				И (энргСтабильныеПериоды.Помещение = &Помещение)
	|				И (энргСтабильныеПериоды.НомерПозиции = 0)
	|				И (энргСтабильныеПериоды.УслугаПодключена)
	|				И энргСтабильныеПериоды.Строение = УслугиКорректироватьГодовойОбъем.Строение
	|				И энргСтабильныеПериоды.Услуга = УслугиКорректироватьГодовойОбъем.Услуга
	|				И (&ВыполнятьГодовуюКорректировку)) КАК ВложенныйЗапрос
	|
	|СГРУППИРОВАТЬ ПО
	|	ВложенныйЗапрос.Организация,
	|	ВложенныйЗапрос.Район,
	|	ВложенныйЗапрос.ЧастныйСектор,
	|	ВложенныйЗапрос.Строение,
	|	ВложенныйЗапрос.Помещение,
	|	ВложенныйЗапрос.Услуга,
	|	ВложенныйЗапрос.КорректировкаТекущегоПериода
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&Организация КАК Организация,
	|	&ПериодНачисления КАК ПериодНачисления,
	|	&Район КАК Район,
	|	ВложенныйЗапрос.ЧастныйСектор КАК ЧастныйСектор,
	|	ВложенныйЗапрос.Строение КАК Строение,
	|	ВложенныйЗапрос.Помещение КАК Помещение,
	|	ВложенныйЗапрос.Абонент КАК Абонент,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	ВложенныйЗапрос.Поставщик КАК Поставщик,
	|	ВложенныйЗапрос.СуммаПотребленный - ВложенныйЗапрос.Сумма КАК СуммаКорректировки,
	|	&ЗавершениеОП КАК ЗавершениеОП
	|ПОМЕСТИТЬ КорректируемыеОбъемы
	|ИЗ
	|	(ВЫБРАТЬ
	|		энргОбъемНачисленийОбороты.ЧастныйСектор КАК ЧастныйСектор,
	|		энргОбъемНачисленийОбороты.Строение КАК Строение,
	|		энргОбъемНачисленийОбороты.Помещение КАК Помещение,
	|		энргОбъемНачисленийОбороты.Абонент КАК Абонент,
	|		энргОбъемНачисленийОбороты.Услуга КАК Услуга,
	|		энргОбъемНачисленийОбороты.Поставщик КАК Поставщик,
	|		СУММА(энргОбъемНачисленийОбороты.СуммаОборот) КАК Сумма,
	|		СУММА(энргОбъемНачисленийОбороты.ОбъемУслугиПотребленныйОборот * энргОбъемНачисленийОбороты.ЗначениеТарифа) КАК СуммаПотребленный
	|	ИЗ
	|		РегистрНакопления.энргОбъемНачислений.Обороты(
	|				&НачалоГода,
	|				КОНЕЦПЕРИОДА(&ПериодНачисления, МЕСЯЦ),
	|				Год,
	|				Организация = &Организация
	|					И Район = &Район
	|					И НЕ(ВидНачисления = ЗНАЧЕНИЕ(Перечисление.энргВидыНачислений.Перерасчет)
	|							И СпособНачисления = ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.КорректировкаСезонныхУслуг))
	|					И ЧастныйСектор = &ЧастныйСектор
	|					И Строение = &Строение
	|					И Помещение = &Помещение) КАК энргОбъемНачисленийОбороты
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТочкиДляКорректировкиТекущийПериод КАК ТочкиДляКорректировки
	|			ПО энргОбъемНачисленийОбороты.ЧастныйСектор = ТочкиДляКорректировки.ЧастныйСектор
	|				И энргОбъемНачисленийОбороты.Строение = ТочкиДляКорректировки.Строение
	|				И энргОбъемНачисленийОбороты.Помещение = ТочкиДляКорректировки.Помещение
	|				И энргОбъемНачисленийОбороты.Услуга = ТочкиДляКорректировки.Услуга
	|				И (ТочкиДляКорректировки.КорректировкаТекущегоПериода)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		энргОбъемНачисленийОбороты.ЧастныйСектор,
	|		энргОбъемНачисленийОбороты.Строение,
	|		энргОбъемНачисленийОбороты.Помещение,
	|		энргОбъемНачисленийОбороты.Абонент,
	|		энргОбъемНачисленийОбороты.Услуга,
	|		энргОбъемНачисленийОбороты.Поставщик
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		энргОбъемНачисленийОбороты.ЧастныйСектор,
	|		энргОбъемНачисленийОбороты.Строение,
	|		энргОбъемНачисленийОбороты.Помещение,
	|		энргОбъемНачисленийОбороты.Абонент,
	|		энргОбъемНачисленийОбороты.Услуга,
	|		энргОбъемНачисленийОбороты.Поставщик,
	|		СУММА(энргОбъемНачисленийОбороты.СуммаОборот),
	|		СУММА(энргОбъемНачисленийОбороты.ОбъемУслугиПотребленныйОборот * энргОбъемНачисленийОбороты.ЗначениеТарифа)
	|	ИЗ
	|		РегистрНакопления.энргОбъемНачислений.Обороты(
	|				ДОБАВИТЬКДАТЕ(&НачалоГода, ГОД, -1),
	|				КОНЕЦПЕРИОДА(ДОБАВИТЬКДАТЕ(&НачалоГода, ГОД, -1), ГОД),
	|				Год,
	|				Организация = &Организация
	|					И Район = &Район
	|					И ЧастныйСектор = &ЧастныйСектор
	|					И НЕ(ВидНачисления = ЗНАЧЕНИЕ(Перечисление.энргВидыНачислений.Перерасчет)
	|							И СпособНачисления = ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.КорректировкаСезонныхУслуг))
	|					И Строение = &Строение
	|					И Помещение = &Помещение
	|					И &ВыполнятьГодовуюКорректировку) КАК энргОбъемНачисленийОбороты
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТочкиДляКорректировкиТекущийПериод КАК ТочкиДляКорректировки
	|			ПО энргОбъемНачисленийОбороты.ЧастныйСектор = ТочкиДляКорректировки.ЧастныйСектор
	|				И энргОбъемНачисленийОбороты.Строение = ТочкиДляКорректировки.Строение
	|				И энргОбъемНачисленийОбороты.Помещение = ТочкиДляКорректировки.Помещение
	|				И энргОбъемНачисленийОбороты.Услуга = ТочкиДляКорректировки.Услуга
	|				И (НЕ ТочкиДляКорректировки.КорректировкаТекущегоПериода)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		энргОбъемНачисленийОбороты.ЧастныйСектор,
	|		энргОбъемНачисленийОбороты.Строение,
	|		энргОбъемНачисленийОбороты.Помещение,
	|		энргОбъемНачисленийОбороты.Абонент,
	|		энргОбъемНачисленийОбороты.Услуга,
	|		энргОбъемНачисленийОбороты.Поставщик) КАК ВложенныйЗапрос
	|ГДЕ
	|	НЕ ВложенныйЗапрос.СуммаПотребленный = ВложенныйЗапрос.Сумма
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргДокументыНачислений.МКД КАК МКД,
	|	энргДокументыНачислений.ДокументНачисления КАК ДокументНачисления,
	|	энргДокументыНачислений.ПометкаУдаления КАК ПометкаУдаления
	|ПОМЕСТИТЬ ДокументыНачислений
	|ИЗ
	|	РегистрСведений.энргДокументыНачислений КАК энргДокументыНачислений
	|ГДЕ
	|	энргДокументыНачислений.Организация = &Организация
	|	И энргДокументыНачислений.ПериодНачисления = &ПериодНачисления
	|	И энргДокументыНачислений.Район = &Район
	|	И энргДокументыНачислений.ВидОперацийНачисления = ЗНАЧЕНИЕ(Перечисление.энргВидыОперацийНачисления.КорректировкаПотребленияСезонныхУслуг)
	|	И энргДокументыНачислений.МКД = &МКД";
	
	Возврат Текст;
	
КонецФункции

Функция ТекстЗапросаДанныеДляКорректировкаПотребленияСезонныхУслуг()
	
	Текст  = 
	"ВЫБРАТЬ
	|	КорректируемыеОбъемы.Организация КАК Организация,
	|	КорректируемыеОбъемы.ПериодНачисления КАК ПериодНачисления,
	|	КорректируемыеОбъемы.Район КАК Район,
	|	КорректируемыеОбъемы.ЧастныйСектор КАК ЧастныйСектор,
	|	КорректируемыеОбъемы.Строение КАК Строение,
	|	КорректируемыеОбъемы.Помещение КАК Помещение,
	|	КорректируемыеОбъемы.Абонент КАК Абонент,
	|	КорректируемыеОбъемы.Услуга КАК Услуга,
	|	ЗНАЧЕНИЕ(Перечисление.энргВидыНачислений.Перерасчет) КАК ВидНачисления,
	|	ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.КорректировкаСезонныхУслуг) КАК СпособНачисления,
	|	КорректируемыеОбъемы.Поставщик КАК Поставщик,
	|	КорректируемыеОбъемы.СуммаКорректировки КАК Сумма,
	|	ВЫБОР
	|		КОГДА КорректируемыеОбъемы.ЧастныйСектор
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка)
	|		ИНАЧЕ КорректируемыеОбъемы.Строение
	|	КОНЕЦ КАК МКД,
	|	ЕСТЬNULL(ДокументыНачислений.ДокументНачисления, ЗНАЧЕНИЕ(Документ.энргПерерасчет.ПустаяСсылка)) КАК ДокументНачисления,
	|	ЕСТЬNULL(ДокументыНачислений.ПометкаУдаления, ЛОЖЬ) КАК ДокументНачисленияПометкаУдаления,
	|	КорректируемыеОбъемы.ЗавершениеОП КАК ЗавершениеОП
	|ИЗ
	|	КорректируемыеОбъемы КАК КорректируемыеОбъемы
	|		ЛЕВОЕ СОЕДИНЕНИЕ ДокументыНачислений КАК ДокументыНачислений
	|		ПО (ВЫБОР
	|				КОГДА КорректируемыеОбъемы.ЧастныйСектор
	|					ТОГДА ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка)
	|				ИНАЧЕ КорректируемыеОбъемы.Строение
	|			КОНЕЦ = ДокументыНачислений.МКД)";
	
	Возврат Текст;
	
КонецФункции

#КонецОбласти

#Область КорректировкаПотребленияСезонныхУслугМКД

Функция ТекстЗапросаВспомогательныеДанныеДляКорректировкиПотребленияСезонныхУслугМКД()
	
	Текст  =
	"ВЫБРАТЬ
	|	энргНастройкаСезонностиУслуг.МКД КАК МКД,
	|	энргНастройкаСезонностиУслуг.Услуга КАК Услуга,
	|	энргНастройкаСезонностиУслуг.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	энргНастройкаСезонностиУслуг.КорректироватьГодовойОбъем КАК КорректироватьГодовойОбъем,
	|	0 КАК Приоритет
	|ПОМЕСТИТЬ УслугиКорректироватьГодовойОбъемНабор
	|ИЗ
	|	РегистрСведений.энргНастройкаСезонностиУслуг.СрезПоследних(
	|			&ПериодНачисления,
	|			Организация = &Организация
	|				И Район = &Район
	|				И НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|				И НЕ МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка)
	|				И МКД = &МКД) КАК энргНастройкаСезонностиУслуг
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	энргНастройкаСезонностиУслуг.МКД,
	|	энргНастройкаСезонностиУслуг.Услуга,
	|	энргНастройкаСезонностиУслуг.НеПрименятьСезонность,
	|	энргНастройкаСезонностиУслуг.КорректироватьГодовойОбъем,
	|	1
	|ИЗ
	|	РегистрСведений.энргНастройкаСезонностиУслуг.СрезПоследних(
	|			&ПериодНачисления,
	|			Организация = &Организация
	|				И Район = &Район
	|				И НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)
	|				И МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка)) КАК энргНастройкаСезонностиУслуг
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.МКД КАК МКД,
	|	ВложенныйЗапрос.Услуга КАК Услуга
	|ПОМЕСТИТЬ УслугиКорректироватьГодовойОбъем
	|ИЗ
	|	(ВЫБРАТЬ
	|		УслугиКорректироватьГодовойОбъемНабор.МКД КАК МКД,
	|		УслугиКорректироватьГодовойОбъемНабор.Услуга КАК Услуга,
	|		МИНИМУМ(УслугиКорректироватьГодовойОбъемНабор.Приоритет) КАК Приоритет
	|	ИЗ
	|		УслугиКорректироватьГодовойОбъемНабор КАК УслугиКорректироватьГодовойОбъемНабор
	|	
	|	СГРУППИРОВАТЬ ПО
	|		УслугиКорректироватьГодовойОбъемНабор.МКД,
	|		УслугиКорректироватьГодовойОбъемНабор.Услуга) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ УслугиКорректироватьГодовойОбъемНабор КАК УслугиКорректироватьГодовойОбъемНабор
	|		ПО ВложенныйЗапрос.МКД = УслугиКорректироватьГодовойОбъемНабор.МКД
	|			И ВложенныйЗапрос.Услуга = УслугиКорректироватьГодовойОбъемНабор.Услуга
	|			И ВложенныйЗапрос.Приоритет = УслугиКорректироватьГодовойОбъемНабор.Приоритет
	|ГДЕ
	|	УслугиКорректироватьГодовойОбъемНабор.НеПрименятьСезонность
	|	И УслугиКорректироватьГодовойОбъемНабор.КорректироватьГодовойОбъем
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргСтабильныеПериоды.МКД КАК МКД,
	|	энргСтабильныеПериоды.ТочкаУчета КАК ТочкаУчета,
	|	энргСтабильныеПериоды.Услуга КАК Услуга,
	|	ИСТИНА КАК КорректировкаТекущегоПериода
	|ПОМЕСТИТЬ ТочкиДляКорректировкиТекущийПериод
	|ИЗ
	|	РегистрСведений.энргСтабильныеПериодыМКД КАК энргСтабильныеПериоды
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ УслугиКорректироватьГодовойОбъем КАК УслугиКорректироватьГодовойОбъем
	|		ПО энргСтабильныеПериоды.МКД = УслугиКорректироватьГодовойОбъем.МКД
	|			И энргСтабильныеПериоды.Услуга = УслугиКорректироватьГодовойОбъем.Услуга
	|			И (энргСтабильныеПериоды.Организация = &Организация)
	|			И (энргСтабильныеПериоды.ПериодНачисления = &ПериодНачисления)
	|			И (энргСтабильныеПериоды.Район = &Район)
	|			И (энргСтабильныеПериоды.МКД = &МКД)
	|
	|СГРУППИРОВАТЬ ПО
	|	энргСтабильныеПериоды.МКД,
	|	энргСтабильныеПериоды.ТочкаУчета,
	|	энргСтабильныеПериоды.Услуга
	|
	|ИМЕЮЩИЕ
	|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ энргСтабильныеПериоды.УслугаПодключена) > 1
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.МКД,
	|	ВложенныйЗапрос.ТочкаУчета,
	|	ВложенныйЗапрос.Услуга,
	|	ЛОЖЬ
	|ИЗ
	|	(ВЫБРАТЬ
	|		энргСтабильныеПериоды.МКД КАК МКД,
	|		энргСтабильныеПериоды.ТочкаУчета КАК ТочкаУчета,
	|		энргСтабильныеПериоды.Услуга КАК Услуга
	|	ИЗ
	|		РегистрСведений.энргСтабильныеПериодыМКД КАК энргСтабильныеПериоды
	|			ЛЕВОЕ СОЕДИНЕНИЕ УслугиКорректироватьГодовойОбъемНабор КАК УслугиКорректироватьГодовойОбъемНабор
	|			ПО энргСтабильныеПериоды.Услуга = УслугиКорректироватьГодовойОбъемНабор.Услуга
	|				И энргСтабильныеПериоды.МКД = УслугиКорректироватьГодовойОбъемНабор.МКД
	|	ГДЕ
	|		&ВыполнятьГодовуюКорректировку
	|		И энргСтабильныеПериоды.Организация = &Организация
	|		И энргСтабильныеПериоды.ПериодНачисления = &ПериодНачисления
	|		И энргСтабильныеПериоды.Район = &Район
	|		И энргСтабильныеПериоды.МКД = &МКД
	|		И энргСтабильныеПериоды.НомерПозиции = 0
	|		И УслугиКорректироватьГодовойОбъемНабор.МКД ЕСТЬ NULL) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ УслугиКорректироватьГодовойОбъем КАК УслугиКорректироватьГодовойОбъем
	|		ПО ВложенныйЗапрос.Услуга = УслугиКорректироватьГодовойОбъем.Услуга
	|			И (УслугиКорректироватьГодовойОбъем.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка))
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	энргСтабильныеПериоды.МКД,
	|	энргСтабильныеПериоды.ТочкаУчета,
	|	энргСтабильныеПериоды.Услуга,
	|	ЛОЖЬ
	|ИЗ
	|	РегистрСведений.энргСтабильныеПериодыМКД КАК энргСтабильныеПериоды
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ УслугиКорректироватьГодовойОбъем КАК УслугиКорректироватьГодовойОбъем
	|		ПО (энргСтабильныеПериоды.Организация = &Организация)
	|			И (энргСтабильныеПериоды.ПериодНачисления = НАЧАЛОПЕРИОДА(&ПериодНачисления, ГОД))
	|			И (энргСтабильныеПериоды.Район = &Район)
	|			И (энргСтабильныеПериоды.МКД = &МКД)
	|			И (энргСтабильныеПериоды.НомерПозиции = 0)
	|			И (энргСтабильныеПериоды.УслугаПодключена)
	|			И (энргСтабильныеПериоды.МКДОткрыт)
	|			И энргСтабильныеПериоды.МКД = УслугиКорректироватьГодовойОбъем.МКД
	|			И энргСтабильныеПериоды.Услуга = УслугиКорректироватьГодовойОбъем.Услуга
	|			И (&ВыполнятьГодовуюКорректировку)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&Организация КАК Организация,
	|	&ПериодНачисления КАК ПериодНачисления,
	|	&Район КАК Район,
	|	ВложенныйЗапрос.МКД КАК МКД,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	ВложенныйЗапрос.ТочкаУчета КАК ТочкаУчета,
	|	ВложенныйЗапрос.Поставщик КАК Поставщик,
	|	ВложенныйЗапрос.ОбъемУслугиПотребленный - ВложенныйЗапрос.ОбъемУслуги КАК ОбъемКорректировки,
	|	ВложенныйЗапрос.ОбъемУслугиПотребленный КАК ОбъемУслугиПотребленный,
	|	ВложенныйЗапрос.ОбъемУслуги КАК ОбъемУслуги,
	|	&ЗавершениеОП КАК ЗавершениеОП
	|ПОМЕСТИТЬ КорректируемыеОбъемы
	|ИЗ
	|	(ВЫБРАТЬ
	|		энргОбъемНачисленийОбороты.МКД КАК МКД,
	|		энргОбъемНачисленийОбороты.Услуга КАК Услуга,
	|		энргОбъемНачисленийОбороты.ТочкаУчета КАК ТочкаУчета,
	|		энргОбъемНачисленийОбороты.Поставщик КАК Поставщик,
	|		СУММА(энргОбъемНачисленийОбороты.ОбъемУслугиОборот) КАК ОбъемУслуги,
	|		СУММА(энргОбъемНачисленийОбороты.ОбъемУслугиПотребленныйОборот) КАК ОбъемУслугиПотребленный
	|	ИЗ
	|		РегистрНакопления.энргОбъемНачисленийМКД.Обороты(
	|				&ПериодНачисления,
	|				КОНЕЦПЕРИОДА(&ПериодНачисления, МЕСЯЦ),
	|				Месяц,
	|				Организация = &Организация
	|					И Район = &Район
	|					И МКД = &МКД) КАК энргОбъемНачисленийОбороты
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТочкиДляКорректировкиТекущийПериод КАК ТочкиДляКорректировки
	|			ПО энргОбъемНачисленийОбороты.МКД = ТочкиДляКорректировки.МКД
	|				И энргОбъемНачисленийОбороты.ТочкаУчета = ТочкиДляКорректировки.ТочкаУчета
	|				И энргОбъемНачисленийОбороты.Услуга = ТочкиДляКорректировки.Услуга
	|				И (ТочкиДляКорректировки.КорректировкаТекущегоПериода)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		энргОбъемНачисленийОбороты.МКД,
	|		энргОбъемНачисленийОбороты.Услуга,
	|		энргОбъемНачисленийОбороты.ТочкаУчета,
	|		энргОбъемНачисленийОбороты.Поставщик
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		энргОбъемНачисленийОбороты.МКД,
	|		энргОбъемНачисленийОбороты.Услуга,
	|		энргОбъемНачисленийОбороты.ТочкаУчета,
	|		энргОбъемНачисленийОбороты.Поставщик,
	|		СУММА(энргОбъемНачисленийОбороты.ОбъемУслугиОборот),
	|		СУММА(энргОбъемНачисленийОбороты.ОбъемУслугиПотребленныйОборот)
	|	ИЗ
	|		РегистрНакопления.энргОбъемНачисленийМКД.Обороты(
	|				НАЧАЛОПЕРИОДА(ДОБАВИТЬКДАТЕ(НАЧАЛОПЕРИОДА(&ПериодНачисления, ГОД), СЕКУНДА, -1), ГОД),
	|				КОНЕЦПЕРИОДА(НАЧАЛОПЕРИОДА(ДОБАВИТЬКДАТЕ(НАЧАЛОПЕРИОДА(&ПериодНачисления, ГОД), СЕКУНДА, -1), ГОД), ГОД),
	|				Год,
	|				Организация = &Организация
	|					И Район = &Район
	|					И МКД = &МКД
	|					И &ВыполнятьГодовуюКорректировку) КАК энргОбъемНачисленийОбороты
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТочкиДляКорректировкиТекущийПериод КАК ТочкиДляКорректировки
	|			ПО энргОбъемНачисленийОбороты.МКД = ТочкиДляКорректировки.МКД
	|				И энргОбъемНачисленийОбороты.ТочкаУчета = ТочкиДляКорректировки.ТочкаУчета
	|				И энргОбъемНачисленийОбороты.Услуга = ТочкиДляКорректировки.Услуга
	|				И (НЕ ТочкиДляКорректировки.КорректировкаТекущегоПериода)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		энргОбъемНачисленийОбороты.МКД,
	|		энргОбъемНачисленийОбороты.Услуга,
	|		энргОбъемНачисленийОбороты.ТочкаУчета,
	|		энргОбъемНачисленийОбороты.Поставщик) КАК ВложенныйЗапрос
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргДокументыНачислений.Организация,
	|	энргДокументыНачислений.Район,
	|	энргДокументыНачислений.ПериодНачисления,
	|	энргДокументыНачислений.ДокументНачисления КАК ДокументНачисления,
	|	энргДокументыНачислений.ПометкаУдаления КАК ПометкаУдаления
	|ПОМЕСТИТЬ ДокументыНачислений
	|ИЗ
	|	РегистрСведений.энргДокументыНачислений КАК энргДокументыНачислений
	|ГДЕ
	|	энргДокументыНачислений.Организация = &Организация
	|	И энргДокументыНачислений.ПериодНачисления = &ПериодНачисления
	|	И энргДокументыНачислений.Район = &Район
	|	И энргДокументыНачислений.ВидОперацийНачисления = ЗНАЧЕНИЕ(Перечисление.энргВидыОперацийНачисления.КорректировкаПотребленияСезонныхУслугМКД)
	|	И энргДокументыНачислений.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка)";
	
	Возврат Текст;
	
КонецФункции

Функция ТекстЗапросаДанныеДляКорректировкаПотребленияСезонныхУслугМКД()
	
	Текст  = 
	"ВЫБРАТЬ
	|	КорректируемыеОбъемы.Организация КАК Организация,
	|	КорректируемыеОбъемы.ПериодНачисления КАК ПериодНачисления,
	|	КорректируемыеОбъемы.Район КАК Район,
	|	КорректируемыеОбъемы.МКД КАК МКД,
	|	КорректируемыеОбъемы.Услуга КАК Услуга,
	|	КорректируемыеОбъемы.ТочкаУчета КАК ТочкаУчета,
	|	ЗНАЧЕНИЕ(Перечисление.энргВидыНачислений.Перерасчет) КАК ВидНачисления,
	|	ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.КорректировкаСезонныхУслуг) КАК СпособНачисления,
	|	КорректируемыеОбъемы.Поставщик КАК Поставщик,
	|	КорректируемыеОбъемы.ОбъемКорректировки КАК ОбъемУслуги,
	|	ЕСТЬNULL(ДокументыНачислений.ДокументНачисления, ЗНАЧЕНИЕ(Документ.энргПерерасчет.ПустаяСсылка)) КАК ДокументНачисления,
	|	ЕСТЬNULL(ДокументыНачислений.ПометкаУдаления, ЛОЖЬ) КАК ДокументНачисленияПометкаУдаления,
	|	КорректируемыеОбъемы.ЗавершениеОП КАК ЗавершениеОП
	|ИЗ
	|	КорректируемыеОбъемы КАК КорректируемыеОбъемы
	|		ЛЕВОЕ СОЕДИНЕНИЕ ДокументыНачислений КАК ДокументыНачислений
	|		ПО КорректируемыеОбъемы.Организация = ДокументыНачислений.Организация
	|			И КорректируемыеОбъемы.Район = ДокументыНачислений.Район
	|			И КорректируемыеОбъемы.ПериодНачисления = ДокументыНачислений.ПериодНачисления";
	
	Возврат Текст;
	
КонецФункции

#КонецОбласти

#КонецОбласти

#Область Начислить_ВспомогательныеПроцедурыИФункции

Функция РезультатЗапросаИндивидуальныеНачисления(Организация,ПериодНачисления,Район,Строение,Помещение,НачалоПериодаРасчета,КонецПериодаРасчета,ПериодНовогоТарифа,ДнейВПериоде)
	МВТ  = Новый МенеджерВременныхТаблиц;
	ВспомогательныеДанныеНачисления(МВТ,Организация, ПериодНачисления,Район,Строение,Помещение,НачалоПериодаРасчета,КонецПериодаРасчета,ПериодНовогоТарифа,ДнейВПериоде);
	ПолучитьСтабильныеПериоды(МВТ,Ложь);
	ПолучитьДанныеДляРасчета(МВТ,ЛОЖЬ,Ложь,"энргНачисление");
	Возврат РассчитатьИндивидуальныйОбъемПотребления(МВТ);
КонецФункции

Процедура ОбработатьРезультатЗапросаНачислений(РезультатЗапроса, ГраницыПериода, Набор, НаборОбъемПомещений, ЗаписыватьНаборыЗаписей, Помещение = Неопределено)
	
	Перем ТекПериодНачисления, ТекОрганизация, ТекРайон, ТекСтроение,ТекМКД,ТекПомещениеРодитель,ТекПомещение,ТекТочкаУчета, ТекНачалоПериода,
	ТекКонецПериода, ДокументОбъект,ДокументСсылка, НаборВыполненные;
	
	Ошибки 										= "";
	Выборка  									= РезультатЗапроса.выбрать();
	
	ТекЧастныйСектор							= Ложь;	
	НачисленияПоУслугам 						= Новый Соответствие;
	НачисленияПоУслугамПомещения 				= Новый Соответствие;
	ПлощадиПомещенийПоУслугам 					= Новый Соответствие;
		
	ПересчитатьСтроки 							= Новый Массив;
	ПересчитатьСтрокиПоПлощади 					= Новый Массив;
	ПересчитатьСтрокиПоФормуле 					= Новый Соответствие;
	ПересчитатьТехническиеТочки 				= Новый Массив;
	ПересчитатьТехническиеТочкиПомещ 			= Новый Массив;
	ДеревоТочекУчета 							= Новый Соответствие;
	ОстатокСоциальнойНормы 						= Новый Соответствие;
	ТекЗавершениеОП 							= ГраницыПериода.ЗавершениеОП - 1;
	ЗаписиСтороннихПоставщиков					= Новый Массив;
	ТЗДвеТочкиПоРазделеннымЛС					= Новый ТаблицаЗначений;
	ТЗДвеТочкиПоРазделеннымЛС.Колонки.Добавить("Абонент");
	ТЗДвеТочкиПоРазделеннымЛС.Колонки.Добавить("ТарифнаяЗона");
	ТЗДвеТочкиПоРазделеннымЛС.Колонки.Добавить("Услуга");
	ТЗДвеТочкиПоРазделеннымЛС.Колонки.Добавить("ТочкаУчета");
	ТЗДвеТочкиПоРазделеннымЛС.Колонки.Добавить("СоставнаяУслуга");
	
 	Пока Выборка.следующий() цикл
		// Потомки помещения
		Если НЕ ТекПомещениеРодитель = Выборка.ПомещениеРодитель Тогда
			Если Не ТекПомещениеРодитель = Неопределено Тогда
				ПересчитатьСтрокиНачисление(Набор,НаборОбъемПомещений, НачисленияПоУслугамПомещения, ПересчитатьСтроки, ПересчитатьСтрокиПоПлощади, ПлощадиПомещенийПоУслугам, ТекПомещениеРодитель);
			КонецЕсли;
			ПересчитатьСтроки 					= Новый Массив;
			ПересчитатьСтрокиПоПлощади 			= Новый Массив;
			ПлощадиПомещенийПоУслугам 			= Новый Соответствие;
			НачисленияПоУслугамПомещения 		= Новый Соответствие;			
		КонецЕсли;
		// Помещение
		Если НЕ ТекПериодНачисления = Выборка.ПериодНачисления
			ИЛИ НЕ ТекЧастныйСектор = Выборка.ЧастныйСектор
			ИЛИ НЕ ТекСтроение = Выборка.Строение
			ИЛИ НЕ ТекПомещение = Выборка.Помещение Тогда
			Если НЕ ТекПериодНачисления = Неопределено Тогда
				РассчитатьДеревоТочекУчета(ДеревоТочекУчета, ГраницыПериода.ЗавершениеОП, Набор, НаборОбъемПомещений, ПересчитатьТехническиеТочки,ПересчитатьТехническиеТочкиПомещ, ОстатокСоциальнойНормы);									
			КонецЕсли;			
			ДеревоТочекУчета 					= Новый Соответствие;			
		КонецЕсли;		
		
		// Помещение в рамках периода
		Если НЕ ТекПериодНачисления = Выборка.ПериодНачисления
			ИЛИ НЕ ТекЧастныйСектор = Выборка.ЧастныйСектор
			ИЛИ НЕ ТекСтроение = Выборка.Строение
			ИЛИ НЕ ТекПомещение = Выборка.Помещение
			ИЛИ НЕ ТекНачалоПериода = Выборка.НачалоПериода
			ИЛИ НЕ ТекКонецПериода = Выборка.КонецПериода Тогда			
			НачисленияПоУслугам 				= Новый Соответствие;			
		КонецЕсли;		
		 		
		Если НЕ ТекМКД = Выборка.МКД И ЗаписыватьНаборыЗаписей Тогда			
			Если НЕ ТекМКД = Неопределено Тогда				
				ПересчитатьСтрокиПоФормуле(Набор, НаборОбъемПомещений, ПересчитатьСтрокиПоФормуле);
				УдалитьТехническиеТочкиУчета(Набор, НаборОбъемПомещений, НачисленияПоУслугамПомещения, ПересчитатьТехническиеТочки, ПересчитатьТехническиеТочкиПомещ);
				ПересчитатьСоциальнуюНорму(Набор, НаборОбъемПомещений, ОстатокСоциальнойНормы, ПересчитатьТехническиеТочки, ПересчитатьТехническиеТочкиПомещ);				
				УдалитьЗаписиСторонихПоставщиков(ЗаписиСтороннихПоставщиков, Набор);
				ЗаписатьНаборыЗаписейНачисление(ДокументОбъект, Набор, НаборВыполненные, НаборОбъемПомещений, Ошибки);					
			КонецЕсли;
			ЗаписиСтороннихПоставщиков			= Новый Массив;
			ДокументОбъект  					= Неопределено;
			НаборВыполненные 					= Неопределено;
			ЗамещатьНаборВыполненные 			= Истина;
			ПрочитатьНаборыЗаписейНачисление(Выборка, ДокументОбъект, Помещение, Набор, НаборОбъемПомещений, НаборВыполненные, Перечисления.энргВидыОперацийНачисления.Индивидуальные);
			ПересчитатьТехническиеТочки			= Новый Массив;
			ПересчитатьТехническиеТочкиПомещ	= Новый Массив;
			ПересчитатьСтрокиПоФормуле 			= Новый Соответствие;
			ОстатокСоциальнойНормы 				= Новый Соответствие;
		КонецЕсли; 				
		
		ЗаполнитьНаборыЗаписейНачисление(Выборка, ДокументСсылка, Набор, НаборОбъемПомещений, НачисленияПоУслугам, НачисленияПоУслугамПомещения, ПересчитатьСтроки, ПересчитатьСтрокиПоПлощади, ПлощадиПомещенийПоУслугам, ПересчитатьСтрокиПоФормуле, ПересчитатьТехническиеТочки, ПересчитатьТехническиеТочкиПомещ, ДеревоТочекУчета, ОстатокСоциальнойНормы, ЗаписиСтороннихПоставщиков,ТЗДвеТочкиПоРазделеннымЛС);
			
		ТекОрганизация 							= Выборка.Организация;
		ТекПериодНачисления 					= Выборка.ПериодНачисления;
		ТекРайон 								= Выборка.Район;
		ТекМКД 									= Выборка.МКД;
		ТекЧастныйСектор						= Выборка.ЧастныйСектор;
		ТекСтроение								= Выборка.Строение;
		ТекПомещениеРодитель 					= Выборка.ПомещениеРодитель;
		ТекПомещение							= Выборка.Помещение;
		ТекТочкаУчета							= Выборка.ТочкаУчета;
		ТекНачалоПериода						= Выборка.НачалоПериода;
		ТекКонецПериода 						= Выборка.КонецПериода;
		ТекЗавершениеОП 						= Выборка.ЗавершениеОП;
	КонецЦикла;	
	
	Если НЕ ТекПериодНачисления = Неопределено Тогда 
		РассчитатьДеревоТочекУчета(ДеревоТочекУчета, ГраницыПериода.ЗавершениеОП, Набор, НаборОбъемПомещений, ПересчитатьТехническиеТочки, ПересчитатьТехническиеТочкиПомещ, ОстатокСоциальнойНормы);		
		ПересчитатьСтрокиНачисление(Набор, НаборОбъемПомещений, НачисленияПоУслугамПомещения, ПересчитатьСтроки, ПересчитатьСтрокиПоПлощади, ПлощадиПомещенийПоУслугам, ТекПомещениеРодитель);
		ПересчитатьСтрокиПоФормуле(Набор, НаборОбъемПомещений, ПересчитатьСтрокиПоФормуле);
		УдалитьТехническиеТочкиУчета(Набор, НаборОбъемПомещений, НачисленияПоУслугамПомещения, ПересчитатьТехническиеТочки, ПересчитатьТехническиеТочкиПомещ);
		ПересчитатьСоциальнуюНорму(Набор, НаборОбъемПомещений, ОстатокСоциальнойНормы, ПересчитатьТехническиеТочки, ПересчитатьТехническиеТочкиПомещ);		
		УдалитьЗаписиСторонихПоставщиков(ЗаписиСтороннихПоставщиков, Набор);
	КонецЕсли; 	

	Если ЗаписыватьНаборыЗаписей И НЕ Набор = Неопределено и Набор.Количество() > 0 Тогда
		ЗаписатьНаборыЗаписейНачисление(ДокументОбъект, Набор, НаборВыполненные, НаборОбъемПомещений, Ошибки);	
	КонецЕсли;
	
	Если Не ПустаяСтрока(Ошибки) Тогда
		ВызватьИсключение Ошибки;
	КонецЕсли;
	
КонецПроцедуры

Процедура УдалитьЗаписиСторонихПоставщиков(Знач ЗаписиСтороннихПоставщиков, Набор)
	
	Перем СтрокаНабора, Сч;
	
	Для Сч = 0 По ЗаписиСтороннихПоставщиков.ВГраница() Цикл
		СтрокаНабора 				 	= Набор.Получить(ЗаписиСтороннихПоставщиков[Сч]);
 		Набор.Удалить(СтрокаНабора);
	КонецЦикла;

КонецПроцедуры

Процедура ПересчитатьСтрокиНачисление(Набор, НаборОбъемПомещений, НачисленияПоУслугамПомещения, ПересчитатьСтроки, ПересчитатьСтрокиПоПлощади, ПлощадиПомещенийПоУслугам, ТекПомещениеРодитель)
		
	Если ПересчитатьСтрокиПоПлощади.Количество() > 0 Тогда
		Для Сч = 0 По ПересчитатьСтрокиПоПлощади.ВГраница() Цикл
			СтрокНабора 								= Набор.Получить(ПересчитатьСтрокиПоПлощади[Сч]);
			Если НЕ ПлощадиПомещенийПоУслугам[СтрокНабора.Услуга][СтрокНабора.НачалоПериода].Площадь = 0 Тогда
				СтрокНабора.ОбъемУслуги 				= (НачисленияПоУслугамПомещения[СтрокНабора.Услуга][СтрокНабора.СоставнаяУслуга][СтрокНабора.ТарифнаяЗона][СтрокНабора.НачалоПериода].ОбъемУслуги * СтрокНабора.ЗначениеПлощади / ПлощадиПомещенийПоУслугам[СтрокНабора.Услуга][СтрокНабора.НачалоПериода].Площадь);
				СтрокНабора.ОбъемУслугиПотребленный		= (НачисленияПоУслугамПомещения[СтрокНабора.Услуга][СтрокНабора.СоставнаяУслуга][СтрокНабора.ТарифнаяЗона][СтрокНабора.НачалоПериода].ОбъемУслугиПотребленный * СтрокНабора.ЗначениеПлощади / ПлощадиПомещенийПоУслугам[СтрокНабора.Услуга][СтрокНабора.НачалоПериода].Площадь);
			Иначе
				СтрокНабора.ОбъемУслуги 				= 0;
				СтрокНабора.ОбъемУслугиПотребленный 	= 0;
			КонецЕсли;					
			//СтрокНабора.Сумма 							= СтрокНабора.ОбъемУслуги * СтрокНабора.ЗначениеТарифа;
			РассчитатьРеквизитСумму_СПовышающимКоэффициентом(СтрокНабора);
			УстановитьСуммуПоПовышенномуКоэффициенту(СтрокНабора);	
		КонецЦикла;				
	КонецЕсли;
	
	Если ПересчитатьСтроки.Количество() > 0 Тогда
		Для Сч = 0 По ПересчитатьСтроки.ВГраница() Цикл
			СтрокНабора 								= Набор.Получить(ПересчитатьСтроки[Сч]);
			СтрокНабора.ОбъемУслуги 					= (НачисленияПоУслугамПомещения[СтрокНабора.Услуга][СтрокНабора.СоставнаяУслуга][СтрокНабора.ТарифнаяЗона][СтрокНабора.НачалоПериода].ОбъемУслуги - НачисленияПоУслугамПомещения[СтрокНабора.Услуга][СтрокНабора.СоставнаяУслуга][СтрокНабора.ТарифнаяЗона][СтрокНабора.НачалоПериода].ОбъемУслугиОстаток) * СтрокНабора.КоэффициентРаспределенияОстатка;
			СтрокНабора.ОбъемУслугиПотребленный			= (НачисленияПоУслугамПомещения[СтрокНабора.Услуга][СтрокНабора.СоставнаяУслуга][СтрокНабора.ТарифнаяЗона][СтрокНабора.НачалоПериода].ОбъемУслугиПотребленный - НачисленияПоУслугамПомещения[СтрокНабора.Услуга][СтрокНабора.СоставнаяУслуга][СтрокНабора.ТарифнаяЗона][СтрокНабора.НачалоПериода].ОбъемУслугиПотребленныйОстаток)* СтрокНабора.КоэффициентРаспределенияОстатка;
			//СтрокНабора.Сумма 							= СтрокНабора.ОбъемУслуги * СтрокНабора.ЗначениеТарифа;
			РассчитатьРеквизитСумму_СПовышающимКоэффициентом(СтрокНабора);
			УстановитьСуммуПоПовышенномуКоэффициенту(СтрокНабора);	
		КонецЦикла;				
	КонецЕсли;
	
КонецПроцедуры

Процедура ПересчитатьСтрокиПоФормуле(Набор, НаборОбъемПомещений, ПересчитатьСтрокиПоФормуле)
	
	СпособПоФормуле 												= Перечисления.энргСпособНачислений.ПоФормуламРасчета;
	СпособПоПриборам 												= Перечисления.энргСпособНачислений.ПоПриборам;
	Для Каждого СтрокаПоФормуле Из ПересчитатьСтрокиПоФормуле Цикл 																			 
		Для Каждого СтрокаПериод Из СтрокаПоФормуле.Значение Цикл
			ОбъемУслуги 											= 0;
			ОбъемУслугиПотребленный 								= 0;
			ПараметрыФормулы 										= СтрокаПериод.Значение.ПараметрыФормулы;
			мТочкиУчета  											= Новый Массив;
			ВсеНачисленияПоПрибору 									= Истина;
			Для Каждого ПараметрФормулы Из ПараметрыФормулы Цикл
				Если НЕ мТочкиУчета.Найти(ПараметрФормулы.ТочкаУчета) = Неопределено Тогда
					Продолжить;
				КонецЕсли;
				Если НЕ ПараметрФормулы.СпособНачисления  = СпособПоПриборам Тогда
					ВсеНачисленияПоПрибору 							= Ложь;
					// чтобы снять этот объем когда придут все показания
					яСтрокаНабора 									= Набор.Получить(ПараметрФормулы.ИндексСтроки);
					яСтрокаНабора.СниматьНачисленныйСредний 		= Истина;
				КонецЕсли;
				
				ОбъемУслуги 										= ОбъемУслуги + ПараметрФормулы.ОбъемУслуги * ПараметрФормулы.КоэффициентФормула;
				ОбъемУслугиПотребленный 							= ОбъемУслугиПотребленный + ПараметрФормулы.ОбъемУслугиПотребленный * ПараметрФормулы.КоэффициентФормула;
				мТочкиУчета.Добавить(ПараметрФормулы.ТочкаУчета);
			КонецЦикла;
			
			ИндексыСтрок 											= СтрокаПериод.Значение.ИндексыСтрок;
			
			Для Сч = 0 По ИндексыСтрок.ВГраница() Цикл
				СтрокаНабора 										= Набор.Получить(ИндексыСтрок[Сч]);
				СтрокаНабора.СпособНачисления 						= СпособПоФормуле;
				СтрокаНабора.ОбъемУслуги							= ОбъемУслуги;
				СтрокаНабора.ОбъемУслугиПотребленный				= ОбъемУслугиПотребленный;
				СтрокаНабора.СуммаПоПовышенномуКоэффициенту			= 0;
				СтрокаНабора.ПовыщающийКоэффициент					= 0;
				СтрокаНабора.СниматьНачисленныйСредний 				= НЕ ВсеНачисленияПоПрибору;
				СтрокаНабора.СниматьНачисленныйСреднийЗависимыхТочек= ВсеНачисленияПоПрибору;
				СтрокаНабора.КоэффициентФормула 					= 1;			
				РассчитатьРеквизитСумму_СПовышающимКоэффициентом(СтрокаНабора);
			КонецЦикла;
			
 			ИндексыСтрок 											= СтрокаПериод.Значение.ИндексыСтрокПомещений;
			
			Для Сч = 0 По ИндексыСтрок.ВГраница() Цикл
				СтрокаНабора 										= НаборОбъемПомещений.Получить(ИндексыСтрок[Сч]);
				СтрокаНабора.СпособНачисления 						= СпособПоФормуле;
				СтрокаНабора.ОбъемУслуги							= ОбъемУслуги;
				СтрокаНабора.ОбъемУслугиПотребленный				= ОбъемУслугиПотребленный;
				СтрокаНабора.СуммаПоПовышенномуКоэффициенту			= 0;
				СтрокаНабора.ПовыщающийКоэффициент					= 0;			
			КонецЦикла;
		КонецЦикла;
	КонецЦикла;
	
КонецПроцедуры

Процедура УдалитьТехническиеТочкиУчета(Набор, НаборОбъемПомещений, НачисленияПоУслугамПомещения, ПересчитатьТехническиеТочки, ПересчитатьТехническиеТочкиПомещения)
	
	СтрокиУдалить  						= Новый Массив;
	Для Сч = 0 По ПересчитатьТехническиеТочки.ВГраница() Цикл
		СтрокаНабора 				 	= Набор.Получить(ПересчитатьТехническиеТочки[Сч]);
		СтрокаНабора.ОбъемУслуги 		= 0;
		СтрокаНабора.Сумма		 		= 0;
	КонецЦикла;
	
	СтрокиУдалить  						= Новый Массив;
	Для Сч = 0 По ПересчитатьТехническиеТочкиПомещения.ВГраница() Цикл
		СтрокаНабора 					= Набор.Получить(ПересчитатьТехническиеТочкиПомещения[Сч]);
		СтрокаНабора.ОбъемУслуги 		= 0;
	КонецЦикла;
	
КонецПроцедуры

Процедура ЗаполнитьНаборыЗаписейНачисление(Выборка, ДокументСсылка, Набор, НаборОбъемПомещений, НачисленияПоУслугам, НачисленияПоУслугамПомещения, ПересчитатьСтроки, ПересчитатьСтрокиПоПлощади, ПлощадиПомещенийПоУслугам, ПересчитатьСтрокиПоФормуле, ПересчитатьТехническиеТочки, ПересчитатьТехническиеТочкиПомещения,ДеревоТочекУчета, ОстатокСоциальнойНормы, ЗаписиСтороннихПоставщиков,ТЗДвеТочкиПоРазделеннымЛС)
	
	ВидНачисления 											= Перечисления.энргВидыНачислений.Начисление;	
	ЕстьСумма 												= Истина;
	ЕстьНачисления 											= Истина;
	КлючФормулы 											= "ИндексыСтрок,ИндексыСтрокПомещений,ПараметрыФормулы";
	КлючиПараметровФормулы 									= "ТочкаУчета,Услуга,КоэффициентФормула,ИндексСтроки,СпособНачисления,ОбъемУслуги,ОбъемУслугиПотребленный";
	ЕстьАбонент 											= Ложь;
	
	Если ЗначениеЗаполнено(Выборка.Абонент) И Выборка.ПомещениеРодитель = Выборка.Помещение Тогда		 
		СтрокНабора 										= Набор.добавить();
		ЗаполнитьЗначенияСвойств(СтрокНабора,Выборка);
		РассчитатьРеквизитСумму_СПовышающимКоэффициентом(СтрокНабора);
		СтрокНабора.Период									= Выборка.ЗавершениеОП-1;
		СтрокНабора.ВидНачисления 							= ВидНачисления;
		СтрокНабора.ПериодРасчета 							= Выборка.ПериодНачисления;
		ЕстьАбонент 										= Истина;
	ИначеЕсли  ЗначениеЗаполнено(Выборка.Абонент) и Выборка.СпособРаспределенияОбъемаПомещения = Перечисления.энргСпособыРаспределенияОбъема.ДолевоеРаспределение Тогда
		Если НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга] = Неопределено Тогда
			// если в самой квартире нет начислений по этой услуге, то и в помещении начислений не должно быть
			Возврат;
		КонецЕсли;
		СтрокНабора 										= Набор.добавить();
		ЗаполнитьЗначенияСвойств(СтрокНабора,Выборка);
		СтрокНабора.Период									= Выборка.ЗавершениеОП-1;
		СтрокНабора.ВидНачисления 							= ВидНачисления;
		СтрокНабора.ПериодРасчета 							= Выборка.ПериодНачисления;
		СтрокНабора.ОбъемУслуги 							= НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслуги * Выборка.ДоляПотребленияЧислитель / Выборка.ДоляПотребленияЗнаменатель;
		СтрокНабора.ОбъемУслугиПотребленный					= НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслугиПотребленный * Выборка.ДоляПотребленияЧислитель / Выборка.ДоляПотребленияЗнаменатель;
		СтрокНабора.ПовыщающийКоэффициент					= НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ПовыщающийКоэффициент;
		//СтрокНабора.Сумма 									= СтрокНабора.ОбъемУслуги * СтрокНабора.ЗначениеТарифа;
		РассчитатьРеквизитСумму_СПовышающимКоэффициентом(СтрокНабора);
		ЕстьАбонент 										= Истина;
		
		НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслугиОстаток 				= НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслугиОстаток + СтрокНабора.ОбъемУслуги;
		НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслугиПотребленныйОстаток 	= НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслугиПотребленныйОстаток + СтрокНабора.ОбъемУслугиПотребленный;
		
	ИначеЕсли  ЗначениеЗаполнено(Выборка.Абонент) и Выборка.СпособРаспределенияОбъемаПомещения = Перечисления.энргСпособыРаспределенияОбъема.ФиксированныйОбъем Тогда 
		Если НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга] = Неопределено Тогда
			// если в самой квартире нет начислений по этой услуге, то и в помещении начислений не должно быть
			Возврат;
		КонецЕсли;
		СтрокНабора 										= Набор.добавить();
		ЗаполнитьЗначенияСвойств(СтрокНабора,Выборка);
		РассчитатьРеквизитСумму_СПовышающимКоэффициентом(СтрокНабора);
		СтрокНабора.Период									= Выборка.ЗавершениеОП-1;
		СтрокНабора.ВидНачисления 							= ВидНачисления;
		СтрокНабора.ПериодРасчета 							= Выборка.ПериодНачисления;
		ЕстьАбонент 										= Истина;
		
		НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслугиОстаток 				= НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслугиОстаток + СтрокНабора.ОбъемУслуги;
		НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслугиПотребленныйОстаток 	= НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслугиПотребленныйОстаток + СтрокНабора.ОбъемУслугиПотребленный;
		
	ИначеЕсли  ЗначениеЗаполнено(Выборка.Абонент) и Выборка.СпособРаспределенияОбъемаПомещения = Перечисления.энргСпособыРаспределенияОбъема.Остаток Тогда
		Если НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга] = Неопределено Тогда
			// если в самой квартире нет начислений по этой услуге, то и в помещении начислений не должно быть
			Возврат;
		КонецЕсли;
		СтрокНабора 										= Набор.добавить();
		ЗаполнитьЗначенияСвойств(СтрокНабора,Выборка);
		РассчитатьРеквизитСумму_СПовышающимКоэффициентом(СтрокНабора);
		СтрокНабора.Период									= Выборка.ЗавершениеОП-1;
		СтрокНабора.ВидНачисления 							= ВидНачисления;
		СтрокНабора.ПериодРасчета 							= Выборка.ПериодНачисления;
		ЕстьАбонент 										= Истина;
		
		ПересчитатьСтроки.Добавить(Набор.Индекс(СтрокНабора));
		
	ИначеЕсли   ЗначениеЗаполнено(Выборка.Абонент) Тогда
		Если НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга] = Неопределено Тогда
			// если в самой квартире нет начислений по этой услуге, то и в помещении начислений не должно быть
			Возврат;
		КонецЕсли;
		СтрокНабора 										= Набор.добавить();
		ЗаполнитьЗначенияСвойств(СтрокНабора,Выборка);
		СтрокНабора.Период									= Выборка.ЗавершениеОП-1;
		СтрокНабора.ВидНачисления 							= ВидНачисления;
		СтрокНабора.ПериодРасчета 							= Выборка.ПериодНачисления;
		ЕстьАбонент 										= Истина;
		КоличествоЖильцов 									= ?(НЕ Выборка.КоличествоПроживающих = 0, Выборка.КоличествоПроживающих, ?(НЕ Выборка.КоличествоПрописанных = 0, Выборка.КоличествоПрописанных, Выборка.КоличествоСобственников));
		
		СтрокНабора.ЗначениеСоциальнойНормы = НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ЗначениеСоциальнойНормы / НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].КоличествоЧеловек  * КоличествоЖильцов;
		
		Если ЗначениеЗаполнено(Выборка.ВидПлощади) Тогда
			ПересчитатьСтрокиПоПлощади.Добавить(Набор.Индекс(СтрокНабора));
		Иначе
			мСтрок = ТЗДвеТочкиПоРазделеннымЛС.НайтиСтроки(Новый Структура("Услуга,ТарифнаяЗона,Абонент,СоставнаяУслуга",Выборка.Услуга,Выборка.ТарифнаяЗона,Выборка.Абонент, Выборка.СоставнаяУслуга));
			Если мСтрок.Количество() = 0 или (мСтрок.Количество() > 0 и мСтрок[0].ТочкаУчета = Выборка.ТочкаУчета) Тогда
				СтрокиНабораПомещения 							= НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].СтрокиНабораПомещения;
				СтрокНабора.ОбъемУслугиПотребленный				= НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслугиПотребленный * КоличествоЖильцов /  НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].КоличествоЧеловек; 
				СтрокНабора.ОбъемУслуги 						= НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслуги * КоличествоЖильцов /  НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].КоличествоЧеловек; 
				СтрокНабора.СпособНачисления 					= НаборОбъемПомещений[СтрокиНабораПомещения[0]].СпособНачисления;
				СтрокНабора.ПриборУчета		 					= НаборОбъемПомещений[СтрокиНабораПомещения[0]].ПриборУчета;
				СтрокНабора.Шкала		 						= НаборОбъемПомещений[СтрокиНабораПомещения[0]].Шкала;
				СтрокНабора.ПовыщающийКоэффициент				= НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ПовыщающийКоэффициент;
				СтрокНабора.СниматьНачисленныйСредний			= НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].СниматьНачисленныйСредний;
				НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслугиОстаток 				= НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслугиОстаток + СтрокНабора.ОбъемУслуги;
				НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслугиПотребленныйОстаток 	= НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслугиПотребленныйОстаток + СтрокНабора.ОбъемУслугиПотребленный;			
				ЗаполнитьЗначенияСвойств(ТЗДвеТочкиПоРазделеннымЛС.добавить(),Выборка);
			Иначе		
				СтрокНабора.СпособНачисления 					= НаборОбъемПомещений[СтрокиНабораПомещения[0]].СпособНачисления;
				СтрокНабора.ПриборУчета		 					= НаборОбъемПомещений[СтрокиНабораПомещения[0]].ПриборУчета;
				СтрокНабора.Шкала		 						= НаборОбъемПомещений[СтрокиНабораПомещения[0]].Шкала;
				СтрокНабора.ОбъемУслугиПотребленный = 0;
				СтрокНабора.ОбъемУслуги = 0;
				
			КонецЕсли;
		КонецЕсли;
		
		РассчитатьРеквизитСумму_СПовышающимКоэффициентом(СтрокНабора);
	Иначе
		СтрокНабора 										= НаборОбъемПомещений.добавить();
		ЗаполнитьЗначенияСвойств(СтрокНабора,Выборка);
		СтрокНабора.Период									= Выборка.ЗавершениеОП-1;
		СтрокНабора.ВидНачисления 							= ВидНачисления;
		СтрокНабора.ПериодРасчета 							= Выборка.ПериодНачисления;
		ЕстьСумма 											= Ложь;
		
		Если НачисленияПоУслугамПомещения[Выборка.Услуга] = Неопределено Тогда
			СоотвествиеПоШкалам 							= Новый Соответствие;
			СоответствиеПоСоставнойУслуге					= Новый Соответствие;
			СоотвествиеПоТарифнамЗонам 						= Новый Соответствие;
			СоотвествиеПоПериодам 							= Новый Соответствие;
			СтрокиНабораПомещения 							= Новый Массив;
			СтрокиНабораПомещения.Добавить(НаборОбъемПомещений.Индекс(СтрокНабора));
			СоотвествиеПоПериодам.Вставить(Выборка.НачалоПериода,  Новый Структура("СтрокиНабораПомещения,КоличествоЧеловек,ОбъемУслуги,ОбъемУслугиПотребленный,ОбъемУслугиОстаток,ОбъемУслугиПотребленныйОстаток,ЗначениеСоциальнойНормы,ПовыщающийКоэффициент,СниматьНачисленныйСредний", СтрокиНабораПомещения,Выборка.КоличествоЖильцов,Выборка.ОбъемУслуги, Выборка.ОбъемУслугиПотребленный,0,0, Выборка.ЗначениеСоциальнойНормы, Выборка.ПовыщающийКоэффициент, Выборка.СниматьНачисленныйСредний));
			СоотвествиеПоТарифнамЗонам.Вставить(Выборка.ТарифнаяЗона,  СоотвествиеПоПериодам);
			СоответствиеПоСоставнойУслуге.Вставить(Выборка.СоставнаяУслуга, СоотвествиеПоТарифнамЗонам);
			НачисленияПоУслугамПомещения.Вставить(Выборка.Услуга,СоответствиеПоСоставнойУслуге);
		ИначеЕсли НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга] = Неопределено Тогда
			СтрокиНабораПомещения 							= Новый Массив;
			СоотвествиеПоТарифнамЗонам 						= Новый Соответствие;
			СоотвествиеПоПериодам 							= Новый Соответствие;
			СтрокиНабораПомещения 							= Новый Массив;
			СтрокиНабораПомещения.Добавить(НаборОбъемПомещений.Индекс(СтрокНабора));
			СоотвествиеПоПериодам.Вставить(Выборка.НачалоПериода,  Новый Структура("СтрокиНабораПомещения,КоличествоЧеловек,ОбъемУслуги,ОбъемУслугиПотребленный,ОбъемУслугиОстаток,ОбъемУслугиПотребленныйОстаток,ЗначениеСоциальнойНормы,ПовыщающийКоэффициент,СниматьНачисленныйСредний",СтрокиНабораПомещения, Выборка.КоличествоЖильцов,Выборка.ОбъемУслуги, Выборка.ОбъемУслугиПотребленный,0,0, Выборка.ЗначениеСоциальнойНормы, Выборка.ПовыщающийКоэффициент, Выборка.СниматьНачисленныйСредний));
			СоотвествиеПоТарифнамЗонам.Вставить(Выборка.ТарифнаяЗона,  СоотвествиеПоПериодам);
			НачисленияПоУслугамПомещения[Выборка.Услуга].Вставить(Выборка.СоставнаяУслуга, СоотвествиеПоТарифнамЗонам);
		ИначеЕсли НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона] = Неопределено Тогда
			СтрокиНабораПомещения 							= Новый Массив;
			СоотвествиеПоПериодам 							= Новый Соответствие;
			СтрокиНабораПомещения 							= Новый Массив;
			СтрокиНабораПомещения.Добавить(НаборОбъемПомещений.Индекс(СтрокНабора));
			СоотвествиеПоПериодам.Вставить(Выборка.НачалоПериода,  Новый Структура("СтрокиНабораПомещения,КоличествоЧеловек,ОбъемУслуги,ОбъемУслугиПотребленный,ОбъемУслугиОстаток,ОбъемУслугиПотребленныйОстаток,ЗначениеСоциальнойНормы,ПовыщающийКоэффициент,СниматьНачисленныйСредний",СтрокиНабораПомещения, Выборка.КоличествоЖильцов,Выборка.ОбъемУслуги, Выборка.ОбъемУслугиПотребленный,0,0, Выборка.ЗначениеСоциальнойНормы, Выборка.ПовыщающийКоэффициент, Выборка.СниматьНачисленныйСредний));
			НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга].Вставить(Выборка.ТарифнаяЗона, СоотвествиеПоПериодам);
		ИначеЕсли НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода] = Неопределено Тогда
			СтрокиНабораПомещения 							= Новый Массив;
			СтрокиНабораПомещения.Добавить(НаборОбъемПомещений.Индекс(СтрокНабора));
			НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона].Вставить(Выборка.НачалоПериода, Новый Структура("СтрокиНабораПомещения,КоличествоЧеловек,ОбъемУслуги,ОбъемУслугиПотребленный,ОбъемУслугиОстаток,ОбъемУслугиПотребленныйОстаток,ЗначениеСоциальнойНормы,ПовыщающийКоэффициент,СниматьНачисленныйСредний", СтрокиНабораПомещения, Выборка.КоличествоЖильцов,Выборка.ОбъемУслуги, Выборка.ОбъемУслугиПотребленный,0,0, Выборка.ЗначениеСоциальнойНормы, Выборка.ПовыщающийКоэффициент, Выборка.СниматьНачисленныйСредний));
		Иначе	
			СтрокиНабораПомещения 							= НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].СтрокиНабораПомещения;
			СтрокиНабораПомещения.Добавить(НаборОбъемПомещений.Индекс(СтрокНабора));
			НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].КоличествоЧеловек 		= Выборка.КоличествоЖильцов;
			НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслуги 				= НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслуги + Выборка.ОбъемУслуги;
			НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслугиПотребленный	= НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслугиПотребленный + Выборка.ОбъемУслугиПотребленный;
			НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ЗначениеСоциальнойНормы 	= Выборка.ЗначениеСоциальнойНормы;
		КонецЕсли;		
		
		РассчитатьРеквизитСумму_СПовышающимКоэффициентом(СтрокНабора);
	КонецЕсли;
	
	// Начисления поставщиков из РС "Поставщики не начислять"
	Если ЕстьАбонент И Выборка.УдалитьЗапись Тогда
		ЗаписиСтороннихПоставщиков.Вставить(0, Набор.Индекс(СтрокНабора));
	КонецЕсли;
	
	Если Выборка.ПомещениеРодитель = Выборка.Помещение И ЗначениеЗаполнено(Выборка.ЗависитОтУслуги) И НЕ Выборка.РасчетПоФормуле И НЕ ЗначениеЗаполнено(Выборка.ЗависимаяТочкаУчета) Тогда
		ОбъемУслуги 										= 0;
		ОбъемУслугиПотребленный								= 0;
		
		Если НЕ НачисленияПоУслугам.Получить(Выборка.ТочкаУчета) = Неопределено 
			И НЕ НачисленияПоУслугам[Выборка.ТочкаУчета][Выборка.ЗависитОтУслуги] = Неопределено
			И НЕ НачисленияПоУслугам[Выборка.ТочкаУчета][Выборка.ЗависитОтУслуги][Выборка.Шкала][Выборка.ТарифнаяЗона] = Неопределено
			И НЕ НачисленияПоУслугам[Выборка.ТочкаУчета][Выборка.ЗависитОтУслуги][Выборка.Шкала][Выборка.ТарифнаяЗона][Выборка.СпособНачисления] Тогда 
			ОбъемУслуги 									= НачисленияПоУслугам[Выборка.ТочкаУчета][Выборка.ЗависитОтУслуги][Выборка.Шкала][Выборка.ТарифнаяЗона][Выборка.СпособНачисления].ОбъемУслуги;
			ОбъемУслугиПотребленный 						= НачисленияПоУслугам[Выборка.ТочкаУчета][Выборка.ЗависитОтУслуги][Выборка.Шкала][Выборка.ТарифнаяЗона][Выборка.СпособНачисления].ОбъемУслугиПотребленный;
		КонецЕсли;	
		    
		ОбъемУслуги 										= ОбъемУслуги * ?(Выборка.УмножатьНаНормуРодительскойУслуги,Выборка.НормаПотребления,1);
		ОбъемУслугиПотребленный 							= ОбъемУслугиПотребленный * ?(Выборка.УмножатьНаНормуРодительскойУслуги,Выборка.НормаПотребления,1);
				
		СтрокНабора.ОбъемУслуги 							= ОбъемУслуги;
		СтрокНабора.ОбъемУслугиПотребленный 				= ОбъемУслугиПотребленный;                 
		
		Если ЕстьСумма Тогда
			//СтрокНабора.Сумма 								= СтрокНабора.ОбъемУслуги * СтрокНабора.ЗначениеТарифа;
			РассчитатьРеквизитСумму_СПовышающимКоэффициентом(СтрокНабора);
		КонецЕсли;
				
		Если Не ЗначениеЗаполнено(Выборка.Абонент) Тогда				
			НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслуги 				= НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслуги + СтрокНабора.ОбъемУслуги - Выборка.ОбъемУслуги;
			НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслугиПотребленный 	= НачисленияПоУслугамПомещения[Выборка.Услуга][Выборка.СоставнаяУслуга][Выборка.ТарифнаяЗона][Выборка.НачалоПериода].ОбъемУслугиПотребленный + СтрокНабора.ОбъемУслугиПотребленный - Выборка.ОбъемУслугиПотребленный;
		КонецЕсли;			
	КонецЕсли; 
	
	Если ЕстьСумма Тогда
		РассчитатьРеквизитСумму_СПовышающимКоэффициентом(СтрокНабора);
		УстановитьСуммуПоПовышенномуКоэффициенту(СтрокНабора);	
	КонецЕсли;
	
	ИзменитьОстатокСоциальнойНормы(ОстатокСоциальнойНормы, Выборка.КлючПомещения, Выборка.Услуга, Выборка.НаправлениеИспользованияТУ, Выборка.ЗначениеСоциальнойНормы, Набор, НаборОбъемПомещений, СтрокНабора);
	
	Если Выборка.РасчетПоФормуле Тогда
		Если НЕ ПересчитатьСтрокиПоФормуле[Выборка.ТочкаУчета] = Неопределено И НЕ ПересчитатьСтрокиПоФормуле[Выборка.ТочкаУчета][Выборка.НачалоПериода] = Неопределено Тогда
			Если ЕстьАбонент Тогда
				ПересчитатьСтрокиПоФормуле[Выборка.ТочкаУчета][Выборка.НачалоПериода].ИндексыСтрок.Добавить(Набор.Индекс(СтрокНабора));
			Иначе
				ПересчитатьСтрокиПоФормуле[Выборка.ТочкаУчета][Выборка.НачалоПериода].ИндексыСтрокПомещений.Добавить(НаборОбъемПомещений.Индекс(СтрокНабора));				
			КонецЕсли;			
		ИначеЕсли НЕ ПересчитатьСтрокиПоФормуле[Выборка.ТочкаУчета] = Неопределено Тогда
			ИндексыСтрок 									= Новый Массив;
			ИндексыСтрокПомещения 							= Новый Массив;
			Если ЕстьАбонент Тогда
				ИндексыСтрок.Добавить(Набор.Индекс(СтрокНабора));
			Иначе
				ИндексыСтрокПомещения.Добавить(НаборОбъемПомещений.Индекс(СтрокНабора));
			КонецЕсли;
			ПересчитатьСтрокиПоФормуле[Выборка.ТочкаУчета].Вставить(Выборка.НачалоПериода, Новый Структура(КлючФормулы, ИндексыСтрок,ИндексыСтрокПомещения,Новый Массив));
		Иначе			
			ИндексыСтрок 									= Новый Массив;
			ИндексыСтрокПомещения 							= Новый Массив;			
			Если ЕстьАбонент Тогда
				ИндексыСтрок.Добавить(Набор.Индекс(СтрокНабора));
			Иначе
				ИндексыСтрокПомещения.Добавить(НаборОбъемПомещений.Индекс(СтрокНабора));
			КонецЕсли;			
			СоотвествиеПериод 								= Новый Соответствие;
			СоотвествиеПериод.Вставить(Выборка.НачалоПериода, Новый Структура(КлючФормулы, ИндексыСтрок,ИндексыСтрокПомещения,Новый Массив));
			ПересчитатьСтрокиПоФормуле.Вставить(Выборка.ТочкаУчета, СоотвествиеПериод);
		КонецЕсли;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Выборка.ЗависимаяТочкаУчета) Тогда
		Если ПересчитатьСтрокиПоФормуле[Выборка.ЗависимаяТочкаУчета] = Неопределено Тогда
		    ИндексыСтрок 									= Новый Массив;
			ИндексыСтрокПомещения 							= Новый Массив;
			СоотвествиеПериод 								= Новый Соответствие;
			СоотвествиеПериод.Вставить(Выборка.НачалоПериода, Новый Структура(КлючФормулы, ИндексыСтрок,ИндексыСтрокПомещения,Новый Массив));
			ПересчитатьСтрокиПоФормуле.Вставить(Выборка.ЗависимаяТочкаУчета,СоотвествиеПериод);
		ИначеЕсли ПересчитатьСтрокиПоФормуле[Выборка.ЗависимаяТочкаУчета][Выборка.НачалоПериода] = Неопределено Тогда 				
			ИндексыСтрок 									= Новый Массив;
			ИндексыСтрокПомещения 							= Новый Массив; 			
			ПересчитатьСтрокиПоФормуле[Выборка.ЗависимаяТочкаУчета].Вставить(Выборка.НачалоПериода, Новый Структура(КлючФормулы, ИндексыСтрок,ИндексыСтрокПомещения,Новый Массив));				
		КонецЕсли;
		
		ПараметрФормулы 									= Новый Структура(КлючиПараметровФормулы);
		ПараметрФормулы.ТочкаУчета 							= Выборка.ТочкаУчета;
		ПараметрФормулы.Услуга 								= Выборка.Услуга;
		ПараметрФормулы.КоэффициентФормула					= Выборка.КоэффициентФормула;
		ПараметрФормулы.СпособНачисления					= Выборка.СпособНачисления;
		ПараметрФормулы.ОбъемУслуги 						= СтрокНабора.ОбъемУслуги;
		ПараметрФормулы.ОбъемУслугиПотребленный 			= СтрокНабора.ОбъемУслугиПотребленный;
		ПараметрФормулы.ИндексСтроки 						= Набор.Индекс(СтрокНабора);
		ПересчитатьСтрокиПоФормуле[Выборка.ЗависимаяТочкаУчета][Выборка.НачалоПериода].ПараметрыФормулы.Добавить(ПараметрФормулы);			
	КонецЕсли;
	
	Если НачисленияПоУслугам[Выборка.ТочкаУчета] = Неопределено Тогда
		СоотвествиеПоУслугам 								= Новый Соответствие;
		СоотвествиеПоШкалам 								= Новый Соответствие;
		СоотвествиеПоТарифнамЗонам 							= Новый Соответствие;
		СоотвествиеПоСпособам 								= Новый Соответствие;
		СоотвествиеПоСпособам.Вставить(Выборка.СпособНачисления, Новый Структура("ОбъемУслуги,ОбъемУслугиПотребленный", Выборка.ОбъемУслуги, Выборка.ОбъемУслугиПотребленный));
		СоотвествиеПоТарифнамЗонам.Вставить(Выборка.ТарифнаяЗона, СоотвествиеПоСпособам);
		СоотвествиеПоШкалам.Вставить(Выборка.Шкала, СоотвествиеПоТарифнамЗонам);
		СоотвествиеПоУслугам.Вставить(Выборка.Услуга, СоотвествиеПоШкалам);
		НачисленияПоУслугам.Вставить(Выборка.ТочкаУчета,СоотвествиеПоУслугам)
	ИначеЕсли НачисленияПоУслугам[Выборка.ТочкаУчета][Выборка.Услуга] = Неопределено Тогда
		СоотвествиеПоШкалам 								= Новый Соответствие;
		СоотвествиеПоТарифнамЗонам 							= Новый Соответствие;
		СоотвествиеПоСпособам 								= Новый Соответствие;
		СоотвествиеПоСпособам.Вставить(Выборка.СпособНачисления, Новый Структура("ОбъемУслуги,ОбъемУслугиПотребленный", Выборка.ОбъемУслуги, Выборка.ОбъемУслугиПотребленный));
		СоотвествиеПоТарифнамЗонам.Вставить(Выборка.ТарифнаяЗона, СоотвествиеПоСпособам);
		СоотвествиеПоШкалам.Вставить(Выборка.Шкала, СоотвествиеПоТарифнамЗонам);
		НачисленияПоУслугам[Выборка.ТочкаУчета].Вставить(Выборка.Услуга,СоотвествиеПоШкалам)
	ИначеЕсли НачисленияПоУслугам[Выборка.ТочкаУчета][Выборка.Услуга][Выборка.Шкала] = Неопределено Тогда
		СоотвествиеПоТарифнамЗонам 							= Новый Соответствие;
		СоотвествиеПоСпособам 								= Новый Соответствие;
		СоотвествиеПоСпособам.Вставить(Выборка.СпособНачисления, Новый Структура("ОбъемУслуги,ОбъемУслугиПотребленный", Выборка.ОбъемУслуги, Выборка.ОбъемУслугиПотребленный));
		СоотвествиеПоТарифнамЗонам.Вставить(Выборка.ТарифнаяЗона, СоотвествиеПоСпособам);
		НачисленияПоУслугам[Выборка.ТочкаУчета][Выборка.Услуга].Вставить(Выборка.Шкала, СоотвествиеПоТарифнамЗонам);
	ИначеЕсли НачисленияПоУслугам[Выборка.ТочкаУчета][Выборка.Услуга][Выборка.Шкала][Выборка.ТарифнаяЗона] = Неопределено Тогда
		СоотвествиеПоСпособам 								= Новый Соответствие;
		СоотвествиеПоСпособам.Вставить(Выборка.СпособНачисления, Новый Структура("ОбъемУслуги,ОбъемУслугиПотребленный", Выборка.ОбъемУслуги, Выборка.ОбъемУслугиПотребленный));
		НачисленияПоУслугам[Выборка.ТочкаУчета][Выборка.Услуга][Выборка.Шкала].Вставить(Выборка.ТарифнаяЗона, СоотвествиеПоСпособам);
	ИначеЕсли НачисленияПоУслугам[Выборка.ТочкаУчета][Выборка.Услуга][Выборка.Шкала][Выборка.ТарифнаяЗона][Выборка.СпособНачисления] = Неопределено Тогда
		НачисленияПоУслугам[Выборка.ТочкаУчета][Выборка.Услуга][Выборка.Шкала][Выборка.ТарифнаяЗона].Вставить(Выборка.СпособНачисления, Новый Структура("ОбъемУслуги,ОбъемУслугиПотребленный", Выборка.ОбъемУслуги, Выборка.ОбъемУслугиПотребленный));
	Иначе	
		НачисленияПоУслугам[Выборка.ТочкаУчета][Выборка.Услуга][Выборка.Шкала][Выборка.ТарифнаяЗона][Выборка.СпособНачисления].ОбъемУслуги = НачисленияПоУслугам[Выборка.ТочкаУчета][Выборка.Услуга][Выборка.Шкала][Выборка.ТарифнаяЗона][Выборка.СпособНачисления].ОбъемУслуги + Выборка.ОбъемУслуги;
		НачисленияПоУслугам[Выборка.ТочкаУчета][Выборка.Услуга][Выборка.Шкала][Выборка.ТарифнаяЗона][Выборка.СпособНачисления].ОбъемУслугиПотребленный = НачисленияПоУслугам[Выборка.ТочкаУчета][Выборка.Услуга][Выборка.Шкала][Выборка.ТарифнаяЗона][Выборка.СпособНачисления].ОбъемУслугиПотребленный + Выборка.ОбъемУслугиПотребленный;
	КонецЕсли; 		   		                                                 
	
	// запоминаем значения площадей для того чтобы пересчитать объем коммунальных квартир		
	Если Выборка.ПорядокПомещения  = 0 Тогда
		// если будут возникать ошибки суммарной площади (изменений в один день) исправить соотвествие на хранение площадей для каждого помещения
		НачалоПериода 			= НачалоДня(Выборка.НачалоПериода);
		Если ПлощадиПомещенийПоУслугам[Выборка.Услуга] = Неопределено Тогда
			ПлощадиПоПериодам  = Новый Соответствие;
			ПлощадиПоПериодам.Вставить(НачалоПериода, Новый Структура("Площадь,Помещения",Выборка.ЗначениеПлощади, Новый Массив));
			ПлощадиПомещенийПоУслугам.Вставить(Выборка.Услуга, ПлощадиПоПериодам);
		ИначеЕсли ПлощадиПомещенийПоУслугам[Выборка.Услуга][НачалоПериода] = Неопределено Тогда
			ПлощадиПомещенийПоУслугам[Выборка.Услуга].Вставить(НачалоПериода, Новый Структура("Площадь,Помещения",Выборка.ЗначениеПлощади, Новый Массив));
		ИначеЕсли ПлощадиПомещенийПоУслугам[Выборка.Услуга][НачалоПериода].Помещения.Найти(Выборка.Помещение) = Неопределено Тогда 
			ПлощадиПомещенийПоУслугам[Выборка.Услуга][НачалоПериода].Площадь = ПлощадиПомещенийПоУслугам[Выборка.Услуга][НачалоПериода].Площадь + Выборка.ЗначениеПлощади;
			ПлощадиПомещенийПоУслугам[Выборка.Услуга][НачалоПериода].Помещения.добавить(Выборка.Помещение);
		КонецЕсли;
	КонецЕсли;		
	
	Если Выборка.Техническая и ЕстьАбонент Тогда
		ПересчитатьТехническиеТочки.Добавить(Набор.Индекс(СтрокНабора));
	ИначеЕсли Выборка.Техническая Тогда
		ПересчитатьТехническиеТочкиПомещения.Добавить(НаборОбъемПомещений.Индекс(СтрокНабора));		
	КонецЕсли;	
	
		
	Если ДеревоТочекУчета[Выборка.КонецПериода] = Неопределено Тогда
		СтрокиНабора  									= Новый Массив;
		СтрокиНабора.Добавить(Набор.Индекс(СтрокНабора));
		
		СоотвествиеУслуги 								= Новый Соответствие;
		СоотвествиеУслуги.Вставить(Выборка.Услуга, СтрокиНабора);
		
		СоотвествиеТочки 								= Новый Соответствие;
		СоотвествиеТочки.Вставить(Выборка.ТочкаУчета, СоотвествиеУслуги);
		
		ДанныеТочкиУчета 								= Новый Соответствие;
		ДанныеТочкиУчета.Вставить(Выборка.ТочкаУчетаРодитель, СоотвествиеТочки);		
		
		ДеревоТочекУчета.Вставить(Выборка.КонецПериода, ДанныеТочкиУчета);
	ИначеЕсли ДеревоТочекУчета[Выборка.КонецПериода][Выборка.ТочкаУчетаРодитель] = Неопределено Тогда		
		
		СтрокиНабора  									= Новый Массив;
		СтрокиНабора.Добавить(Набор.Индекс(СтрокНабора));
		
		СоотвествиеУслуги 								= Новый Соответствие;
		СоотвествиеУслуги.Вставить(Выборка.Услуга, СтрокиНабора);
		
		СоотвествиеТочки 								= Новый Соответствие;
		СоотвествиеТочки.Вставить(Выборка.ТочкаУчета, СоотвествиеУслуги);
				
		ДеревоТочекУчета[Выборка.КонецПериода].Вставить(Выборка.ТочкаУчетаРодитель, СоотвествиеТочки);
		
	ИначеЕсли ДеревоТочекУчета[Выборка.КонецПериода][Выборка.ТочкаУчетаРодитель][Выборка.ТочкаУчета] = Неопределено Тогда
		СтрокиНабора  									= Новый Массив;
		СтрокиНабора.Добавить(Набор.Индекс(СтрокНабора));
		
		СоотвествиеУслуги 								= Новый Соответствие;
		СоотвествиеУслуги.Вставить(Выборка.Услуга, СтрокиНабора);
				
		ДеревоТочекУчета[Выборка.КонецПериода][Выборка.ТочкаУчетаРодитель].Вставить(Выборка.ТочкаУчета, СоотвествиеУслуги);
		
	ИначеЕсли ДеревоТочекУчета[Выборка.КонецПериода][Выборка.ТочкаУчетаРодитель][Выборка.ТочкаУчета][Выборка.Услуга] = Неопределено Тогда
		СтрокиНабора  									= Новый Массив;
		СтрокиНабора.Добавить(Набор.Индекс(СтрокНабора));		
				
		ДеревоТочекУчета[Выборка.КонецПериода][Выборка.ТочкаУчетаРодитель][Выборка.ТочкаУчета].Вставить(Выборка.Услуга, СтрокиНабора);
	Иначе
		
		ДеревоТочекУчета[Выборка.КонецПериода][Выборка.ТочкаУчетаРодитель][Выборка.ТочкаУчета][Выборка.Услуга].Добавить(Набор.Индекс(СтрокНабора)); 	
	КонецЕсли;
	
	
	//закрытая схема
	Если Выборка.ЗакрытаяСхемаГВС Тогда
		СтрокНабора.ОбъемУслуги 							= 0;
		СтрокНабора.Сумма 									= 0;
	КонецЕсли;

КонецПроцедуры

Процедура ПрочитатьНаборыЗаписейНачисление(Выборка, ДокументОбъект, Помещение, Набор, НаборОбъемПомещений, НаборВыполненные, ВидОперацийНачисления)
	
	НачатьТранзакцию();
	ДокументСсылка 									= Выборка.ДокументНачисления;
	ПометкаУдаления 								= Выборка.ДокументНачисленияПометкаУдаления;
	ДокументОбъект 									= Неопределено;
	Набор 											= Неопределено;
	НаборОбъемПомещений 							= Неопределено;
	НаборВыполненные 								= Неопределено;
	
	Если НЕ ЗначениеЗаполнено(ДокументСсылка)  Тогда
		Если ВидОперацийНачисления = Перечисления.энргВидыОперацийНачисления.Индивидуальные Тогда
			ДокументСсылка 							= Документы.энргНачисление.ПолучитьСсылку(Новый УникальныйИдентификатор());
			ДокументОбъект  						= Документы.энргНачисление.СоздатьДокумент();
			ДокументОбъект.МКД 						= Выборка.МКД;
		ИначеЕсли ВидОперацийНачисления = Перечисления.энргВидыОперацийНачисления.КорректировкаПотребленияСезонныхУслуг Тогда
			ДокументСсылка 							= Документы.энргПерерасчет.ПолучитьСсылку(Новый УникальныйИдентификатор());
			ДокументОбъект  						= Документы.энргПерерасчет.СоздатьДокумент();
			ДокументОбъект.ВидОперации				= Перечисления.энргВидыОпераций.энргПерерасчет_КорректировкаГодовогоПотребленияСезонныхУслуг;
			ДокументОбъект.Строение					= Выборка.МКД;
		Иначе
			ВызватьИсключение "Не указан вид операций начисления";
		КонецЕсли;
		
		ДокументОбъект.УстановитьСсылкуНового(ДокументСсылка);
		
		ДокументОбъект.район  						= Выборка.Район;		
																	 
		ДокументОбъект.Дата							= Выборка.ЗавершениеОП-1;
		ДокументОбъект.Организация 					= Выборка.Организация;
		
		НаборВыполненные 							= РегистрыСведений.энргДокументыНачислений.СоздатьНаборЗаписей();
		НаборВыполненныеДопСвойства 				= НаборВыполненные.ДополнительныеСвойства;
		НаборВыполненныеДопСвойства.Вставить("Замещать", Ложь);
		ЗаписьВыполненные							= НаборВыполненные.Добавить();
		ЗаписьВыполненные.Организация 				= Выборка.Организация;
		ЗаписьВыполненные.Район		 				= Выборка.Район;
		ЗаписьВыполненные.ПериодНачисления 			= Выборка.ПериодНачисления;
		ЗаписьВыполненные.ВидОперацийНачисления		= ВидОперацийНачисления;
		ЗаписьВыполненные.МКД 						= Выборка.МКД;
		ЗаписьВыполненные.ДокументНачисления 		= ДокументСсылка;
		
	ИначеЕсли ПометкаУдаления Тогда
		ДокументОбъект  							= ДокументСсылка.ПолучитьОбъект();
		ДокументОбъект.ПометкаУдаления 				= Ложь;
		ДокументОбъект.Дата							= Выборка.ЗавершениеОП-1;
		
		НаборВыполненные 							= РегистрыСведений.энргДокументыНачислений.СоздатьНаборЗаписей();
																																									 
		НаборВыполненные.Отбор.Организация.Установить(Выборка.Организация);
		НаборВыполненные.Отбор.ПериодНачисления.Установить(Выборка.ПериодНачисления);
		НаборВыполненные.Отбор.Район.Установить(Выборка.Район);
		НаборВыполненные.Отбор.ВидОперацийНачисления.Установить(ВидОперацийНачисления);
		НаборВыполненные.Отбор.МКД.Установить(Выборка.МКД);
		НаборВыполненныеДопСвойства 				= НаборВыполненные.ДополнительныеСвойства;
		НаборВыполненныеДопСвойства.Вставить("Замещать", Истина);
		
		ЗаписьВыполненные							= НаборВыполненные.Добавить();
		ЗаписьВыполненные.Организация 				= Выборка.Организация;
		ЗаписьВыполненные.Район		 				= Выборка.Район;
		ЗаписьВыполненные.ПериодНачисления 			= Выборка.ПериодНачисления;
		ЗаписьВыполненные.ВидОперацийНачисления 	= ВидОперацийНачисления;
		ЗаписьВыполненные.МКД 						= Выборка.МКД;
		ЗаписьВыполненные.ДокументНачисления 		= ДокументСсылка;
		ЗаписьВыполненные.ПометкаУдаления	 		= Ложь;
	КонецЕсли;
	
	Набор 											= РегистрыНакопления.энргОбъемНачислений.СоздатьНаборЗаписей();
	Набор.Отбор.Регистратор.Установить(ДокументСсылка);
	
	Набор.ДополнительныеСвойства.Вставить("Организация",		Выборка.Организация);
	Набор.ДополнительныеСвойства.Вставить("Район",				Выборка.Район);
	Набор.ДополнительныеСвойства.Вставить("ПериодНачисления",	Выборка.ПериодНачисления);
	Набор.ДополнительныеСвойства.Вставить("ЧастныйСектор",		Выборка.ЧастныйСектор);
	Набор.ДополнительныеСвойства.Вставить("Строение",			Выборка.МКД);
	Набор.ДополнительныеСвойства.Вставить("ДатаРегистратора",	Выборка.ЗавершениеОП-1);
	
	Если Не Помещение = Неопределено Тогда					
		Набор.ДополнительныеСвойства.Вставить("Помещение",	Помещение);
																			 
		Набор.Прочитать();		
		СтрокиУдалить 							= Новый Массив;
																																												
		Для Каждого СтрокаНабора ИЗ Набор Цикл
			Если НЕ СтрокаНабора.Помещение = Помещение Тогда
				Продолжить;
			КонецЕсли;			
			СтрокиУдалить.Добавить(СтрокаНабора);
		КонецЦикла;
		
		Для Сч = 0 По СтрокиУдалить.ВГраница() Цикл
			Набор.Удалить(СтрокиУдалить[Сч]);
		КонецЦикла; 				
	КонецЕсли;
	
	НаборОбъемПомещений								= РегистрыНакопления.энргОбъемНачисленийПомещенийСРазделеннымиЛС.СоздатьНаборЗаписей();
	НаборОбъемПомещений.Отбор.Регистратор.Установить(ДокументСсылка);
	НаборОбъемПомещений.ДополнительныеСвойства.Вставить("Организация",		Выборка.Организация);
	НаборОбъемПомещений.ДополнительныеСвойства.Вставить("Район",			Выборка.Район);
	НаборОбъемПомещений.ДополнительныеСвойства.Вставить("ПериодНачисления",	Выборка.ПериодНачисления);
	НаборОбъемПомещений.ДополнительныеСвойства.Вставить("ЧастныйСектор",	Выборка.ЧастныйСектор);
	НаборОбъемПомещений.ДополнительныеСвойства.Вставить("Строение",			Выборка.МКД);
	НаборОбъемПомещений.ДополнительныеСвойства.Вставить("ДатаРегистратора",	Выборка.ЗавершениеОП - 1);	
		
	Если Не Помещение = Неопределено Тогда					
		НаборОбъемПомещений.ДополнительныеСвойства.Вставить("Помещение",	Помещение);		
																			 
		НаборОбъемПомещений.Прочитать();
		СтрокиУдалить 							= Новый Массив;
																																																				 
		Для Каждого СтрокаНабора ИЗ НаборОбъемПомещений Цикл
			Если НЕ СтрокаНабора.Помещение = Помещение Тогда
				Продолжить;
			КонецЕсли;			
			СтрокиУдалить.Добавить(СтрокаНабора);
		КонецЦикла;
		
		Для Сч = 0 По СтрокиУдалить.ВГраница() Цикл
			НаборОбъемПомещений.Удалить(СтрокиУдалить[Сч]);
		КонецЦикла; 		
	КонецЕсли;
	
	Если ДокументОбъект = Неопределено Тогда
		Набор.Записать();
		НаборОбъемПомещений.Записать();
	КонецЕсли;
	
КонецПроцедуры

Процедура ЗаписатьНаборыЗаписейНачисление(ДокументОбъект, Набор, НаборВыполненные, НаборОбъемПомещений, Ошибки)
	
	Попытка
		Если НЕ ДокументОбъект = Неопределено Тогда
			ДокументОбъект.ДополнительныеСвойства.Вставить("ПроведениеРазрешено",Истина);
			ДокументОбъект.записать(РежимЗаписиДокумента.Запись);
		КонецЕсли;														
		
		Если НЕ НаборВыполненные = Неопределено Тогда
			НаборВыполненные.Записать(НаборВыполненные.ДополнительныеСвойства.Замещать);
		КонецЕсли;
										
		Набор.Записать(Ложь);								
		НаборОбъемПомещений.Записать(Ложь);						
		
		ЗафиксироватьТранзакцию();
	Исключение						
		ОтменитьТранзакцию();
		ИнформацияОбОшибке  					= ИнформацияОбОшибке();
		Ошибки 									= Ошибки +
		Символы.ПС + ПодробноеПредставлениеОшибки(ИнформацияОбОшибке);
	КонецПопытки;

КонецПроцедуры

Процедура УстановитьСуммуПоПовышенномуКоэффициенту(СтрокНабора)
	
	ПовыщающийКоэффициент = Макс(0,СтрокНабора.ПовыщающийКоэффициент - 1);
	
	СтрокНабора.СуммаПоПовышенномуКоэффициенту = СтрокНабора.ОбъемУслуги * СтрокНабора.ЗначениеТарифа * ПовыщающийКоэффициент;
	
КонецПроцедуры

Процедура РассчитатьРеквизитСумму_СПовышающимКоэффициентом(СтрокНабора, ДопЧисло = 1)
	
	ПовыщающийКоэффициент 	= Макс(1,СтрокНабора.ПовыщающийКоэффициент);	
	СтрокНабора.Сумма 		= ДопЧисло * СтрокНабора.ОбъемУслуги * СтрокНабора.ЗначениеТарифа * ПовыщающийКоэффициент;
	
КонецПроцедуры

Процедура РассчитатьДеревоТочекУчета(ДеревоТочекУчета,ЗавершениеОП,Набор, НаборОбъемПомещений,ПересчитатьТехническиеТочки, ПересчитатьТехническиеТочкиПомещения,ОстатокСоциальнойНормы)
	
	Для Каждого КлючЗначениеПериод Из ДеревоТочекУчета Цикл
		Дерево  								= Новый Массив;
		
		Если КлючЗначениеПериод.Значение.Количество() = 1 Тогда
			Продолжить;
		КонецЕсли;
		
		
		
		Для Каждого Вершины Из КлючЗначениеПериод.Значение Цикл
			Если ЗначениеЗаполнено(Вершины.Ключ) Тогда
				Продолжить;
			КонецЕсли;
			
			Для Каждого КлючЗначение ИЗ Вершины.Значение Цикл 				
				Дерево.Добавить(Новый Структура("ТочкаУчета, Услуги, Потомки", КлючЗначение.Ключ, КлючЗначение.Значение, Новый Массив));					
			КонецЦикла;			
		КонецЦикла;
		
		Для Каждого Вершина Из Дерево Цикл 			
			ЗаполнитьДеревоТочекУчетаРекурсивно(КлючЗначениеПериод.Значение, Вершина.ТочкаУчета, Вершина.Потомки, Вершина.Услуги);		
		КонецЦикла;	
		
		Для Каждого Вершина Из Дерево Цикл
			
			Если Вершина.Потомки.Количество() = 0 Тогда
				Продолжить;
			КонецЕсли;
			
			Для Каждого УслугаВершины из Вершина.Услуги Цикл 
				
				СтрокиНабора 						= УслугаВершины.Значение;
				ДанныеСтрокиНачислений 				= Набор.Получить(СтрокиНабора[0]);
				
				ОбщаяСуммаЗначениеСоциальнойНормы 	= ДанныеСтрокиНачислений.ЗначениеСоциальнойНормы; //"ЗначениеСоциальнойНормы" необходимо будет определять если у всей ветки "ОбщаяСуммаЗначениеСоциальнойНормы" больше 0
				ОпределитьОбщуюСуммуЗначениеСоциальнойНормыРекурсия(Набор, Вершина.Потомки, ОбщаяСуммаЗначениеСоциальнойНормы, УслугаВершины.Ключ);		
				
				Если (ДанныеСтрокиНачислений.СпособНачисления  = Перечисления.энргСпособНачислений.ПоПриборам
					ИЛИ ДанныеСтрокиНачислений.СпособНачисления  = Перечисления.энргСпособНачислений.НачислениеПоСреднему) Тогда
					// Обходим первый уровень потомков смотрим есть ли точки учета с расходом то прибору учета
					// Если расход по прибору учета есть, уменьшаем объем к распределению для точек/групп точек
					// Если расхода по прибору нет и таких точек учета на одном уровне больше 1, то
					// Оставляем расход только на голове			
					ОбъемКРаспределению  									= ДанныеСтрокиНачислений.ОбъемУслугиПотребленный;
					РасходПотомковПоПрибору 								= 0;
					СтрокБезРасходаПоПрибору 								= 0;
					ИндексГруппаТочекБезПрибора 							= Неопределено;
					Для Сч = 0 По Вершина.Потомки.ВГраница() Цикл
						СтрокиНабораПотомка									= Вершина.Потомки[Сч].Услуги[УслугаВершины.Ключ];
						Если СтрокиНабораПотомка = Неопределено Тогда
							Продолжить;
						КонецЕсли;
						
						Для Индекс = 0 По СтрокиНабораПотомка.ВГраница() Цикл
							СтрокаНачисленийПотомка  			= Набор.Получить(СтрокиНабораПотомка[Индекс]); 	
							
							Если СтрокаНачисленийПотомка.СверхНорматива Тогда
								Продолжить;
							КонецЕсли;
							
							Если (СтрокаНачисленийПотомка.СпособНачисления  = Перечисления.энргСпособНачислений.ПоПриборам
								ИЛИ СтрокаНачисленийПотомка.СпособНачисления  = Перечисления.энргСпособНачислений.НачислениеПоСреднему) Тогда 					
								РасходПотомковПоПрибору 					= РасходПотомковПоПрибору + СтрокаНачисленийПотомка.ОбъемУслугиПотребленный;
							Иначе
								СтрокБезРасходаПоПрибору 					= СтрокБезРасходаПоПрибору + 1;
								ИндексГруппаТочекБезПрибора 				= Сч;
							КонецЕсли;
						КонецЦикла;
					КонецЦикла;	
	
					ОчиститьОбъемУслугиТочекУчетаДереревоРекурсия(ЗавершениеОП, Набор, Вершина.Потомки, УслугаВершины.Ключ , ДанныеСтрокиНачислений, ОстатокСоциальнойНормы, ОбщаяСуммаЗначениеСоциальнойНормы);

				Иначе
					Для Сч  = 0 По СтрокиНабора.ВГраница() Цикл
						ДанныеСтрокиНачислений 								= Набор.Получить(СтрокиНабора[Сч]);
						ДанныеСтрокиНачислений.СпособНачисления 			= Перечисления.энргСпособНачислений.Расчетный; 					
						ДанныеСтрокиНачислений.ОбъемУслуги 					= СуммаНормативовПотомковРекурсия(Набор, Вершина.Потомки, ДанныеСтрокиНачислений.Услуга);
						ДанныеСтрокиНачислений.ЗначениеСоциальнойНормы 		= 0;
						ДанныеСтрокиНачислений.ОбъемУслугиПотребленный		= 0;
						//ДанныеСтрокиНачислений.Сумма 					= ДанныеСтрокиНачислений.ОбъемУслуги * ДанныеСтрокиНачислений.ЗначениеТарифа;
						РассчитатьРеквизитСумму_СПовышающимКоэффициентом(ДанныеСтрокиНачислений);
						УстановитьСуммуПоПовышенномуКоэффициенту(ДанныеСтрокиНачислений);					
					КонецЦикла;			
					
					ОчиститьОбъемУслугиТочекУчетаДереревоРекурсия(ЗавершениеОП, Набор, Вершина.Потомки,УслугаВершины.Ключ, ДанныеСтрокиНачислений, ОстатокСоциальнойНормы, ОбщаяСуммаЗначениеСоциальнойНормы);
				КонецЕсли;
				
				ДанныеСтрокиНачислений.ЗначениеСоциальнойНормы		= ОстатокСоциальнойНормы[ДанныеСтрокиНачислений.КлючПомещения][УслугаВершины.Ключ][ДанныеСтрокиНачислений.НаправлениеИспользованияТУ].Остаток;
				
			КонецЦикла;
		КонецЦикла;
	КонецЦикла;
КонецПроцедуры

Процедура ПересчитатьСоциальнуюНорму(Набор, НаборОбъемПомещений, ОстатокСоциальнойНормы, ПересчитатьТехническиеТочки, ПересчитатьТехническиеТочкиПомещения)
	  	
	Для Каждого КлючЗначениеПомещение Из ОстатокСоциальнойНормы Цикл		
		Для Каждого КлючЗначениеУслуга Из КлючЗначениеПомещение.Значение Цикл
			Для Каждого КлючЗначениеНаправление Из КлючЗначениеУслуга.Значение Цикл
				СтруктураСоциальнойНормы 							= КлючЗначениеНаправление.Значение;
				Остаток 											= СтруктураСоциальнойНормы.Остаток;
				ОстатокИзСтруктуры									= СтруктураСоциальнойНормы.Остаток;
				ИндексыСтрок 										= СтруктураСоциальнойНормы.ИндексыСтрок;
				ИндексыСтрокПомещения								= СтруктураСоциальнойНормы.ИндексыСтрокПомещения;
				Если Остаток < 0 Тогда
					Продолжить;
				КонецЕсли;
				
				Для Сч = 0 По ИндексыСтрок.ВГраница() Цикл
					СтрокаНабора  									= Набор.Получить(ИндексыСтрок[Сч]);
					Если СтрокаНабора.ОбъемУслуги = 0 Тогда
						Продолжить;
					КонецЕсли;
										
					Если ОстатокИзСтруктуры = 0 Тогда						
						СтрокаНабора.СверхНорматива 		= Истина;
						СтрокаНабора.ОбъемУслугиСоцНорма 	= СтрокаНабора.ОбъемУслуги;
						СтрокаНабора.ЗначениеТарифа 		= СтрокаНабора.ЗначениеТарифаСверхНорматива;						
						РассчитатьРеквизитСумму_СПовышающимКоэффициентом(СтрокаНабора);
						Продолжить;
					КонецЕсли;
					
					
					Используем 										= Мин(Остаток, СтрокаНабора.ОбъемУслуги);
					Остаток											= Остаток - Используем;
					Если Используем > 0 И Используем = СтрокаНабора.ОбъемУслуги Тогда
						СтрокаНабора.ОбъемУслугиСоцНорма 			= Используем;
					ИначеЕсли Используем > 0 Тогда					
						СтрокаСверхНормы 							= Набор.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаСверхНормы,СтрокаНабора);
						СтрокаСверхНормы.СверхНорматива 			= Истина;
						СтрокаСверхНормы.ОбъемУслуги 				= СтрокаСверхНормы.ОбъемУслуги - Используем;
						СтрокаСверхНормы.ОбъемУслугиПотребленный 	= 0;
						СтрокаСверхНормы.ЗначениеТарифа 			= СтрокаСверхНормы.ЗначениеТарифаСверхНорматива;
						//СтрокаСверхНормы.Сумма 						= СтрокаСверхНормы.ОбъемУслуги * СтрокаСверхНормы.ЗначениеТарифа;
						РассчитатьРеквизитСумму_СПовышающимКоэффициентом(СтрокаСверхНормы);
						
						
						Если НЕ ПересчитатьТехническиеТочки.Найти(ИндексыСтрок[Сч]) = Неопределено Тогда
							ПересчитатьТехническиеТочки.Добавить(Набор.Индекс(СтрокаСверхНормы));
						КонецЕсли;	
						
						СтрокаНабора.ОбъемУслуги 					= Используем;
						СтрокаНабора.ОбъемУслугиСоцНорма 			= Используем;
						//СтрокаНабора.Сумма 							= СтрокаНабора.ОбъемУслуги * СтрокаНабора.ЗначениеТарифа;
						РассчитатьРеквизитСумму_СПовышающимКоэффициентом(СтрокаНабора);
					ИначеЕсли СтрокаНабора.ОбъемУслуги > 0 Тогда
						СтрокаНабора.ЗначениеТарифа 				= СтрокаНабора.ЗначениеТарифаСверхНорматива;
						//СтрокаНабора.Сумма 							= СтрокаНабора.ОбъемУслуги * СтрокаНабора.ЗначениеТарифа;
						РассчитатьРеквизитСумму_СПовышающимКоэффициентом(СтрокаНабора);
						СтрокаНабора.СверхНорматива 				= Истина;
					КонецЕсли;				
				КонецЦикла;
				
				Для Сч = 0 По ИндексыСтрокПомещения.ВГраница() Цикл
					
					Если ОстатокИзСтруктуры = 0 Тогда
						СтрокаНабора  						= НаборОбъемПомещений.Получить(ИндексыСтрокПомещения[Сч]);
						СтрокаНабора.СверхНорматива 		= Истина;
						СтрокаНабора.ОбъемУслугиСоцНорма 	= СтрокаНабора.ОбъемУслуги;
						//СтрокаНабора.ЗначениеТарифа 		= СтрокаНабора.ЗначениеТарифаСверхНорматива;						
						//РассчитатьРеквизитСумму_СПовышающимКоэффициентом(СтрокаНабора);
						Продолжить;
					КонецЕсли;					
					
					СтрокаНабора  									= НаборОбъемПомещений.Получить(ИндексыСтрокПомещения[Сч]);
					Используем 										= Мин(Остаток, СтрокаНабора.ОбъемУслуги);
					Остаток											= Остаток - Используем;
					Если Используем > 0 И Используем = СтрокаНабора.ОбъемУслуги Тогда
						СтрокаНабора.ОбъемУслугиСоцНорма 			= Используем;
					ИначеЕсли Используем > 0 Тогда					
						СтрокаСверхНормы 							= НаборОбъемПомещений.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаСверхНормы,СтрокаНабора);
						СтрокаСверхНормы.СверхНорматива 			= Истина;
						СтрокаСверхНормы.ОбъемУслуги 				= СтрокаСверхНормы.ОбъемУслуги - Используем;
						СтрокаСверхНормы.ОбъемУслугиПотребленный 	= 0;				
						Если НЕ ПересчитатьТехническиеТочкиПомещения.Найти(НаборОбъемПомещений[Сч]) = Неопределено Тогда
							ПересчитатьТехническиеТочкиПомещения.Добавить(НаборОбъемПомещений.Индекс(СтрокаСверхНормы));
						КонецЕсли;	
						
						СтрокаНабора.ОбъемУслуги 					= Используем;
						СтрокаНабора.ОбъемУслугиСоцНорма 			= Используем;					
					ИначеЕсли СтрокаНабора.ОбъемУслуги > 0 Тогда										
						СтрокаНабора.СверхНорматива 				= Истина;
					КонецЕсли;				
				КонецЦикла;			
			КонецЦикла;		
		КонецЦикла;
	КонецЦикла;
	
КонецПроцедуры

Процедура ЗаполнитьДеревоТочекУчетаРекурсивно(ДеревоТочекУчета,Родитель,Потомки,Услуги)
	Коллекция  			= ДеревоТочекУчета[Родитель];
	
	Если Коллекция = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Для Каждого КлючЗначение Из Коллекция Цикл
		врПотомки  		= Новый Массив;
		ЗаполнитьДеревоТочекУчетаРекурсивно(ДеревоТочекУчета, КлючЗначение.Ключ, врПотомки, КлючЗначение.Значение);
		Потомки.Добавить(Новый Структура("ТочкаУчета, Потомки, Услуги", КлючЗначение.Ключ, врПотомки, КлючЗначение.Значение)); 		
	КонецЦикла;
КонецПроцедуры

Процедура ОчиститьОбъемУслугиТочекУчетаДереревоРекурсия(ЗавершениеОП, Набор, Потомки, Услуга, ДанныеСтрокиРодителя, ОстатокСоциальнойНормы, ОбщаяСуммаЗначениеСоциальнойНормы)
	
	Для Каждого СтрокаПотомка Из Потомки Цикл
		СтрокиНабора 								= СтрокаПотомка.Услуги[Услуга];
		Если СтрокиНабора = Неопределено Тогда
			Продолжить;
		КонецЕсли; 	
		
		Для Сч = 0 По СтрокиНабора.ВГраница() Цикл
			ДанныеСтрокиНачислений 					=  Набор.Получить(СтрокиНабора[Сч]);
			Если Сч = 0 и ОбщаяСуммаЗначениеСоциальнойНормы > 0 Тогда
				
				Если НЕ ДанныеСтрокиРодителя.НаправлениеИспользованияТУ = ДанныеСтрокиНачислений.НаправлениеИспользованияТУ Тогда
					ОстатокСоциальнойНормы[ДанныеСтрокиРодителя.КлючПомещения]
					[ДанныеСтрокиРодителя.Услуга]
					[ДанныеСтрокиРодителя.НаправлениеИспользованияТУ]
					.Остаток 						= Макс(ОстатокСоциальнойНормы[ДанныеСтрокиРодителя.КлючПомещения]
					[ДанныеСтрокиРодителя.Услуга]
					[ДанныеСтрокиРодителя.НаправлениеИспользованияТУ]
					.Остаток,0) + ДанныеСтрокиНачислений.ЗначениеСоциальнойНормыРасчетныйСпособ;									
				КонецЕсли;				
			КонецЕсли;			
			
			ДанныеСтрокиНачислений.ОбъемУслуги  	= 0;
			ДанныеСтрокиНачислений.Сумма 			= 0;
			ДанныеСтрокиНачислений.СверхНорматива 	= Ложь;
			УстановитьСуммуПоПовышенномуКоэффициенту(ДанныеСтрокиНачислений);
		КонецЦикла;
		ОчиститьОбъемУслугиТочекУчетаДереревоРекурсия(ЗавершениеОП, Набор, СтрокаПотомка.Потомки, Услуга, ДанныеСтрокиРодителя,ОстатокСоциальнойНормы, ОбщаяСуммаЗначениеСоциальнойНормы);
	КонецЦикла;
	
КонецПроцедуры

Функция СуммаНормативовПотомковРекурсия(Набор, Потомки, Услуга) 
	
	врНорматив 							= 0;
	Для Каждого СтрокаПотомка Из Потомки Цикл
		Если СтрокаПотомка.Потомки.Количество()  = 0 Тогда
			СтрокиНабора 				= СтрокаПотомка.Услуги[Услуга];
			Если СтрокиНабора = Неопределено Тогда
				Продолжить;
			КонецЕсли;
			
			Для Сч = 0 По СтрокиНабора.ВГраница() Цикл
				СтрокаНабора 			= Набор.Получить(СтрокиНабора[Сч]);
				Если НЕ Услуга = СтрокаНабора.Услуга Тогда
					Продолжить;
				КонецЕсли;				  				
				врНорматив 							= врНорматив + СтрокаНабора.ОбъемУслугиПотребленный;
			КонецЦикла;			
		Иначе
			врНорматив 					= врНорматив + СуммаНормативовПотомковРекурсия(Набор, СтрокаПотомка.Потомки, Услуга);
		КонецЕсли;		
	КонецЦикла;
	
	Возврат врНорматив;
	
КонецФункции

Процедура ОпределитьОбщуюСуммуЗначениеСоциальнойНормыРекурсия(Набор, Потомки, ОбщаяСуммаЗначениеСоциальнойНормы, Услуга);
	
	Для Каждого СтрокаПотомка Из Потомки Цикл
		
		СтрокиНабора = СтрокаПотомка.Услуги[Услуга];
		Если СтрокиНабора = Неопределено Тогда
			Продолжить;
		КонецЕсли;	
		
		Для Сч = 0 По СтрокиНабора.ВГраница() Цикл  			
			ДанныеСтрокиНачислений 				= Набор.Получить(СтрокиНабора[Сч]);			 
			ОбщаяСуммаЗначениеСоциальнойНормы 	= ОбщаяСуммаЗначениеСоциальнойНормы + ДанныеСтрокиНачислений.ЗначениеСоциальнойНормы;
		КонецЦикла;
		
		ОпределитьОбщуюСуммуЗначениеСоциальнойНормыРекурсия(Набор, СтрокаПотомка.Потомки, ОбщаяСуммаЗначениеСоциальнойНормы, Услуга);
	КонецЦикла;	
	
КонецПроцедуры

Процедура ИзменитьОстатокСоциальнойНормы(ОстатокСоциальнойНормы, КлючПомещения, Услуга, НаправлениеИспользованияТУ, ЗначениеСоциальнойНормы, Набор, НаборОбъемПомещений, СтрокНабора);
			
	ЕстьАбонент 											= Набор.Индекс(СтрокНабора) >= 0;
	
	Если ОстатокСоциальнойНормы[КлючПомещения] = Неопределено Тогда
		ИндексыСтрок 										= Новый Массив;
		ИндексыСтрокПомещения 								= Новый Массив;
		Если ЕстьАбонент Тогда
			ИндексыСтрок.Добавить(Набор.Индекс(СтрокНабора));
		Иначе
			ИндексыСтрокПомещения.Добавить(НаборОбъемПомещений.Индекс(СтрокНабора));
		КонецЕсли;
		СоотвествиеНаправление  							= Новый Соответствие;
		СоотвествиеУслуга		  							= Новый Соответствие;
		ОписаниеСоциальнойНормы  							= Новый Структура("КонецПериода,Остаток,ИндексыСтрок,ИндексыСтрокПомещения", СтрокНабора.КонецПериода, ЗначениеСоциальнойНормы,ИндексыСтрок,ИндексыСтрокПомещения);
		СоотвествиеНаправление.Вставить(НаправлениеИспользованияТУ, ОписаниеСоциальнойНормы);
		СоотвествиеУслуга.Вставить(Услуга, СоотвествиеНаправление);
		ОстатокСоциальнойНормы.Вставить(КлючПомещения, СоотвествиеУслуга);
	ИначеЕсли ОстатокСоциальнойНормы[КлючПомещения][Услуга] = Неопределено Тогда		
		ИндексыСтрок 										= Новый Массив;
		ИндексыСтрокПомещения 								= Новый Массив;
		Если ЕстьАбонент Тогда
			ИндексыСтрок.Добавить(Набор.Индекс(СтрокНабора));
		Иначе
			ИндексыСтрокПомещения.Добавить(НаборОбъемПомещений.Индекс(СтрокНабора));
		КонецЕсли;
		ОписаниеСоциальнойНормы  							= Новый Структура("КонецПериода,Остаток,ИндексыСтрок,ИндексыСтрокПомещения", СтрокНабора.КонецПериода,ЗначениеСоциальнойНормы,ИндексыСтрок,ИндексыСтрокПомещения);
		СоотвествиеНаправление  							= Новый Соответствие;
		СоотвествиеНаправление.Вставить(НаправлениеИспользованияТУ, ОписаниеСоциальнойНормы);																																 
		ОстатокСоциальнойНормы[КлючПомещения].Вставить(Услуга, СоотвествиеНаправление);		
	ИначеЕсли ОстатокСоциальнойНормы[КлючПомещения][Услуга][НаправлениеИспользованияТУ] = Неопределено Тогда
		ИндексыСтрок 										= Новый Массив;
		ИндексыСтрокПомещения 								= Новый Массив;
		Если ЕстьАбонент Тогда
			ИндексыСтрок.Добавить(Набор.Индекс(СтрокНабора));
		Иначе
			ИндексыСтрокПомещения.Добавить(НаборОбъемПомещений.Индекс(СтрокНабора));
		КонецЕсли;
		ОписаниеСоциальнойНормы  							= Новый Структура("КонецПериода,Остаток,ИндексыСтрок,ИндексыСтрокПомещения", СтрокНабора.КонецПериода,ЗначениеСоциальнойНормы,ИндексыСтрок,ИндексыСтрокПомещения);
		ОстатокСоциальнойНормы[КлючПомещения][Услуга].Вставить(НаправлениеИспользованияТУ, ОписаниеСоциальнойНормы);
	ИначеЕсли ОстатокСоциальнойНормы[КлючПомещения][Услуга][НаправлениеИспользованияТУ].КонецПериода < СтрокНабора.КонецПериода Тогда
		ОстатокСоциальнойНормы[КлючПомещения][Услуга][НаправлениеИспользованияТУ].Остаток = ЗначениеСоциальнойНормы;
		Если ЕстьАбонент Тогда
			ОстатокСоциальнойНормы[КлючПомещения][Услуга][НаправлениеИспользованияТУ].ИндексыСтрок.Добавить(Набор.Индекс(СтрокНабора));
		Иначе
			ОстатокСоциальнойНормы[КлючПомещения][Услуга][НаправлениеИспользованияТУ].ИндексыСтрокПомещения.Добавить(НаборОбъемПомещений.Индекс(СтрокНабора));
		КонецЕсли;		
	ИначеЕсли ЕстьАбонент Тогда		
		ОстатокСоциальнойНормы[КлючПомещения][Услуга][НаправлениеИспользованияТУ].ИндексыСтрок.Добавить(Набор.Индекс(СтрокНабора));
	Иначе		
		ОстатокСоциальнойНормы[КлючПомещения][Услуга][НаправлениеИспользованияТУ].ИндексыСтрокПомещения.Добавить(НаборОбъемПомещений.Индекс(СтрокНабора));
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область НачислениеНаОДН_ВспомогательныеПроцедурыИФункции

Функция РезультатЗапросаНачисленияНаОДН(Организация,ПериодНачисления,Район,МКД,НачалоПериодаРасчета,КонецПериодаРасчета,ДнейВПериоде) 	
	МВТ  = Новый МенеджерВременныхТаблиц;
	ВспомогательныеДанныеНачисленияМКД(МВТ,Организация, ПериодНачисления,Район,МКД,НачалоПериодаРасчета,КонецПериодаРасчета,ДнейВПериоде);
	ПолучитьСтабильныеПериодыМКД(МВТ,Ложь);
	ПолучитьДанныеДляРасчетаМКД(МВТ,"энргНачислениеМКД");
	Возврат РассчитатьОбъемПотребленияМКД(МВТ);
КонецФункции

Процедура ВспомогательныеДанныеНачисленияМКД(МВТ,Организация,ПериодНачисления,Район,МКД,НачалоПериодаРасчета,КонецПериодаРасчета,ДнейВПериоде)
	Запрос 							= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Текст  							= ТекстЗапросаВспомогательныеДанныеНачисленияМКД(МКД<>Неопределено);	
	Если МКД = Неопределено тогда
		Текст 						= СтрЗаменить(Текст,"И энргМаксимальныеПоказанияСрезМКД.МКД = &МКД","");		
		Текст 						= СтрЗаменить(Текст,"И энргПредоставленныеПоказанияМКД.МКД = &МКД","");
		Текст 						= СтрЗаменить(Текст,"И энргСреднийОбъемПотребленияМКД.МКД = &МКД","");
		Текст 						= СтрЗаменить(Текст,"И энргВыводПриборовУчетаМКД.МКД = &МКД","");
		Текст 						= СтрЗаменить(Текст,"И (энргНомераСтрокСтабильногоПериодаМКД.МКД = &МКД)","");
		Текст 						= СтрЗаменить(Текст,"И энргСтабильныеПериодыМКД.МКД = &МКД","");
		Текст 						= СтрЗаменить(Текст,"И энргСтабильныеПериодыШкалы.МКД = &МКД","");
		Текст 						= СтрЗаменить(Текст,"МКД = &МКД","ИСТИНА");
	иначе
		Запрос.УстановитьПараметр("МКД",МКД);
	КонецЕсли; 	
	
	Запрос.УстановитьПараметр("НачалоВеденияУчета",		Константы.энргДатаНачалаВеденияУчета.Получить());	 // Дата
	Запрос.УстановитьПараметр("НачалоПериодаРасчета",	НачалоПериодаРасчета);	 // Дата
	Запрос.УстановитьПараметр("КонецПериодаРасчета",	КонецПериодаРасчета);	 // Дата
	Запрос.УстановитьПараметр("Организация",			Организация);	 // Дата
	Запрос.УстановитьПараметр("ПериодНачисления",		ПериодНачисления);	 // Дата
	Запрос.УстановитьПараметр("Район",					Район);	 // Районы
	Запрос.УстановитьПараметр("ДнейВПериоде",			ДнейВПериоде );
	Запрос.Текст 					= Текст;
	Запрос.Выполнить();
КонецПроцедуры

Процедура ПолучитьСтабильныеПериодыМКД(МВТ,ЭтоПерерасчет)
	Запрос 							= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Текст  							= ТекстЗапросаПолучитьСтабильныеПериодыМКД();	
	Запрос.УстановитьПараметр("НачалоВеденияУчета", Константы.энргДатаНачалаВеденияУчета.Получить()); 
	Запрос.Текст 					= Текст;
	Запрос.Выполнить();
КонецПроцедуры

Процедура ПолучитьДанныеДляРасчетаМКД(МВТ,ИмяДокумента)
	Текст 							= ТекстЗапросаПолучитьДанныеДляРасчетаМКД(ИмяДокумента);
	Запрос 							= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Запрос.Текст 					= Текст;
	Запрос.Выполнить(); 	
КонецПроцедуры

Процедура ДобавитьСтрокиНачисленияМКДПоФормуле(ПериодНачисления, Организация, Район, МКД, ТочкаУчета, КонецПериодаРасчета, ОписаниеУслуг, НормативыПоУслугам, Набор)
	
 	ТипыРасходов 									= энргНачисления.ТипыРасходовВФормулахРасчета();
	ТипРасходаПоШкале  								= ТипыРасходов["РасходИзмерителяПоШкале"];	
	ТипРасходаНорматив 								= ТипыРасходов["ЗначениеНормативаПоУслуге"];
	
	Для Каждого СтрокаФормулы Из ОписаниеУслуг Цикл			
		ТекФормулаОбъемУслуги	 					= СтрокаФормулы.ФормулаРасчета;
		
		Если Не ЗначениеЗаполнено(ТекФормулаОбъемУслуги) Тогда
			Продолжить;
		КонецЕсли;
		ТекФормулаОбъемУслугиПотребленный			= СтрокаФормулы.ФормулаРасчета;
		ПараметрыФормулы 							= СтрокаФормулы.ПараметрыФормулы;
		Для Каждого КлючЗначениеЧастьУзла Из ПараметрыФормулы Цикл
			Шкалы 									= КлючЗначениеЧастьУзла.Значение;
			КлючЧастьУзлаПриборУчета 				= XMLСтрока(КлючЗначениеЧастьУзла.Ключ); 
			Для Каждого КлючЗначениеШкала Из Шкалы Цикл
				КлючШкалы 							= XMLСтрока(КлючЗначениеШкала.Ключ);
				ОписаниеОбъема 						= КлючЗначениеШкала.Значение;
				Ключ 								= Новый Структура("ТипРасхода, ПриборУчета, Шкала", ТипРасходаПоШкале, КлючЧастьУзлаПриборУчета,КлючШкалы); 
				ТекФормулаОбъемУслуги 				= СтрЗаменить(ТекФормулаОбъемУслуги,"[" + ЗначениеВСтрокуВнутр(Ключ) + "]",ОписаниеОбъема.ОбъемУслуги);
				ТекФормулаОбъемУслугиПотребленный 	= СтрЗаменить(ТекФормулаОбъемУслугиПотребленный,"[" + ЗначениеВСтрокуВнутр(Ключ) + "]",ОписаниеОбъема.ОбъемУслугиПотребленный);
			КонецЦикла; 			
		КонецЦикла;
		
		Для Каждого ПараметрФормулы Из НормативыПоУслугам Цикл			
			Ключ 									= Новый Структура("ТипРасхода, Услуга", ТипРасходаНорматив, XMLСтрока(ПараметрФормулы.Ключ));			
			ТекФормулаОбъемУслуги 					= СтрЗаменить(ТекФормулаОбъемУслуги,"[" + ЗначениеВСтрокуВнутр(Ключ) + "]",ПараметрФормулы.Значение);
			ТекФормулаОбъемУслугиПотребленный 		= СтрЗаменить(ТекФормулаОбъемУслугиПотребленный,"[" + ЗначениеВСтрокуВнутр(Ключ) + "]",ПараметрФормулы.Значение);
		КонецЦикла;
		
		ТекФормулаОбъемУслуги						= СтрЗаменить(ТекФормулаОбъемУслуги," ","");
		ТекФормулаОбъемУслуги						= СтрЗаменить(ТекФормулаОбъемУслуги,Символы.НПП,"");
		ТекФормулаОбъемУслуги						= СтрЗаменить(ТекФормулаОбъемУслуги,",",".");
		РезультатПоФормуламОбъемУслуги				= 0;
		ТекФормулаОбъемУслуги 						= СтрЗаменить(ТекФормулаОбъемУслуги,"[Результат]=","РезультатПоФормуламОбъемУслуги=");
		Выполнить ТекФормулаОбъемУслуги;
		
		ТекФормулаОбъемУслугиПотребленный			= СтрЗаменить(ТекФормулаОбъемУслугиПотребленный," ","");
		ТекФормулаОбъемУслугиПотребленный			= СтрЗаменить(ТекФормулаОбъемУслугиПотребленный,Символы.НПП,"");
		ТекФормулаОбъемУслугиПотребленный			= СтрЗаменить(ТекФормулаОбъемУслугиПотребленный,",",".");
		РезультатПоФормуламОбъемУслугиПотребленный	= 0;
		ТекФормулаОбъемУслугиПотребленный			= СтрЗаменить(ТекФормулаОбъемУслугиПотребленный,"[Результат]=","РезультатПоФормуламОбъемУслугиПотребленный=");
		Выполнить ТекФормулаОбъемУслугиПотребленный;
		
		Если РезультатПоФормуламОбъемУслуги = 0 И РезультатПоФормуламОбъемУслугиПотребленный = 0 Тогда
			Продолжить;
		КонецЕсли;
		
		СтрокаНабора 								= Набор.добавить();
		СтрокаНабора.Период 						= КонецПериодаРасчета-1;
		СтрокаНабора.Организация 					= Организация;
		СтрокаНабора.Район 							= Район;
		СтрокаНабора.МКД 							= МКД;
		СтрокаНабора.Услуга 						= СтрокаФормулы.Услуга;
		СтрокаНабора.ТочкаУчета 					= ТочкаУчета;
		СтрокаНабора.ВидНачисления 					= Перечисления.энргВидыНачислений.Начисление;
		СтрокаНабора.СпособНачисления 				= СтрокаФормулы.СпособНачисления;
		СтрокаНабора.ПриборУчета 					= СтрокаФормулы.УзелПриборУчета;
		СтрокаНабора.ТарифнаяЗона 					= Справочники.энргТарифныеЗоны.ПустаяСсылка();
		СтрокаНабора.Поставщик 						= СтрокаФормулы.Поставщик;
		СтрокаНабора.ПериодРасчета 					= ПериодНачисления;
		СтрокаНабора.ПериодНачисления 				= ПериодНачисления;
		СтрокаНабора.ОбъемУслуги 					= РезультатПоФормуламОбъемУслуги;		
		СтрокаНабора.ОбъемУслугиПотребленный 		= РезультатПоФормуламОбъемУслугиПотребленный;		
		СтрокаНабора.НачалоПериода 					= СтрокаФормулы.НачалоПериода;
		СтрокаНабора.КонецПериода 					= СтрокаФормулы.КонецПериода;			
		СтрокаНабора.НеПрименятьСезонность			= СтрокаФормулы.НеПрименятьСезонность;
	КонецЦикла;
	
КонецПроцедуры

Процедура ОбработатьРезультатЗапросаНачисленийМКД(РезультатЗапроса, ГраницыПериода, МКД, Набор)
	перем ДокументОбъект, НаборВыполненные, ТекМКД, ТекУслуга, ТекШкала;
		
	Выборка  														= РезультатЗапроса.выбрать();
			
	ТекТочкаУчета													= Неопределено;
	ТекПриборУчета													= Неопределено;
	ТекНачалоПериода												= Неопределено;
	ТекКонецПериода 												= Неопределено;
	ТекФормулаРасчета												= Неопределено;
	ТекПоставщик  													= Неопределено;
	СпособРасчетаПоПрибору 											= Перечисления.энргСпособНачислений.ПоПриборам;
	СпособРасчетаПоСреднему											= Перечисления.энргСпособНачислений.НачислениеПоСреднему;
	КлючТепловаяСоставляющая 										= энргРаботаСФормуламиРасчетаСервер.ТепловаяСоставляющаяКлюч();
	ФормулыРасчет 													= Неопределено;
	ПараметрыФормулы 												= Неопределено;
	ТекСпособНачисленияПоФормуле 									= Неопределено;
	НачисляемПоФормуле 												= Ложь;	
	СпособРасчетаПоФормуле 											= Неопределено;	
	НормативыПоУслугам 												= Неопределено;
	СтрокаОписанияФормулы 											= Неопределено;
	МассивФормулРасчета												= Неопределено;	
	КлючСтруктурыФормулы 											= "
	|Услуга, ФормулаРасчета, Поставщик,
	|СпособНачисления, УзелПриборУчета, НеПрименятьСезонность,
	|НачалоПериода, КонецПериода, ОбъемЗаПрошлыйГод";
			
	НачисленияПоУслугамТочки 										= Неопределено;
		
	Ошибки 															= "";
	Если Выборка.Количество() = 0 Тогда
		Возврат;		
	КонецЕсли;
	
	НачатьТранзакцию();

	ЧитатьНаборыЗаписейДокументаНачисленияМКД 						= Набор = Неопределено;
	
	Пока Выборка.следующий() цикл
		
		Если ТекМКД = Неопределено И ЧитатьНаборыЗаписейДокументаНачисленияМКД Тогда
			ПрочитатьНаборыЗаписейДокументаНачисленияМКД(Выборка, МКД, ДокументОбъект, НаборВыполненные, Набор, Перечисления.энргВидыОперацийНачисления.РасчетМКД);
		КонецЕсли;
	
		Если Не ТекМКД = Выборка.МКД Или НЕ ТекТочкаУчета = Выборка.ТочкаУчета ИЛИ Не ТекНачалоПериода = Выборка.НачалоПериода Тогда
			
			Если НЕ ТекМКД = Неопределено Тогда
				СтрокаОписанияФормулы.Вставить("ПараметрыФормулы", ПараметрыФормулы);
				МассивФормулРасчета.Добавить(СтрокаОписанияФормулы); 				
				
				ДобавитьСтрокиНачисленияМКДПоФормуле(Выборка.ПериодНачисления, Выборка.Организация, Выборка.Район, ТекМКД, ТекТочкаУчета, Выборка.ЗавершениеОП-1, МассивФормулРасчета, НормативыПоУслугам, Набор);
			КонецЕсли;
			
			МассивФормулРасчета 									= Новый Массив;
			СтрокаОписанияФормулы 									= Новый Структура(КлючСтруктурыФормулы);
			СтрокаОписанияФормулы.Услуга 							= Выборка.Услуга;
			СтрокаОписанияФормулы.ФормулаРасчета 					= Выборка.ФормулаРасчета;
			СтрокаОписанияФормулы.Поставщик 						= Выборка.Поставщик;
			СтрокаОписанияФормулы.СпособНачисления 					= Выборка.СпособНачисления;
			СтрокаОписанияФормулы.УзелПриборУчета 					= Выборка.УзелПриборУчета;
			СтрокаОписанияФормулы.НеПрименятьСезонность 			= Выборка.НеПрименятьСезонность;
			СтрокаОписанияФормулы.НачалоПериода 					= Выборка.НачалоПериода;
			СтрокаОписанияФормулы.КонецПериода 						= Выборка.КонецПериода;
			СтрокаОписанияФормулы.ОбъемЗаПрошлыйГод 				= Выборка.ОбъемЗаПрошлыйГод;
							
			ПараметрыФормулы 										= Новый Соответствие;
			НачисленияПоУслугамТочки 								= Новый Соответствие;
			НачисленияПоШкале 										= Новый Соответствие;
			
			НормативыПоУслугам  									= Новый Соответствие;
			НормативыПоУслугам.Вставить(Выборка.Услуга, 	Выборка.НормаПотребления);			
			
			УдалитьСтрокиПоСреднемуПоНормативу					= Новый Соответствие;
		ИначеЕсли НЕ ТекУслуга = Выборка.Услуга Тогда
			СтрокаОписанияФормулы.Вставить("ПараметрыФормулы", ПараметрыФормулы);
			МассивФормулРасчета.Добавить(СтрокаОписанияФормулы);
			НачисленияПоУслугамТочки.Вставить(ТекУслуга, НачисленияПоШкале);
			
			ПараметрыФормулы 										= Новый Соответствие;
			НачисленияПоШкале 										= Новый Соответствие;
			
			СтрокаОписанияФормулы 									= Новый Структура(КлючСтруктурыФормулы);
			СтрокаОписанияФормулы.Услуга 							= Выборка.Услуга;
			СтрокаОписанияФормулы.ФормулаРасчета 					= Выборка.ФормулаРасчета;
			СтрокаОписанияФормулы.Поставщик 						= Выборка.Поставщик;
			СтрокаОписанияФормулы.СпособНачисления 					= Выборка.СпособНачисления;
			СтрокаОписанияФормулы.УзелПриборУчета 					= Выборка.УзелПриборУчета;
			СтрокаОписанияФормулы.НеПрименятьСезонность 			= Выборка.НеПрименятьСезонность;
			СтрокаОписанияФормулы.НачалоПериода 					= Выборка.НачалоПериода;
			СтрокаОписанияФормулы.КонецПериода 						= Выборка.КонецПериода;
			СтрокаОписанияФормулы.ОбъемЗаПрошлыйГод 				= Выборка.ОбъемЗаПрошлыйГод;
					
			НормативыПоУслугам.Вставить(Выборка.Услуга, 		Выборка.НормаПотребления);			
		ИначеЕсли НЕ ТекШкала = Выборка.Шкала Тогда
			НачисленияПоШкале 										= Новый Соответствие;
		КонецЕсли; 
		
		//перенос с отэка
		Если НЕ ЗначениеЗаполнено(Выборка.ФормулаРасчета) Тогда
			Если Выборка.СпособНачисления = Перечисления.энргСпособНачислений.СреднееПоНормативу Тогда
				Если УдалитьСтрокиПоСреднемуПоНормативу[Выборка.Услуга] = Неопределено или УдалитьСтрокиПоСреднемуПоНормативу[Выборка.Услуга][Выборка.УзелПриборУчета] = Неопределено Тогда
					
					СтрокаНабора 											= Набор.добавить();
					ЗаполнитьЗначенияСвойств(СтрокаНабора,Выборка);
					СтрокаНабора.ПриборУчета								= Выборка.УзелПриборУчета;
					СтрокаНабора.Период 									= Выборка.ЗавершениеОП-1;
					СтрокаНабора.ВидНачисления 								= Перечисления.энргВидыНачислений.Начисление;
					
					Если ЗначениеЗаполнено(Выборка.ЗависитОтУслуги) и НЕ Выборка.ПривязанаКШкале и НЕ Выборка.РасчетПоФормуле Тогда
						ОбъемУслуги 										= 0;
						ОбъемУслугиПотребленный 							= 0;
						Если НЕ НачисленияПоУслугамТочки[Выборка.ЗависитОтУслуги] = Неопределено Тогда
							Если НЕ НачисленияПоУслугамТочки[Выборка.ЗависитОтУслуги][Выборка.Шкала] = Неопределено Тогда
								ОбъемУслугиОсновной 						= НачисленияПоУслугамТочки[Выборка.ЗависитОтУслуги][Выборка.Шкала];
								ОбъемУслуги 								= ОбъемУслугиОсновной.ОбъемУслуги * Выборка.НормаПотребления;
								ОбъемУслугиПотребленный 					= ОбъемУслугиОсновной.ОбъемУслугиПотребленный * Выборка.НормаПотребления;
							КонецЕсли;
						КонецЕсли;
						СтрокаНабора.ОбъемУслуги 							= ОбъемУслуги;
						СтрокаНабора.ОбъемУслугиПотребленный 				= ОбъемУслугиПотребленный;
					КонецЕсли;
					
					Если УдалитьСтрокиПоСреднемуПоНормативу[Выборка.Услуга] <> Неопределено Тогда
						УдалитьСтрокиПоСреднемуПоНормативу[Выборка.Услуга].Вставить(Выборка.УзелПриборУчета,Истина);
					Иначе
						СоотвествиеПрибора = Новый Соответствие;
						СоотвествиеПрибора.Вставить(Выборка.УзелПриборУчета,Истина);
						УдалитьСтрокиПоСреднемуПоНормативу.Вставить(Выборка.Услуга,СоотвествиеПрибора);
					КонецЕсли;
				КонецЕсли;
			Иначе
				СтрокаНабора 											= Набор.добавить();
				ЗаполнитьЗначенияСвойств(СтрокаНабора,Выборка);
				СтрокаНабора.Период 									= Выборка.ЗавершениеОП-1;
				СтрокаНабора.ВидНачисления 								= Перечисления.энргВидыНачислений.Начисление;
				
				Если ЗначениеЗаполнено(Выборка.ЗависитОтУслуги) и НЕ Выборка.ПривязанаКШкале и НЕ Выборка.РасчетПоФормуле Тогда
					ОбъемУслуги 										= 0;
					ОбъемУслугиПотребленный 							= 0;
					Если НЕ НачисленияПоУслугамТочки[Выборка.ЗависитОтУслуги] = Неопределено Тогда
						Если НЕ НачисленияПоУслугамТочки[Выборка.ЗависитОтУслуги][Выборка.Шкала] = Неопределено Тогда
							ОбъемУслугиОсновной 						= НачисленияПоУслугамТочки[Выборка.ЗависитОтУслуги][Выборка.Шкала];
							ОбъемУслуги 								= ОбъемУслугиОсновной.ОбъемУслуги * Выборка.НормаПотребления;
							ОбъемУслугиПотребленный 					= ОбъемУслугиОсновной.ОбъемУслугиПотребленный * Выборка.НормаПотребления;
						КонецЕсли;
					КонецЕсли;
					СтрокаНабора.ОбъемУслуги 							= ОбъемУслуги;
					СтрокаНабора.ОбъемУслугиПотребленный 				= ОбъемУслугиПотребленный;
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
		//отэк
		 		
		
		КлючЧастиУзла 												= Выборка.ЧастьУзлаПриборУчета.УникальныйИдентификатор();
		КлючШкалы 													= Выборка.Шкала.УникальныйИдентификатор();
		Если ПараметрыФормулы[КлючЧастиУзла] = Неопределено Тогда
			СоотвествиеШкалы 										= Новый Соответствие;
			СоотвествиеШкалы.Вставить(КлючШкалы, Новый Структура("ОбъемУслуги, ОбъемУслугиПотребленный", Выборка.ОбъемУслуги, Выборка.ОбъемУслугиПотребленный));
			ПараметрыФормулы.Вставить(КлючЧастиУзла, СоотвествиеШкалы);
		ИначеЕсли ПараметрыФормулы[КлючЧастиУзла][КлючШкалы] = Неопределено Тогда
			ПараметрыФормулы[КлючЧастиУзла].Вставить(КлючШкалы, Новый Структура("ОбъемУслуги, ОбъемУслугиПотребленный", Выборка.ОбъемУслуги, Выборка.ОбъемУслугиПотребленный));
		Иначе
			ПараметрыФормулы[КлючЧастиУзла][КлючШкалы].ОбъемУслуги 				= ПараметрыФормулы[КлючЧастиУзла][КлючШкалы].ОбъемУслуги + Выборка.ОбъемУслуги;
			ПараметрыФормулы[КлючЧастиУзла][КлючШкалы].ОбъемУслугиПотребленный 	= ПараметрыФормулы[КлючЧастиУзла][КлючШкалы].ОбъемУслугиПотребленный + Выборка.ОбъемУслугиПотребленный;
		КонецЕсли; 		
		
		Если НЕ НачисленияПоШкале[Выборка.Шкала] = Неопределено Тогда
			НачисленияПоШкале[Выборка.Шкала].ОбъемУслуги 			 = НачисленияПоШкале[Выборка.Шкала].ОбъемУслуги + Выборка.ОбъемУслуги;
			НачисленияПоШкале[Выборка.Шкала].ОбъемУслугиПотребленный = НачисленияПоШкале[Выборка.Шкала].ОбъемУслугиПотребленный + Выборка.ОбъемУслугиПотребленный;
		Иначе
			НачисленияПоШкале.Вставить(Выборка.Шкала, Новый Структура("ОбъемУслуги, ОбъемУслугиПотребленный", Выборка.ОбъемУслуги, Выборка.ОбъемУслугиПотребленный));
		КонецЕсли;
		
		//закрытая схема
		Если Выборка.ЗакрытаяСхемаГВС Тогда
			СтрокаНабора.ОбъемУслуги = 0;
		КонецЕсли;		 		
		
		ТекМКД 														= Выборка.МКД;
		ТекУслуга 													= Выборка.Услуга;
		ТекНачалоПериода											= Выборка.НачалоПериода;
		ТекКонецПериода												= Выборка.КонецПериода;
		ТекТочкаУчета 												= Выборка.ТочкаУчета;
		ТекШкала 													= Выборка.Шкала;
	КонецЦикла;	
	
	Если Не МассивФормулРасчета = Неопределено Тогда
		СтрокаОписанияФормулы.Вставить("ПараметрыФормулы", ПараметрыФормулы);
		МассивФормулРасчета.Добавить(СтрокаОписанияФормулы);		
		ДобавитьСтрокиНачисленияМКДПоФормуле(Выборка.ПериодНачисления, Выборка.Организация, Выборка.Район, ТекМКД, ТекТочкаУчета, Выборка.ЗавершениеОП-1, МассивФормулРасчета, НормативыПоУслугам, Набор);
	КонецЕсли;
	
	Если ЧитатьНаборыЗаписейДокументаНачисленияМКД Тогда
		ЗаписатьНаборыЗаписейНачислениеМКД(ДокументОбъект, Набор, НаборВыполненные, Ошибки) ;     
	КонецЕсли;
	
	Если НЕ ПустаяСтрока(Ошибки) Тогда
		ВызватьИсключение Ошибки;
	КонецЕсли;
	
КонецПроцедуры

Процедура ПрочитатьНаборыЗаписейДокументаНачисленияМКД(Выборка,МКД,ДокументОбъект,НаборВыполненные,Набор, ВидОперацийНачисления)
	
	ДокументСсылка											= Выборка.ДокументНачисления;
	ПометкаУдаления 										= Выборка.ДокументНачисленияПометкаУдаления;
	
	ДокументОбъект 											= Неопределено;
	НаборВыполненные 										= Неопределено;
	Набор 													= Неопределено;
	
	Если НЕ ЗначениеЗаполнено(ДокументСсылка) Тогда				
		Если ВидОперацийНачисления = Перечисления.энргВидыОперацийНачисления.РасчетМКД Тогда																							   
			ДокументСсылка 									= Документы.энргНачислениеМКД.ПолучитьСсылку(Новый УникальныйИдентификатор());
			ДокументОбъект  								= Документы.энргНачислениеМКД.СоздатьДокумент();																					 
		ИначеЕсли ВидОперацийНачисления = Перечисления.энргВидыОперацийНачисления.КорректировкаПотребленияСезонныхУслугМКД Тогда
			ДокументСсылка 									= Документы.энргПерерасчетМКД.ПолучитьСсылку(Новый УникальныйИдентификатор());															  
			ДокументОбъект  								= Документы.энргПерерасчетМКД.СоздатьДокумент();																										  
			ДокументОбъект.ВидОперации 						= Перечисления.энргВидыОпераций.энргПерерасчетМКД_КорректировкаГодовогоПотребленияСезонныхУслуг;
		Иначе
			ВызватьИсключение "Не указан вид операций начисления";																						 
		КонецЕсли;
		
		ДокументОбъект.район  								= Выборка.Район;
		ДокументОбъект.Дата									= Выборка.ЗавершениеОП-1;
		ДокументОбъект.Организация 							= Выборка.Организация;
		ДокументОбъект.УстановитьСсылкуНового(ДокументСсылка);
		
		НаборВыполненные 									= РегистрыСведений.энргДокументыНачислений.СоздатьНаборЗаписей();
		НаборВыполненныеДопСвойства 						= НаборВыполненные.ДополнительныеСвойства;
		НаборВыполненныеДопСвойства.Вставить("Замещать", Ложь);
		ЗаписьВыполненные									= НаборВыполненные.Добавить();
		ЗаписьВыполненные.Организация 						= Выборка.Организация;
		ЗаписьВыполненные.ПериодНачисления 					= Выборка.ПериодНачисления;
		ЗаписьВыполненные.Район			 					= Выборка.Район;
		ЗаписьВыполненные.ВидОперацийНачисления 			= ВидОперацийНачисления;
		ЗаписьВыполненные.МКД 								= Справочники.энргСтроения.ПустаяСсылка();
		ЗаписьВыполненные.ДокументНачисления 				= ДокументСсылка;							
	ИначеЕсли ПометкаУдаления Тогда
		ДокументОбъект										= ДокументСсылка.ПолучитьОбъект();
		ДокументОбъект.ПометкаУдаления 						= Ложь;
		
		НаборВыполненные 									= РегистрыСведений.энргДокументыНачислений.СоздатьНаборЗаписей();
		НаборВыполненныеДопСвойства 						= НаборВыполненные.ДополнительныеСвойства;
		НаборВыполненныеДопСвойства.Вставить("Замещать", Истина);
		
		НаборВыполненные.Отбор.Организация.Установить(Выборка.Организация);
		НаборВыполненные.Отбор.ПериодНачисления.Установить(Выборка.ПериодНачисления);
		НаборВыполненные.Отбор.Район.Установить(Выборка.Район);
		НаборВыполненные.Отбор.ВидОперацийНачисления.Установить(ВидОперацийНачисления);
		НаборВыполненные.Отбор.МКД.Установить(Справочники.энргСтроения.ПустаяСсылка());  					  
		
		ЗаписьВыполненные									= НаборВыполненные.Добавить();
		ЗаписьВыполненные.Организация 						= Выборка.Организация;
		ЗаписьВыполненные.ПериодНачисления 					= Выборка.ПериодНачисления;
		ЗаписьВыполненные.Район			 					= Выборка.Район;
		ЗаписьВыполненные.ВидОперацийНачисления 			= ВидОперацийНачисления;
		ЗаписьВыполненные.МКД 								= Справочники.энргСтроения.ПустаяСсылка();
		ЗаписьВыполненные.ДокументНачисления 				= ДокументСсылка;
		ЗаписьВыполненные.ПометкаУдаления	 				= Ложь;				
	КонецЕсли;
	
	Набор 													= РегистрыНакопления.энргОбъемНачисленийМКД.СоздатьНаборЗаписей();
	Набор.ДополнительныеСвойства.Вставить("Организация",		Выборка.Организация);
	Набор.ДополнительныеСвойства.Вставить("Район",				Выборка.Район);
	Набор.ДополнительныеСвойства.Вставить("ПериодНачисления",	Выборка.ПериодНачисления);
	Набор.ДополнительныеСвойства.Вставить("ДатаРегистратора",	Выборка.ЗавершениеОП-1);
	Набор.Отбор.Регистратор.Установить(ДокументСсылка);
	
	ОчищатьНабор 											= Ложь;
	
	Если НЕ МКД = Неопределено Тогда
		ОчищатьНабор 										= Истина;
		Набор.ДополнительныеСвойства.Вставить("МКД",	МКД);		
		Набор.Прочитать();
		СтрокиУдалить 										= Новый Массив;
		Для Каждого СтрокаНабора ИЗ Набор Цикл
			Если НЕ СтрокаНабора.МКД = МКД Тогда
				Продолжить;
			КонецЕсли;				
			СтрокиУдалить.Добавить(СтрокаНабора);
		КонецЦикла;
		
		Для Сч = 0 По СтрокиУдалить.ВГраница() Цикл
			Набор.Удалить(СтрокиУдалить[Сч]);
		КонецЦикла;			
	КонецЕсли;	
	
	Если ДокументОбъект = Неопределено Тогда
		Набор.ДополнительныеСвойства.Вставить("ЭтоОчистка",Истина);
		Набор.Записать();
		Набор.ДополнительныеСвойства.Удалить("ЭтоОчистка");
		Если ОчищатьНабор Тогда
			Набор.Очистить();
		КонецЕсли;		
	КонецЕсли;

КонецПроцедуры

Функция РассчитатьОбъемПотребленияМКД(МВТ); 
	Текст 							= ТекстЗапросаРассчитатьОбъемПотребленияМКД();
	Запрос 							= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Запрос.Текст 					= Текст;
	Возврат Запрос.Выполнить();	
КонецФункции

#КонецОбласти

#Область СнятьСредниеНачисления_ВспомогательныеПроцедурыИФункции

Процедура ПрочитатьНеСписанныйСредний(МВТ,ПериодНачисления,Организация,Район,Строение,Помещение,НачалоПериодаРасчета,ТаблицаПриемник = Неопределено)
	Запрос  						= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Текст 							=
	"ВЫБРАТЬ
	|	энргДокументыНачислений.ДокументНачисления КАК ДокументНачисления
	|ПОМЕСТИТЬ ДокументыНачислений
	|ИЗ
	|	РегистрСведений.энргДокументыНачислений КАК энргДокументыНачислений
	|ГДЕ
	|	энргДокументыНачислений.Организация = &Организация
	|	И энргДокументыНачислений.ПериодНачисления = &ПериодНачисления
	|	И энргДокументыНачислений.Район = &Район
	|	И энргДокументыНачислений.МКД = &МКД
	|	И энргДокументыНачислений.ВидОперацийНачисления = ЗНАЧЕНИЕ(Перечисление.энргВидыОперацийНачисления.Индивидуальные)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргНачисленныйСреднийОбъемОстатки.Организация КАК Организация,
	|	энргНачисленныйСреднийОбъемОстатки.Район КАК Район,
	|	энргНачисленныйСреднийОбъемОстатки.ЧастныйСектор КАК ЧастныйСектор,
	|	энргНачисленныйСреднийОбъемОстатки.Строение КАК Строение,
	|	энргНачисленныйСреднийОбъемОстатки.Помещение КАК Помещение,
	|	энргНачисленныйСреднийОбъемОстатки.Абонент КАК Абонент,
	|	энргНачисленныйСреднийОбъемОстатки.ПериодНачисления КАК ПериодНачисления,
	|	энргНачисленныйСреднийОбъемОстатки.ТочкаУчета КАК ТочкаУчета,
	|	энргНачисленныйСреднийОбъемОстатки.Услуга КАК Услуга,
	|	энргНачисленныйСреднийОбъемОстатки.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	энргНачисленныйСреднийОбъемОстатки.ЗначениеТарифа КАК ЗначениеТарифа,
	|	энргНачисленныйСреднийОбъемОстатки.ПриборУчета КАК ПриборУчета,
	|	энргНачисленныйСреднийОбъемОстатки.Шкала КАК Шкала,
	|	энргНачисленныйСреднийОбъемОстатки.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргНачисленныйСреднийОбъемОстатки.Поставщик КАК Поставщик,
	|	энргНачисленныйСреднийОбъемОстатки.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|	энргНачисленныйСреднийОбъемОстатки.ПриборЗависимой КАК ПриборЗависимой,
	|	энргНачисленныйСреднийОбъемОстатки.СпособНачисления КАК СпособНачисления,
	|	энргНачисленныйСреднийОбъемОстатки.СверхНорматива КАК СверхНорматива,
	|	энргНачисленныйСреднийОбъемОстатки.СуммаОстаток КАК Сумма,
	|	энргНачисленныйСреднийОбъемОстатки.ОбъемУслугиОстаток КАК ОбъемУслуги,
	|	энргНачисленныйСреднийОбъемОстатки.ОбъемУслугиПотребленныйОстаток КАК ОбъемУслугиПотребленный,
	|	энргПомещения.Родитель КАК ПомещениеРодитель
	|ПОМЕСТИТЬ НеСписанныйСредний
	|ИЗ
	|	РегистрНакопления.энргНачисленныйСреднийОбъем.Остатки(
	|			&НачалоПериодаРасчетаГраница,
	|			Организация = &Организация
	|				И Район = &Район
	|				И ЧастныйСектор = &ЧастныйСектор
	|				И Строение = &Строение
	|				И Помещение = &Помещение) КАК энргНачисленныйСреднийОбъемОстатки
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.энргПомещения КАК энргПомещения
	|		ПО энргНачисленныйСреднийОбъемОстатки.Помещение = энргПомещения.Ссылка";
	
	Если НЕ Помещение = Неопределено и ЗначениеЗаполнено(Помещение) тогда
		Запрос.УстановитьПараметр("ЧастныйСектор",		Не ЗначениеЗаполнено(Строение));
		Запрос.УстановитьПараметр("Строение",			Строение);
		Запрос.УстановитьПараметр("Помещение",			Помещение);
		Запрос.УстановитьПараметр("МКД",				Строение);
	ИначеЕсли НЕ Строение = Неопределено и ЗначениеЗаполнено(Строение) тогда
		Запрос.УстановитьПараметр("ЧастныйСектор",		Ложь);
		Запрос.УстановитьПараметр("Строение",			Строение);
		Запрос.УстановитьПараметр("МКД",				Строение);
		Текст 		= СтрЗаменить(Текст,"И Помещение = &Помещение",""); 		
	ИначеЕсли НЕ Строение = Неопределено и Не ЗначениеЗаполнено(Строение) тогда
		Запрос.УстановитьПараметр("ЧастныйСектор",		Истина);
		Запрос.УстановитьПараметр("МКД",				Справочники.энргСтроения.ПустаяСсылка());
		Текст 		= СтрЗаменить(Текст,"И Строение = &Строение","");
		Текст 		= СтрЗаменить(Текст,"И Помещение = &Помещение","");
	иначе 		
		Текст 		= СтрЗаменить(Текст,"И ЧастныйСектор = &ЧастныйСектор","");
		Текст 		= СтрЗаменить(Текст,"И Строение = &Строение","");		
		Текст 		= СтрЗаменить(Текст,"И Помещение = &Помещение","");
		Текст 		= СтрЗаменить(Текст,"И энргДокументыНачислений.МКД = &МКД","");
	КонецЕсли;  
	
	Запрос.УстановитьПараметр("НачалоПериодаРасчетаГраница",Новый Граница(НачалоПериодаРасчета,ВидГраницы.Исключая));
	Запрос.УстановитьПараметр("ПериодНачисления",				ПериодНачисления);
	Запрос.УстановитьПараметр("Район",							Район);
	Запрос.УстановитьПараметр("Организация",					Организация);
	Запрос.Текст 			= Текст;
	
	Если ТаблицаПриемник = Неопределено тогда
		Запрос.Выполнить();
	иначе
		Запрос.Текст 		= СтрЗаменить(Запрос.Текст,"ПОМЕСТИТЬ НеСписанныйСредний","");
		Результат  			= Запрос.Выполнить();
		Выборка 			= Результат.Выбрать();
		Пока Выборка.Следующий() цикл
			ЗаполнитьЗначенияСвойств(ТаблицаПриемник.добавить(),Выборка);
		КонецЦикла;  		 
	КонецЕсли; 
	
КонецПроцедуры

Функция РезультатЗапросаПерерасчетСреднего(МВТ,Организация,ПериодНачисления,КонецПериодаРасчета,Район,Строение,Помещение,НачисленныйСреднийОбъем=Неопределено)
	ТекстРазделить 						= " 
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|";  
	
	Текст 	= "";
	Если НачисленныйСреднийОбъем <> Неопределено тогда
		Текст 	="ВЫБРАТЬ
		|	НеСписанныйСредний.Организация,
		|	НеСписанныйСредний.Район,
		|	НеСписанныйСредний.МКД,
		|	НеСписанныйСредний.Абонент,
		|	НеСписанныйСредний.ПериодНачисления,
		|	НеСписанныйСредний.ТочкаУчета,
		|	НеСписанныйСредний.Услуга,
		|	НеСписанныйСредний.ЗначениеТарифа,
		|	НеСписанныйСредний.ПриборУчета,
		|	НеСписанныйСредний.Сумма,
		|	НеСписанныйСредний.ОбъемУслуги,
		|	НеСписанныйСредний.ОбъемУслугиПотребленный,
		|	НеСписанныйСредний.Поставщик,
		|	НеСписанныйСредний.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
		|	НеСписанныйСредний.ПриборЗависимой КАК ПриборЗависимой
		|ПОМЕСТИТЬ НеСписанныйСреднийБезГруппировки
		|ИЗ
		|	&НачисленныйСреднийОбъем КАК НеСписанныйСредний
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НеСписанныйСреднийБезГруппировки.Организация,
		|	НеСписанныйСреднийБезГруппировки.Район,
		|	НеСписанныйСреднийБезГруппировки.МКД,
		|	НеСписанныйСреднийБезГруппировки.Абонент,
		|	НеСписанныйСреднийБезГруппировки.ПериодНачисления,
		|	НеСписанныйСреднийБезГруппировки.ТочкаУчета,
		|	НеСписанныйСреднийБезГруппировки.Услуга,
		|	НеСписанныйСреднийБезГруппировки.ЗначениеТарифа,
		|	НеСписанныйСреднийБезГруппировки.ПриборУчета,
		|	СУММА(НеСписанныйСреднийБезГруппировки.Сумма) КАК Сумма,
		|	СУММА(НеСписанныйСреднийБезГруппировки.ОбъемУслуги) КАК ОбъемУслуги,
		|	СУММА(НеСписанныйСреднийБезГруппировки.ОбъемУслугиПотребленный) КАК ОбъемУслугиПотребленный,
		|	НеСписанныйСреднийБезГруппировки.Поставщик,
		|	НеСписанныйСреднийБезГруппировки.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
		|	НеСписанныйСреднийБезГруппировки.ПриборЗависимой КАК ПриборЗависимой
		|ПОМЕСТИТЬ НеСписанныйСредний
		|ИЗ
		|	НеСписанныйСреднийБезГруппировки КАК НеСписанныйСреднийБезГруппировки
		|
		|СГРУППИРОВАТЬ ПО
		|	НеСписанныйСреднийБезГруппировки.Организация,
		|	НеСписанныйСреднийБезГруппировки.Район,
		|	НеСписанныйСреднийБезГруппировки.МКД,
		|	НеСписанныйСреднийБезГруппировки.Абонент,
		|	НеСписанныйСреднийБезГруппировки.ПериодНачисления,
		|	НеСписанныйСреднийБезГруппировки.ТочкаУчета,
		|	НеСписанныйСреднийБезГруппировки.Услуга,
		|	НеСписанныйСреднийБезГруппировки.ЗначениеТарифа,
		|	НеСписанныйСреднийБезГруппировки.ПриборУчета,
		|	НеСписанныйСреднийБезГруппировки.Поставщик,
		|	НеСписанныйСреднийБезГруппировки.ЗависимаяТочкаУчета,
		|	НеСписанныйСреднийБезГруппировки.ПриборЗависимой";
		
		Текст 		= Текст + ТекстРазделить;
	КонецЕсли;  
	
	Текст 			= Текст + 
	"ВЫБРАТЬ
	|	НеСписанныйСредний.Организация КАК Организация,
	|	НеСписанныйСредний.Район КАК Район,
	|	НеСписанныйСредний.ЧастныйСектор КАК ЧастныйСектор,
	|	НеСписанныйСредний.Строение КАК Строение,
	|	НеСписанныйСредний.Помещение КАК Помещение,
	|	НеСписанныйСредний.ПериодНачисления КАК ПериодНачисления,
	|	НеСписанныйСредний.ТочкаУчета КАК ТочкаУчета,
	|	НеСписанныйСредний.Услуга КАК Услуга,
	|	НеСписанныйСредний.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	НеСписанныйСредний.ЗначениеТарифа КАК ЗначениеТарифа,
	|	НеСписанныйСредний.ПриборУчета КАК ПриборУчета,
	|	НеСписанныйСредний.Шкала КАК Шкала,
	|	НеСписанныйСредний.ТарифнаяЗона КАК ТарифнаяЗона,
	|	НеСписанныйСредний.Абонент КАК Абонент,
	|	НеСписанныйСредний.Сумма КАК Сумма,
	|	НеСписанныйСредний.ОбъемУслуги КАК ОбъемУслуги,
	|	НеСписанныйСредний.ОбъемУслугиПотребленный КАК ОбъемУслугиПотребленный,
	|	МИНИМУМ(энргПредоставленныеПоказания.ДатаРегистратора) КАК ДатаРегистратора,
	|	НеСписанныйСредний.Поставщик КАК Поставщик,
	|	НеСписанныйСредний.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|	НеСписанныйСредний.ПриборЗависимой КАК ПриборЗависимой,
	|	НеСписанныйСредний.СпособНачисления КАК СпособНачисления,
	|	НеСписанныйСредний.СверхНорматива КАК СверхНорматива,
	|	НеСписанныйСредний.ПомещениеРодитель КАК ПомещениеРодитель
	|ПОМЕСТИТЬ ДанныеДляСписанияМинДата
	|ИЗ
	|	РегистрСведений.энргПредоставленныеПоказания КАК энргПредоставленныеПоказания
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ НеСписанныйСредний КАК НеСписанныйСредний
	|		ПО энргПредоставленныеПоказания.Организация = НеСписанныйСредний.Организация
	|			И энргПредоставленныеПоказания.Район = НеСписанныйСредний.Район
	|			И энргПредоставленныеПоказания.ЧастныйСектор = НеСписанныйСредний.ЧастныйСектор
	|			И энргПредоставленныеПоказания.Строение = НеСписанныйСредний.Строение
	|			И энргПредоставленныеПоказания.Помещение = НеСписанныйСредний.Помещение
	|			И энргПредоставленныеПоказания.ПриборУчета = НеСписанныйСредний.ПриборУчета
	|			И энргПредоставленныеПоказания.Шкала = НеСписанныйСредний.Шкала
	|			И энргПредоставленныеПоказания.ТарифнаяЗона = НеСписанныйСредний.ТарифнаяЗона
	|			И (энргПредоставленныеПоказания.Организация = &Организация)
	|			И (энргПредоставленныеПоказания.ПериодНачисления = &ПериодНачисления)
	|			И (энргПредоставленныеПоказания.Район = &Район)
	|			И (энргПредоставленныеПоказания.ЧастныйСектор = &ЧастныйСектор)
	|			И (энргПредоставленныеПоказания.Строение = &Строение)
	|			И (энргПредоставленныеПоказания.Помещение = &Помещение)
	|			И (энргПредоставленныеПоказания.ПоказанияТекущегоПериода)
	|
	|СГРУППИРОВАТЬ ПО
	|	НеСписанныйСредний.Организация,
	|	НеСписанныйСредний.Район,
	|	НеСписанныйСредний.ЧастныйСектор,
	|	НеСписанныйСредний.Строение,
	|	НеСписанныйСредний.Помещение,
	|	НеСписанныйСредний.ПериодНачисления,
	|	НеСписанныйСредний.ТочкаУчета,
	|	НеСписанныйСредний.Услуга,
	|	НеСписанныйСредний.НаправлениеИспользованияТУ,
	|	НеСписанныйСредний.ЗначениеТарифа,
	|	НеСписанныйСредний.ПриборУчета,
	|	НеСписанныйСредний.Шкала,
	|	НеСписанныйСредний.ТарифнаяЗона,
	|	НеСписанныйСредний.Абонент,
	|	НеСписанныйСредний.Сумма,
	|	НеСписанныйСредний.ОбъемУслуги,
	|	НеСписанныйСредний.ОбъемУслугиПотребленный,
	|	НеСписанныйСредний.Поставщик,
	|	НеСписанныйСредний.ЗависимаяТочкаУчета,
	|	НеСписанныйСредний.ПриборЗависимой,
	|	НеСписанныйСредний.СпособНачисления,
	|	НеСписанныйСредний.СверхНорматива,
	|	НеСписанныйСредний.ПомещениеРодитель
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	НеСписанныйСредний.Организация,
	|	НеСписанныйСредний.Район,
	|	НеСписанныйСредний.ЧастныйСектор,
	|	НеСписанныйСредний.Строение,
	|	НеСписанныйСредний.Помещение,
	|	НеСписанныйСредний.ПериодНачисления,
	|	НеСписанныйСредний.ТочкаУчета,
	|	НеСписанныйСредний.Услуга,
	|	НеСписанныйСредний.НаправлениеИспользованияТУ,
	|	НеСписанныйСредний.ЗначениеТарифа,
	|	НеСписанныйСредний.ПриборУчета,
	|	НеСписанныйСредний.Шкала,
	|	НеСписанныйСредний.ТарифнаяЗона,
	|	НеСписанныйСредний.Абонент,
	|	НеСписанныйСредний.Сумма,
	|	НеСписанныйСредний.ОбъемУслуги,
	|	НеСписанныйСредний.ОбъемУслугиПотребленный,
	|	МИНИМУМ(энргПредоставленныеПоказания.ДатаРегистратора),
	|	НеСписанныйСредний.Поставщик,
	|	НеСписанныйСредний.ЗависимаяТочкаУчета,
	|	НеСписанныйСредний.ПриборЗависимой,
	|	НеСписанныйСредний.СпособНачисления,
	|	НеСписанныйСредний.СверхНорматива,
	|	НеСписанныйСредний.ПомещениеРодитель
	|ИЗ
	|	РегистрСведений.энргПредоставленныеПоказания КАК энргПредоставленныеПоказания
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ НеСписанныйСредний КАК НеСписанныйСредний
	|		ПО энргПредоставленныеПоказания.Организация = НеСписанныйСредний.Организация
	|			И энргПредоставленныеПоказания.Район = НеСписанныйСредний.Район
	|			И энргПредоставленныеПоказания.ЧастныйСектор = НеСписанныйСредний.ЧастныйСектор
	|			И энргПредоставленныеПоказания.Строение = НеСписанныйСредний.Строение
	|			И энргПредоставленныеПоказания.Помещение = НеСписанныйСредний.ПомещениеРодитель
	|			И энргПредоставленныеПоказания.ПриборУчета = НеСписанныйСредний.ПриборУчета
	|			И энргПредоставленныеПоказания.Шкала = НеСписанныйСредний.Шкала
	|			И энргПредоставленныеПоказания.ТарифнаяЗона = НеСписанныйСредний.ТарифнаяЗона
	|			И (энргПредоставленныеПоказания.Организация = &Организация)
	|			И (энргПредоставленныеПоказания.ПериодНачисления = &ПериодНачисления)
	|			И (энргПредоставленныеПоказания.Район = &Район)
	|			И (энргПредоставленныеПоказания.ЧастныйСектор = &ЧастныйСектор)
	|			И (энргПредоставленныеПоказания.Строение = &Строение)
	|			И (энргПредоставленныеПоказания.Помещение = &Помещение)
	|			И (энргПредоставленныеПоказания.ПоказанияТекущегоПериода)
	|
	|СГРУППИРОВАТЬ ПО
	|	НеСписанныйСредний.Организация,
	|	НеСписанныйСредний.Район,
	|	НеСписанныйСредний.ЧастныйСектор,
	|	НеСписанныйСредний.Строение,
	|	НеСписанныйСредний.Помещение,
	|	НеСписанныйСредний.ПериодНачисления,
	|	НеСписанныйСредний.ТочкаУчета,
	|	НеСписанныйСредний.Услуга,
	|	НеСписанныйСредний.НаправлениеИспользованияТУ,
	|	НеСписанныйСредний.ЗначениеТарифа,
	|	НеСписанныйСредний.ПриборУчета,
	|	НеСписанныйСредний.Шкала,
	|	НеСписанныйСредний.ТарифнаяЗона,
	|	НеСписанныйСредний.Абонент,
	|	НеСписанныйСредний.Сумма,
	|	НеСписанныйСредний.ОбъемУслуги,
	|	НеСписанныйСредний.ОбъемУслугиПотребленный,
	|	НеСписанныйСредний.Поставщик,
	|	НеСписанныйСредний.ЗависимаяТочкаУчета,
	|	НеСписанныйСредний.ПриборЗависимой,
	|	НеСписанныйСредний.СпособНачисления,
	|	НеСписанныйСредний.СверхНорматива,
	|	НеСписанныйСредний.ПомещениеРодитель
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеДляСписанияМинДата.Организация КАК Организация,
	|	ДанныеДляСписанияМинДата.Район КАК Район,
	|	ДанныеДляСписанияМинДата.ЧастныйСектор КАК ЧастныйСектор,
	|	ДанныеДляСписанияМинДата.Строение КАК Строение,
	|	ДанныеДляСписанияМинДата.Помещение КАК Помещение,
	|	ДанныеДляСписанияМинДата.ПериодНачисления КАК ПериодНачисления,
	|	ДанныеДляСписанияМинДата.ТочкаУчета КАК ТочкаУчета,
	|	ДанныеДляСписанияМинДата.Услуга КАК Услуга,
	|	ДанныеДляСписанияМинДата.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	ДанныеДляСписанияМинДата.ЗначениеТарифа КАК ЗначениеТарифа,
	|	ДанныеДляСписанияМинДата.ПриборУчета КАК ПриборУчета,
	|	ДанныеДляСписанияМинДата.Шкала КАК Шкала,
	|	ДанныеДляСписанияМинДата.ТарифнаяЗона КАК ТарифнаяЗона,
	|	ДанныеДляСписанияМинДата.Сумма КАК Сумма,
	|	ДанныеДляСписанияМинДата.ОбъемУслуги КАК ОбъемУслуги,
	|	ДанныеДляСписанияМинДата.ОбъемУслугиПотребленный КАК ОбъемУслугиПотребленный,
	|	ДанныеДляСписанияМинДата.ДатаРегистратора КАК ДатаРегистратора,
	|	МИНИМУМ(энргПредоставленныеПоказания.ДокРегистратор) КАК ДокРегистратор,
	|	ДанныеДляСписанияМинДата.Поставщик КАК Поставщик,
	|	ДанныеДляСписанияМинДата.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|	ДанныеДляСписанияМинДата.ПриборЗависимой КАК ПриборЗависимой,
	|	ДанныеДляСписанияМинДата.СпособНачисления КАК СпособНачисления,
	|	ДанныеДляСписанияМинДата.Абонент КАК Абонент,
	|	ДанныеДляСписанияМинДата.СверхНорматива КАК СверхНорматива,
	|	ДанныеДляСписанияМинДата.ПомещениеРодитель КАК ПомещениеРодитель
	|ПОМЕСТИТЬ ДанныеДляСписанияМинРегистратор
	|ИЗ
	|	ДанныеДляСписанияМинДата КАК ДанныеДляСписанияМинДата
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргПредоставленныеПоказания КАК энргПредоставленныеПоказания
	|		ПО ДанныеДляСписанияМинДата.Организация = энргПредоставленныеПоказания.Организация
	|			И ДанныеДляСписанияМинДата.Район = энргПредоставленныеПоказания.Район
	|			И ДанныеДляСписанияМинДата.ЧастныйСектор = энргПредоставленныеПоказания.ЧастныйСектор
	|			И ДанныеДляСписанияМинДата.Строение = энргПредоставленныеПоказания.Строение
	|			И ДанныеДляСписанияМинДата.Помещение = энргПредоставленныеПоказания.Помещение
	|			И ДанныеДляСписанияМинДата.ПриборУчета = энргПредоставленныеПоказания.ПриборУчета
	|			И ДанныеДляСписанияМинДата.Шкала = энргПредоставленныеПоказания.Шкала
	|			И ДанныеДляСписанияМинДата.ТарифнаяЗона = энргПредоставленныеПоказания.ТарифнаяЗона
	|			И ДанныеДляСписанияМинДата.ДатаРегистратора = энргПредоставленныеПоказания.ДатаРегистратора
	|			И (энргПредоставленныеПоказания.Организация = &Организация)
	|			И (энргПредоставленныеПоказания.ПериодНачисления = &ПериодНачисления)
	|			И (энргПредоставленныеПоказания.Район = &Район)
	|			И (энргПредоставленныеПоказания.ЧастныйСектор = &ЧастныйСектор)
	|			И (энргПредоставленныеПоказания.Строение = &Строение)
	|			И (энргПредоставленныеПоказания.Помещение = &Помещение)
	|			И (энргПредоставленныеПоказания.ПоказанияТекущегоПериода)
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеДляСписанияМинДата.Организация,
	|	ДанныеДляСписанияМинДата.Район,
	|	ДанныеДляСписанияМинДата.ЧастныйСектор,
	|	ДанныеДляСписанияМинДата.Строение,
	|	ДанныеДляСписанияМинДата.Помещение,
	|	ДанныеДляСписанияМинДата.ПериодНачисления,
	|	ДанныеДляСписанияМинДата.ТочкаУчета,
	|	ДанныеДляСписанияМинДата.Услуга,
	|	ДанныеДляСписанияМинДата.НаправлениеИспользованияТУ,
	|	ДанныеДляСписанияМинДата.ЗначениеТарифа,
	|	ДанныеДляСписанияМинДата.ПриборУчета,
	|	ДанныеДляСписанияМинДата.Шкала,
	|	ДанныеДляСписанияМинДата.ТарифнаяЗона,
	|	ДанныеДляСписанияМинДата.Сумма,
	|	ДанныеДляСписанияМинДата.ОбъемУслуги,
	|	ДанныеДляСписанияМинДата.ОбъемУслугиПотребленный,
	|	ДанныеДляСписанияМинДата.ДатаРегистратора,
	|	ДанныеДляСписанияМинДата.Поставщик,
	|	ДанныеДляСписанияМинДата.ЗависимаяТочкаУчета,
	|	ДанныеДляСписанияМинДата.ПриборЗависимой,
	|	ДанныеДляСписанияМинДата.СпособНачисления,
	|	ДанныеДляСписанияМинДата.Абонент,
	|	ДанныеДляСписанияМинДата.СверхНорматива,
	|	ДанныеДляСписанияМинДата.ПомещениеРодитель
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ДанныеДляСписанияМинДата.Организация,
	|	ДанныеДляСписанияМинДата.Район,
	|	ДанныеДляСписанияМинДата.ЧастныйСектор,
	|	ДанныеДляСписанияМинДата.Строение,
	|	ДанныеДляСписанияМинДата.Помещение,
	|	ДанныеДляСписанияМинДата.ПериодНачисления,
	|	ДанныеДляСписанияМинДата.ТочкаУчета,
	|	ДанныеДляСписанияМинДата.Услуга,
	|	ДанныеДляСписанияМинДата.НаправлениеИспользованияТУ,
	|	ДанныеДляСписанияМинДата.ЗначениеТарифа,
	|	ДанныеДляСписанияМинДата.ПриборУчета,
	|	ДанныеДляСписанияМинДата.Шкала,
	|	ДанныеДляСписанияМинДата.ТарифнаяЗона,
	|	ДанныеДляСписанияМинДата.Сумма,
	|	ДанныеДляСписанияМинДата.ОбъемУслуги,
	|	ДанныеДляСписанияМинДата.ОбъемУслугиПотребленный,
	|	ДанныеДляСписанияМинДата.ДатаРегистратора,
	|	МИНИМУМ(энргПредоставленныеПоказания.ДокРегистратор),
	|	ДанныеДляСписанияМинДата.Поставщик,
	|	ДанныеДляСписанияМинДата.ЗависимаяТочкаУчета,
	|	ДанныеДляСписанияМинДата.ПриборЗависимой,
	|	ДанныеДляСписанияМинДата.СпособНачисления,
	|	ДанныеДляСписанияМинДата.Абонент,
	|	ДанныеДляСписанияМинДата.СверхНорматива,
	|	ДанныеДляСписанияМинДата.ПомещениеРодитель
	|ИЗ
	|	ДанныеДляСписанияМинДата КАК ДанныеДляСписанияМинДата
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргПредоставленныеПоказания КАК энргПредоставленныеПоказания
	|		ПО ДанныеДляСписанияМинДата.Организация = энргПредоставленныеПоказания.Организация
	|			И ДанныеДляСписанияМинДата.Район = энргПредоставленныеПоказания.Район
	|			И ДанныеДляСписанияМинДата.ЧастныйСектор = энргПредоставленныеПоказания.ЧастныйСектор
	|			И ДанныеДляСписанияМинДата.Строение = энргПредоставленныеПоказания.Строение
	|			И ДанныеДляСписанияМинДата.ПомещениеРодитель = энргПредоставленныеПоказания.Помещение
	|			И ДанныеДляСписанияМинДата.ПриборУчета = энргПредоставленныеПоказания.ПриборУчета
	|			И ДанныеДляСписанияМинДата.Шкала = энргПредоставленныеПоказания.Шкала
	|			И ДанныеДляСписанияМинДата.ТарифнаяЗона = энргПредоставленныеПоказания.ТарифнаяЗона
	|			И ДанныеДляСписанияМинДата.ДатаРегистратора = энргПредоставленныеПоказания.ДатаРегистратора
	|			И (энргПредоставленныеПоказания.Организация = &Организация)
	|			И (энргПредоставленныеПоказания.ПериодНачисления = &ПериодНачисления)
	|			И (энргПредоставленныеПоказания.Район = &Район)
	|			И (энргПредоставленныеПоказания.ЧастныйСектор = &ЧастныйСектор)
	|			И (энргПредоставленныеПоказания.Строение = &Строение)
	|			И (энргПредоставленныеПоказания.Помещение = &Помещение)
	|			И (энргПредоставленныеПоказания.ПоказанияТекущегоПериода)
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеДляСписанияМинДата.Организация,
	|	ДанныеДляСписанияМинДата.Район,
	|	ДанныеДляСписанияМинДата.ЧастныйСектор,
	|	ДанныеДляСписанияМинДата.Строение,
	|	ДанныеДляСписанияМинДата.Помещение,
	|	ДанныеДляСписанияМинДата.ПериодНачисления,
	|	ДанныеДляСписанияМинДата.ТочкаУчета,
	|	ДанныеДляСписанияМинДата.Услуга,
	|	ДанныеДляСписанияМинДата.НаправлениеИспользованияТУ,
	|	ДанныеДляСписанияМинДата.ЗначениеТарифа,
	|	ДанныеДляСписанияМинДата.ПриборУчета,
	|	ДанныеДляСписанияМинДата.Шкала,
	|	ДанныеДляСписанияМинДата.ТарифнаяЗона,
	|	ДанныеДляСписанияМинДата.Сумма,
	|	ДанныеДляСписанияМинДата.ОбъемУслуги,
	|	ДанныеДляСписанияМинДата.ОбъемУслугиПотребленный,
	|	ДанныеДляСписанияМинДата.ДатаРегистратора,
	|	ДанныеДляСписанияМинДата.Поставщик,
	|	ДанныеДляСписанияМинДата.ЗависимаяТочкаУчета,
	|	ДанныеДляСписанияМинДата.ПриборЗависимой,
	|	ДанныеДляСписанияМинДата.СпособНачисления,
	|	ДанныеДляСписанияМинДата.Абонент,
	|	ДанныеДляСписанияМинДата.СверхНорматива,
	|	ДанныеДляСписанияМинДата.ПомещениеРодитель
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргОбъемНачислений.Организация КАК Организация,
	|	энргОбъемНачислений.Район КАК Район,
	|	энргОбъемНачислений.Строение КАК Строение,
	|	энргОбъемНачислений.Помещение КАК Помещение,
	|	энргОбъемНачислений.Абонент КАК Абонент,
	|	энргОбъемНачислений.Услуга КАК Услуга,
	|	энргОбъемНачислений.ТочкаУчета КАК ТочкаУчета,
	|	энргОбъемНачислений.Шкала КАК Шкала,
	|	энргОбъемНачислений.ТарифнаяЗона КАК ТарифнаяЗона,
	|	СУММА(энргОбъемНачислений.Сумма) КАК СуммаОборот,
	|	СУММА(энргОбъемНачислений.ОбъемУслуги) КАК ОбъемУслугиОборот,
	|	СУММА(энргОбъемНачислений.ОбъемУслугиПотребленный) КАК ОбъемУслугиПотребленныйОборот,
	|	МАКСИМУМ(энргОбъемНачислений.СниматьНачисленныйСреднийЗависимыхТочек) КАК СниматьНачисленныйСреднийЗависимыхТочек,
	|	МАКСИМУМ(энргОбъемНачислений.ЕстьСреднийПоВсемТочкамУслуги) КАК ЕстьСреднийПоВсемТочкамУслуги,
	|	энргОбъемНачислений.ЧастныйСектор КАК ЧастныйСектор,
	|	МАКСИМУМ(энргОбъемНачислений.ЗначениеТарифа) КАК ЗначениеТарифа
	|ПОМЕСТИТЬ НачисленныйОбъем
	|ИЗ
	|	ДокументыНачислений КАК ДокументыНачислений
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.энргОбъемНачислений КАК энргОбъемНачислений
	|		ПО (энргОбъемНачислений.Период = &КонецПериода)
	|			И ДокументыНачислений.ДокументНачисления = энргОбъемНачислений.Регистратор
	|
	|СГРУППИРОВАТЬ ПО
	|	энргОбъемНачислений.Организация,
	|	энргОбъемНачислений.Район,
	|	энргОбъемНачислений.Строение,
	|	энргОбъемНачислений.Помещение,
	|	энргОбъемНачислений.Абонент,
	|	энргОбъемНачислений.Услуга,
	|	энргОбъемНачислений.ТочкаУчета,
	|	энргОбъемНачислений.Шкала,
	|	энргОбъемНачислений.ТарифнаяЗона,
	|	энргОбъемНачислений.ЧастныйСектор
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.МКД КАК МКД,
	|	ВложенныйЗапрос.ЧастныйСектор КАК ЧастныйСектор,
	|	ВложенныйЗапрос.Строение КАК Строение,
	|	ВложенныйЗапрос.Помещение КАК Помещение,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.ТочкаУчета КАК ТочкаУчета,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	ВложенныйЗапрос.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	ВложенныйЗапрос.ЗначениеТарифа КАК ЗначениеТарифа,
	|	ВложенныйЗапрос.ПриборУчета КАК ПриборУчета,
	|	ВложенныйЗапрос.Шкала КАК Шкала,
	|	ВложенныйЗапрос.ТарифнаяЗона КАК ТарифнаяЗона,
	|	ВложенныйЗапрос.Сумма КАК Сумма,
	|	ВложенныйЗапрос.ОбъемУслуги КАК ОбъемУслуги,
	|	ВложенныйЗапрос.ОбъемУслугиПотребленный КАК ОбъемУслугиПотребленный,
	|	ВложенныйЗапрос.ДокументОснование КАК ДокументОснование,
	|	ВложенныйЗапрос.Поставщик КАК Поставщик,
	|	ВложенныйЗапрос.ДатаДокументаОснования КАК ДатаДокументаОснования,
	|	ВложенныйЗапрос.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|	ВложенныйЗапрос.ПриборЗависимой КАК ПриборЗависимой,
	|	ВложенныйЗапрос.СпособНачисления КАК СпособНачисления,
	|	ВложенныйЗапрос.Абонент КАК Абонент,
	|	ВложенныйЗапрос.СверхНорматива КАК СверхНорматива,
	|	ЕСТЬNULL(энргПерерасчет.Ссылка, ЗНАЧЕНИЕ(Документ.энргПерерасчет.Пустаяссылка)) КАК ДокументПерерасчета,
	|	ЕСТЬNULL(энргПерерасчет.ПометкаУдаления, ЛОЖЬ) КАК ДокументПерерасчетаПометкаУдаления
	|ИЗ
	|	(ВЫБРАТЬ
	|		ДанныеДляСписанияМинРегистратор.Организация КАК Организация,
	|		ДанныеДляСписанияМинРегистратор.Район КАК Район,
	|		ВЫБОР
	|			КОГДА ДанныеДляСписанияМинРегистратор.ЧастныйСектор
	|				ТОГДА ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка)
	|			ИНАЧЕ ДанныеДляСписанияМинРегистратор.Строение
	|		КОНЕЦ КАК МКД,
	|		ДанныеДляСписанияМинРегистратор.ЧастныйСектор КАК ЧастныйСектор,
	|		ДанныеДляСписанияМинРегистратор.Строение КАК Строение,
	|		ДанныеДляСписанияМинРегистратор.Помещение КАК Помещение,
	|		ДанныеДляСписанияМинРегистратор.ПериодНачисления КАК ПериодНачисления,
	|		ДанныеДляСписанияМинРегистратор.ТочкаУчета КАК ТочкаУчета,
	|		ДанныеДляСписанияМинРегистратор.Услуга КАК Услуга,
	|		ДанныеДляСписанияМинРегистратор.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|		ДанныеДляСписанияМинРегистратор.ЗначениеТарифа КАК ЗначениеТарифа,
	|		ДанныеДляСписанияМинРегистратор.ПриборУчета КАК ПриборУчета,
	|		ДанныеДляСписанияМинРегистратор.Шкала КАК Шкала,
	|		ДанныеДляСписанияМинРегистратор.ТарифнаяЗона КАК ТарифнаяЗона,
	|		ДанныеДляСписанияМинРегистратор.Сумма КАК Сумма,
	|		ДанныеДляСписанияМинРегистратор.ОбъемУслуги КАК ОбъемУслуги,
	|		ДанныеДляСписанияМинРегистратор.ОбъемУслугиПотребленный КАК ОбъемУслугиПотребленный,
	|		ДанныеДляСписанияМинРегистратор.ДокРегистратор КАК ДокументОснование,
	|		ДанныеДляСписанияМинРегистратор.Поставщик КАК Поставщик,
	|		ДанныеДляСписанияМинРегистратор.ДатаРегистратора КАК ДатаДокументаОснования,
	|		ДанныеДляСписанияМинРегистратор.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|		ДанныеДляСписанияМинРегистратор.ПриборЗависимой КАК ПриборЗависимой,
	|		ДанныеДляСписанияМинРегистратор.СпособНачисления КАК СпособНачисления,
	|		ДанныеДляСписанияМинРегистратор.Абонент КАК Абонент,
	|		ДанныеДляСписанияМинРегистратор.СверхНорматива КАК СверхНорматива
	|	ИЗ
	|		ДанныеДляСписанияМинРегистратор КАК ДанныеДляСписанияМинРегистратор
	|	ГДЕ
	|		(ДанныеДляСписанияМинРегистратор.Организация, ДанныеДляСписанияМинРегистратор.Район, ДанныеДляСписанияМинРегистратор.Строение, ДанныеДляСписанияМинРегистратор.Помещение, ДанныеДляСписанияМинРегистратор.ЧастныйСектор, ДанныеДляСписанияМинРегистратор.ТочкаУчета, ДанныеДляСписанияМинРегистратор.Услуга, ДанныеДляСписанияМинРегистратор.Шкала, ДанныеДляСписанияМинРегистратор.ТарифнаяЗона, ДанныеДляСписанияМинРегистратор.Абонент) В
	|				(ВЫБРАТЬ
	|					НачисленныйОбъем.Организация,
	|					НачисленныйОбъем.Район,
	|					НачисленныйОбъем.Строение,
	|					НачисленныйОбъем.Помещение,
	|					НачисленныйОбъем.ЧастныйСектор,
	|					НачисленныйОбъем.ТочкаУчета,
	|					НачисленныйОбъем.Услуга,
	|					НачисленныйОбъем.Шкала,
	|					НачисленныйОбъем.ТарифнаяЗона,
	|					НачисленныйОбъем.Абонент
	|				ИЗ
	|					НачисленныйОбъем КАК НачисленныйОбъем)
	|		И НЕ ДанныеДляСписанияМинРегистратор.СпособНачисления = ЗНАЧЕНИЕ(ПЕРЕЧИСЛЕНИЕ.энргСпособНачислений.ПоПриборам)
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		НеСписанныйСредний.Организация,
	|		НеСписанныйСредний.Район,
	|		ВЫБОР
	|			КОГДА НеСписанныйСредний.ЧастныйСектор
	|				ТОГДА ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка)
	|			ИНАЧЕ НеСписанныйСредний.Строение
	|		КОНЕЦ,
	|		НеСписанныйСредний.ЧастныйСектор,
	|		НеСписанныйСредний.Строение,
	|		НеСписанныйСредний.Помещение,
	|		НеСписанныйСредний.ПериодНачисления,
	|		НеСписанныйСредний.ТочкаУчета,
	|		НеСписанныйСредний.Услуга,
	|		НеСписанныйСредний.НаправлениеИспользованияТУ,
	|		НеСписанныйСредний.ЗначениеТарифа,
	|		НеСписанныйСредний.ПриборУчета,
	|		НеСписанныйСредний.Шкала,
	|		НеСписанныйСредний.ТарифнаяЗона,
	|		НеСписанныйСредний.Сумма,
	|		НеСписанныйСредний.ОбъемУслуги,
	|		НеСписанныйСредний.ОбъемУслугиПотребленный,
	|		НЕОПРЕДЕЛЕНО,
	|		НеСписанныйСредний.Поставщик,
	|		ДАТАВРЕМЯ(1, 1, 1),
	|		НеСписанныйСредний.ЗависимаяТочкаУчета,
	|		НеСписанныйСредний.ПриборЗависимой,
	|		НеСписанныйСредний.СпособНачисления,
	|		НеСписанныйСредний.Абонент,
	|		НеСписанныйСредний.СверхНорматива
	|	ИЗ
	|		НеСписанныйСредний КАК НеСписанныйСредний
	|	ГДЕ
	|		(НеСписанныйСредний.Организация, НеСписанныйСредний.Район, НеСписанныйСредний.ЧастныйСектор, НеСписанныйСредний.Строение, НеСписанныйСредний.Помещение, НеСписанныйСредний.ТочкаУчета, НеСписанныйСредний.Услуга) В
	|				(ВЫБРАТЬ
	|					НачисленныйОбъем.Организация,
	|					НачисленныйОбъем.Район,
	|					НачисленныйОбъем.ЧастныйСектор,
	|					НачисленныйОбъем.Строение,
	|					НачисленныйОбъем.Помещение,
	|					НачисленныйОбъем.ТочкаУчета,
	|					НачисленныйОбъем.Услуга
	|				ИЗ
	|					НачисленныйОбъем КАК НачисленныйОбъем
	|				ГДЕ
	|					НачисленныйОбъем.СниматьНачисленныйСреднийЗависимыхТочек)
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		НеСписанныйСредний.Организация,
	|		НеСписанныйСредний.Район,
	|		ВЫБОР
	|			КОГДА НеСписанныйСредний.ЧастныйСектор
	|				ТОГДА ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка)
	|			ИНАЧЕ НеСписанныйСредний.Строение
	|		КОНЕЦ,
	|		НеСписанныйСредний.ЧастныйСектор,
	|		НеСписанныйСредний.Строение,
	|		НеСписанныйСредний.Помещение,
	|		НеСписанныйСредний.ПериодНачисления,
	|		НеСписанныйСредний.ТочкаУчета,
	|		НеСписанныйСредний.Услуга,
	|		НеСписанныйСредний.НаправлениеИспользованияТУ,
	|		НеСписанныйСредний.ЗначениеТарифа,
	|		НеСписанныйСредний.ПриборУчета,
	|		НеСписанныйСредний.Шкала,
	|		НеСписанныйСредний.ТарифнаяЗона,
	|		НеСписанныйСредний.Сумма,
	|		НеСписанныйСредний.ОбъемУслуги,
	|		НеСписанныйСредний.ОбъемУслугиПотребленный,
	|		НЕОПРЕДЕЛЕНО,
	|		НеСписанныйСредний.Поставщик,
	|		ДАТАВРЕМЯ(1, 1, 1),
	|		НеСписанныйСредний.ЗависимаяТочкаУчета,
	|		НеСписанныйСредний.ПриборЗависимой,
	|		НеСписанныйСредний.СпособНачисления,
	|		НеСписанныйСредний.Абонент,
	|		НеСписанныйСредний.СверхНорматива
	|	ИЗ
	|		НеСписанныйСредний КАК НеСписанныйСредний
	|	ГДЕ
	|		(НеСписанныйСредний.Организация, НеСписанныйСредний.Район, НеСписанныйСредний.ЧастныйСектор, НеСписанныйСредний.Строение, НеСписанныйСредний.Помещение, НеСписанныйСредний.Услуга, НеСписанныйСредний.СпособНачисления) В
	|				(ВЫБРАТЬ
	|					НачисленныйОбъем.Организация,
	|					НачисленныйОбъем.Район,
	|					НачисленныйОбъем.ЧастныйСектор,
	|					НачисленныйОбъем.Строение,
	|					НачисленныйОбъем.Помещение,
	|					НачисленныйОбъем.Услуга,
	|					ЗНАЧЕНИЕ(ПЕРЕЧИСЛЕНИЕ.энргСпособНачислений.ПоПриборам)
	|				ИЗ
	|					НачисленныйОбъем КАК НачисленныйОбъем
	|				ГДЕ
	|					НачисленныйОбъем.ЕстьСреднийПоВсемТочкамУслуги)) КАК ВложенныйЗапрос
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.энргПерерасчет КАК энргПерерасчет
	|		ПО ВложенныйЗапрос.Район = энргПерерасчет.Район
	|			И (энргПерерасчет.КлючПомещения = ЗНАЧЕНИЕ(Справочник.энргКлючиПомещений.ПустаяСсылка))
	|			И (ВЫБОР
	|				КОГДА ВложенныйЗапрос.ЧастныйСектор
	|					ТОГДА энргПерерасчет.Строение = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка)
	|				ИНАЧЕ ВложенныйЗапрос.Строение = энргПерерасчет.Строение
	|			КОНЕЦ)
	|			И (энргПерерасчет.Организация = &Организация)
	|			И (НАЧАЛОПЕРИОДА(энргПерерасчет.Дата, МЕСЯЦ) = &ПериодНачисления)
	|			И (энргПерерасчет.ВидОперации = ЗНАЧЕНИЕ(Перечисление.энргВидыОпераций.энргПерерасчет_СвязанныйПерерасчет))
	|
	|УПОРЯДОЧИТЬ ПО
	|	ВложенныйЗапрос.Район,
	|	ВложенныйЗапрос.МКД,
	|	ВложенныйЗапрос.ЧастныйСектор,
	|	ВложенныйЗапрос.Строение,
	|	ВложенныйЗапрос.Помещение";  	
	
	Если НачисленныйСреднийОбъем <> Неопределено тогда
		
		Текст 						= Текст + ТекстРазделить + "УНИЧТОЖИТЬ ДанныеДляСписанияМинДата";
		Текст 						= Текст + ТекстРазделить + "УНИЧТОЖИТЬ ДанныеДляСписанияМинРегистратор";
		
		Текст 						= Текст + ТекстРазделить + "УНИЧТОЖИТЬ НеСписанныйСредний"; 						
		Текст 						= Текст + ТекстРазделить + "УНИЧТОЖИТЬ НеСписанныйСреднийБезГруппировки"; 		
	КонецЕсли;  
	
	Если Строение = Неопределено Тогда
		Текст 						= СтрЗаменить(Текст,"И (энргПредоставленныеПоказания.ЧастныйСектор = &ЧастныйСектор)","");
		Текст						= СтрЗаменить(Текст,"И (энргПредоставленныеПоказания.Строение = &Строение)","");
		Текст 						= СтрЗаменить(Текст,"И (энргПредоставленныеПоказания.Помещение = &Помещение)","");
		
		Текст 						= СтрЗаменить(Текст,"И ЧастныйСектор = &ЧастныйСектор","");
		Текст 						= СтрЗаменить(Текст,"И Строение = &Строение","");
		Текст 						= СтрЗаменить(Текст,"И Помещение = &Помещение","");

	ИначеЕсли НЕ ЗначениеЗаполнено(Строение) Тогда
		Текст 						= СтрЗаменить(Текст,"И (энргПредоставленныеПоказания.Строение = &Строение)","");
		Текст 						= СтрЗаменить(Текст,"И (энргПредоставленныеПоказания.Помещение = &Помещение)","");
		
		Текст 						= СтрЗаменить(Текст,"И Строение = &Строение","");
		Текст 						= СтрЗаменить(Текст,"И Помещение = &Помещение","");
	ИначеЕсли Помещение = Неопределено Тогда 
		Текст 						= СтрЗаменить(Текст,"И (энргПредоставленныеПоказания.Помещение = &Помещение)","");
		Текст 						= СтрЗаменить(Текст,"И Помещение = &Помещение","");
	КонецЕсли;
	 
	Запрос  						= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Запрос.УстановитьПараметр("ПериодНачисления",			ПериодНачисления);
	Запрос.УстановитьПараметр("Организация",				Организация);
	Запрос.УстановитьПараметр("Район",						Район);
	Запрос.УстановитьПараметр("НачисленныйСреднийОбъем", 	НачисленныйСреднийОбъем);
	Запрос.УстановитьПараметр("КонецПериода", 				КонецПериодаРасчета);	
	
	Если НЕ Строение = Неопределено И НЕ ЗначениеЗаполнено(Строение) Тогда
		Запрос.УстановитьПараметр("ЧастныйСектор",		Истина);
	ИначеЕсли НЕ Строение = Неопределено И Помещение = Неопределено Тогда 
		Запрос.УстановитьПараметр("ЧастныйСектор",		Ложь);
		Запрос.УстановитьПараметр("Строение",			Строение);
	Иначе
		Запрос.УстановитьПараметр("ЧастныйСектор",		Ложь);
		Запрос.УстановитьПараметр("Строение",			Строение);
		Запрос.УстановитьПараметр("Помещение",			Помещение);		
	КонецЕсли;
	
	Запрос.Текст 					= Текст;
	Результат  						= Запрос.Выполнить();  
	Возврат Результат;
КонецФункции

Функция РезультатОтменитьСнятьСредниеНачисления(ПериодНачисления,Организация,Район,Строение)
	
	Запрос  		= Новый Запрос;
	Запрос.УстановитьПараметр("ПериодНачисления",	ПериодНачисления);
	Запрос.УстановитьПараметр("Организация",		Организация);
	Запрос.УстановитьПараметр("Район",				Район);
	Запрос.УстановитьПараметр("Строение",			Строение);
	Запрос.Текст 	= 
	"ВЫБРАТЬ
	|	энргПерерасчет.Ссылка КАК Ссылка
	|ИЗ
	|	Документ.энргПерерасчет КАК энргПерерасчет
	|ГДЕ
	|	НЕ энргПерерасчет.ПометкаУдаления
	|	И энргПерерасчет.ВидОперации = ЗНАЧЕНИЕ(Перечисление.энргВидыОпераций.энргПерерасчет_СвязанныйПерерасчет)
	|	И энргПерерасчет.Район = &Район
	|	И энргПерерасчет.Организация = &Организация
	|	И НАЧАЛОПЕРИОДА(энргПерерасчет.Дата, МЕСЯЦ) = &ПериодНачисления
	|	И энргПерерасчет.Строение = &Строение";
	
	Если Строение = Неопределено Тогда
		Запрос.Текст = СтрЗаменить(Запрос.Текст,"И энргПерерасчет.Строение = &Строение","");
	КонецЕсли;
	
	Результат  = Запрос.Выполнить();
	Возврат Результат.Выбрать();
	
КонецФункции

#КонецОбласти

#Область СнятьСредниеНачисленияМКД_ВспомогательныеПроцедурыИФункции

Процедура ПрочитатьНеСписанныйСреднийМКД(МВТ,Организация,Район, МКД, НачалоПериодаРасчета,ТаблицаПриемник = Неопределено)
	Запрос  						= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Текст 	=
	"ВЫБРАТЬ
	|	энргНачисленныйСреднийОбъемОстатки.Район КАК Район,
	|	энргНачисленныйСреднийОбъемОстатки.МКД КАК МКД,
	|	энргНачисленныйСреднийОбъемОстатки.ПериодНачисления КАК ПериодНачисления,
	|	энргНачисленныйСреднийОбъемОстатки.ТочкаУчета КАК ТочкаУчета,
	|	энргНачисленныйСреднийОбъемОстатки.Услуга КАК Услуга,
	|	энргНачисленныйСреднийОбъемОстатки.ПриборУчета КАК ПриборУчета,
	|	энргНачисленныйСреднийОбъемОстатки.Шкала КАК Шкала,
	|	энргНачисленныйСреднийОбъемОстатки.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргНачисленныйСреднийОбъемОстатки.Поставщик КАК Поставщик,
	|	энргНачисленныйСреднийОбъемОстатки.ОбъемУслугиОстаток КАК ОбъемУслуги,
	|	энргНачисленныйСреднийОбъемОстатки.СпособНачисления КАК СпособНачисления
	|ПОМЕСТИТЬ НеСписанныйСредний
	|ИЗ
	|	РегистрНакопления.энргНачисленныйСреднийОбъемМКД.Остатки(
	|			&НачалоПериодаРасчетаГраница,
	|			Организация = &Организация
	|				И Район = &Район
	|				И МКД = &МКД) КАК энргНачисленныйСреднийОбъемОстатки";
	
	Если ЗначениеЗаполнено(МКД) тогда
		Запрос.УстановитьПараметр("МКД",				МКД);
	иначе 		
		Текст 		= СтрЗаменить(Текст,"И МКД = &МКД","");	
	КонецЕсли;  
	
	Запрос.УстановитьПараметр("НачалоПериодаРасчетаГраница",Новый Граница(НачалоПериодаРасчета,ВидГраницы.Исключая));
	Запрос.УстановитьПараметр("Район",							Район);
	Запрос.УстановитьПараметр("Организация",					Организация);
	Запрос.Текст 			= Текст;
	
	Если ТаблицаПриемник = Неопределено тогда
		Запрос.Выполнить();
	иначе
		Запрос.Текст 		= СтрЗаменить(Запрос.Текст,"ПОМЕСТИТЬ НеСписанныйСредний","");
		Результат  			= Запрос.Выполнить();
		Выборка 			= Результат.Выбрать();
		Пока Выборка.Следующий() цикл
			ЗаполнитьЗначенияСвойств(ТаблицаПриемник.добавить(),Выборка);
		КонецЦикла;  		 
	КонецЕсли;
КонецПроцедуры

Функция РезультатЗапросаПерерасчетСреднегоМКД(МВТ,Организация,ПериодНачисления,Район,МКД,НачисленныйСреднийОбъем=Неопределено)
	
	ТекстРазделить 						= " 
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|";  
	
	Текст 	= "";
	Если НачисленныйСреднийОбъем <> Неопределено тогда
		Текст 	=
		"ВЫБРАТЬ
		|	НеСписанныйСредний.Район,
		|	НеСписанныйСредний.МКД,
		|	НеСписанныйСредний.ПериодНачисления,
		|	НеСписанныйСредний.ТочкаУчета,
		|	НеСписанныйСредний.Услуга,
		|	НеСписанныйСредний.ПриборУчета,
		|	НеСписанныйСредний.ОбъемУслуги,
		|	НеСписанныйСредний.Поставщик
		|ПОМЕСТИТЬ НеСписанныйСреднийБезГруппировки
		|ИЗ
		|	&НачисленныйСреднийОбъем КАК НеСписанныйСредний
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НеСписанныйСреднийБезГруппировки.Район,
		|	НеСписанныйСреднийБезГруппировки.МКД,
		|	НеСписанныйСреднийБезГруппировки.ПериодНачисления,
		|	НеСписанныйСреднийБезГруппировки.ТочкаУчета,
		|	НеСписанныйСреднийБезГруппировки.Услуга,
		|	НеСписанныйСреднийБезГруппировки.ПриборУчета,
		|	СУММА(НеСписанныйСреднийБезГруппировки.ОбъемУслуги) КАК ОбъемУслуги,
		|	НеСписанныйСреднийБезГруппировки.Поставщик
		|ПОМЕСТИТЬ НеСписанныйСредний
		|ИЗ
		|	НеСписанныйСреднийБезГруппировки КАК НеСписанныйСреднийБезГруппировки
		|
		|СГРУППИРОВАТЬ ПО
		|	НеСписанныйСреднийБезГруппировки.Район,
		|	НеСписанныйСреднийБезГруппировки.МКД,
		|	НеСписанныйСреднийБезГруппировки.ПериодНачисления,
		|	НеСписанныйСреднийБезГруппировки.ТочкаУчета,
		|	НеСписанныйСреднийБезГруппировки.Услуга,
		|	НеСписанныйСреднийБезГруппировки.ПриборУчета,
		|	НеСписанныйСреднийБезГруппировки.Поставщик";
		
		Текст = Текст + ТекстРазделить;
	КонецЕсли;  
	
	Текст 	=Текст + 
	"ВЫБРАТЬ
	|	НеСписанныйСредний.Район КАК Район,
	|	НеСписанныйСредний.МКД КАК МКД,
	|	НеСписанныйСредний.ПериодНачисления КАК ПериодНачисления,
	|	НеСписанныйСредний.ТочкаУчета КАК ТочкаУчета,
	|	НеСписанныйСредний.Услуга КАК Услуга,
	|	НеСписанныйСредний.ПриборУчета КАК ПриборУчета,
	|	НеСписанныйСредний.Шкала КАК Шкала,
	|	НеСписанныйСредний.ТарифнаяЗона КАК ТарифнаяЗона,
	|	НеСписанныйСредний.ОбъемУслуги КАК ОбъемУслуги,
	|	МИНИМУМ(энргПредоставленныеПоказания.ДатаРегистратора) КАК ДатаРегистратора,
	|	НеСписанныйСредний.Поставщик КАК Поставщик,
	|	НеСписанныйСредний.СпособНачисления КАК СпособНачисления
	|ПОМЕСТИТЬ ДанныеДляСписанияМинДата
	|ИЗ
	|	РегистрСведений.энргПредоставленныеПоказанияМКД КАК энргПредоставленныеПоказания
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ НеСписанныйСредний КАК НеСписанныйСредний
	|		ПО энргПредоставленныеПоказания.Район = НеСписанныйСредний.Район
	|			И энргПредоставленныеПоказания.МКД = НеСписанныйСредний.МКД
	|			И энргПредоставленныеПоказания.ПриборУчета = НеСписанныйСредний.ПриборУчета
	|			И энргПредоставленныеПоказания.Шкала = НеСписанныйСредний.Шкала
	|			И энргПредоставленныеПоказания.ТарифнаяЗона = НеСписанныйСредний.ТарифнаяЗона
	|			И (энргПредоставленныеПоказания.ПериодНачисления = &ПериодНачисления)
	|			И (энргПредоставленныеПоказания.Организация = &Организация)
	|			И (энргПредоставленныеПоказания.Район = &Район)
	|			И (энргПредоставленныеПоказания.МКД = &МКД)
	|			И (энргПредоставленныеПоказания.ПоказанияТекущегоПериода)
	|
	|СГРУППИРОВАТЬ ПО
	|	НеСписанныйСредний.Район,
	|	НеСписанныйСредний.МКД,
	|	НеСписанныйСредний.ПериодНачисления,
	|	НеСписанныйСредний.ТочкаУчета,
	|	НеСписанныйСредний.Услуга,
	|	НеСписанныйСредний.ПриборУчета,
	|	НеСписанныйСредний.Шкала,
	|	НеСписанныйСредний.ТарифнаяЗона,
	|	НеСписанныйСредний.ОбъемУслуги,
	|	НеСписанныйСредний.Поставщик,
	|	НеСписанныйСредний.СпособНачисления
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеДляСписанияМинДата.Район КАК Район,
	|	ДанныеДляСписанияМинДата.МКД КАК МКД,
	|	ДанныеДляСписанияМинДата.ПериодНачисления КАК ПериодНачисления,
	|	ДанныеДляСписанияМинДата.ТочкаУчета КАК ТочкаУчета,
	|	ДанныеДляСписанияМинДата.Услуга КАК Услуга,
	|	ДанныеДляСписанияМинДата.ПриборУчета КАК ПриборУчета,
	|	ДанныеДляСписанияМинДата.Шкала КАК Шкала,
	|	ДанныеДляСписанияМинДата.ТарифнаяЗона КАК ТарифнаяЗона,
	|	ДанныеДляСписанияМинДата.ОбъемУслуги КАК ОбъемУслуги,
	|	ДанныеДляСписанияМинДата.ДатаРегистратора КАК ДатаРегистратора,
	|	МИНИМУМ(энргПредоставленныеПоказания.ДокРегистратор) КАК ДокРегистратор,
	|	ДанныеДляСписанияМинДата.Поставщик КАК Поставщик,
	|	ДанныеДляСписанияМинДата.СпособНачисления КАК СпособНачисления
	|ПОМЕСТИТЬ ДанныеДляСписанияМинРегистратор
	|ИЗ
	|	ДанныеДляСписанияМинДата КАК ДанныеДляСписанияМинДата
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргПредоставленныеПоказанияМКД КАК энргПредоставленныеПоказания
	|		ПО ДанныеДляСписанияМинДата.Район = энргПредоставленныеПоказания.Район
	|			И ДанныеДляСписанияМинДата.МКД = энргПредоставленныеПоказания.МКД
	|			И ДанныеДляСписанияМинДата.ПриборУчета = энргПредоставленныеПоказания.ПриборУчета
	|			И ДанныеДляСписанияМинДата.Шкала = энргПредоставленныеПоказания.Шкала
	|			И ДанныеДляСписанияМинДата.ТарифнаяЗона = энргПредоставленныеПоказания.ТарифнаяЗона
	|			И ДанныеДляСписанияМинДата.ДатаРегистратора = энргПредоставленныеПоказания.ДатаРегистратора
	|			И (энргПредоставленныеПоказания.Организация = &Организация)
	|			И (энргПредоставленныеПоказания.ПериодНачисления = &ПериодНачисления)
	|			И (энргПредоставленныеПоказания.Район = &Район)
	|			И (энргПредоставленныеПоказания.МКД = &МКД)
	|			И (энргПредоставленныеПоказания.ПоказанияТекущегоПериода)
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеДляСписанияМинДата.Район,
	|	ДанныеДляСписанияМинДата.МКД,
	|	ДанныеДляСписанияМинДата.ПериодНачисления,
	|	ДанныеДляСписанияМинДата.ТочкаУчета,
	|	ДанныеДляСписанияМинДата.Услуга,
	|	ДанныеДляСписанияМинДата.ПриборУчета,
	|	ДанныеДляСписанияМинДата.Шкала,
	|	ДанныеДляСписанияМинДата.ТарифнаяЗона,
	|	ДанныеДляСписанияМинДата.ОбъемУслуги,
	|	ДанныеДляСписанияМинДата.ДатаРегистратора,
	|	ДанныеДляСписанияМинДата.Поставщик,
	|	ДанныеДляСписанияМинДата.СпособНачисления 
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеДляСписанияМинРегистратор.Район КАК Район,
	|	ДанныеДляСписанияМинРегистратор.МКД КАК МКД,
	|	ДанныеДляСписанияМинРегистратор.ПериодНачисления КАК ПериодНачисления,
	|	ДанныеДляСписанияМинРегистратор.ТочкаУчета КАК ТочкаУчета,
	|	ДанныеДляСписанияМинРегистратор.Услуга КАК Услуга,
	|	ДанныеДляСписанияМинРегистратор.ПриборУчета КАК ПриборУчета,
	|	ДанныеДляСписанияМинРегистратор.Шкала КАК Шкала,
	|	ДанныеДляСписанияМинРегистратор.ТарифнаяЗона КАК ТарифнаяЗона,
	|	ДанныеДляСписанияМинРегистратор.ОбъемУслуги КАК ОбъемУслуги,
	|	ДанныеДляСписанияМинРегистратор.ДокРегистратор КАК ДокументОснование,
	|	МАКСИМУМ(ЕСТЬNULL(энргПерерасчет.Ссылка, ЗНАЧЕНИЕ(Документ.энргПерерасчетМКД.Пустаяссылка))) КАК ДокументПерерасчета,
	|	ДанныеДляСписанияМинРегистратор.Поставщик КАК Поставщик,
	|	ДанныеДляСписанияМинРегистратор.СпособНачисления КАК СпособНачисления,
	|	ДанныеДляСписанияМинРегистратор.ДатаРегистратора КАК ДатаДокументаОснования
	|ИЗ
	|	ДанныеДляСписанияМинРегистратор КАК ДанныеДляСписанияМинРегистратор
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.энргПерерасчетМКД КАК энргПерерасчет
	|		ПО ДанныеДляСписанияМинРегистратор.Район = энргПерерасчет.Район
	|			И (НАЧАЛОПЕРИОДА(энргПерерасчет.Дата, МЕСЯЦ) = &ПериодНачисления)
	|			И (энргПерерасчет.Организация = &Организация)
	|			И (энргПерерасчет.ВидОперации = ЗНАЧЕНИЕ(Перечисление.энргВидыОпераций.энргПерерасчетМКД_СвязанныйПерерасчет))
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеДляСписанияМинРегистратор.Район,
	|	ДанныеДляСписанияМинРегистратор.МКД,
	|	ДанныеДляСписанияМинРегистратор.ПериодНачисления,
	|	ДанныеДляСписанияМинРегистратор.ТочкаУчета,
	|	ДанныеДляСписанияМинРегистратор.Услуга,
	|	ДанныеДляСписанияМинРегистратор.ПриборУчета,
	|	ДанныеДляСписанияМинРегистратор.Шкала,
	|	ДанныеДляСписанияМинРегистратор.ТарифнаяЗона,
	|	ДанныеДляСписанияМинРегистратор.ОбъемУслуги,
	|	ДанныеДляСписанияМинРегистратор.ДокРегистратор,
	|	ДанныеДляСписанияМинРегистратор.Поставщик,
	|	ДанныеДляСписанияМинРегистратор.СпособНачисления,
	|	ДанныеДляСписанияМинРегистратор.ДатаРегистратора
	|
	|УПОРЯДОЧИТЬ ПО
	|	Район,
	|	МКД"; 	
	
	Если НачисленныйСреднийОбъем <> Неопределено тогда
		
		Текст 						= Текст + ТекстРазделить + "УНИЧТОЖИТЬ ДанныеДляСписанияМинДата";
		Текст 						= Текст + ТекстРазделить + "УНИЧТОЖИТЬ ДанныеДляСписанияМинРегистратор";
		
		Текст 						= Текст + ТекстРазделить + "УНИЧТОЖИТЬ НеСписанныйСредний"; 						
		Текст 						= Текст + ТекстРазделить + "УНИЧТОЖИТЬ НеСписанныйСреднийБезГруппировки"; 		
	КонецЕсли;  
	
	Запрос  						= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Запрос.УстановитьПараметр("Организация",				Организация);
	Запрос.УстановитьПараметр("ПериодНачисления",			ПериодНачисления);
	Запрос.УстановитьПараметр("Район",						Район);
	Запрос.УстановитьПараметр("НачисленныйСреднийОбъем", 	НачисленныйСреднийОбъем);
	Если ЗначениеЗаполнено(МКД) тогда
		Запрос.УстановитьПараметр("МКД",					МКД);		
	иначе 		
		Текст 						= СтрЗаменить(Текст,"И МКД = &МКД","");
		Текст 						= СтрЗаменить(Текст,"И (энргПредоставленныеПоказания.МКД = &МКД)","");
	КонецЕсли;
	
	Запрос.Текст 					= Текст;
	Результат  						= Запрос.Выполнить();  
	Возврат Результат;
КонецФункции

#КонецОбласти

#Область ДанныеПерерасчета_ВспомогательныеФункции

Функция ПерерасчетСреднегоПослеПерерасчета(ОбъемПерерасчета,Организация,Район,МКД,Абонент,НачалоПериодаРасчета,КонецПериодаРасчета)
	
	Запрос  					= Новый Запрос;
	Запрос.УстановитьПараметр("ОбъемПерерасчета",			ОбъемПерерасчета);
	Запрос.УстановитьПараметр("Организация",				Организация);
	Запрос.УстановитьПараметр("Район",						Район);
	Запрос.УстановитьПараметр("МКД",						МКД);
	Запрос.УстановитьПараметр("Абонент",					Абонент);
	Запрос.УстановитьПараметр("НачалоПериодаРасчета",		НачалоПериодаРасчета);
	Запрос.УстановитьПараметр("КонецПериодаРасчетаГраница",	Новый Граница(КонецПериодаРасчета,ВидГраницы.Исключая));
	Запрос.Текст 				= "ВЫБРАТЬ
	|	ОбъемПерерасчета.Организация,
	|	ОбъемПерерасчета.ПериодНачисления,
	|	ОбъемПерерасчета.ТочкаУчета,
	|	ОбъемПерерасчета.Услуга,
	|	ОбъемПерерасчета.ЗначениеТарифа,
	|	ОбъемПерерасчета.ПриборУчета,
	|	ОбъемПерерасчета.Поставщик,
	|	ОбъемПерерасчета.ЗависимаяТочкаУчета,
	|	ОбъемПерерасчета.ПриборЗависимой,
	|	ОбъемПерерасчета.Сумма,
	|	ОбъемПерерасчета.ОбъемУслуги
	|ПОМЕСТИТЬ ОбъемПеререасчета
	|ИЗ
	|	&ОбъемПерерасчета КАК ОбъемПерерасчета
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргНачисленныйСреднийОбъемОбороты.Организация,
	|	энргНачисленныйСреднийОбъемОбороты.ПериодНачисления,
	|	энргНачисленныйСреднийОбъемОбороты.ТочкаУчета,
	|	энргНачисленныйСреднийОбъемОбороты.Услуга,
	|	энргНачисленныйСреднийОбъемОбороты.ЗначениеТарифа,
	|	энргНачисленныйСреднийОбъемОбороты.ПриборУчета,
	|	энргНачисленныйСреднийОбъемОбороты.Поставщик,
	|	энргНачисленныйСреднийОбъемОбороты.ЗависимаяТочкаУчета,
	|	энргНачисленныйСреднийОбъемОбороты.ПриборЗависимой,
	|	энргНачисленныйСреднийОбъемОбороты.СуммаОборот КАК Сумма,
	|	энргНачисленныйСреднийОбъемОбороты.ОбъемУслугиОборот КАК ОбъемУслуги
	|ПОМЕСТИТЬ НачислениеСреднего
	|ИЗ
	|	РегистрНакопления.энргНачисленныйСреднийОбъем.Обороты(
	|			&НачалоПериодаРасчета,
	|			&КонецПериодаРасчетаГраница,
	|			,
	|			Организация =&Организация И Район = &Район
	|				И МКД = &МКД
	|				И Абонент = &Абонент) КАК энргНачисленныйСреднийОбъемОбороты
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЕСТЬNULL(ОбъемПеререасчета.Организация, НачислениеСреднего.Организация) КАК Организация,
	|	ЕСТЬNULL(ОбъемПеререасчета.ПериодНачисления, НачислениеСреднего.ПериодНачисления) КАК ПериодНачисления,
	|	ЕСТЬNULL(ОбъемПеререасчета.ТочкаУчета, НачислениеСреднего.ТочкаУчета) КАК ТочкаУчета,
	|	ЕСТЬNULL(ОбъемПеререасчета.Услуга, НачислениеСреднего.Услуга) КАК Услуга,
	|	ЕСТЬNULL(ОбъемПеререасчета.ЗначениеТарифа, НачислениеСреднего.ЗначениеТарифа) КАК ЗначениеТарифа,
	|	ЕСТЬNULL(ОбъемПеререасчета.ПриборУчета, НачислениеСреднего.ПриборУчета) КАК ПриборУчета,
	|	ЕСТЬNULL(ОбъемПеререасчета.Поставщик, НачислениеСреднего.Поставщик) КАК Поставщик,
	|	ЕСТЬNULL(ОбъемПеререасчета.ЗависимаяТочкаУчета, НачислениеСреднего.ЗависимаяТочкаУчета) КАК ЗависимаяТочкаУчета,
	|	ЕСТЬNULL(ОбъемПеререасчета.ПриборЗависимой, НачислениеСреднего.ПриборЗависимой) КАК ПриборЗависимой,
	|	ЕСТЬNULL(НачислениеСреднего.Сумма, 0) КАК СуммаДо,
	|	ЕСТЬNULL(НачислениеСреднего.ОбъемУслуги, 0) КАК ОбъемУслугиДо,
	|	ЕСТЬNULL(ОбъемПеререасчета.Сумма, 0) КАК СуммаПосле,
	|	ЕСТЬNULL(ОбъемПеререасчета.ОбъемУслуги, 0) КАК ОбъемУслугиПосле
	|ИЗ
	|	ОбъемПеререасчета КАК ОбъемПеререасчета
	|		ПОЛНОЕ СОЕДИНЕНИЕ НачислениеСреднего КАК НачислениеСреднего
	|		ПО ОбъемПеререасчета.ПериодНачисления = НачислениеСреднего.ПериодНачисления
	|			И ОбъемПеререасчета.ТочкаУчета = НачислениеСреднего.ТочкаУчета
	|			И ОбъемПеререасчета.Услуга = НачислениеСреднего.Услуга
	|			И ОбъемПеререасчета.ЗначениеТарифа = НачислениеСреднего.ЗначениеТарифа
	|			И ОбъемПеререасчета.ПриборУчета = НачислениеСреднего.ПриборУчета
	|			И ОбъемПеререасчета.Поставщик = НачислениеСреднего.Поставщик
	|			И ОбъемПеререасчета.ЗависимаяТочкаУчета = НачислениеСреднего.ЗависимаяТочкаУчета
	|			И ОбъемПеререасчета.ПриборЗависимой = НачислениеСреднего.ПриборЗависимой"; 	
	
	Возврат Запрос.Выполнить();
	
КонецФункции

Функция ОбъемыНачисленийПослеПерерасчета(МВТ) 
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Текст = 
	"ВЫБРАТЬ
	|	ДанныеНачислений.Организация КАК Организация,
	|	ДанныеНачислений.ПериодНачисления КАК ПериодНачисления,
	|	ДанныеНачислений.Услуга КАК Услуга,
	|	ДанныеНачислений.Поставщик КАК Поставщик,
	|	ДанныеНачислений.ТочкаУчета КАК ТочкаУчета,
	|	ДанныеНачислений.ПриборУчета КАК ПриборУчета,
	|	СУММА(ДанныеНачислений.ОбъемУслуги) КАК ОбъемУслуги,
	|	ДанныеНачислений.СпособНачисления КАК СпособНачисления,
	|	ДанныеНачислений.ЗначениеТарифа КАК ЗначениеТарифа,
	|	СУММА(ДанныеНачислений.Сумма) КАК Сумма
	|ПОМЕСТИТЬ СвернутыеДанные
	|ИЗ
	|	ДанныеНачислений КАК ДанныеНачислений
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеНачислений.Организация,
	|	ДанныеНачислений.ПериодНачисления,
	|	ДанныеНачислений.Услуга,
	|	ДанныеНачислений.Поставщик,
	|	ДанныеНачислений.ТочкаУчета,
	|	ДанныеНачислений.ПриборУчета,
	|	ДанныеНачислений.СпособНачисления,
	|	ДанныеНачислений.ЗначениеТарифа
	|
	|ИМЕЮЩИЕ
	|	(СУММА(ДанныеНачислений.ОбъемУслуги) <> 0
	|		ИЛИ СУММА(ДанныеНачислений.Сумма) <> 0)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЕСТЬNULL(ОбъемДляКорректировки.Организация, СвернутыеДанные.Организация) КАК Организация,
	|	ЕСТЬNULL(ОбъемДляКорректировки.ПериодНачисления, СвернутыеДанные.ПериодНачисления) КАК ПериодНачисления,
	|	ЕСТЬNULL(ОбъемДляКорректировки.Услуга, СвернутыеДанные.Услуга) КАК Услуга,
	|	ЕСТЬNULL(ОбъемДляКорректировки.Поставщик, СвернутыеДанные.Поставщик) КАК Поставщик,
	|	ЕСТЬNULL(ОбъемДляКорректировки.ТочкаУчета, СвернутыеДанные.ТочкаУчета) КАК ТочкаУчета,
	|	ЕСТЬNULL(ОбъемДляКорректировки.ПриборУчета, СвернутыеДанные.ПриборУчета) КАК ПриборУчета,
	|	ЕСТЬNULL(ОбъемДляКорректировки.СпособНачисления, СвернутыеДанные.СпособНачисления) КАК СпособНачисления,
	|	ЕСТЬNULL(ОбъемДляКорректировки.ЗначениеТарифа, СвернутыеДанные.ЗначениеТарифа) КАК ЗначениеТарифа,
	|	ЕСТЬNULL(ОбъемДляКорректировки.Сумма, 0) КАК СуммаДо,
	|	ЕСТЬNULL(ОбъемДляКорректировки.ОбъемУслуги, 0) КАК ОбъемУслугиДо,
	|	ЕСТЬNULL(СвернутыеДанные.Сумма, 0) КАК СуммаПосле,
	|	ЕСТЬNULL(СвернутыеДанные.ОбъемУслуги, 0) КАК ОбъемУслугиПосле
	|ИЗ
	|	ОбъемДляКорректировки КАК ОбъемДляКорректировки
	|		ПОЛНОЕ СОЕДИНЕНИЕ СвернутыеДанные КАК СвернутыеДанные
	|		ПО ОбъемДляКорректировки.Организация = СвернутыеДанные.Организация
	|			И ОбъемДляКорректировки.ПериодНачисления = СвернутыеДанные.ПериодНачисления
	|			И ОбъемДляКорректировки.Услуга = СвернутыеДанные.Услуга
	|			И ОбъемДляКорректировки.ТочкаУчета = СвернутыеДанные.ТочкаУчета
	|			И ОбъемДляКорректировки.ПриборУчета = СвернутыеДанные.ПриборУчета
	|			И ОбъемДляКорректировки.СпособНачисления = СвернутыеДанные.СпособНачисления
	|			И ОбъемДляКорректировки.ЗначениеТарифа = СвернутыеДанные.ЗначениеТарифа
	|			И ОбъемДляКорректировки.Поставщик = СвернутыеДанные.Поставщик
	|
	|УПОРЯДОЧИТЬ ПО
	|	ПериодНачисления";
	Запрос.Текст 						= Текст;
	
	Возврат Запрос.Выполнить();   
КонецФункции       

// Вирутально проводит документ начисления. 
// Данные записываем в таблицу значений.
Функция ПрочитатьНачисленныйСреднийОбъем(МВТ,Организация,ПериодНачисления,НачислениеПоФормулам,НачисленияПоСреднемуФормулы)
	
	Запрос  						= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Запрос.УстановитьПараметр("ПериодНачисления",			ПериодНачисления);
	Запрос.УстановитьПараметр("Организация",				Организация);
	Запрос.УстановитьПараметр("НачислениеПоФормулам",		НачислениеПоФормулам);
	Запрос.УстановитьПараметр("НачисленияПоСреднемуФормулы",НачисленияПоСреднемуФормулы);
	Текст 							=
	"ВЫБРАТЬ
	|	&Организация КАК Организация,
	|	НачисленияПоСреднемуФормулы.ПериодНачисления КАК ПериодНачисления,
	|	НачисленияПоСреднемуФормулы.Абонент КАК Абонент,
	|	НачисленияПоСреднемуФормулы.ЗначениеТарифа КАК ЗначениеТарифа,
	|	НачисленияПоСреднемуФормулы.Поставщик КАК Поставщик,
	|	НачисленияПоСреднемуФормулы.ПриборУчета КАК ПриборУчета,
	|	НачисленияПоСреднемуФормулы.ТочкаУчета КАК ТочкаУчета,
	|	НачисленияПоСреднемуФормулы.Услуга КАК Услуга,
	|	НачисленияПоСреднемуФормулы.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|	НачисленияПоСреднемуФормулы.ПриборЗависимой КАК ПриборЗависимой,
	|	НачисленияПоСреднемуФормулы.ОбъемУслуги КАК ОбъемУслуги,
	|	НачисленияПоСреднемуФормулы.Сумма КАК Сумма
	|ПОМЕСТИТЬ НачисленияПоСреднемуФормулы
	|ИЗ
	|	&НачисленияПоСреднемуФормулы КАК НачисленияПоСреднемуФормулы
	|ГДЕ
	|	НачисленияПоСреднемуФормулы.ПериодНачисления = &ПериодНачисления
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&Организация КАК Организация,
	|	НачислениеПоФормулам.ПериодНачисления КАК ПериодНачисления,
	|	НачислениеПоФормулам.Абонент КАК Абонент,
	|	НачислениеПоФормулам.ТочкаУчета КАК ТочкаУчета,
	|	НачислениеПоФормулам.Услуга КАК Услуга,
	|	НачислениеПоФормулам.ЗначениеТарифа КАК ЗначениеТарифа,
	|	НачислениеПоФормулам.ПриборУчета КАК ПриборУчета,
	|	НачислениеПоФормулам.Поставщик КАК Поставщик,
	|	-НачислениеПоФормулам.Сумма КАК Сумма,
	|	-НачислениеПоФормулам.ОбъемУслуги КАК ОбъемУслуги
	|ПОМЕСТИТЬ НачислениеПоФормулам
	|ИЗ
	|	&НачислениеПоФормулам КАК НачислениеПоФормулам
	|ГДЕ
	|	НачислениеПоФормулам.ПериодНачисления = &ПериодНачисления
	|	И НачислениеПоФормулам.СписатьИзНормы
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Абонент КАК Абонент,
	|	ВложенныйЗапрос.ЗначениеТарифа КАК ЗначениеТарифа,
	|	ВложенныйЗапрос.Поставщик КАК Поставщик,
	|	ВложенныйЗапрос.ПриборУчета КАК ПриборУчета,
	|	ВложенныйЗапрос.ТочкаУчета КАК ТочкаУчета,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	ВложенныйЗапрос.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|	ВложенныйЗапрос.ПриборЗависимой КАК ПриборЗависимой,
	|	СУММА(ВложенныйЗапрос.ОбъемУслуги) КАК ОбъемУслуги,
	|	СУММА(ВложенныйЗапрос.Сумма) КАК Сумма
	|ИЗ
	|	(ВЫБРАТЬ
	|		НачисленияПоСреднемуФормулы.Организация КАК Организация,
	|		НачисленияПоСреднемуФормулы.ПериодНачисления КАК ПериодНачисления,
	|		НачисленияПоСреднемуФормулы.Абонент КАК Абонент,
	|		НачисленияПоСреднемуФормулы.ЗначениеТарифа КАК ЗначениеТарифа,
	|		НачисленияПоСреднемуФормулы.Поставщик КАК Поставщик,
	|		НачисленияПоСреднемуФормулы.ПриборУчета КАК ПриборУчета,
	|		НачисленияПоСреднемуФормулы.ТочкаУчета КАК ТочкаУчета,
	|		НачисленияПоСреднемуФормулы.Услуга КАК Услуга,
	|		НачисленияПоСреднемуФормулы.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|		НачисленияПоСреднемуФормулы.ПриборЗависимой КАК ПриборЗависимой,
	|		НачисленияПоСреднемуФормулы.ОбъемУслуги КАК ОбъемУслуги,
	|		НачисленияПоСреднемуФормулы.Сумма КАК Сумма
	|	ИЗ
	|		НачисленияПоСреднемуФормулы КАК НачисленияПоСреднемуФормулы
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		НачислениеПоФормулам.Организация,
	|		НачислениеПоФормулам.ПериодНачисления,
	|		НачислениеПоФормулам.Абонент,
	|		НачислениеПоФормулам.ЗначениеТарифа,
	|		НачислениеПоФормулам.Поставщик,
	|		НачислениеПоФормулам.ПриборУчета,
	|		НачислениеПоФормулам.ТочкаУчета,
	|		НачислениеПоФормулам.Услуга,
	|		ЛОЖЬ,
	|		ЗНАЧЕНИЕ(Справочник.энргПриборыУчетаАбонента.ПустаяСсылка),
	|		НачислениеПоФормулам.ОбъемУслуги,
	|		НачислениеПоФормулам.Сумма
	|	ИЗ
	|		НачислениеПоФормулам КАК НачислениеПоФормулам
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ДанныеНачислений.Организация,
	|		ДанныеНачислений.ПериодНачисления,
	|		ДанныеНачислений.Абонент,
	|		ДанныеНачислений.ЗначениеТарифа,
	|		ДанныеНачислений.Поставщик,
	|		ДанныеНачислений.ПриборУчета,
	|		ДанныеНачислений.ТочкаУчета,
	|		ДанныеНачислений.Услуга,
	|		ЛОЖЬ,
	|		ЗНАЧЕНИЕ(Справочник.энргПриборыУчетаАбонента.ПустаяСсылка),
	|		ДанныеНачислений.ОбъемУслуги,
	|		ДанныеНачислений.Сумма
	|	ИЗ
	|		ДанныеНачислений КАК ДанныеНачислений
	|	ГДЕ
	|		ДанныеНачислений.СпособНачисления В (ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.НачислениеПоСреднему), ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.СреднееПоНормативу))
	|		И ДанныеНачислений.ПериодНачисления = &ПериодНачисления
	|		И ДанныеНачислений.Организация = &Организация) КАК ВложенныйЗапрос
	|
	|СГРУППИРОВАТЬ ПО
	|	ВложенныйЗапрос.Организация,
	|	ВложенныйЗапрос.ПериодНачисления,
	|	ВложенныйЗапрос.Абонент,
	|	ВложенныйЗапрос.ЗначениеТарифа,
	|	ВложенныйЗапрос.Поставщик,
	|	ВложенныйЗапрос.ПриборУчета,
	|	ВложенныйЗапрос.ТочкаУчета,
	|	ВложенныйЗапрос.Услуга,
	|	ВложенныйЗапрос.ЗависимаяТочкаУчета,
	|	ВложенныйЗапрос.ПриборЗависимой
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ НачислениеПоФормулам
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ НачисленияПоСреднемуФормулы";	
	
	Запрос.Текст 	= Текст;
	Возврат Запрос.Выполнить();
	
КонецФункции  

Функция ОписаниеРегистраНакопления(ИмяТаблицы)
	
	НачисленныйСреднийОбъем 	= Новый ТаблицаЗначений;	
	МетаданныеРегистра  		= Метаданные.РегистрыНакопления[ИмяТаблицы];
	
	для Каждого Измерение из МетаданныеРегистра.Измерения цикл
		НачисленныйСреднийОбъем.Колонки.Добавить(Измерение.имя,Измерение.Тип);
	КонецЦикла;
	
	для Каждого Ресурс из МетаданныеРегистра.Ресурсы цикл
		НачисленныйСреднийОбъем.Колонки.Добавить(Ресурс.имя,Ресурс.Тип);
	КонецЦикла;
	
	Возврат НачисленныйСреднийОбъем;
КонецФункции

Процедура ПрочитатьСтабильныеПериодыПерерасчет(МВТ,Организация,ПериодНачисленияНачало,ПериодНачисленияКонец,НачалоПериодаРасчета,КонецПериодаРасчета,Район,КлючиПомещений,Абоненты)
	
	ТекстГраницОтчетногоПериода = энргНачисления.ТекстГраницОтчетногоПериода(ПериодНачисленияНачало,ПериодНачисленияКонец,Ложь);
	
	Объекты  					= Новый Структура;
	//Объекты.Вставить("энргСостояниеЛС",									Новый Структура("
	//|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "Абонент В (&Абоненты)", "ТаблицаРС.Абонент В (&Абоненты)", НЕОПРЕДЕЛЕНО,Новый Структура));
	
	Объекты.Вставить("энргАбонентыПомещений",						Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", НЕОПРЕДЕЛЕНО,Новый Структура));
	
	Объекты.Вставить("энргГруппыПотребителейАбонентов",				Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", НЕОПРЕДЕЛЕНО,Новый Структура));
	
	Объекты.Вставить("энргВидБлагоустройствАбонента",				Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", НЕОПРЕДЕЛЕНО ,Новый Структура));
	
	Объекты.Вставить("энргКоличествоКомнат",						Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", НЕОПРЕДЕЛЕНО ,Новый Структура));
	
	Объекты.Вставить("энргЗначенияПлощадей",						Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", НЕОПРЕДЕЛЕНО,Новый Структура));
	
	Объекты.Вставить("энргКоличествоПрописанных",					Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", НЕОПРЕДЕЛЕНО ,Новый Структура));
	
	Объекты.Вставить("энргКоличествоСобственников",					Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", НЕОПРЕДЕЛЕНО ,Новый Структура));
	
	Объекты.Вставить("энргКоличествоПроживающих",					Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", НЕОПРЕДЕЛЕНО ,Новый Структура));
	
	//Объекты.Вставить("энргАбонентыОтключаемыеВНеполивнойСезон",			Новый Структура("
	//|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "Абонент В (&Абоненты)", "ТаблицаРС.Абонент в (&Абоненты)", НЕОПРЕДЕЛЕНО ,Новый Структура));
		
	Объекты.Вставить("энргТипСобственностиАбонентов",				Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", НЕОПРЕДЕЛЕНО ,Новый Структура));
	
	Объекты.Вставить("энргВладельцыТочекУчета",						Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "АбонентВладелец в (&КлючиПомещений)", "ТаблицаРС.АбонентВладелец в (&КлючиПомещений)", "ТочкаУчета",Новый Структура("АбонентВладелец","КлючПомещения")));  	
	
	Объекты.Вставить("энргАктивностьТочекУчета",					Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", "ТочкаУчета",Новый Структура));
	
	Объекты.Вставить("энргПриборыТочекУчета",						Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", "ТочкаУчета",Новый Структура));
	
	Объекты.Вставить("энргСостояниеПриборовУчетаАбонента",			Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", "ТочкаУчета" ,Новый Структура));
	
	Объекты.Вставить("энргУслугиТочекУчета",						Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", "ТочкаУчета",Новый Структура));
	
	Объекты.Вставить("энргРасчетныеСпособыТочекУчета",				Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", "ТочкаУчета",Новый Структура));
	
	Объекты.Вставить("энргФормулыРасчетаТочекУчета",				Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", "ТочкаИсточник" ,Новый Структура("КлючПомещения,КлючПомещенияИсточник","КлючПомещенияРасчитываемая","КлючПомещения")));
	
	Объекты.Вставить("энргПоставщикиУслугАбонента",					Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", "ТочкаУчета",Новый Структура));
	
	Объекты.Вставить("энргКоэффциентыПриборовУчета",				Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", "ТочкаУчета" ,Новый Структура));
	
	Объекты.Вставить("энргДатыПоверкиПрибораУчета",					Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", "ТочкаУчета" ,Новый Структура));
			
	Объекты.Вставить("энргВидыДифференцированностиПриборовУчета",	Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", "ТочкаУчета",Новый Структура));
	
	Объекты.Вставить("энргНаправлениеИспользованияТочекУчета",		Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", "ТочкаУчета",Новый Структура));
	
	Объекты.Вставить("энргДиаметрСеченияТочекУчета",				Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", "ТочкаУчета",Новый Структура));
	
	Объекты.Вставить("энргЗначенияИзмерителейТочекУчета",			Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", "ТочкаУчета",Новый Структура));
	
	Объекты.Вставить("энргТехническаяВозможностьУстановкиПУ",		Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", "ТочкаУчета",Новый Структура));
	
	Объекты.Вставить("энргРодительТочкиУчета",						Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "КлючПомещения В (&КлючиПомещений)", "ТаблицаРС.КлючПомещения В (&КлючиПомещений)", "ТочкаУчета",Новый Структура));
		
	
	ИтоговыйТекст  				= 
	"ВЫБРАТЬ * 
	|ПОМЕСТИТЬ ГраницыОтчетногоПериода
	|ИЗ 
	|	(" + ТекстГраницОтчетногоПериода + ") КАК ВложенныйЗапрос
	|;
	|///////////
	|";
		
	ШаблонНаборПериодов 		= 
	"ВЫБРАТЬ
	|	вТаблица.Регистратор КАК ДокРегистратор,
	|	вТаблица.Период КАК Период, 	
	|	ВЫБОР 
	|		КОГДА вТаблица.ПериодРегистрации > вТаблица.Период
	|			ТОГДА  вТаблица.Период
	|		ИНАЧЕ вТаблица.ПериодРегистрации
	|	КОНЕЦ  КАК ПериодРегистрации,
	|	вТаблица.КлючПомещения КАК КлючПомещения,
	|	вТаблица.ТочкаУчета КАК ТочкаУчета
	|ИЗ 
	|	Набор%%ИмяТаблицы%%  КАК вТаблица";
	
			
	ШаблонГраницыРС				= 
	"ВЫБРАТЬ
	|	%%СтрокаресурсыИзмеренияГраницы%%
	|   , ТаблицаРС.Регистратор КАК ДокРегистратор
	|   , ТаблицаРС.Период КАК ПериодС
	|	, МИНИМУМ(ЕСТЬNULL(ТаблицаКонец.Период,ДОБАВИТЬКДАТЕ(&КонецПериода,СЕКУНДА,1))) КАК ПериодПо
	|ПОМЕСТИТЬ Набор%%ИмяТаблицы%%Границы
	|ИЗ
	|	Набор%%ИмяТаблицы%% КАК ТаблицаРС
	|		ЛЕВОЕ СОЕДИНЕНИЕ НАбор%%ИмяТаблицы%% КАК ТаблицаКонец
	|		ПО %%СтрокаСоединенения%%
	|		И (ВЫБОР
	|			КОГДА ТаблицаРС.Период < ТаблицаКонец.Период
	|				ТОГДА ИСТИНА
	|			КОГДА ТаблицаРС.Период = ТаблицаКонец.Период
	|					И ТаблицаРС.ПериодРегистрации < ТаблицаКонец.ПериодРегистрации
	|				ТОГДА ИСТИНА
	|			ИНАЧЕ ТаблицаРС.Период = ТаблицаКонец.Период
	|					И ТаблицаРС.ПериодРегистрации = ТаблицаКонец.ПериодРегистрации
	|					И ТаблицаРС.Регистратор < ТаблицаКонец.Регистратор
	|		КОНЕЦ)	
	|СГРУППИРОВАТЬ ПО
	|   %%СтрокаресурсыИзмеренияГраницы%%
	|	,ТаблицаРС.Регистратор
	|	,ТаблицаРС.Период";
	
	ШаблонЗаписиЗаПериод  		=
	"ВЫБРАТЬ
	|	%%СтрокаресурсыИзмерения%%
	|	,&НачалоПериода КАК Период
	|	,ВЫБОР КОГДА ТаблицаРС.ПериодРегистрации < &НачалоПериода Тогда ЗНАЧЕНИЕ(Документ.энргНачисление.ПустаяСсылка) ИНАЧЕ ТаблицаРС.Регистратор КОНЕЦ КАК Регистратор
	|	,ВЫБОР КОГДА ТаблицаРС.ПериодРегистрации < &НачалоПериода Тогда &НачалоПериода ИНАЧЕ ТаблицаРС.ПериодРегистрации КОНЕЦ КАК ПериодРегистрации
	|ПОМЕСТИТЬ Набор%%ИмяТаблицы%%
	|ИЗ
	|	РегистрСведений.%%ИмяТаблицы%%.СрезПоследних(
	|			ДОБАВИТЬКДАТЕ(&НачалоПериода, СЕКУНДА, -1),
	|			Организация = &Организация
	|				И Район = &Район
	|				И %%ДополнительноеУсловие%%) КАК ТаблицаРС
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	%%СтрокаресурсыИзмерения%%
	|	,КОНЕЦПЕРИОДА(ТаблицаРС.Период,ДЕНЬ) КАК Период 
	|	,ТаблицаРС.Регистратор
	|	,ТаблицаРС.ПериодРегистрации
	|ИЗ
	|	РегистрСведений.%%ИмяТаблицы%% КАК ТаблицаРС
	|ГДЕ
	|	ТаблицаРС.Период >= &НачалоПериода
	|	И ТаблицаРС.Период < &КонецПериода
	|	И ТаблицаРС.Организация = &Организация
	|	И ТаблицаРС.Район = &Район
	|	И %%ДополнительноеУсловиеТаблица%%";
	
	ГлавСчетчик									= 0;
	ТекстНаборПериодов 							= "";
	
	для Каждого объект из Объекты цикл
		
		СтрокаСоединения  						= "";
		Метад 									= Метаданные.РегистрыСведений[объект.Ключ]; 
		Измерения  								= Метад.Измерения;
		Ресурсы 								= Метад.Ресурсы; 
		СинонимыПолей 							= объект.Значение.СинонимыПолей;
		ТексПериода 							= "";
		Сч 										= 0;
		ИзмеренияРесурсы  						= "";
		ИзмеренияРесурсыГруппировка				= "";
		ИзмеренияРесурсыГраницы					= "";
		
		СтрокаРесурсов 							= "";
		
		// Измерения		
		для Каждого Измерение из Измерения цикл
			Синоним 					= Измерение.Имя;
			Если СинонимыПолей.Свойство(Измерение.Имя) Тогда
				Синоним 				= СинонимыПолей[Измерение.Имя];
			КонецЕсли;
			
			ИзмеренияРесурсы			= ИзмеренияРесурсы 				+ ?(Сч > 0,Символы.ПС + ",","")  + " ТаблицаРС." +  Измерение.Имя +" КАК " + Синоним + "";
			ИзмеренияРесурсыГраницы		= ИзмеренияРесурсыГраницы 		+ ?(Сч > 0,Символы.ПС + ",","")  + " ТаблицаРС." +  Синоним;			
			ИзмеренияРесурсыГруппировка	= ИзмеренияРесурсыГруппировка 	+ ?(Сч > 0,Символы.ПС + ",","")  + " ТаблицаРС." +  Измерение.Имя;
			СтрокаСоединения 			= СтрокаСоединения 				+ ?(Сч > 0,Символы.ПС + "И ","")  + " %%ТаблицаИсточник%%." +  Синоним +" = %%ТаблицаПриемник%%." + Синоним; 
			Сч 							= Сч + 1;
		КонецЦикла;
		
		//  Ресурсы.
		для Каждого Ресурс из Ресурсы цикл
			Синоним 					= Ресурс.Имя;
			Если СинонимыПолей.Свойство(Ресурс.Имя) Тогда
				Синоним 				= СинонимыПолей[Ресурс.Имя];				
			КонецЕсли;
			ИзмеренияРесурсы			= ИзмеренияРесурсы 				+ Символы.ПС +?(Сч > 0,",","")  + " ТаблицаРС." +  Ресурс.Имя +" КАК " + Синоним + "" ;
			ИзмеренияРесурсыГраницы		= ИзмеренияРесурсыГраницы 		+ Символы.ПС +?(Сч > 0,",","")  + " ТаблицаРС." +  Синоним;
			ИзмеренияРесурсыГруппировка	= ИзмеренияРесурсыГруппировка 	+ Символы.ПС +?(Сч > 0,",","")  + " ТаблицаРС." +  Ресурс.Имя ;
			Сч 							= Сч + 1;
		КонецЦикла; 
		
		Если НЕ объект.Значение.СвойствоТочки = Неопределено Тогда
			ИзмеренияРесурсы			= ИзмеренияРесурсы 	+ Символы.ПС +?(Сч > 0,",","")  + " ТаблицаРС." +  объект.Значение.СвойствоТочки +"";
		КонецЕсли;		
		
		ТексПериода 					= СтрЗаменить(ШаблонЗаписиЗаПериод,	"%%СтрокаресурсыИзмерения%%", 				ИзмеренияРесурсы);
		ТексПериода 					= СтрЗаменить(ТексПериода,			"%%СтрокаресурсыИзмеренияГруппировка%%", 	ИзмеренияРесурсыГруппировка);
		ТексПериода 					= СтрЗаменить(ТексПериода,			"%%ДополнительноеУсловие%%", 				объект.Значение.Условие);
		ТексПериода 					= СтрЗаменить(ТексПериода,			"%%ДополнительноеУсловиеТаблица%%", 		объект.Значение.УсловиеТаблицы);
		ТексПериода 					= СтрЗаменить(ТексПериода,			"%%ИмяТаблицы%%", 							объект.Ключ);
						
		// Сформировать границы регистра.		
		ТексПериода 					= ТексПериода + Символы.ПС + ";" + Символы.ПС + "//////////"+ Символы.ПС;
		
		ГраницыРС 						= ""; 		
		ГраницыРС 						= СтрЗаменить(ШаблонГраницыРС,	"%%СтрокаресурсыИзмеренияГраницы%%",		ИзмеренияРесурсыГраницы);
		ГраницыРС 						= СтрЗаменить(ГраницыРС,		"%%ИмяТаблицы%%",							объект.Ключ);
		ГраницыРС 						= СтрЗаменить(ГраницыРС,		"%%СтрокаСоединенения%%",					СтрокаСоединения);
		ГраницыРС 						= СтрЗаменить(ГраницыРС,		"%%ТаблицаИсточник%%",						"ТаблицаРС");
		ГраницыРС 						= СтрЗаменить(ГраницыРС,		"%%ТаблицаПриемник%%",						"ТаблицаКонец");
		
		ИтоговыйТекст 					= ИтоговыйТекст + ?(ГлавСчетчик>0,Символы.ПС + ";" + Символы.ПС + "//////////"+ Символы.ПС,"")  + ТексПериода;
		
		ИтоговыйТекст 					= ИтоговыйТекст + ГраницыРС;
		
		ВрТекст 						= СтрЗаменить(ШаблонНаборПериодов,"%%ИмяТаблицы%%",объект.Ключ);
		
		Если объект.Значение.СвойствоТочки = Неопределено Тогда
			ВрТекст 					= СтрЗаменить(ВрТекст,"вТаблица.ТочкаУчета КАК ТочкаУчета","НЕОПРЕДЕЛЕНО КАК ТочкаУчета");
		Иначе
			ВрТекст 					= СтрЗаменить(ВрТекст,"вТаблица.ТочкаУчета КАК ТочкаУчета","вТаблица." + объект.Значение.СвойствоТочки + " КАК ТочкаУчета");
		КонецЕсли;
				
		ТекстНаборПериодов  			= ТекстНаборПериодов + ?(ГлавСчетчик>0,Символы.ПС + "ОБЪЕДИНИТЬ ВСЕ" + Символы.ПС ,"")  + ВрТекст;
		
		ГлавСчетчик 					= ГлавСчетчик + 1;				
	КонецЦикла;
	
	ТекстНаборПериодов  				=
	"ВЫБРАТЬ РАЗЛИЧНЫЕ 
	|	ВложенныйЗапрос.ДокРегистратор КАК ДокРегистратор,
	|	ВложенныйЗапрос.Период КАК Период,
	|	ВложенныйЗапрос.ПериодРегистрации,
	|	ВложенныйЗапрос.КлючПомещения,
	|	ВложенныйЗапрос.ТочкаУчета
	|ПОМЕСТИТЬ НаборПериодов 
	|ИЗ 
	|	(" + ТекстНаборПериодов + "
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	| 	Значение(Документ.энргНачисление.ПустаяСсылка), 
	| 	ГраницыОтчетногоПериода.НачалоОП,
	| 	ГраницыОтчетногоПериода.НачалоОП,
	| 	НЕОПРЕДЕЛЕНО,
	| 	НЕОПРЕДЕЛЕНО
	|ИЗ
	|	ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	| 	Значение(Документ.энргНачисление.ПустаяСсылка),
	|	ГраницыОтчетногоПериода.ЗавершениеОП,
	|	ГраницыОтчетногоПериода.ЗавершениеОП,
	| 	НЕОПРЕДЕЛЕНО,
	| 	НЕОПРЕДЕЛЕНО
	|ИЗ
	|	ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода) КАК ВложенныйЗапрос";
	
	
	ИтоговыйТекст 				= ИтоговыйТекст + Символы.ПС + ";" + Символы.ПС + "//////////"+ Символы.ПС +ТекстНаборПериодов;
		
	ИтоговыйТекст 				= ИтоговыйТекст + Символы.ПС + ";" + Символы.ПС + 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	НаборэнргАктивностьТочекУчета.КлючПомещения КАК КлючПомещения,
	|	НаборэнргАктивностьТочекУчета.ТочкаУчета КАК ТочкаУчета
	|ПОМЕСТИТЬ ВсеТочкиУчета
	|ИЗ
	|	НаборэнргАктивностьТочекУчета КАК НаборэнргАктивностьТочекУчета
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НаборПериодов.ДокРегистратор КАК ДокРегистратор,
	|	НаборПериодов.Период КАК Период,
	|	НаборПериодов.КлючПомещения КАК КлючПомещения,
	|	НаборПериодов.ТочкаУчета КАК ТочкаУчета,
	|	НаборПериодов.ПериодРегистрации КАК ПериодРегистрации
	|ПОМЕСТИТЬ НаборПериодовТочкиУчета
	|ИЗ
	|	НаборПериодов КАК НаборПериодов
	|ГДЕ
	|	НЕ НаборПериодов.КлючПомещения = НЕОПРЕДЕЛЕНО
	|	И НЕ НаборПериодов.ТочкаУчета = НЕОПРЕДЕЛЕНО
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	НаборПериодов.ДокРегистратор,
	|	НаборПериодов.Период,
	|	ВсеТочкиУчета.КлючПомещения,
	|	ВсеТочкиУчета.ТочкаУчета,
	|	НаборПериодов.ПериодРегистрации
	|ИЗ
	|	ВсеТочкиУчета КАК ВсеТочкиУчета
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборПериодов КАК НаборПериодов
	|		ПО ВсеТочкиУчета.КлючПомещения = НаборПериодов.КлючПомещения
	|			И (НаборПериодов.ТочкаУчета = НЕОПРЕДЕЛЕНО)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	НаборПериодов.ДокРегистратор,
	|	НаборПериодов.Период,
	|	ВсеТочкиУчета.КлючПомещения,
	|	ВсеТочкиУчета.ТочкаУчета,
	|	НаборПериодов.ПериодРегистрации
	|ИЗ
	|	ВсеТочкиУчета КАК ВсеТочкиУчета
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборПериодов КАК НаборПериодов
	|		ПО (НаборПериодов.КлючПомещения = НЕОПРЕДЕЛЕНО)
	|			И (НаборПериодов.ТочкаУчета = НЕОПРЕДЕЛЕНО)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.НачалоОП КАК НачалоОП,
	|	энргПериодыПриемаПоказаний.ДатаС КАК ДатаС,
	|	энргПериодыПриемаПоказаний.ДатаПо КАК ДатаПо
	|ПОМЕСТИТЬ ПериодыПриемаПоказаний
	|ИЗ
	|	(ВЫБРАТЬ
	|		ГраницыОтчетногоПериода.Организация КАК Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|		ГраницыОтчетногоПериода.НачалоОП КАК НачалоОП,
	|		МАКСИМУМ(энргПериодыПриемаПоказаний.Период) КАК Период
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргПериодыПриемаПоказаний КАК энргПериодыПриемаПоказаний
	|			ПО ГраницыОтчетногоПериода.Организация = энргПериодыПриемаПоказаний.Организация
	|				И ГраницыОтчетногоПериода.ЗавершениеОП > энргПериодыПриемаПоказаний.Период
	|				И (энргПериодыПриемаПоказаний.Организация = &Организация)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ГраницыОтчетногоПериода.Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления,
	|		ГраницыОтчетногоПериода.НачалоОП) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргПериодыПриемаПоказаний КАК энргПериодыПриемаПоказаний
	|		ПО ВложенныйЗапрос.Организация = энргПериодыПриемаПоказаний.Организация
	|			И ВложенныйЗапрос.Период = энргПериодыПриемаПоказаний.Период
	|			И (энргПериодыПриемаПоказаний.Организация = &Организация)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.Район КАК Район,
	|	энргПоставщикиНеНачислять.Поставщик КАК Поставщик
	|ПОМЕСТИТЬ ПоставщикиНеНачислять
	|ИЗ
	|	(ВЫБРАТЬ
	|		ГраницыОтчетногоПериода.Организация КАК Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|		энргПоставщикиНеНачислять.Район КАК Район,
	|		МАКСИМУМ(энргПоставщикиНеНачислять.Период) КАК Период
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргПоставщикиНеНачислять КАК энргПоставщикиНеНачислять
	|			ПО ГраницыОтчетногоПериода.Организация = энргПоставщикиНеНачислять.Организация
	|				И ГраницыОтчетногоПериода.ЗавершениеОП > энргПоставщикиНеНачислять.Период
	|				И (энргПоставщикиНеНачислять.Организация = &Организация)
	|				И (энргПоставщикиНеНачислять.Район = &Район)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ГраницыОтчетногоПериода.Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления,
	|		энргПоставщикиНеНачислять.Район) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргПоставщикиНеНачислять КАК энргПоставщикиНеНачислять
	|		ПО ВложенныйЗапрос.Организация = энргПоставщикиНеНачислять.Организация
	|			И ВложенныйЗапрос.Период = энргПоставщикиНеНачислять.Период
	|			И ВложенныйЗапрос.Район = энргПоставщикиНеНачислять.Район
	|			И (энргПоставщикиНеНачислять.Организация = &Организация)
	|			И (энргПоставщикиНеНачислять.Район = &Район)
	|			И (энргПоставщикиНеНачислять.Использование)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	ВложенныйЗапрос.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	энгрЗначенияПовышающихКоэффициентов.Коэффициент КАК Коэффициент
	|ПОМЕСТИТЬ ЗначенияПовышающихКоэффициентов
	|ИЗ
	|	(ВЫБРАТЬ
	|		ГраницыОтчетногоПериода.Организация КАК Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|		энгрЗначенияПовышающихКоэффициентов.Район КАК Район,
	|		энгрЗначенияПовышающихКоэффициентов.Услуга КАК Услуга,
	|		энгрЗначенияПовышающихКоэффициентов.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|		МАКСИМУМ(энгрЗначенияПовышающихКоэффициентов.Период) КАК Период
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энгрЗначенияПовышающихКоэффициентов КАК энгрЗначенияПовышающихКоэффициентов
	|			ПО ГраницыОтчетногоПериода.Организация = энгрЗначенияПовышающихКоэффициентов.Организация
	|				И ГраницыОтчетногоПериода.ЗавершениеОП > энгрЗначенияПовышающихКоэффициентов.Период
	|				И (энгрЗначенияПовышающихКоэффициентов.Организация = &Организация)
	|				И (энгрЗначенияПовышающихКоэффициентов.Район = &Район)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ГраницыОтчетногоПериода.Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления,
	|		энгрЗначенияПовышающихКоэффициентов.Район,
	|		энгрЗначенияПовышающихКоэффициентов.Услуга,
	|		энгрЗначенияПовышающихКоэффициентов.НаправлениеИспользованияТУ) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энгрЗначенияПовышающихКоэффициентов КАК энгрЗначенияПовышающихКоэффициентов
	|		ПО ВложенныйЗапрос.Организация = энгрЗначенияПовышающихКоэффициентов.Организация
	|			И ВложенныйЗапрос.Период = энгрЗначенияПовышающихКоэффициентов.Период
	|			И ВложенныйЗапрос.Район = энгрЗначенияПовышающихКоэффициентов.Район
	|			И ВложенныйЗапрос.Услуга = энгрЗначенияПовышающихКоэффициентов.Услуга
	|			И ВложенныйЗапрос.НаправлениеИспользованияТУ = энгрЗначенияПовышающихКоэффициентов.НаправлениеИспользованияТУ
	|			И (энгрЗначенияПовышающихКоэффициентов.Организация = &Организация)
	|			И (энгрЗначенияПовышающихКоэффициентов.Район = &Район)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.КлючНорматива КАК КлючНорматива,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	ВложенныйЗапрос.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	энргЗначенияНормативовПотребления.ЗначениеНорматива КАК ЗначениеНорматива
	|ПОМЕСТИТЬ ЗначенияТекущихНормПотребления
	|ИЗ
	|	(ВЫБРАТЬ
	|		ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|		ГраницыОтчетногоПериода.Организация КАК Организация,
	|		энргЗначенияНормативовПотребления.Район КАК Район,
	|		энргЗначенияНормативовПотребления.КлючНорматива КАК КлючНорматива,
	|		энргЗначенияНормативовПотребления.ТипНачисления КАК ТипНачисления,
	|		энргЗначенияНормативовПотребления.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|		энргЗначенияНормативовПотребления.Услуга КАК Услуга,
	|		МАКСИМУМ(энргЗначенияНормативовПотребления.Период) КАК Период
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначенияНормативовПотребления КАК энргЗначенияНормативовПотребления
	|			ПО ГраницыОтчетногоПериода.Организация = энргЗначенияНормативовПотребления.Организация
	|				И ГраницыОтчетногоПериода.ЗавершениеОП > энргЗначенияНормативовПотребления.Период
	|				И (энргЗначенияНормативовПотребления.Организация = &Организация)
	|				И (энргЗначенияНормативовПотребления.Район = &Район)
	|				И (энргЗначенияНормативовПотребления.ТипНачисления = ЗНАЧЕНИЕ(Перечисление.энргТипыНачислений.ИндивидуальныеНачисления))
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ГраницыОтчетногоПериода.ПериодНачисления,
	|		ГраницыОтчетногоПериода.Организация,
	|		энргЗначенияНормативовПотребления.Район,
	|		энргЗначенияНормативовПотребления.КлючНорматива,
	|		энргЗначенияНормативовПотребления.ТипНачисления,
	|		энргЗначенияНормативовПотребления.НаправлениеИспользованияТУ,
	|		энргЗначенияНормативовПотребления.Услуга) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначенияНормативовПотребления КАК энргЗначенияНормативовПотребления
	|		ПО ВложенныйЗапрос.Организация = энргЗначенияНормативовПотребления.Организация
	|			И ВложенныйЗапрос.Район = энргЗначенияНормативовПотребления.Район
	|			И ВложенныйЗапрос.КлючНорматива = энргЗначенияНормативовПотребления.КлючНорматива
	|			И ВложенныйЗапрос.Услуга = энргЗначенияНормативовПотребления.Услуга
	|			И ВложенныйЗапрос.ТипНачисления = энргЗначенияНормативовПотребления.ТипНачисления
	|			И ВложенныйЗапрос.НаправлениеИспользованияТУ = энргЗначенияНормативовПотребления.НаправлениеИспользованияТУ
	|			И ВложенныйЗапрос.Период = энргЗначенияНормативовПотребления.Период
	|			И (энргЗначенияНормативовПотребления.Организация = &Организация)
	|			И (энргЗначенияНормативовПотребления.Район = &Район)
	|			И (энргЗначенияНормативовПотребления.ТипНачисления = ЗНАЧЕНИЕ(Перечисление.энргТипыНачислений.ИндивидуальныеНачисления))
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.КлючНорматива КАК КлючНорматива,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	ВложенныйЗапрос.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	энргЗначенияСоциальныхНормативов.ЗначениеНорматива КАК ЗначениеНорматива
	|ПОМЕСТИТЬ ЗначенияТекущихСоциальныхНормПотребления
	|ИЗ
	|	(ВЫБРАТЬ
	|		ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|		ГраницыОтчетногоПериода.Организация КАК Организация,
	|		энргЗначенияСоциальныхНормативов.Район КАК Район,
	|		энргЗначенияСоциальныхНормативов.КлючНорматива КАК КлючНорматива,
	|		энргЗначенияСоциальныхНормативов.ТипНачисления КАК ТипНачисления,
	|		энргЗначенияСоциальныхНормативов.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|		энргЗначенияСоциальныхНормативов.Услуга КАК Услуга,
	|		МАКСИМУМ(энргЗначенияСоциальныхНормативов.Период) КАК Период
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначенияСоциальныхНормативов КАК энргЗначенияСоциальныхНормативов
	|			ПО ГраницыОтчетногоПериода.Организация = энргЗначенияСоциальныхНормативов.Организация
	|				И ГраницыОтчетногоПериода.ЗавершениеОП > энргЗначенияСоциальныхНормативов.Период
	|				И (энргЗначенияСоциальныхНормативов.Организация = &Организация)
	|				И (энргЗначенияСоциальныхНормативов.Район = &Район)
	|				И (энргЗначенияСоциальныхНормативов.ТипНачисления = ЗНАЧЕНИЕ(Перечисление.энргТипыНачислений.ИндивидуальныеНачисления))
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ГраницыОтчетногоПериода.ПериодНачисления,
	|		ГраницыОтчетногоПериода.Организация,
	|		энргЗначенияСоциальныхНормативов.Район,
	|		энргЗначенияСоциальныхНормативов.КлючНорматива,
	|		энргЗначенияСоциальныхНормативов.ТипНачисления,
	|		энргЗначенияСоциальныхНормативов.НаправлениеИспользованияТУ,
	|		энргЗначенияСоциальныхНормативов.Услуга) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначенияСоциальныхНормативов КАК энргЗначенияСоциальныхНормативов
	|		ПО ВложенныйЗапрос.Организация = энргЗначенияСоциальныхНормативов.Организация
	|			И ВложенныйЗапрос.Район = энргЗначенияСоциальныхНормативов.Район
	|			И ВложенныйЗапрос.КлючНорматива = энргЗначенияСоциальныхНормативов.КлючНорматива
	|			И ВложенныйЗапрос.Услуга = энргЗначенияСоциальныхНормативов.Услуга
	|			И ВложенныйЗапрос.ТипНачисления = энргЗначенияСоциальныхНормативов.ТипНачисления
	|			И ВложенныйЗапрос.НаправлениеИспользованияТУ = энргЗначенияСоциальныхНормативов.НаправлениеИспользованияТУ
	|			И ВложенныйЗапрос.Период = энргЗначенияСоциальныхНормативов.Период
	|			И (энргЗначенияСоциальныхНормативов.Организация = &Организация)
	|			И (энргЗначенияСоциальныхНормативов.Район = &Район)
	|			И (энргЗначенияСоциальныхНормативов.ТипНачисления = ЗНАЧЕНИЕ(Перечисление.энргТипыНачислений.ИндивидуальныеНачисления))
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.ГруппаПотребителей КАК ГруппаПотребителей,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	ВложенныйЗапрос.Поставщик КАК Поставщик,
	|	ВложенныйЗапрос.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргЗначенияТарифов.Значение КАК Значение,
	|	энргЗначенияТарифов.ЗначениеСверхНорматива КАК ЗначениеСверхНорматива,
	|	энргЗначенияТарифов.ЗначениеРЭК КАК ЗначениеТарифаРЭК,
	|	энргЗначенияТарифов.СтавкаНДС КАК СтавкаНДС,
	|	энргЗначенияТарифов.НДСВнутри КАК НДСВнутри
	|ПОМЕСТИТЬ ЗначенияТекущихТарифов
	|ИЗ
	|	(ВЫБРАТЬ
	|		ГраницыОтчетногоПериода.Организация КАК Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|		энргЗначенияТарифов.Район КАК Район,
	|		энргЗначенияТарифов.ГруппаПотребителей КАК ГруппаПотребителей,
	|		энргЗначенияТарифов.Услуга КАК Услуга,
	|		энргЗначенияТарифов.Поставщик КАК Поставщик,
	|		энргЗначенияТарифов.ТарифнаяЗона КАК ТарифнаяЗона,
	|		МАКСИМУМ(энргЗначенияТарифов.Период) КАК Период
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначенияТарифов КАК энргЗначенияТарифов
	|			ПО ГраницыОтчетногоПериода.Организация = энргЗначенияТарифов.Организация
	|				И ГраницыОтчетногоПериода.ЗавершениеОП > энргЗначенияТарифов.Период
	|				И (энргЗначенияТарифов.Организация = &Организация)
	|				И (энргЗначенияТарифов.Район = &Район)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ГраницыОтчетногоПериода.Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления,
	|		энргЗначенияТарифов.Район,
	|		энргЗначенияТарифов.ГруппаПотребителей,
	|		энргЗначенияТарифов.Услуга,
	|		энргЗначенияТарифов.Поставщик,
	|		энргЗначенияТарифов.ТарифнаяЗона) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначенияТарифов КАК энргЗначенияТарифов
	|		ПО ВложенныйЗапрос.Организация = энргЗначенияТарифов.Организация
	|			И ВложенныйЗапрос.Район = энргЗначенияТарифов.Район
	|			И ВложенныйЗапрос.ГруппаПотребителей = энргЗначенияТарифов.ГруппаПотребителей
	|			И ВложенныйЗапрос.Услуга = энргЗначенияТарифов.Услуга
	|			И ВложенныйЗапрос.Поставщик = энргЗначенияТарифов.Поставщик
	|			И ВложенныйЗапрос.ТарифнаяЗона = энргЗначенияТарифов.ТарифнаяЗона
	|			И ВложенныйЗапрос.Период = энргЗначенияТарифов.Период
	|			И (энргЗначенияТарифов.Организация = &Организация)
	|			И (энргЗначенияТарифов.Район = &Район)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ГраницыОтчетногоПериода.Организация КАК Организация,
	|	ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|	энргСпособыРасчетаПоНаправлениям.Район КАК Район,
	|	энргСпособыРасчетаПоНаправлениям.Услуга КАК Услуга,
	|	энргСпособыРасчетаПоНаправлениям.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	энргСпособыРасчетаПоНаправлениям.ВидПлощади КАК ВидПлощади,
	|	энргСпособыРасчетаПоНаправлениям.Сезонность КАК Сезонность,
	|	энргСпособыРасчетаПоНаправлениям.НормативПоДням КАК НормативПоДням,
	|	энргСпособыРасчетаПоНаправлениям.СпособОпределенияСоциальнойНормы КАК СпособОпределенияСоциальнойНормы
	|ПОМЕСТИТЬ СпособыРасчетаПоНаправлениям
	|ИЗ
	|	ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргСпособыРасчетаПоНаправлениям.СрезПоследних(&НачалоПериода, ) КАК энргСпособыРасчетаПоНаправлениям
	|		ПО (энргСпособыРасчетаПоНаправлениям.Организация = &Организация)
	|			И (энргСпособыРасчетаПоНаправлениям.Район = &Район)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	энргНормаСкоростиДвиженияВоды.СкоростьДвижения КАК СкоростьДвижения
	|ПОМЕСТИТЬ НормаСкоростиДвиженияВоды
	|ИЗ
	|	(ВЫБРАТЬ
	|		ГраницыОтчетногоПериода.Организация КАК Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|		МАКСИМУМ(энргНормаСкоростиДвиженияВоды.Период) КАК Период
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргНормаСкоростиДвиженияВоды КАК энргНормаСкоростиДвиженияВоды
	|			ПО ГраницыОтчетногоПериода.Организация = энргНормаСкоростиДвиженияВоды.Организация
	|				И ГраницыОтчетногоПериода.ЗавершениеОП > энргНормаСкоростиДвиженияВоды.Период
	|				И (энргНормаСкоростиДвиженияВоды.Организация = &Организация)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ГраницыОтчетногоПериода.Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргНормаСкоростиДвиженияВоды КАК энргНормаСкоростиДвиженияВоды
	|		ПО ВложенныйЗапрос.Организация = энргНормаСкоростиДвиженияВоды.Организация
	|			И ВложенныйЗапрос.Период = энргНормаСкоростиДвиженияВоды.Период
	|			И (энргНормаСкоростиДвиженияВоды.Организация = &Организация)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	ВложенныйЗапрос.МКД КАК МКД,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	НастройкаСезонностиУслуг.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	НастройкаСезонностиУслуг.Коэффициент КАК КоэффициентНорматива,
	|	НастройкаСезонностиУслуг.КоэффициентНеПрименятьСезонность КАК КоэффициентНеПрименятьСезонность,
	|	НастройкаСезонностиУслуг.КорректироватьГодовойОбъем КАК КорректироватьГодовойОбъем,
	|	НастройкаСезонностиУслуг.ОбъемЗаПрошлыйГод КАК ОбъемЗаПрошлыйГод
	|ПОМЕСТИТЬ НастройкаСезонностиУслуг
	|ИЗ
	|	(ВЫБРАТЬ
	|		НастройкаСезонностиУслуг.Организация КАК Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|		НастройкаСезонностиУслуг.Район КАК Район,
	|		НастройкаСезонностиУслуг.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|		НастройкаСезонностиУслуг.МКД КАК МКД,
	|		НастройкаСезонностиУслуг.Услуга КАК Услуга,
	|		МАКСИМУМ(НастройкаСезонностиУслуг.Период) КАК Период
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргНастройкаСезонностиУслуг КАК НастройкаСезонностиУслуг
	|			ПО ГраницыОтчетногоПериода.Организация = НастройкаСезонностиУслуг.Организация
	|				И (НастройкаСезонностиУслуг.Организация = &Организация)
	|				И (НастройкаСезонностиУслуг.Район = &Район)
	|				И (НастройкаСезонностиУслуг.МКД = &МКД
	|					ИЛИ НастройкаСезонностиУслуг.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка))
	|				И ГраницыОтчетногоПериода.ЗавершениеОП > НастройкаСезонностиУслуг.Период
	|	
	|	СГРУППИРОВАТЬ ПО
	|		НастройкаСезонностиУслуг.Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления,
	|		НастройкаСезонностиУслуг.Район,
	|		НастройкаСезонностиУслуг.НаправлениеИспользованияТУ,
	|		НастройкаСезонностиУслуг.МКД,
	|		НастройкаСезонностиУслуг.Услуга) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргНастройкаСезонностиУслуг КАК НастройкаСезонностиУслуг
	|		ПО ВложенныйЗапрос.Организация = НастройкаСезонностиУслуг.Организация
	|			И ВложенныйЗапрос.Район = НастройкаСезонностиУслуг.Район
	|			И ВложенныйЗапрос.НаправлениеИспользованияТУ = НастройкаСезонностиУслуг.НаправлениеИспользованияТУ
	|			И ВложенныйЗапрос.МКД = НастройкаСезонностиУслуг.МКД
	|			И ВложенныйЗапрос.Услуга = НастройкаСезонностиУслуг.Услуга
	|			И ВложенныйЗапрос.Период = НастройкаСезонностиУслуг.Период
	|			И (НастройкаСезонностиУслуг.Организация = &Организация)
	|			И (НастройкаСезонностиУслуг.Район = &Район)
	|			И (НастройкаСезонностиУслуг.МКД = &МКД
	|				ИЛИ НастройкаСезонностиУслуг.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка))
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.МКД КАК Строение,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	ВложенныйЗапрос.ТипСхемы КАК ТипСхемы,
	|	ВложенныйЗапрос.ПринадлежностьКТепловомуПункту КАК ПринадлежностьКТепловомуПункту,
	|	энргНастройкаНачисленияГВСМКД.ПредставлениеУслуги КАК ПредставлениеУслуги,
	|	энргНастройкаНачисленияГВСМКД.НеНачислять КАК НеНачислять
	|ПОМЕСТИТЬ МКДНеНачислятьТЭ
	|ИЗ
	|	(ВЫБРАТЬ
	|		энргНастройкаНачисленияГВСМКД.Организация КАК Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|		энргНастройкаНачисленияГВСМКД.Район КАК Район,
	|		энргНастройкаНачисленияГВСМКД.МКД КАК МКД,
	|		энргНастройкаНачисленияГВСМКД.Услуга КАК Услуга,
	|		энргНастройкаНачисленияГВСМКД.ТипСхемы КАК ТипСхемы,
	|		энргНастройкаНачисленияГВСМКД.ПринадлежностьКТепловомуПункту КАК ПринадлежностьКТепловомуПункту,
	|		МАКСИМУМ(энргНастройкаНачисленияГВСМКД.Период) КАК Период
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргНастройкаНачисленияГВСМКД КАК энргНастройкаНачисленияГВСМКД
	|			ПО ГраницыОтчетногоПериода.Организация = энргНастройкаНачисленияГВСМКД.Организация
	|				И (энргНастройкаНачисленияГВСМКД.Организация = &Организация)
	|				И (энргНастройкаНачисленияГВСМКД.Район = &Район)
	|				И (энргНастройкаНачисленияГВСМКД.МКД = &МКД
	|					ИЛИ энргНастройкаНачисленияГВСМКД.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка))
	|				И ГраницыОтчетногоПериода.ЗавершениеОП > энргНастройкаНачисленияГВСМКД.Период
	|	
	|	СГРУППИРОВАТЬ ПО
	|		энргНастройкаНачисленияГВСМКД.Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления,
	|		энргНастройкаНачисленияГВСМКД.Район,
	|		энргНастройкаНачисленияГВСМКД.МКД,
	|		энргНастройкаНачисленияГВСМКД.Услуга,
	|		энргНастройкаНачисленияГВСМКД.ТипСхемы,
	|		энргНастройкаНачисленияГВСМКД.ПринадлежностьКТепловомуПункту) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргНастройкаНачисленияГВСМКД КАК энргНастройкаНачисленияГВСМКД
	|		ПО ВложенныйЗапрос.Организация = энргНастройкаНачисленияГВСМКД.Организация
	|			И ВложенныйЗапрос.Район = энргНастройкаНачисленияГВСМКД.Район
	|			И ВложенныйЗапрос.МКД = энргНастройкаНачисленияГВСМКД.МКД
	|			И ВложенныйЗапрос.Услуга = энргНастройкаНачисленияГВСМКД.Услуга
	|			И ВложенныйЗапрос.ТипСхемы = энргНастройкаНачисленияГВСМКД.ТипСхемы
	|			И ВложенныйЗапрос.ПринадлежностьКТепловомуПункту = энргНастройкаНачисленияГВСМКД.ПринадлежностьКТепловомуПункту
	|			И ВложенныйЗапрос.Период = энргНастройкаНачисленияГВСМКД.Период
	|			И (энргНастройкаНачисленияГВСМКД.Организация = &Организация)
	|			И (энргНастройкаНачисленияГВСМКД.Район = &Район)
	|			И (энргНастройкаНачисленияГВСМКД.МКД = &МКД
	|				ИЛИ энргНастройкаНачисленияГВСМКД.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка))
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.МКД КАК Строение,
	|	энргТипСхемыГВС.ТипСхемы КАК ТипСхемы
	|ПОМЕСТИТЬ ТипСхемыГВС
	|ИЗ
	|	(ВЫБРАТЬ
	|		энргТипСхемыГВС.Организация КАК Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|		энргТипСхемыГВС.Район КАК Район,
	|		энргТипСхемыГВС.МКД КАК МКД,
	|		МАКСИМУМ(энргТипСхемыГВС.Период) КАК Период
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргТипСхемыГВС КАК энргТипСхемыГВС
	|			ПО ГраницыОтчетногоПериода.Организация = энргТипСхемыГВС.Организация
	|				И (энргТипСхемыГВС.Организация = &Организация)
	|				И (энргТипСхемыГВС.Район = &Район)
	|				И (энргТипСхемыГВС.МКД = &МКД)
	|				И ГраницыОтчетногоПериода.ЗавершениеОП > энргТипСхемыГВС.Период
	|	
	|	СГРУППИРОВАТЬ ПО
	|		энргТипСхемыГВС.Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления,
	|		энргТипСхемыГВС.Район,
	|		энргТипСхемыГВС.МКД) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргТипСхемыГВС КАК энргТипСхемыГВС
	|		ПО ВложенныйЗапрос.Организация = энргТипСхемыГВС.Организация
	|			И ВложенныйЗапрос.Район = энргТипСхемыГВС.Район
	|			И ВложенныйЗапрос.МКД = энргТипСхемыГВС.МКД
	|			И ВложенныйЗапрос.Период = энргТипСхемыГВС.Период
	|			И (энргТипСхемыГВС.Организация = &Организация)
	|			И (энргТипСхемыГВС.Район = &Район)
	|			И (энргТипСхемыГВС.МКД = &МКД)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.МКД КАК Строение,
	|	энргТипПринадлежностиМКД.ВидТепловогоПункта КАК ВидТепловогоПункта
	|ПОМЕСТИТЬ ВидыТепловыхПунктов
	|ИЗ
	|	(ВЫБРАТЬ
	|		энргТипПринадлежностиМКД.Организация КАК Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|		энргТипПринадлежностиМКД.Район КАК Район,
	|		энргТипПринадлежностиМКД.МКД КАК МКД,
	|		МАКСИМУМ(энргТипПринадлежностиМКД.Период) КАК Период
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргТипПринадлежностиМКД КАК энргТипПринадлежностиМКД
	|			ПО ГраницыОтчетногоПериода.Организация = энргТипПринадлежностиМКД.Организация
	|				И (энргТипПринадлежностиМКД.Организация = &Организация)
	|				И (энргТипПринадлежностиМКД.Район = &Район)
	|				И (энргТипПринадлежностиМКД.МКД = &МКД)
	|				И ГраницыОтчетногоПериода.ЗавершениеОП > энргТипПринадлежностиМКД.Период
	|	
	|	СГРУППИРОВАТЬ ПО
	|		энргТипПринадлежностиМКД.Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления,
	|		энргТипПринадлежностиМКД.Район,
	|		энргТипПринадлежностиМКД.МКД) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргТипПринадлежностиМКД КАК энргТипПринадлежностиМКД
	|		ПО ВложенныйЗапрос.Организация = энргТипПринадлежностиМКД.Организация
	|			И ВложенныйЗапрос.Район = энргТипПринадлежностиМКД.Район
	|			И ВложенныйЗапрос.МКД = энргТипПринадлежностиМКД.МКД
	|			И ВложенныйЗапрос.Период = энргТипПринадлежностиМКД.Период
	|			И (энргТипПринадлежностиМКД.Организация = &Организация)
	|			И (энргТипПринадлежностиМКД.Район = &Район)
	|			И (энргТипПринадлежностиМКД.МКД = &МКД)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ДанныеСтроений.ЧастныйСектор КАК ЧастныйСектор,
	|	ДанныеСтроений.Строение КАК Строение,
	|	ДанныеСтроений.Помещение КАК Помещение,
	|	ВложенныйЗапрос.ТочкаУчета КАК ТочкаУчета,
	|	ВложенныйЗапрос.ПриборУчета КАК ПриборУчета
	|ПОМЕСТИТЬ ДанныеВыводаПрибораУчета
	|ИЗ
	|	(ВЫБРАТЬ
	|		энргВыводПриборовУчета.Организация КАК Организация,
	|		энргВыводПриборовУчета.ПериодНачисления КАК ПериодНачисления,
	|		энргВыводПриборовУчета.Район КАК Район,
	|		энргВыводПриборовУчета.Строение КАК Строение,
	|		энргВыводПриборовУчета.КлючПомещения КАК КлючПомещения,
	|		энргВыводПриборовУчета.ТочкаУчета КАК ТочкаУчета,
	|		энргВыводПриборовУчета.ПриборУчета КАК ПриборУчета
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргВыводПриборовУчета КАК энргВыводПриборовУчета
	|			ПО ГраницыОтчетногоПериода.Организация = энргВыводПриборовУчета.Организация
	|				И (энргВыводПриборовУчета.Организация = &Организация)
	|				И (энргВыводПриборовУчета.Район = &Район)
	|				И (энргВыводПриборовУчета.Строение = &МКД)
	|				И (энргВыводПриборовУчета.КлючПомещения В (&КлючиПомещений))) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДанныеСтроений КАК ДанныеСтроений
	|		ПО ВложенныйЗапрос.КлючПомещения = ДанныеСтроений.КлючПомещения
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.ДокРегистратор КАК ДокРегистратор,
	|	ВложенныйЗапрос.КлючПомещения КАК КлючПомещения,
	|	ВложенныйЗапрос.ТочкаУчета КАК ТочкаУчета,
	|	ВложенныйЗапрос.ПериодРегистрации КАК ПериодРегистрации,
	|	ВложенныйЗапрос.НачПер КАК НачПер,
	|	ВложенныйЗапрос.КонПер КАК КонПер
	|ПОМЕСТИТЬ ГраницыПериодов
	|ИЗ
	|	(ВЫБРАТЬ
	|		НаборПериодовНачало.ДокРегистратор КАК ДокРегистратор,
	|		НаборПериодовНачало.КлючПомещения КАК КлючПомещения,
	|		НаборПериодовНачало.ТочкаУчета КАК ТочкаУчета,
	|		НаборПериодовНачало.Период КАК НачПер,
	|		НаборПериодовНачало.ПериодРегистрации КАК ПериодРегистрации,
	|		МИНИМУМ(НаборПериодовКонец.Период) КАК КонПер
	|	ИЗ
	|		НаборПериодовТочкиУчета КАК НаборПериодовНачало
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ НаборПериодовТочкиУчета КАК НаборПериодовКонец
	|			ПО НаборПериодовНачало.КлючПомещения = НаборПериодовКонец.КлючПомещения
	|				И НаборПериодовНачало.ТочкаУчета = НаборПериодовКонец.ТочкаУчета
	|				И (ВЫБОР
	|					КОГДА НаборПериодовНачало.Период < НаборПериодовКонец.Период
	|						ТОГДА ИСТИНА
	|					КОГДА НаборПериодовНачало.Период = НаборПериодовКонец.Период
	|							И НаборПериодовНачало.ПериодРегистрации < НаборПериодовКонец.ПериодРегистрации
	|						ТОГДА ИСТИНА
	|					ИНАЧЕ НаборПериодовНачало.Период = НаборПериодовКонец.Период
	|							И НаборПериодовНачало.ПериодРегистрации = НаборПериодовКонец.ПериодРегистрации
	|							И НаборПериодовНачало.ДокРегистратор < НаборПериодовКонец.ДокРегистратор
	|				КОНЕЦ)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		НаборПериодовНачало.ДокРегистратор,
	|		НаборПериодовНачало.КлючПомещения,
	|		НаборПериодовНачало.ТочкаУчета,
	|		НаборПериодовНачало.ПериодРегистрации,
	|		НаборПериодовНачало.Период) КАК ВложенныйЗапрос
	|ГДЕ
	|	ВложенныйЗапрос.КонПер <> ДАТАВРЕМЯ(1, 1, 1)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&Организация КАК Организация,
	|	ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|	&Район КАК Район,
	|	ДанныеСтроений.ЧастныйСектор КАК ЧастныйСектор,
	|	ДанныеСтроений.Строение КАК Строение,
	|	ДанныеСтроений.Помещение КАК Помещение,
	|	ДанныеСтроений.КлючПомещения КАК КлючПомещения,
	|	ГраницыОтчетногоПериода.НачалоОП КАК НачалоОП,
	|	ГраницыОтчетногоПериода.ЗавершениеОП КАК ЗавершениеОП,
	|	ГраницыОтчетногоПериода.ДнейВПериоде КАК ДнейВПериоде,
	|	ГраницыПериодов.ДокРегистратор КАК ДокРегистратор,
	|	ГраницыПериодов.ПериодРегистрации КАК ПериодРегистрации,
	|	ГраницыПериодов.НачПер КАК НачПер,
	|	ГраницыПериодов.КонПер КАК КонПер,
	|	ГраницыПериодов.ТочкаУчета КАК ТочкаУчета,
	|	НаборэнргАбонентыПомещенийГраницы.Абонент КАК Абонент,
	|	ИСТИНА КАК СостояниеЛС,
	|	ЕСТЬNULL(НаборэнргКоличествоКомнатГраницы.Количество, 0) КАК КоличествоКомнат,
	|	ЕСТЬNULL(НаборэнргКоличествоПрописанныхГраницы.Количество, 0) КАК КоличествоПрописанных,
	|	ЕСТЬNULL(НаборэнргКоличествоСобственниковГраницы.Количество, 1) КАК КоличествоСобственников,
	|	ЕСТЬNULL(НаборэнргКоличествоПроживающихГраницы.Количество, 0) КАК КоличествоПроживающих,
	|	ЗНАЧЕНИЕ(Перечисление.энргТипыСобственниковЖилья.ЧастнаяСобственность) КАК ВидСобственности
	|ПОМЕСТИТЬ ОбщиеДанные
	|ИЗ
	|	ГраницыПериодов КАК ГраницыПериодов
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргАбонентыПомещенийГраницы КАК НаборэнргАбонентыПомещенийГраницы
	|		ПО ГраницыПериодов.КлючПомещения = НаборэнргАбонентыПомещенийГраницы.КлючПомещения
	|			И (ВЫБОР
	|				КОГДА ГраницыПериодов.НачПер = ГраницыПериодов.КонПер
	|					ТОГДА ГраницыПериодов.ДокРегистратор = НаборэнргАбонентыПомещенийГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргАбонентыПомещенийГраницы.ПериодС <= ГраницыПериодов.НачПер
	|						И НаборэнргАбонентыПомещенийГраницы.ПериодПо >= ГраницыПериодов.КонПер
	|			КОНЕЦ)
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргКоличествоКомнатГраницы КАК НаборэнргКоличествоКомнатГраницы
	|		ПО ГраницыПериодов.КлючПомещения = НаборэнргКоличествоКомнатГраницы.КлючПомещения
	|			И (ВЫБОР
	|				КОГДА ГраницыПериодов.НачПер = ГраницыПериодов.КонПер
	|					ТОГДА ГраницыПериодов.ДокРегистратор = НаборэнргКоличествоКомнатГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргКоличествоКомнатГраницы.ПериодС <= ГраницыПериодов.НачПер
	|						И НаборэнргКоличествоКомнатГраницы.ПериодПо >= ГраницыПериодов.КонПер
	|			КОНЕЦ)
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргКоличествоПрописанныхГраницы КАК НаборэнргКоличествоПрописанныхГраницы
	|		ПО ГраницыПериодов.КлючПомещения = НаборэнргКоличествоПрописанныхГраницы.КлючПомещения
	|			И (ВЫБОР
	|				КОГДА ГраницыПериодов.НачПер = ГраницыПериодов.КонПер
	|					ТОГДА ГраницыПериодов.ДокРегистратор = НаборэнргКоличествоПрописанныхГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргКоличествоПрописанныхГраницы.ПериодС <= ГраницыПериодов.НачПер
	|						И НаборэнргКоличествоПрописанныхГраницы.ПериодПо >= ГраницыПериодов.КонПер
	|			КОНЕЦ)
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргКоличествоСобственниковГраницы КАК НаборэнргКоличествоСобственниковГраницы
	|		ПО ГраницыПериодов.КлючПомещения = НаборэнргКоличествоСобственниковГраницы.КлючПомещения
	|			И (ВЫБОР
	|				КОГДА ГраницыПериодов.НачПер = ГраницыПериодов.КонПер
	|					ТОГДА ГраницыПериодов.ДокРегистратор = НаборэнргКоличествоСобственниковГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргКоличествоСобственниковГраницы.ПериодС <= ГраницыПериодов.НачПер
	|						И НаборэнргКоличествоСобственниковГраницы.ПериодПо >= ГраницыПериодов.КонПер
	|			КОНЕЦ)
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргКоличествоПроживающихГраницы КАК НаборэнргКоличествоПроживающихГраницы
	|		ПО ГраницыПериодов.КлючПомещения = НаборэнргКоличествоПроживающихГраницы.КлючПомещения
	|			И (ВЫБОР
	|				КОГДА ГраницыПериодов.НачПер = ГраницыПериодов.КонПер
	|					ТОГДА ГраницыПериодов.ДокРегистратор = НаборэнргКоличествоПроживающихГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргКоличествоПроживающихГраницы.ПериодС <= ГраницыПериодов.НачПер
	|						И НаборэнргКоличествоПроживающихГраницы.ПериодПо >= ГраницыПериодов.КонПер
	|			КОНЕЦ)		
	|		ЛЕВОЕ СОЕДИНЕНИЕ ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|		ПО ГраницыПериодов.НачПер >= ГраницыОтчетногоПериода.НачалоОП
	|			И ГраницыПериодов.КонПер <= ГраницыОтчетногоПериода.ЗавершениеОП
	|		ЛЕВОЕ СОЕДИНЕНИЕ ДанныеСтроений КАК ДанныеСтроений
	|		ПО ГраницыПериодов.КлючПомещения = ДанныеСтроений.КлючПомещения
	|ГДЕ
	|	НЕ ГраницыОтчетногоПериода.ПериодНачисления ЕСТЬ NULL
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ОбщиеДанные.Организация КАК Организация,
	|	ОбщиеДанные.ПериодНачисления КАК ПериодНачисления,
	|	ОбщиеДанные.Район КАК Район,
	|	ОбщиеДанные.КлючПомещения КАК КлючПомещения,
	|	ОбщиеДанные.ЧастныйСектор КАК ЧастныйСектор,
	|	ОбщиеДанные.Строение КАК Строение,
	|	ОбщиеДанные.Помещение КАК Помещение,
	|	ОбщиеДанные.Абонент КАК Абонент,
	|	ОбщиеДанные.ДнейВПериоде КАК ДнейВПериоде,
	|	ОбщиеДанные.ПериодРегистрации КАК ПериодРегистрации,
	|	ОбщиеДанные.НачПер КАК НачПер,
	|	ОбщиеДанные.КонПер КАК КонПер,
	|	ОбщиеДанные.ДокРегистратор КАК ДокРегистратор,
	|	ОбщиеДанные.НачалоОП КАК НачалоОП,
	|	ОбщиеДанные.ЗавершениеОП КАК ЗавершениеОП,
	|	ОбщиеДанные.ТочкаУчета КАК ТочкаУчета,
	|	ОбщиеДанные.СостояниеЛС КАК СостояниеЛС,
	|	ВЫБОР
	|		КОГДА НаборэнргАктивностьТочекУчетаГраницы.Состояние ЕСТЬ NULL
	|			ТОГДА ЛОЖЬ
	|		КОГДА НаборэнргАктивностьТочекУчетаГраницы.Состояние = ЗНАЧЕНИЕ(Перечисление.энргСостояниеТочекУчета.Отключена)
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ ИСТИНА
	|	КОНЕЦ КАК УслугаПодключена,
	|	НаборэнргУслугиТочекУчетаГраницы.Услуга КАК Услуга,
	|	ОбщиеДанные.КоличествоКомнат КАК КоличествоКомнат,
	|	ОбщиеДанные.КоличествоПрописанных КАК КоличествоПрописанных,
	|	ОбщиеДанные.КоличествоСобственников КАК КоличествоСобственников,
	|	ОбщиеДанные.КоличествоПроживающих КАК КоличествоПроживающих,
	|	ОбщиеДанные.ВидСобственности КАК ВидСобственности,
	|	НаборэнргУслугиТочекУчетаГраницы.Техническая КАК Техническая,
	|	ЕСТЬNULL(НаборэнргПриборыТочекУчетаГраницы.ПриборУчета, ЗНАЧЕНИЕ(Справочник.энргПриборыУчетаАбонента.ПустаяСсылка)) КАК ПриборУчета,
	|	ЕСТЬNULL(НаборэнргРасчетныеСпособыТочекУчетаГраницы.РасчетныйСпособ, ЛОЖЬ) КАК РасчетПоФормуле,
	|	ЕСТЬNULL(НаборэнргФормулыРасчетаТочекУчетаГраницы.РассчитываемаяТочка, ЗНАЧЕНИЕ(Справочник.энргТочкиУчета.ПустаяСсылка)) КАК ЗависимаяТочкаУчета,
	|	ЕСТЬNULL(НаборэнргФормулыРасчетаТочекУчетаГраницы.Коэффициент, 0) КАК КоэффициентФормула,
	|	ЕСТЬNULL(НаборэнргНаправлениеИспользованияТочекУчетаГраницы.НаправлениеИспользованияТУ, ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)) КАК НаправлениеИспользованияТУ,
	|	ЕСТЬNULL(НаборэнргДиаметрСеченияТочекУчетаГраницы.Использовать, ЛОЖЬ) КАК ИспользоватьДиаметрСечения,
	|	ЕСТЬNULL(НаборэнргДиаметрСеченияТочекУчетаГраницы.ДиаметрСечения, 0) КАК ДиаметрСечения,
	|	ЕСТЬNULL(НаборэнргТехническаяВозможностьУстановкиПУГраницы.НетВозможностьУстановкиПУ,ЛОЖЬ) КАК НетВозможностьУстановкиПУ,
	|	ЕСТЬNULL(НаборэнргТехническаяВозможностьУстановкиПУГраницы.РасчетТолькоПоПоказаниям,ЛОЖЬ) КАК РасчетТолькоПоПоказаниям,
	|	ЕСТЬNULL(НаборэнргРодительТочкиУчетаГраницы.РодительТочкиУчета,ЗНАЧЕНИЕ(Справочник.энргТочкиУчета.ПустаяСсылка)) КАК ТочкаУчетаРодитель
	|ПОМЕСТИТЬ ДанныеПриборовУчета
	|ИЗ
	|	ОбщиеДанные КАК ОбщиеДанные
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргАктивностьТочекУчетаГраницы КАК НаборэнргАктивностьТочекУчетаГраницы
	|		ПО ОбщиеДанные.КлючПомещения = НаборэнргАктивностьТочекУчетаГраницы.КлючПомещения
	|			И (ВЫБОР
	|				КОГДА ОбщиеДанные.НачПер = ОбщиеДанные.КонПер
	|					ТОГДА ОбщиеДанные.ДокРегистратор = НаборэнргАктивностьТочекУчетаГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргАктивностьТочекУчетаГраницы.ПериодС <= ОбщиеДанные.НачПер
	|						И НаборэнргАктивностьТочекУчетаГраницы.ПериодПо >= ОбщиеДанные.КонПер
	|			КОНЕЦ)
	|			И ОбщиеДанные.ТочкаУчета = НаборэнргАктивностьТочекУчетаГраницы.ТочкаУчета
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргУслугиТочекУчетаГраницы КАК НаборэнргУслугиТочекУчетаГраницы
	|		ПО ОбщиеДанные.КлючПомещения = НаборэнргУслугиТочекУчетаГраницы.КлючПомещения
	|			И (ВЫБОР
	|				КОГДА ОбщиеДанные.НачПер = ОбщиеДанные.КонПер
	|					ТОГДА ОбщиеДанные.ДокРегистратор = НаборэнргУслугиТочекУчетаГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргУслугиТочекУчетаГраницы.ПериодС <= ОбщиеДанные.НачПер
	|						И НаборэнргУслугиТочекУчетаГраницы.ПериодПо >= ОбщиеДанные.КонПер
	|			КОНЕЦ)
	|			И ОбщиеДанные.ТочкаУчета = НаборэнргУслугиТочекУчетаГраницы.ТочкаУчета
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргПриборыТочекУчетаГраницы КАК НаборэнргПриборыТочекУчетаГраницы
	|		ПО ОбщиеДанные.КлючПомещения = НаборэнргПриборыТочекУчетаГраницы.КлючПомещения
	|			И (ВЫБОР
	|				КОГДА ОбщиеДанные.НачПер = ОбщиеДанные.КонПер
	|					ТОГДА ОбщиеДанные.ДокРегистратор = НаборэнргПриборыТочекУчетаГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргПриборыТочекУчетаГраницы.ПериодС <= ОбщиеДанные.НачПер
	|						И НаборэнргПриборыТочекУчетаГраницы.ПериодПо >= ОбщиеДанные.КонПер
	|			КОНЕЦ)
	|			И ОбщиеДанные.ТочкаУчета = НаборэнргПриборыТочекУчетаГраницы.ТочкаУчета
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргРасчетныеСпособыТочекУчетаГраницы КАК НаборэнргРасчетныеСпособыТочекУчетаГраницы
	|		ПО ОбщиеДанные.КлючПомещения = НаборэнргРасчетныеСпособыТочекУчетаГраницы.КлючПомещения
	|			И (ВЫБОР
	|				КОГДА ОбщиеДанные.НачПер = ОбщиеДанные.КонПер
	|					ТОГДА ОбщиеДанные.ДокРегистратор = НаборэнргРасчетныеСпособыТочекУчетаГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргРасчетныеСпособыТочекУчетаГраницы.ПериодС <= ОбщиеДанные.НачПер
	|						И НаборэнргРасчетныеСпособыТочекУчетаГраницы.ПериодПо >= ОбщиеДанные.КонПер
	|			КОНЕЦ)
	|			И ОбщиеДанные.ТочкаУчета = НаборэнргРасчетныеСпособыТочекУчетаГраницы.ТочкаУчета
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргФормулыРасчетаТочекУчетаГраницы КАК НаборэнргФормулыРасчетаТочекУчетаГраницы
	|		ПО (ВЫБОР
	|				КОГДА ОбщиеДанные.НачПер = ОбщиеДанные.КонПер
	|					ТОГДА ОбщиеДанные.ДокРегистратор = НаборэнргФормулыРасчетаТочекУчетаГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргФормулыРасчетаТочекУчетаГраницы.ПериодС <= ОбщиеДанные.НачПер
	|						И НаборэнргФормулыРасчетаТочекУчетаГраницы.ПериодПо >= ОбщиеДанные.КонПер
	|			КОНЕЦ)
	|			И ОбщиеДанные.ТочкаУчета = НаборэнргФормулыРасчетаТочекУчетаГраницы.ТочкаИсточник
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргНаправлениеИспользованияТочекУчетаГраницы КАК НаборэнргНаправлениеИспользованияТочекУчетаГраницы
	|		ПО ОбщиеДанные.КлючПомещения = НаборэнргНаправлениеИспользованияТочекУчетаГраницы.КлючПомещения
	|			И (ВЫБОР
	|				КОГДА ОбщиеДанные.НачПер = ОбщиеДанные.КонПер
	|					ТОГДА ОбщиеДанные.ДокРегистратор = НаборэнргНаправлениеИспользованияТочекУчетаГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргНаправлениеИспользованияТочекУчетаГраницы.ПериодС <= ОбщиеДанные.НачПер
	|						И НаборэнргНаправлениеИспользованияТочекУчетаГраницы.ПериодПо >= ОбщиеДанные.КонПер
	|			КОНЕЦ)
	|			И ОбщиеДанные.ТочкаУчета = НаборэнргНаправлениеИспользованияТочекУчетаГраницы.ТочкаУчета
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргДиаметрСеченияТочекУчетаГраницы КАК НаборэнргДиаметрСеченияТочекУчетаГраницы
	|		ПО ОбщиеДанные.КлючПомещения = НаборэнргДиаметрСеченияТочекУчетаГраницы.КлючПомещения
	|			И (ВЫБОР
	|				КОГДА ОбщиеДанные.НачПер = ОбщиеДанные.КонПер
	|					ТОГДА ОбщиеДанные.ДокРегистратор = НаборэнргДиаметрСеченияТочекУчетаГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргДиаметрСеченияТочекУчетаГраницы.ПериодС <= ОбщиеДанные.НачПер
	|						И НаборэнргДиаметрСеченияТочекУчетаГраницы.ПериодПо >= ОбщиеДанные.КонПер
	|			КОНЕЦ)
	|			И ОбщиеДанные.ТочкаУчета = НаборэнргДиаметрСеченияТочекУчетаГраницы.ТочкаУчета	
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргТехническаяВозможностьУстановкиПУГраницы КАК НаборэнргТехническаяВозможностьУстановкиПУГраницы
	|		ПО ОбщиеДанные.КлючПомещения = НаборэнргТехническаяВозможностьУстановкиПУГраницы.КлючПомещения
	|			И (ВЫБОР
	|				КОГДА ОбщиеДанные.НачПер = ОбщиеДанные.КонПер
	|					ТОГДА ОбщиеДанные.ДокРегистратор = НаборэнргТехническаяВозможностьУстановкиПУГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргТехническаяВозможностьУстановкиПУГраницы.ПериодС <= ОбщиеДанные.НачПер
	|						И НаборэнргТехническаяВозможностьУстановкиПУГраницы.ПериодПо >= ОбщиеДанные.КонПер
	|			КОНЕЦ)
	|			И ОбщиеДанные.ТочкаУчета = НаборэнргТехническаяВозможностьУстановкиПУГраницы.ТочкаУчета	
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргРодительТочкиУчетаГраницы КАК НаборэнргРодительТочкиУчетаГраницы
	|		ПО ОбщиеДанные.КлючПомещения = НаборэнргРодительТочкиУчетаГраницы.КлючПомещения
	|			И (ВЫБОР
	|				КОГДА ОбщиеДанные.НачПер = ОбщиеДанные.КонПер
	|					ТОГДА ОбщиеДанные.ДокРегистратор = НаборэнргРодительТочкиУчетаГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргРодительТочкиУчетаГраницы.ПериодС <= ОбщиеДанные.НачПер
	|						И НаборэнргРодительТочкиУчетаГраницы.ПериодПо >= ОбщиеДанные.КонПер
	|			КОНЕЦ)
	|			И ОбщиеДанные.ТочкаУчета = НаборэнргРодительТочкиУчетаГраницы.ТочкаУчета	
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеПриборовУчета.Организация КАК Организация,
	|	ДанныеПриборовУчета.ПериодНачисления КАК ПериодНачисления,
	|	ДанныеПриборовУчета.Район КАК Район,
	|	ДанныеПриборовУчета.КлючПомещения КАК КлючПомещения,
	|	ДанныеПриборовУчета.ЧастныйСектор КАК ЧастныйСектор,
	|	ДанныеПриборовУчета.Строение КАК Строение,
	|	ДанныеПриборовУчета.Помещение КАК Помещение,
	|	ДанныеПриборовУчета.Абонент КАК Абонент,
	|	ДанныеПриборовУчета.ДнейВПериоде КАК ДнейВПериоде,
	|	ДанныеПриборовУчета.ПериодРегистрации КАК ПериодРегистрации,
	|	ДанныеПриборовУчета.НачПер КАК НачПер,
	|	ДанныеПриборовУчета.КонПер КАК КонПер,
	|	ДанныеПриборовУчета.ДокРегистратор КАК ДокРегистратор,
	|	ДанныеПриборовУчета.НачалоОП КАК НачалоОП,
	|	ДанныеПриборовУчета.ЗавершениеОП КАК ЗавершениеОП,
	|	ДанныеПриборовУчета.ТочкаУчета КАК ТочкаУчета,
	|	ДанныеПриборовУчета.СостояниеЛС КАК СостояниеЛС,
	|	ДанныеПриборовУчета.УслугаПодключена КАК УслугаПодключена,	
	|	ДанныеПриборовУчета.КоличествоКомнат КАК КоличествоКомнат,
	|	ДанныеПриборовУчета.КоличествоПрописанных КАК КоличествоПрописанных,
	|	ДанныеПриборовУчета.КоличествоСобственников КАК КоличествоСобственников,
	|	ДанныеПриборовУчета.ВидСобственности КАК ВидСобственности,
	|	ДанныеПриборовУчета.КоличествоПроживающих КАК КоличествоПроживающих,
	|	ДанныеПриборовУчета.ПриборУчета КАК ПриборУчета,
	|	ДанныеПриборовУчета.РасчетПоФормуле КАК РасчетПоФормуле,
	|	ДанныеПриборовУчета.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|	ДанныеПриборовУчета.КоэффициентФормула КАК КоэффициентФормула,
	|	ДанныеПриборовУчета.ИспользоватьДиаметрСечения КАК ИспользоватьДиаметрСечения,
	|	ДанныеПриборовУчета.ДиаметрСечения КАК ДиаметрСечения,
	|	ДанныеПриборовУчета.Техническая КАК Техническая,
	|	ДанныеПриборовУчета.НетВозможностьУстановкиПУ КАК НетВозможностьУстановкиПУ,
	|	ДанныеПриборовУчета.РасчетТолькоПоПоказаниям КАК РасчетТолькоПоПоказаниям,
	|	ДанныеПриборовУчета.ТочкаУчетаРодитель,
	|	ДанныеПриборовУчета.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	ЕСТЬNULL(энргВидыУслугСоставляющиеУслуг.Услуга, ДанныеПриборовУчета.Услуга) КАК Услуга,
	|	ВЫБОР
	|		КОГДА НаборэнргСостояниеПриборовУчетаАбонентаГраницы.Состояние ЕСТЬ NULL
	|			ТОГДА ЛОЖЬ
	|		КОГДА НаборэнргСостояниеПриборовУчетаАбонентаГраницы.Состояние = ЗНАЧЕНИЕ(Перечисление.энргСостояниеПриборовУчета.Вывод)
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ ИСТИНА
	|	КОНЕЦ КАК ПриборВведен,
	|	ЕСТЬNULL(НаборэнргКоэффциентыПриборовУчетаГраницы.Коэффициент, 0) КАК КоэффициентПУ,
	|	НаборэнргСостояниеПриборовУчетаАбонентаГраницы.ПериодС КАК ДатаСостоянияПрибора,	
	|	ЕСТЬNULL(НаборэнргДатыПоверкиПрибораУчетаГраницы.ДатаПоверки, ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаПоверки,	
	|	ЕСТЬNULL(энргВидыУслугСоставляющиеУслуг.Ссылка, ЗНАЧЕНИЕ(Справочник.энргВидыУслуг.ПустаяСсылка)) КАК СоставнаяУслуга,
	// Вимание
	|	ЛОЖЬ КАК ОтключатьВНеполивнойСезон
	|ПОМЕСТИТЬ ВсеСведения
	|ИЗ
	|	ДанныеПриборовУчета КАК ДанныеПриборовУчета
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргСостояниеПриборовУчетаАбонентаГраницы КАК НаборэнргСостояниеПриборовУчетаАбонентаГраницы
	|		ПО (ВЫБОР
	|				КОГДА ДанныеПриборовУчета.НачПер = ДанныеПриборовУчета.КонПер
	|					ТОГДА ДанныеПриборовУчета.ДокРегистратор = НаборэнргСостояниеПриборовУчетаАбонентаГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргСостояниеПриборовУчетаАбонентаГраницы.ПериодС <= ДанныеПриборовУчета.НачПер
	|						И НаборэнргСостояниеПриборовУчетаАбонентаГраницы.ПериодПо >= ДанныеПриборовУчета.КонПер
	|			КОНЕЦ)
	|			И ДанныеПриборовУчета.ТочкаУчета = НаборэнргСостояниеПриборовУчетаАбонентаГраницы.ТочкаУчета
	|			И ДанныеПриборовУчета.ПриборУчета = НаборэнргСостояниеПриборовУчетаАбонентаГраницы.ПриборУчета
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргКоэффциентыПриборовУчетаГраницы КАК НаборэнргКоэффциентыПриборовУчетаГраницы
	|		ПО (ВЫБОР
	|				КОГДА ДанныеПриборовУчета.НачПер = ДанныеПриборовУчета.КонПер
	|					ТОГДА ДанныеПриборовУчета.ДокРегистратор = НаборэнргКоэффциентыПриборовУчетаГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргКоэффциентыПриборовУчетаГраницы.ПериодС <= ДанныеПриборовУчета.НачПер
	|						И НаборэнргКоэффциентыПриборовУчетаГраницы.ПериодПо >= ДанныеПриборовУчета.КонПер
	|			КОНЕЦ)
	|			И ДанныеПриборовУчета.ПриборУчета = НаборэнргКоэффциентыПриборовУчетаГраницы.ПриборУчета
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.энргВидыУслуг.СоставляющиеУслуг КАК энргВидыУслугСоставляющиеУслуг
	|		ПО ДанныеПриборовУчета.Услуга = энргВидыУслугСоставляющиеУслуг.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргДатыПоверкиПрибораУчетаГраницы КАК НаборэнргДатыПоверкиПрибораУчетаГраницы
	|		ПО (ВЫБОР
	|				КОГДА ДанныеПриборовУчета.НачПер = ДанныеПриборовУчета.КонПер
	|					ТОГДА ДанныеПриборовУчета.ДокРегистратор = НаборэнргДатыПоверкиПрибораУчетаГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргДатыПоверкиПрибораУчетаГраницы.ПериодС <= ДанныеПриборовУчета.НачПер
	|						И НаборэнргДатыПоверкиПрибораУчетаГраницы.ПериодПо >= ДанныеПриборовУчета.КонПер
	|			КОНЕЦ)
	|			И ДанныеПриборовУчета.ПриборУчета = НаборэнргДатыПоверкиПрибораУчетаГраницы.ПриборУчета
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВсеСведения.Организация КАК Организация,
	|	ВсеСведения.ПериодНачисления КАК ПериодНачисления,
	|	ВсеСведения.Район КАК Район,
	|	ВсеСведения.КлючПомещения КАК КлючПомещения,
	|	ВсеСведения.ЧастныйСектор КАК ЧастныйСектор,
	|	ВсеСведения.Строение КАК Строение,
	|	ВсеСведения.Помещение КАК Помещение,
	|	ВсеСведения.Абонент КАК Абонент,
	|	ВсеСведения.Услуга КАК Услуга,
	|	ВсеСведения.ТочкаУчета КАК ТочкаУчета,
	|	ВсеСведения.ДокРегистратор КАК ДокРегистратор,
	|	ВсеСведения.ПериодРегистрации КАК ПериодРегистрации,
	|	ВсеСведения.НачПер КАК НачПер,
	|	ВсеСведения.КонПер КАК КонПер,
	|	ВсеСведения.НачалоОП КАК НачалоОП,
	|	ВсеСведения.ЗавершениеОП КАК ЗавершениеОП,
	|	ВсеСведения.ДнейВПериоде КАК ДнейВПериоде,
	|	ВсеСведения.СостояниеЛС КАК ЛСОткрыт,
	|	ВсеСведения.УслугаПодключена КАК УслугаПодключена,	
	|	ВсеСведения.ПриборВведен КАК ПриборВведен,
	|	ВсеСведения.ПриборУчета КАК ПриборУчета,
	|	ВсеСведения.ВидСобственности КАК ВидСобственности,
	|	ВсеСведения.ДатаСостоянияПрибора КАК ДатаСостоянияПрибора,
	|	ВсеСведения.КоличествоПрописанных КАК КоличествоПрописанных,
	|	ВсеСведения.КоличествоСобственников КАК КоличествоСобственников,
	|	ВсеСведения.КоличествоПроживающих КАК КоличествоПроживающих,
	|	ВсеСведения.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	ВсеСведения.КоличествоКомнат КАК КоличествоКомнат,
	|	ВсеСведения.РасчетПоФормуле КАК РасчетПоФормуле,
	|	ВсеСведения.КоэффициентПУ КАК КоэффициентПУ,	
	|	ВсеСведения.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|	ВсеСведения.КоэффициентФормула КАК КоэффициентФормула,
	|	ВсеСведения.ОтключатьВНеполивнойСезон КАК ОтключатьВНеполивнойСезон,	
	|	ВсеСведения.ДатаПоверки КАК ДатаПоверки, 	
	|	ВсеСведения.СоставнаяУслуга КАК СоставнаяУслуга,
	|	ВсеСведения.ИспользоватьДиаметрСечения КАК ИспользоватьДиаметрСечения,
	|	ВсеСведения.ДиаметрСечения КАК ДиаметрСечения,
	|	ВсеСведения.Техническая КАК Техническая,
	|	ВсеСведения.НетВозможностьУстановкиПУ КАК НетВозможностьУстановкиПУ,
	|	ВсеСведения.РасчетТолькоПоПоказаниям КАК РасчетТолькоПоПоказаниям,
	|	ВсеСведения.ТочкаУчетаРодитель,
	|	ВЫБОР
	|		КОГДА НЕ СпособыРасчетаПоНаправлениям.ВидПлощади ЕСТЬ NULL
	|			ТОГДА СпособыРасчетаПоНаправлениям.ВидПлощади
	|		КОГДА энргВидыУслуг.Ссылка ЕСТЬ NULL
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ОбщаяПлощадь)
	|		КОГДА энргВидыУслуг.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ПустаяСсылка)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ОбщаяПлощадь)
	|		ИНАЧЕ энргВидыУслуг.ВидПлощади
	|	КОНЕЦ КАК ВидПлощади,
	|	ЕСТЬNULL(НаборэнргВидБлагоустройствАбонентаГраницы.ВидБлагоустройства, ЗНАЧЕНИЕ(Справочник.энргВидыБлагоустройств.ПустаяСсылка)) КАК ВидБлагоустройства,
	|	ЕСТЬNULL(НаборэнргГруппыПотребителейАбонентовГраницы.ГруппаПотребителей, ЗНАЧЕНИЕ(Справочник.энргГруппыПотребителей.ПустаяСсылка)) КАК ТарифнаяГруппа,
	|	энргСтроения.ГодПостройки КАК ГодПостройки,
	|	энргСтроения.КоличествоЭтажей КАК КоличествоЭтажей,
	|	ЕСТЬNULL(НаборэнргПоставщикиУслугАбонентаГраницы.Поставщик, ЗНАЧЕНИЕ(Справочник.энргКонтрагенты.ПустаяСсылка)) КАК Поставщик
	|ПОМЕСТИТЬ ДанныеНормТарифов
	|ИЗ
	|	ВсеСведения КАК ВсеСведения
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргПоставщикиУслугАбонентаГраницы КАК НаборэнргПоставщикиУслугАбонентаГраницы
	|		ПО ВсеСведения.КлючПомещения = НаборэнргПоставщикиУслугАбонентаГраницы.КлючПомещения
	|			И (НаборэнргПоставщикиУслугАбонентаГраницы.ТочкаУчета = ВсеСведения.ТочкаУчета)
	|			И (НаборэнргПоставщикиУслугАбонентаГраницы.Услуга = ВсеСведения.Услуга)
	|			И (ВЫБОР
	|				КОГДА ВсеСведения.НачПер = ВсеСведения.КонПер
	|					ТОГДА ВсеСведения.ДокРегистратор = НаборэнргПоставщикиУслугАбонентаГраницы.ДокРегистратор
	|				ИНАЧЕ ВсеСведения.НачПер >= НаборэнргПоставщикиУслугАбонентаГраницы.ПериодС
	|						И ВсеСведения.КонПер <= НаборэнргПоставщикиУслугАбонентаГраницы.ПериодПо
	|			КОНЕЦ)
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргВидБлагоустройствАбонентаГраницы КАК НаборэнргВидБлагоустройствАбонентаГраницы
	|		ПО ВсеСведения.КлючПомещения = НаборэнргВидБлагоустройствАбонентаГраницы.КлючПомещения
	|			И (НаборэнргВидБлагоустройствАбонентаГраницы.Услуга = ВсеСведения.Услуга)
	|			И (ВЫБОР
	|				КОГДА ВсеСведения.НачПер = ВсеСведения.КонПер
	|					ТОГДА ВсеСведения.ДокРегистратор = НаборэнргВидБлагоустройствАбонентаГраницы.ДокРегистратор
	|				ИНАЧЕ ВсеСведения.НачПер >= НаборэнргВидБлагоустройствАбонентаГраницы.ПериодС
	|						И ВсеСведения.КонПер <= НаборэнргВидБлагоустройствАбонентаГраницы.ПериодПо
	|			КОНЕЦ)
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргГруппыПотребителейАбонентовГраницы КАК НаборэнргГруппыПотребителейАбонентовГраницы
	|		ПО ВсеСведения.КлючПомещения = НаборэнргГруппыПотребителейАбонентовГраницы.КлючПомещения
	|			И (НаборэнргГруппыПотребителейАбонентовГраницы.Услуга = ВсеСведения.Услуга)
	|			И (ВЫБОР
	|				КОГДА ВсеСведения.НачПер = ВсеСведения.КонПер
	|					ТОГДА ВсеСведения.ДокРегистратор = НаборэнргГруппыПотребителейАбонентовГраницы.ДокРегистратор
	|				ИНАЧЕ ВсеСведения.НачПер >= НаборэнргГруппыПотребителейАбонентовГраницы.ПериодС
	|						И ВсеСведения.КонПер <= НаборэнргГруппыПотребителейАбонентовГраницы.ПериодПо
	|			КОНЕЦ)
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.энргВидыУслуг КАК энргВидыУслуг
	|		ПО ВсеСведения.Услуга = энргВидыУслуг.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.энргАбоненты КАК энргАбоненты
	|		ПО ВсеСведения.Абонент = энргАбоненты.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.энргСтроения КАК энргСтроения
	|		ПО ВсеСведения.Строение = энргСтроения.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.энргСпособыРасчетаПоНаправлениям.СрезПоследних(&НачалоПериода, ) КАК СпособыРасчетаПоНаправлениям
	|		ПО ВсеСведения.Услуга = СпособыРасчетаПоНаправлениям.Услуга
	|			И ВсеСведения.НаправлениеИспользованияТУ = СпособыРасчетаПоНаправлениям.НаправлениеИспользованияТУ
	|			И (СпособыРасчетаПоНаправлениям.Организация = &Организация)
	|			И (СпособыРасчетаПоНаправлениям.Район = &Район)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеНормТарифов.Организация КАК Организация,
	|	ДанныеНормТарифов.ПериодНачисления КАК ПериодНачисления,
	|	ДанныеНормТарифов.Район КАК Район,
	|	ДанныеНормТарифов.КлючПомещения КАК КлючПомещения,
	|	ДанныеНормТарифов.ЧастныйСектор КАК ЧастныйСектор,
	|	ДанныеНормТарифов.Строение КАК Строение,
	|	ДанныеНормТарифов.Помещение КАК Помещение,
	|	ДанныеНормТарифов.Абонент КАК Абонент,
	|	ДанныеНормТарифов.Услуга КАК Услуга,
	|	ДанныеНормТарифов.ТочкаУчета КАК ТочкаУчета,
	|	ДанныеНормТарифов.ДокРегистратор КАК ДокРегистратор,
	|	ДанныеНормТарифов.ПериодРегистрации КАК ПериодРегистрации,
	|	ДанныеНормТарифов.НачПер КАК НачПер,
	|	ДанныеНормТарифов.КонПер КАК КонПер,
	|	ДанныеНормТарифов.НачалоОП КАК НачалоОП,
	|	ДанныеНормТарифов.ЗавершениеОП КАК ЗавершениеОП,
	|	ДанныеНормТарифов.ДнейВПериоде КАК ДнейВПериоде,
	|	ДанныеНормТарифов.ЛСОткрыт КАК ЛСОткрыт,
	|	ДанныеНормТарифов.УслугаПодключена КАК УслугаПодключена,
	|	ДанныеНормТарифов.ВидБлагоустройства КАК ВидБлагоустройства,
	|	ДанныеНормТарифов.ТарифнаяГруппа КАК ТарифнаяГруппа,
	|	ДанныеНормТарифов.ПриборВведен КАК ПриборВведен,
	|	ДанныеНормТарифов.ПриборУчета КАК ПриборУчета,
	|	ДанныеНормТарифов.ДатаСостоянияПрибора КАК ДатаСостоянияПрибора,
	|	ДанныеНормТарифов.КоличествоПрописанных КАК КоличествоПрописанных,
	|	ДанныеНормТарифов.КоличествоСобственников КАК КоличествоСобственников,
	|	ДанныеНормТарифов.ВидСобственности КАК ВидСобственности,
	|	ДанныеНормТарифов.КоличествоПроживающих КАК КоличествоПроживающих,
	|	ДанныеНормТарифов.КоличествоКомнат КАК КоличествоКомнат,
	|	ДанныеНормТарифов.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ, 	
	|	ДанныеНормТарифов.КоэффициентПУ КАК КоэффициентПУ,
	|	ДанныеНормТарифов.РасчетПоФормуле КАК РасчетПоФормуле,
	|	ДанныеНормТарифов.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|	ДанныеНормТарифов.КоэффициентФормула КАК КоэффициентФормула,
	|	ДанныеНормТарифов.ОтключатьВНеполивнойСезон КАК ОтключатьВНеполивнойСезон,
	|	ДанныеНормТарифов.ДатаПоверки КАК ДатаПоверки,
	|	ДанныеНормТарифов.Поставщик КАК Поставщик,
	|	ДанныеНормТарифов.СоставнаяУслуга КАК СоставнаяУслуга,
	|	ДанныеНормТарифов.ИспользоватьДиаметрСечения КАК ИспользоватьДиаметрСечения,
	|	ДанныеНормТарифов.ДиаметрСечения КАК ДиаметрСечения,
	|	ДанныеНормТарифов.Техническая КАК Техническая,
	|	ДанныеНормТарифов.НетВозможностьУстановкиПУ КАК НетВозможностьУстановкиПУ,
	|	ДанныеНормТарифов.РасчетТолькоПоПоказаниям КАК РасчетТолькоПоПоказаниям,
	|	ДанныеНормТарифов.ТочкаУчетаРодитель,
	|	ЕСТЬNULL(НаборэнргЗначенияПлощадейГраницы.Площадь, 0) КАК ЗначениеПлощади,
	// Вимание
	|	0 КАК ГодПостройки,
	|	0 КАК КоличествоЭтажей
	|ПОМЕСТИТЬ ВсеПараметрыРасчетаБезНомера
	|ИЗ
	|	ДанныеНормТарифов КАК ДанныеНормТарифов
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргЗначенияПлощадейГраницы КАК НаборэнргЗначенияПлощадейГраницы
	|		ПО ДанныеНормТарифов.КлючПомещения = НаборэнргЗначенияПлощадейГраницы.КлючПомещения
	|			И (ВЫБОР
	|				КОГДА ДанныеНормТарифов.НачПер = ДанныеНормТарифов.КонПер
	|					ТОГДА ДанныеНормТарифов.ДокРегистратор = НаборэнргЗначенияПлощадейГраницы.ДокРегистратор
	|				ИНАЧЕ ДанныеНормТарифов.НачПер >= НаборэнргЗначенияПлощадейГраницы.ПериодС
	|						И ДанныеНормТарифов.КонПер <= НаборэнргЗначенияПлощадейГраницы.ПериодПо
	|			КОНЕЦ)
	|			И ДанныеНормТарифов.ВидПлощади = НаборэнргЗначенияПлощадейГраницы.ВидПлощади
	|ГДЕ
	|	НЕ ДанныеНормТарифов.Услуга ЕСТЬ NULL
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СтабильныеПериодыБезНомераНачало.Организация КАК Организация,
	|	СтабильныеПериодыБезНомераНачало.ПериодНачисления КАК ПериодНачисления,
	|	СтабильныеПериодыБезНомераНачало.Район КАК Район,
	|	СтабильныеПериодыБезНомераНачало.КлючПомещения КАК КлючПомещения,
	|	СтабильныеПериодыБезНомераНачало.ЧастныйСектор КАК ЧастныйСектор,
	|	СтабильныеПериодыБезНомераНачало.Строение КАК Строение,
	|	СтабильныеПериодыБезНомераНачало.Помещение КАК Помещение,
	|	СтабильныеПериодыБезНомераНачало.Абонент КАК Абонент,
	|	СтабильныеПериодыБезНомераНачало.Услуга КАК Услуга,
	|	СтабильныеПериодыБезНомераНачало.ТочкаУчета КАК ТочкаУчета,
	|	СтабильныеПериодыБезНомераНачало.ПериодРегистрации КАК ПериодРегистрации,
	|	СтабильныеПериодыБезНомераНачало.НачПер КАК НачПер,
	|	СтабильныеПериодыБезНомераНачало.КонПер КАК КонПер,
	|	СтабильныеПериодыБезНомераНачало.ДокРегистратор КАК ДокРегистратор,
	|	СтабильныеПериодыБезНомераНачало.НачПер КАК ДатаРегистратора,
	|	СтабильныеПериодыБезНомераНачало.НачалоОП КАК НачалоОП,
	|	СтабильныеПериодыБезНомераНачало.ЗавершениеОП КАК ЗавершениеОП,
	|	СтабильныеПериодыБезНомераНачало.ДнейВПериоде КАК ДнейВПериоде,
	|	СтабильныеПериодыБезНомераНачало.ЛСОткрыт КАК ЛСОткрыт,
	|	СтабильныеПериодыБезНомераНачало.УслугаПодключена КАК УслугаПодключена,
	|	СтабильныеПериодыБезНомераНачало.ВидБлагоустройства КАК ВидБлагоустройства,
	|	СтабильныеПериодыБезНомераНачало.ТарифнаяГруппа КАК ТарифнаяГруппа,
	|	СтабильныеПериодыБезНомераНачало.ПриборВведен КАК ПриборВведен,
	|	СтабильныеПериодыБезНомераНачало.ПриборУчета КАК ПриборУчета,
	|	СтабильныеПериодыБезНомераНачало.ДатаСостоянияПрибора КАК ДатаСостоянияПрибора,
	|	СтабильныеПериодыБезНомераНачало.КоличествоПрописанных КАК КоличествоПрописанных,
	|	СтабильныеПериодыБезНомераНачало.КоличествоСобственников КАК КоличествоСобственников,
	|	СтабильныеПериодыБезНомераНачало.КоличествоПроживающих КАК КоличествоПроживающих,
	|	СтабильныеПериодыБезНомераНачало.КоличествоКомнат КАК КоличествоКомнат,
	|	СтабильныеПериодыБезНомераНачало.ЗначениеПлощади КАК ЗначениеПлощади,
	|	СтабильныеПериодыБезНомераНачало.КоэффициентПУ КАК КоэффициентПУ,
	|	СтабильныеПериодыБезНомераНачало.РасчетПоФормуле КАК РасчетПоФормуле,
	|	СтабильныеПериодыБезНомераНачало.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|	СтабильныеПериодыБезНомераНачало.КоэффициентФормула КАК КоэффициентФормула,
	|	СтабильныеПериодыБезНомераНачало.ОтключатьВНеполивнойСезон КАК ОтключатьВНеполивнойСезон,
	|	СтабильныеПериодыБезНомераНачало.ДатаПоверки КАК ДатаПоверки,
	|	СтабильныеПериодыБезНомераНачало.Поставщик КАК Поставщик,
	|	СтабильныеПериодыБезНомераНачало.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	СтабильныеПериодыБезНомераНачало.СоставнаяУслуга КАК СоставнаяУслуга,
	|	СтабильныеПериодыБезНомераНачало.ИспользоватьДиаметрСечения КАК ИспользоватьДиаметрСечения,
	|	СтабильныеПериодыБезНомераНачало.ДиаметрСечения КАК ДиаметрСечения,
	|	СтабильныеПериодыБезНомераНачало.Техническая КАК Техническая,
	|	СтабильныеПериодыБезНомераНачало.ВидСобственности КАК ВидСобственности,
	|	СтабильныеПериодыБезНомераНачало.ГодПостройки КАК ГодПостройки,
	|	СтабильныеПериодыБезНомераНачало.КоличествоЭтажей КАК КоличествоЭтажей,
	|	СтабильныеПериодыБезНомераНачало.НетВозможностьУстановкиПУ КАК НетВозможностьУстановкиПУ,
	|	СтабильныеПериодыБезНомераНачало.РасчетТолькоПоПоказаниям КАК РасчетТолькоПоПоказаниям,
	|	СтабильныеПериодыБезНомераНачало.ТочкаУчетаРодитель,
	|	ЗНАЧЕНИЕ(Справочник.энргШкалыПриборовУчета.ПустаяСсылка) КАК Шкала,
	|	СУММА(ВЫБОР
	|			КОГДА СтабильныеПериодыБезНомераКонец.ПериодНачисления ЕСТЬ NULL
	|				ТОГДА 0
	|			ИНАЧЕ 1
	|		КОНЕЦ) КАК НомерПозиции,
	|	&МКД КАК МКД,
	// Внимание
	|	0 КАК КоличествоЖильцов,
	|	ЗНАЧЕНИЕ(Перечисление.энргСпособыРаспределенияОбъема.ПустаяСсылка) КАК СпособРаспределенияОбъемаПомещения,
	|	0 КАК ФиксированныйОбъемПотребления,
	|	0 КАК ДоляПотребленияЧислитель,
	|	1 КАК ДоляПотребленияЗнаменатель,
	|	1 КАК КоэффициентРаспределенияОстатка,
	|	ЛОЖЬ КАК ЯвляетсяПомещениемСРазделеннымиЛС,
	|	ЛОЖЬ КАК БлокировочныйАкт,
	|	"""" КАК СоставЖильцов	
	|ПОМЕСТИТЬ ВсеПараметрыРасчета
	|ИЗ
	|	ВсеПараметрыРасчетаБезНомера КАК СтабильныеПериодыБезНомераНачало
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВсеПараметрыРасчетаБезНомера КАК СтабильныеПериодыБезНомераКонец
	|		ПО СтабильныеПериодыБезНомераНачало.Организация = СтабильныеПериодыБезНомераКонец.Организация
	|			И СтабильныеПериодыБезНомераНачало.ПериодНачисления = СтабильныеПериодыБезНомераКонец.ПериодНачисления
	|			И СтабильныеПериодыБезНомераНачало.Район = СтабильныеПериодыБезНомераКонец.Район
	|			И СтабильныеПериодыБезНомераНачало.ЧастныйСектор = СтабильныеПериодыБезНомераКонец.ЧастныйСектор
	|			И СтабильныеПериодыБезНомераНачало.Строение = СтабильныеПериодыБезНомераКонец.Строение
	|			И СтабильныеПериодыБезНомераНачало.Помещение = СтабильныеПериодыБезНомераКонец.Помещение
	|			И СтабильныеПериодыБезНомераНачало.Услуга = СтабильныеПериодыБезНомераКонец.Услуга
	|			И СтабильныеПериодыБезНомераНачало.ТочкаУчета = СтабильныеПериодыБезНомераКонец.ТочкаУчета
	|			И (ВЫБОР
	|				КОГДА СтабильныеПериодыБезНомераНачало.ПериодРегистрации = СтабильныеПериодыБезНомераКонец.ПериодРегистрации
	|					ТОГДА СтабильныеПериодыБезНомераНачало.ДокРегистратор > СтабильныеПериодыБезНомераКонец.ДокРегистратор
	|				ИНАЧЕ СтабильныеПериодыБезНомераНачало.ПериодРегистрации > СтабильныеПериодыБезНомераКонец.ПериодРегистрации
	|			КОНЕЦ)
	|
	|СГРУППИРОВАТЬ ПО
	|	СтабильныеПериодыБезНомераНачало.Организация,
	|	СтабильныеПериодыБезНомераНачало.ПериодНачисления,
	|	СтабильныеПериодыБезНомераНачало.Район,
	|	СтабильныеПериодыБезНомераНачало.КлючПомещения,
	|	СтабильныеПериодыБезНомераНачало.ЧастныйСектор,
	|	СтабильныеПериодыБезНомераНачало.Строение,
	|	СтабильныеПериодыБезНомераНачало.Помещение,
	|	СтабильныеПериодыБезНомераНачало.Абонент,
	|	СтабильныеПериодыБезНомераНачало.Услуга,
	|	СтабильныеПериодыБезНомераНачало.ТочкаУчета,
	|	СтабильныеПериодыБезНомераНачало.ДнейВПериоде,
	|	СтабильныеПериодыБезНомераНачало.ДокРегистратор,
	|	СтабильныеПериодыБезНомераНачало.НачалоОП,
	|	СтабильныеПериодыБезНомераНачало.ЗавершениеОП,
	|	СтабильныеПериодыБезНомераНачало.ЛСОткрыт,
	|	СтабильныеПериодыБезНомераНачало.УслугаПодключена,
	|	СтабильныеПериодыБезНомераНачало.ВидБлагоустройства,
	|	СтабильныеПериодыБезНомераНачало.ТарифнаяГруппа,
	|	СтабильныеПериодыБезНомераНачало.ПриборВведен,
	|	СтабильныеПериодыБезНомераНачало.ПриборУчета,
	|	СтабильныеПериодыБезНомераНачало.ДатаСостоянияПрибора,
	|	СтабильныеПериодыБезНомераНачало.КоличествоПрописанных,
	|	СтабильныеПериодыБезНомераНачало.КоличествоСобственников,
	|	СтабильныеПериодыБезНомераНачало.КоличествоПроживающих,
	|	СтабильныеПериодыБезНомераНачало.КоличествоКомнат,
	|	СтабильныеПериодыБезНомераНачало.ЗначениеПлощади,
	|	СтабильныеПериодыБезНомераНачало.КоэффициентПУ,
	|	СтабильныеПериодыБезНомераНачало.РасчетПоФормуле,
	|	СтабильныеПериодыБезНомераНачало.ЗависимаяТочкаУчета,
	|	СтабильныеПериодыБезНомераНачало.КоэффициентФормула,
	|	СтабильныеПериодыБезНомераНачало.ОтключатьВНеполивнойСезон,
	|	СтабильныеПериодыБезНомераНачало.ДатаПоверки,
	|	СтабильныеПериодыБезНомераНачало.Поставщик,
	|	СтабильныеПериодыБезНомераНачало.НаправлениеИспользованияТУ,
	|	СтабильныеПериодыБезНомераНачало.СоставнаяУслуга,
	|	СтабильныеПериодыБезНомераНачало.ПериодРегистрации,
	|	СтабильныеПериодыБезНомераНачало.НачПер,
	|	СтабильныеПериодыБезНомераНачало.КонПер,
	|	ВЫБОР
	|		КОГДА СтабильныеПериодыБезНомераНачало.ДокРегистратор ССЫЛКА Документ.энргОперацияСЛицевымСчетом
	|			ТОГДА ИСТИНА
	|		КОГДА СтабильныеПериодыБезНомераНачало.ДокРегистратор ССЫЛКА Документ.энргОперацияСУслугами
	|			ТОГДА ИСТИНА
	|		КОГДА СтабильныеПериодыБезНомераНачало.ДокРегистратор ССЫЛКА Документ.энргОперацияСПриборомУчета
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА СтабильныеПериодыБезНомераНачало.ДокРегистратор ССЫЛКА Документ.энргОперацияСЛицевымСчетом
	|			ТОГДА ИСТИНА
	|		КОГДА СтабильныеПериодыБезНомераНачало.ДокРегистратор ССЫЛКА Документ.энргОперацияСУслугами
	|			ТОГДА ИСТИНА
	|		КОГДА СтабильныеПериодыБезНомераНачало.ДокРегистратор ССЫЛКА Документ.энргОперацияСПриборомУчета
	|			ТОГДА ИСТИНА
	|		КОГДА СтабильныеПериодыБезНомераНачало.ДокРегистратор ССЫЛКА Документ.энргУстановитьФормулуРасчетаТочекУчета
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ,
	|	СтабильныеПериодыБезНомераНачало.ИспользоватьДиаметрСечения,
	|	СтабильныеПериодыБезНомераНачало.ДиаметрСечения,
	|	СтабильныеПериодыБезНомераНачало.Техническая,
	|	СтабильныеПериодыБезНомераНачало.НетВозможностьУстановкиПУ,
	|	СтабильныеПериодыБезНомераНачало.РасчетТолькоПоПоказаниям,
	|	СтабильныеПериодыБезНомераНачало.ВидСобственности,
	|	СтабильныеПериодыБезНомераНачало.ГодПостройки,
	|	СтабильныеПериодыБезНомераНачало.КоличествоЭтажей,
	|	СтабильныеПериодыБезНомераНачало.НачПер,
	|	СтабильныеПериодыБезНомераНачало.ТочкаУчетаРодитель
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	СтабильныеПериодыНачало.Организация КАК Организация,
	|	СтабильныеПериодыНачало.ПериодНачисления КАК ПериодНачисления,
	|	СтабильныеПериодыНачало.Район КАК Район,
	|	СтабильныеПериодыНачало.ЧастныйСектор КАК ЧастныйСектор,
	|	СтабильныеПериодыНачало.Строение КАК Строение,
	|	СтабильныеПериодыНачало.Помещение КАК Помещение,
	|	СтабильныеПериодыНачало.ТочкаУчета КАК ТочкаУчета,
	|	СтабильныеПериодыНачало.НомерПозиции КАК НомерПозиции,
	|	ЕСТЬNULL(НаборэнргВидыДифференцированностиПриборовУчетаГраницы.Шкала, ЗНАЧЕНИЕ(Справочник.энргШкалыПриборовУчета.ПустаяСсылка)) КАК Шкала,
	|	ЕСТЬNULL(НаборэнргВидыДифференцированностиПриборовУчетаГраницы.ВидДифференцированности, ЗНАЧЕНИЕ(Справочник.энргВидыДифференцированности.Однотарифный)) КАК ВидДифференцированности
	|ПОМЕСТИТЬ СтабильныеПериодыШкалы
	|ИЗ
	|	ВсеПараметрыРасчета КАК СтабильныеПериодыНачало
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргВидыДифференцированностиПриборовУчетаГраницы КАК НаборэнргВидыДифференцированностиПриборовУчетаГраницы
	|		ПО СтабильныеПериодыНачало.ПриборУчета = НаборэнргВидыДифференцированностиПриборовУчетаГраницы.ПриборУчета
	|			И (ВЫБОР
	|				КОГДА СтабильныеПериодыНачало.НачПер = СтабильныеПериодыНачало.КонПер
	|					ТОГДА СтабильныеПериодыНачало.ДокРегистратор = НаборэнргВидыДифференцированностиПриборовУчетаГраницы.ДокРегистратор
	|				ИНАЧЕ СтабильныеПериодыНачало.НачПер >= НаборэнргВидыДифференцированностиПриборовУчетаГраницы.ПериодС
	|						И СтабильныеПериодыНачало.КонПер <= НаборэнргВидыДифференцированностиПриборовУчетаГраницы.ПериодПо
	|			КОНЕЦ)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СтабильныеПериодыНачало.Организация КАК Организация,
	|	СтабильныеПериодыНачало.ПериодНачисления КАК ПериодНачисления,
	|	СтабильныеПериодыНачало.Район КАК Район,
	|	СтабильныеПериодыНачало.ЧастныйСектор КАК ЧастныйСектор,
	|	СтабильныеПериодыНачало.Строение КАК Строение,
	|	СтабильныеПериодыНачало.Помещение КАК Помещение,
	|	СтабильныеПериодыНачало.КлючПомещения КАК КлючПомещения,
	|	СтабильныеПериодыНачало.НачПер КАК НачПер,
	|	СтабильныеПериодыНачало.КонПер КАК КонПер,
	|	СтабильныеПериодыНачало.ДокРегистратор КАК ДокРегистратор,
	|	СтабильныеПериодыНачало.Услуга КАК Услуга,
	|	СтабильныеПериодыНачало.ТочкаУчета КАК ТочкаУчета,
	|	СтабильныеПериодыНачало.НомерПозиции КАК НомерПозиции,
	|	СтабильныеПериодыНачало.НачалоОП КАК НачалоОП,
	|	СтабильныеПериодыНачало.ЗавершениеОП КАК ЗавершениеОП,
	|	СтабильныеПериодыНачало.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,	
	|	ЕСТЬNULL(НаборэнргЗначенияИзмерителейТочекУчетаГраницы.НаправлениеИспользованияТУ, ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление)) КАК Измеритель,
	|	ЕСТЬNULL(НаборэнргЗначенияИзмерителейТочекУчетаГраницы.Значение, 0) КАК Количество,
	|	ЗНАЧЕНИЕ(Справочник.энргКлючиНормативов.ПустаяСсылка) КАК КлючНорматива,
	|	ЗНАЧЕНИЕ(Справочник.энргКлючиНормативов.ПустаяСсылка) КАК КлючСоцНорматива
	|ПОМЕСТИТЬ ЗначенияИзмерителейНаправлений
	|ИЗ
	|	ВсеПараметрыРасчета КАК СтабильныеПериодыНачало
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргЗначенияИзмерителейТочекУчетаГраницы КАК НаборэнргЗначенияИзмерителейТочекУчетаГраницы
	|		ПО СтабильныеПериодыНачало.КлючПомещения = НаборэнргЗначенияИзмерителейТочекУчетаГраницы.КлючПомещения
	|			И СтабильныеПериодыНачало.ТочкаУчета = НаборэнргЗначенияИзмерителейТочекУчетаГраницы.ТочкаУчета
	|			И (ВЫБОР
	|				КОГДА СтабильныеПериодыНачало.НачПер = СтабильныеПериодыНачало.КонПер
	|					ТОГДА СтабильныеПериодыНачало.ДокРегистратор = НаборэнргЗначенияИзмерителейТочекУчетаГраницы.ДокРегистратор
	|				ИНАЧЕ СтабильныеПериодыНачало.НачПер >= НаборэнргЗначенияИзмерителейТочекУчетаГраницы.ПериодС
	|						И СтабильныеПериодыНачало.КонПер <= НаборэнргЗначенияИзмерителейТочекУчетаГраницы.ПериодПо
	|			КОНЕЦ)";
	
	
	ИтоговыйТекст = ИтоговыйТекст + 
	"
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|";
	
	ИтоговыйТекст 	= ИтоговыйТекст + Справочники.энргКлючиНормативов.ТекстОпределенияКлючейНормативаПерерасчет(Истина);
	
	ИтоговыйТекст 	= ИтоговыйТекст + 
	"
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|";
	
	ИтоговыйТекст 	= ИтоговыйТекст + 
	"ВЫБРАТЬ
	|	ВсеПараметрыРасчета.*,
	|	ЕСТЬNULL(КлючиНорматива.КлючНорматива,ЗНАЧЕНИЕ(Справочник.энргКлючиНормативов.ПустаяСсылка)) КАК КлючНорматива,
	|	ЕСТЬNULL(КлючиНорматива.КлючСоцНорматива,ЗНАЧЕНИЕ(Справочник.энргКлючиНормативов.ПустаяСсылка)) КАК КлючСоцНорматива
	|ПОМЕСТИТЬ СтабильныеПериодыНачало
	|ИЗ
	|	ВсеПараметрыРасчета КАК ВсеПараметрыРасчета
	|		ЛЕВОЕ СОЕДИНЕНИЕ КлючиНорматива КАК КлючиНорматива
	|		ПО ВсеПараметрыРасчета.ПериодНачисления = КлючиНорматива.ПериодНачисления
	|		И (ВсеПараметрыРасчета.НачалоОП = КлючиНорматива.НачалоОП)
	|		И (ВсеПараметрыРасчета.ЗавершениеОП = КлючиНорматива.ЗавершениеОП)
	|		И (ВсеПараметрыРасчета.НачПер = КлючиНорматива.НачПер)
	|		И (ВсеПараметрыРасчета.КонПер = КлючиНорматива.КонПер)
	|		И (ВсеПараметрыРасчета.ДокРегистратор = КлючиНорматива.ДокРегистратор)	
	|		И (ВсеПараметрыРасчета.Услуга = КлючиНорматива.Услуга)
	|		И (ВсеПараметрыРасчета.НаправлениеИспользованияТУ = КлючиНорматива.НаправлениеИспользованияТУ)
	|		И (КлючиНорматива.Измеритель = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление))
	|;
	|ВЫБРАТЬ
	|	ЗначенияИзмерителейНаправлений.*,
	|	ЕСТЬNULL(КлючиНорматива.КлючНорматива,ЗНАЧЕНИЕ(Справочник.энргКлючиНормативов.ПустаяСсылка)) КАК КлючНорматива,
	|	ЕСТЬNULL(КлючиНорматива.КлючСоцНорматива,ЗНАЧЕНИЕ(Справочник.энргКлючиНормативов.ПустаяСсылка)) КАК КлючСоцНорматива
	|ПОМЕСТИТЬ СтабильныеПериодыИзмерителиНаправлений
	|ИЗ
	|	ЗначенияИзмерителейНаправлений КАК ЗначенияИзмерителейНаправлений
	|		ЛЕВОЕ СОЕДИНЕНИЕ КлючиНорматива КАК КлючиНорматива
	|		ПО ЗначенияИзмерителейНаправлений.ПериодНачисления = КлючиНорматива.ПериодНачисления
	|		И (ЗначенияИзмерителейНаправлений.НачалоОП = КлючиНорматива.НачалоОП)
	|		И (ЗначенияИзмерителейНаправлений.ЗавершениеОП = КлючиНорматива.ЗавершениеОП)
	|		И (ЗначенияИзмерителейНаправлений.НачПер = КлючиНорматива.НачПер)
	|		И (ЗначенияИзмерителейНаправлений.КонПер = КлючиНорматива.КонПер)
	|		И (ЗначенияИзмерителейНаправлений.ДокРегистратор = КлючиНорматива.ДокРегистратор)	
	|		И (ЗначенияИзмерителейНаправлений.Услуга = КлючиНорматива.Услуга)
	|		И (ЗначенияИзмерителейНаправлений.НаправлениеИспользованияТУ = КлючиНорматива.НаправлениеИспользованияТУ)
	|		И (ЗначенияИзмерителейНаправлений.Измеритель = КлючиНорматива.Измеритель)";
	
	Запрос  		= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = МВТ;
	Запрос.УстановитьПараметр("Организация",	Организация);
	Запрос.УстановитьПараметр("Район",			Район);
	Запрос.УстановитьПараметр("КлючиПомещений",	КлючиПомещений);
	Запрос.УстановитьПараметр("Абоненты",		Абоненты);
	//Запрос.УстановитьПараметр("Строение",		ДанныеСтроения.Строение);
	//Запрос.УстановитьПараметр("Помещение",		ДанныеСтроения.Помещение);
	Запрос.УстановитьПараметр("МКД",			Справочники.энргСтроения.ПустаяСсылка());
	//Запрос.УстановитьПараметр("КлючПомещения",	ДанныеСтроения.КлючПомещения);
	Запрос.УстановитьПараметр("НачалоПериода",	НачалоПериодаРасчета);
	Запрос.УстановитьПараметр("КонецПериода",	КонецПериодаРасчета); 
	Запрос.УстановитьПараметр("ТипНачисления",	Перечисления.энргТипыНачислений.ИндивидуальныеНачисления); 
	Запрос.Текст 	= ИтоговыйТекст;
	Запрос.Выполнить();
	
КонецПроцедуры

Функция ПересчитатьИндивидуальныйОбъем(МВТ,Организация,ПериодНачисленияНачало,ПериодНачисленияКонец,НачалоПериодаРасчета,КонецПериодаРасчета,Район,КлючПомещений,Абонент,КорректировкаПоказаний,ПериодНовогоТарифа)
	
	ПрочитатьСтабильныеПериодыПерерасчет(МВТ,Организация, ПериодНачисленияНачало,ПериодНачисленияКонец,НачалоПериодаРасчета,КонецПериодаРасчета,Район,КлючПомещений,Абонент);
	
	ПоказанияПерерасчет(МВТ,Организация, ПериодНачисленияНачало,ПериодНачисленияКонец,Район,КорректировкаПоказаний.выгрузить()); // Вспомогательные данные по показаниям
	
	ВспомогательныеДанныеПерерасчет(МВТ,Организация, ПериодНачисленияНачало,ПериодНачисленияКонец,НачалоПериодаРасчета,КонецПериодаРасчета,Район,Абонент,ПериодНовогоТарифа);
	
	ПолучитьСтабильныеПериоды(МВТ,Истина);
	
	// Рассчитываем индивидульный объем
	ПолучитьДанныеДляРасчета(МВТ,Ложь,Истина,"энргНачисление");
	Возврат РассчитатьИндивидуальныйОбъемПотребления(МВТ);
			
КонецФункции

#КонецОбласти

#Область ДанныеПерерасчетаМКД_ВпомогательныеФункции

Функция ПересчитатьОбъемПотребленияМКД(МВТ,Организация,Район,МКД,ПериодНачисленияНачало,ПериодНачисленияКонец,НачалоПериодаРасчета,КонецПериодаРасчета,КорректировкаПоказаний)
	
	ПрочитатьСтабильныеПериодыПерерасчетМКД(МВТ,Организация,Район,МКД,ПериодНачисленияНачало,ПериодНачисленияКонец,НачалоПериодаРасчета,КонецПериодаРасчета);
	
	ПоказанияПерерасчетМКД(МВТ,Организация, ПериодНачисленияНачало,ПериодНачисленияКонец,Район,МКД,КорректировкаПоказаний.выгрузить()); // Вспомогательные данные по показаниям
	
	ВспомогательныеДанныеПерерасчетМКД(МВТ,Организация, ПериодНачисленияНачало,ПериодНачисленияКонец,НачалоПериодаРасчета,КонецПериодаРасчета,Район,МКД);
	
	ПолучитьСтабильныеПериодыМКД(МВТ,Ложь);
	
	ПолучитьДанныеДляРасчетаМКД(МВТ,"энргНачислениеМКД"); 
	
	Возврат РассчитатьОбъемПотребленияМКД(МВТ);
				
КонецФункции

Процедура ПрочитатьСтабильныеПериодыПерерасчетМКД(МВТ,Организация,Район,МКД,ПериодНачисленияНачало,ПериодНачисленияКонец,НачалоПериодаРасчета,КонецПериодаРасчета)
	
	ТекстГраницОтчетногоПериода = энргНачисления.ТекстГраницОтчетногоПериода(ПериодНачисленияНачало,ПериодНачисленияКонец,Ложь);
	
	Объекты  					= Новый Структура;
	
	Объекты.Вставить("энргАктивностьТочекУчетаМКД",					Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "МКД = (&МКД)", "ТаблицаРС.МКД = (&МКД)", НЕОПРЕДЕЛЕНО,Новый Структура));
	
	Объекты.Вставить("энргВидБлагоустройствМКД",					Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "МКД = (&МКД)", "ТаблицаРС.МКД = (&МКД)", НЕОПРЕДЕЛЕНО,Новый Структура));
	
	Объекты.Вставить("энргВидыДифференцированностиПриборовУчетаМКД", Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "МКД = (&МКД)", "ТаблицаРС.МКД = (&МКД)", НЕОПРЕДЕЛЕНО,Новый Структура));
	
	Объекты.Вставить("энргЗначениеПлощадейМКД", 					Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "МКД = (&МКД)", "ТаблицаРС.МКД = (&МКД)", НЕОПРЕДЕЛЕНО,Новый Структура));
	
	Объекты.Вставить("энргПриборыТочекМКД", 						Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "МКД = (&МКД)", "ТаблицаРС.МКД = (&МКД)", НЕОПРЕДЕЛЕНО,Новый Структура));
	
	Объекты.Вставить("энргПоставщикиУслугМКД", 						Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "МКД = (&МКД)", "ТаблицаРС.МКД = (&МКД)", НЕОПРЕДЕЛЕНО,Новый Структура));
		
	Объекты.Вставить("энргПриборыУзловУчетаМКД", 					Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "МКД = (&МКД)", "ТаблицаРС.МКД = (&МКД)", НЕОПРЕДЕЛЕНО,Новый Структура));
	
	Объекты.Вставить("энргСостояниеМКД",							Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "МКД = (&МКД)", "ТаблицаРС.МКД = (&МКД)", НЕОПРЕДЕЛЕНО,Новый Структура));
	
	//Объекты.Вставить("энргСпособРаспределенияОбъемаМКДНаАбонентов",	Новый Структура("
	//|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "МКД = (&МКД)", "ТаблицаРС.МКД = (&МКД)", НЕОПРЕДЕЛЕНО,Новый Структура));  	
	
	//Объекты.Вставить("энргТипПринадлежностиМКД",					Новый Структура("
	//|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "МКД = (&МКД)", "ТаблицаРС.МКД = (&МКД)", НЕОПРЕДЕЛЕНО ,Новый Структура));
	
	//Объекты.Вставить("энргТипСхемыГВС",								Новый Структура("
	//|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "МКД = (&МКД)", "ТаблицаРС.МКД = (&МКД)", НЕОПРЕДЕЛЕНО ,Новый Структура));
		
	Объекты.Вставить("энргСостояниеПриборовМКД",					Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "МКД = (&МКД)", "ТаблицаРС.МКД = (&МКД)", НЕОПРЕДЕЛЕНО ,Новый Структура));
	
	Объекты.Вставить("энргСостояниеПриборовУзловУчетаМКД",			Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "МКД = (&МКД)", "ТаблицаРС.МКД = (&МКД)", НЕОПРЕДЕЛЕНО ,Новый Структура));
	
	Объекты.Вставить("энргУслугиТочекУчетаМКД",						Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "МКД = (&МКД)", "ТаблицаРС.МКД = (&МКД)", НЕОПРЕДЕЛЕНО ,Новый Структура));
	
	Объекты.Вставить("энргФормулыРасчетаУслугМКД",					Новый Структура("
	|Условие, УсловиеТаблицы, СвойствоТочки, СинонимыПолей", "МКД = (&МКД)", "ТаблицаРС.МКД = (&МКД)", НЕОПРЕДЕЛЕНО ,Новый Структура));
		
	
	ИтоговыйТекст  				= 
	"ВЫБРАТЬ * 
	|ПОМЕСТИТЬ ГраницыОтчетногоПериода
	|ИЗ 
	|	(" + ТекстГраницОтчетногоПериода + ") КАК ВложенныйЗапрос
	|;
	|///////////
	|";
		
	ШаблонНаборПериодов 		= 
	"ВЫБРАТЬ
	|	вТаблица.Регистратор КАК ДокРегистратор,
	|	вТаблица.Период КАК Период, 	
	|	ВЫБОР 
	|		КОГДА вТаблица.ПериодРегистрации > вТаблица.Период
	|			ТОГДА  вТаблица.Период
	|		ИНАЧЕ вТаблица.ПериодРегистрации
	|	КОНЕЦ  КАК ПериодРегистрации,
	|	вТаблица.МКД КАК МКД,
	|	вТаблица.ТочкаУчета КАК ТочкаУчета
	|ИЗ 
	|	Набор%%ИмяТаблицы%%  КАК вТаблица";
	
			
	ШаблонГраницыРС				= 
	"ВЫБРАТЬ
	|	%%СтрокаресурсыИзмеренияГраницы%%
	|   , ТаблицаРС.Регистратор КАК ДокРегистратор
	|   , ТаблицаРС.Период КАК ПериодС
	|	, МИНИМУМ(ЕСТЬNULL(ТаблицаКонец.Период,ДОБАВИТЬКДАТЕ(&КонецПериода,СЕКУНДА,1))) КАК ПериодПо
	|ПОМЕСТИТЬ Набор%%ИмяТаблицы%%Границы
	|ИЗ
	|	Набор%%ИмяТаблицы%% КАК ТаблицаРС
	|		ЛЕВОЕ СОЕДИНЕНИЕ НАбор%%ИмяТаблицы%% КАК ТаблицаКонец
	|		ПО %%СтрокаСоединенения%%
	|		И (ВЫБОР
	|			КОГДА ТаблицаРС.Период < ТаблицаКонец.Период
	|				ТОГДА ИСТИНА
	|			КОГДА ТаблицаРС.Период = ТаблицаКонец.Период
	|					И ТаблицаРС.ПериодРегистрации < ТаблицаКонец.ПериодРегистрации
	|				ТОГДА ИСТИНА
	|			ИНАЧЕ ТаблицаРС.Период = ТаблицаКонец.Период
	|					И ТаблицаРС.ПериодРегистрации = ТаблицаКонец.ПериодРегистрации
	|					И ТаблицаРС.Регистратор < ТаблицаКонец.Регистратор
	|		КОНЕЦ)	
	|СГРУППИРОВАТЬ ПО
	|   %%СтрокаресурсыИзмеренияГраницы%%
	|	,ТаблицаРС.Регистратор
	|	,ТаблицаРС.Период";
	
	ШаблонЗаписиЗаПериод  		=
	"ВЫБРАТЬ
	|	%%СтрокаресурсыИзмерения%%
	|	,&НачалоПериода КАК Период
	|	,ВЫБОР КОГДА ТаблицаРС.ПериодРегистрации < &НачалоПериода Тогда ЗНАЧЕНИЕ(Документ.энргНачисление.ПустаяСсылка) ИНАЧЕ ТаблицаРС.Регистратор КОНЕЦ КАК Регистратор
	|	,ВЫБОР КОГДА ТаблицаРС.ПериодРегистрации < &НачалоПериода Тогда &НачалоПериода ИНАЧЕ ТаблицаРС.ПериодРегистрации КОНЕЦ КАК ПериодРегистрации
	|ПОМЕСТИТЬ Набор%%ИмяТаблицы%%
	|ИЗ
	|	РегистрСведений.%%ИмяТаблицы%%.СрезПоследних(
	|			ДОБАВИТЬКДАТЕ(&НачалоПериода, СЕКУНДА, -1),
	|			Организация = &Организация
	|				И Район = &Район
	|				И %%ДополнительноеУсловие%%) КАК ТаблицаРС
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	%%СтрокаресурсыИзмерения%%
	|	,КОНЕЦПЕРИОДА(ТаблицаРС.Период,ДЕНЬ) КАК Период 
	|	,ТаблицаРС.Регистратор
	|	,ТаблицаРС.ПериодРегистрации
	|ИЗ
	|	РегистрСведений.%%ИмяТаблицы%% КАК ТаблицаРС
	|ГДЕ
	|	ТаблицаРС.Период >= &НачалоПериода
	|	И ТаблицаРС.Период < &КонецПериода
	|	И ТаблицаРС.Организация = &Организация
	|	И ТаблицаРС.Район = &Район
	|	И %%ДополнительноеУсловиеТаблица%%";
	
	ГлавСчетчик									= 0;
	ТекстНаборПериодов 							= "";
	
	для Каждого объект из Объекты цикл
		
		СтрокаСоединения  						= "";
		Метад 									= Метаданные.РегистрыСведений[объект.Ключ]; 
		Измерения  								= Метад.Измерения;
		Ресурсы 								= Метад.Ресурсы; 
		СинонимыПолей 							= объект.Значение.СинонимыПолей;
		ТексПериода 							= "";
		Сч 										= 0;
		ИзмеренияРесурсы  						= "";
		ИзмеренияРесурсыГруппировка				= "";
		ИзмеренияРесурсыГраницы					= "";
		
		СтрокаРесурсов 							= "";
		
		// Измерения		
		для Каждого Измерение из Измерения цикл
			Синоним 					= Измерение.Имя;
			Если СинонимыПолей.Свойство(Измерение.Имя) Тогда
				Синоним 				= СинонимыПолей[Измерение.Имя];
			КонецЕсли;
			
			ИзмеренияРесурсы			= ИзмеренияРесурсы 				+ ?(Сч > 0,Символы.ПС + ",","")  + " ТаблицаРС." +  Измерение.Имя +" КАК " + Синоним + "";
			ИзмеренияРесурсыГраницы		= ИзмеренияРесурсыГраницы 		+ ?(Сч > 0,Символы.ПС + ",","")  + " ТаблицаРС." +  Синоним;			
			ИзмеренияРесурсыГруппировка	= ИзмеренияРесурсыГруппировка 	+ ?(Сч > 0,Символы.ПС + ",","")  + " ТаблицаРС." +  Измерение.Имя;
			СтрокаСоединения 			= СтрокаСоединения 				+ ?(Сч > 0,Символы.ПС + "И ","")  + " %%ТаблицаИсточник%%." +  Синоним +" = %%ТаблицаПриемник%%." + Синоним; 
			Сч 							= Сч + 1;
		КонецЦикла;
		
		//  Ресурсы.
		для Каждого Ресурс из Ресурсы цикл
			Синоним 					= Ресурс.Имя;
			Если СинонимыПолей.Свойство(Ресурс.Имя) Тогда
				Синоним 				= СинонимыПолей[Ресурс.Имя];				
			КонецЕсли;
			ИзмеренияРесурсы			= ИзмеренияРесурсы 				+ Символы.ПС +?(Сч > 0,",","")  + " ТаблицаРС." +  Ресурс.Имя +" КАК " + Синоним + "" ;
			ИзмеренияРесурсыГраницы		= ИзмеренияРесурсыГраницы 		+ Символы.ПС +?(Сч > 0,",","")  + " ТаблицаРС." +  Синоним;
			ИзмеренияРесурсыГруппировка	= ИзмеренияРесурсыГруппировка 	+ Символы.ПС +?(Сч > 0,",","")  + " ТаблицаРС." +  Ресурс.Имя ;
			Сч 							= Сч + 1;
		КонецЦикла; 
		
		Если НЕ объект.Значение.СвойствоТочки = Неопределено Тогда
			ИзмеренияРесурсы			= ИзмеренияРесурсы 	+ Символы.ПС +?(Сч > 0,",","")  + " ТаблицаРС." +  объект.Значение.СвойствоТочки +"";
		КонецЕсли;		
		
		ТексПериода 					= СтрЗаменить(ШаблонЗаписиЗаПериод,	"%%СтрокаресурсыИзмерения%%", 				ИзмеренияРесурсы);
		ТексПериода 					= СтрЗаменить(ТексПериода,			"%%СтрокаресурсыИзмеренияГруппировка%%", 	ИзмеренияРесурсыГруппировка);
		ТексПериода 					= СтрЗаменить(ТексПериода,			"%%ДополнительноеУсловие%%", 				объект.Значение.Условие);
		ТексПериода 					= СтрЗаменить(ТексПериода,			"%%ДополнительноеУсловиеТаблица%%", 		объект.Значение.УсловиеТаблицы);
		ТексПериода 					= СтрЗаменить(ТексПериода,			"%%ИмяТаблицы%%", 							объект.Ключ);
						
		// Сформировать границы регистра.		
		ТексПериода 					= ТексПериода + Символы.ПС + ";" + Символы.ПС + "//////////"+ Символы.ПС;
		
		ГраницыРС 						= ""; 		
		ГраницыРС 						= СтрЗаменить(ШаблонГраницыРС,	"%%СтрокаресурсыИзмеренияГраницы%%",		ИзмеренияРесурсыГраницы);
		ГраницыРС 						= СтрЗаменить(ГраницыРС,		"%%ИмяТаблицы%%",							объект.Ключ);
		ГраницыРС 						= СтрЗаменить(ГраницыРС,		"%%СтрокаСоединенения%%",					СтрокаСоединения);
		ГраницыРС 						= СтрЗаменить(ГраницыРС,		"%%ТаблицаИсточник%%",						"ТаблицаРС");
		ГраницыРС 						= СтрЗаменить(ГраницыРС,		"%%ТаблицаПриемник%%",						"ТаблицаКонец");
		
		ИтоговыйТекст 					= ИтоговыйТекст + ?(ГлавСчетчик>0,Символы.ПС + ";" + Символы.ПС + "//////////"+ Символы.ПС,"")  + ТексПериода;
		
		ИтоговыйТекст 					= ИтоговыйТекст + ГраницыРС;
		
		ВрТекст 						= СтрЗаменить(ШаблонНаборПериодов,"%%ИмяТаблицы%%",объект.Ключ);
		
		Если объект.Значение.СвойствоТочки = Неопределено Тогда
			ВрТекст 					= СтрЗаменить(ВрТекст,"вТаблица.ТочкаУчета КАК ТочкаУчета","НЕОПРЕДЕЛЕНО КАК ТочкаУчета");
		Иначе
			ВрТекст 					= СтрЗаменить(ВрТекст,"вТаблица.ТочкаУчета КАК ТочкаУчета","вТаблица." + объект.Значение.СвойствоТочки + " КАК ТочкаУчета");
		КонецЕсли;
				
		ТекстНаборПериодов  			= ТекстНаборПериодов + ?(ГлавСчетчик>0,Символы.ПС + "ОБЪЕДИНИТЬ ВСЕ" + Символы.ПС ,"")  + ВрТекст;
		
		ГлавСчетчик 					= ГлавСчетчик + 1;				
	КонецЦикла;
	
	ТекстНаборПериодов  				=
	"ВЫБРАТЬ РАЗЛИЧНЫЕ 
	|	ВложенныйЗапрос.ДокРегистратор КАК ДокРегистратор,
	|	ВложенныйЗапрос.Период КАК Период,
	|	ВложенныйЗапрос.ПериодРегистрации,
	|	ВложенныйЗапрос.МКД,
	|	ВложенныйЗапрос.ТочкаУчета
	|ПОМЕСТИТЬ НаборПериодов 
	|ИЗ 
	|	(" + ТекстНаборПериодов + "
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	| 	Значение(Документ.энргНачисление.ПустаяСсылка), 
	| 	ГраницыОтчетногоПериода.НачалоОП,
	| 	ГраницыОтчетногоПериода.НачалоОП,
	| 	НЕОПРЕДЕЛЕНО,
	| 	НЕОПРЕДЕЛЕНО
	|ИЗ
	|	ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	| 	Значение(Документ.энргНачисление.ПустаяСсылка),
	|	ГраницыОтчетногоПериода.ЗавершениеОП,
	|	ГраницыОтчетногоПериода.ЗавершениеОП,
	| 	НЕОПРЕДЕЛЕНО,
	| 	НЕОПРЕДЕЛЕНО
	|ИЗ
	|	ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода) КАК ВложенныйЗапрос";
	
	
	ИтоговыйТекст 				= ИтоговыйТекст + Символы.ПС + ";" + Символы.ПС + "//////////"+ Символы.ПС +ТекстНаборПериодов;
		
	ИтоговыйТекст 				= ИтоговыйТекст + Символы.ПС + ";" + Символы.ПС + 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	НаборэнргАктивностьТочекУчетаМКД.МКД КАК МКД,
	|	НаборэнргАктивностьТочекУчетаМКД.ТочкаУчета КАК ТочкаУчета
	|ПОМЕСТИТЬ ВсеТочкиУчета
	|ИЗ
	|	НаборэнргАктивностьТочекУчетаМКД КАК НаборэнргАктивностьТочекУчетаМКД
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НаборПериодов.ДокРегистратор КАК ДокРегистратор,
	|	НаборПериодов.Период КАК Период,
	|	НаборПериодов.МКД КАК МКД,
	|	НаборПериодов.ТочкаУчета КАК ТочкаУчета,
	|	НаборПериодов.ПериодРегистрации КАК ПериодРегистрации
	|ПОМЕСТИТЬ НаборПериодовТочкиУчета
	|ИЗ
	|	НаборПериодов КАК НаборПериодов
	|ГДЕ
	|	НЕ НаборПериодов.МКД = НЕОПРЕДЕЛЕНО
	|	И НЕ НаборПериодов.ТочкаУчета = НЕОПРЕДЕЛЕНО
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	НаборПериодов.ДокРегистратор,
	|	НаборПериодов.Период,
	|	ВсеТочкиУчета.МКД,
	|	ВсеТочкиУчета.ТочкаУчета,
	|	НаборПериодов.ПериодРегистрации
	|ИЗ
	|	ВсеТочкиУчета КАК ВсеТочкиУчета
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборПериодов КАК НаборПериодов
	|		ПО ВсеТочкиУчета.МКД = НаборПериодов.МКД
	|			И (НаборПериодов.ТочкаУчета = НЕОПРЕДЕЛЕНО)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	НаборПериодов.ДокРегистратор,
	|	НаборПериодов.Период,
	|	ВсеТочкиУчета.МКД,
	|	ВсеТочкиУчета.ТочкаУчета,
	|	НаборПериодов.ПериодРегистрации
	|ИЗ
	|	ВсеТочкиУчета КАК ВсеТочкиУчета
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборПериодов КАК НаборПериодов
	|		ПО (НаборПериодов.МКД = НЕОПРЕДЕЛЕНО)
	|			И (НаборПериодов.ТочкаУчета = НЕОПРЕДЕЛЕНО)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.КлючНорматива КАК КлючНорматива,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	энргЗначенияНормативовПотребления.ЗначениеНорматива КАК ЗначениеНорматива
	|ПОМЕСТИТЬ ЗначенияТекущихНормПотребления
	|ИЗ
	|	(ВЫБРАТЬ
	|		ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|		энргЗначенияНормативовПотребления.Организация КАК Организация,
	|		энргЗначенияНормативовПотребления.Район КАК Район,
	|		энргЗначенияНормативовПотребления.КлючНорматива КАК КлючНорматива,
	|		энргЗначенияНормативовПотребления.Услуга КАК Услуга,
	|		МАКСИМУМ(энргЗначенияНормативовПотребления.Период) КАК Период,
	|		ЛОЖЬ КАК НормативДляИндивидуальных
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначенияНормативовПотребления КАК энргЗначенияНормативовПотребления
	|			ПО ГраницыОтчетногоПериода.Организация = энргЗначенияНормативовПотребления.Организация
	|				И ГраницыОтчетногоПериода.ЗавершениеОП > энргЗначенияНормативовПотребления.Период
	|				И (энргЗначенияНормативовПотребления.Организация = &Организация)
	|				И (энргЗначенияНормативовПотребления.Район = &Район)
	|				И (энргЗначенияНормативовПотребления.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление))
	|				И (энргЗначенияНормативовПотребления.ТипНачисления = ЗНАЧЕНИЕ(Перечисление.энргТипыНачислений.ОбщедомовыеНачисления))
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ГраницыОтчетногоПериода.ПериодНачисления,
	|		энргЗначенияНормативовПотребления.Организация,
	|		энргЗначенияНормативовПотребления.Район,
	|		энргЗначенияНормативовПотребления.КлючНорматива,
	|		энргЗначенияНормативовПотребления.Услуга
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ГраницыОтчетногоПериода.ПериодНачисления,
	|		энргЗначенияНормативовПотребления.Организация,
	|		энргЗначенияНормативовПотребления.Район,
	|		энргЗначенияНормативовПотребления.КлючНорматива,
	|		энргЗначенияНормативовПотребления.Услуга,
	|		МАКСИМУМ(энргЗначенияНормативовПотребления.Период),
	|		ИСТИНА
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначенияНормативовПотребления КАК энргЗначенияНормативовПотребления
	|			ПО ГраницыОтчетногоПериода.Организация = энргЗначенияНормативовПотребления.Организация
	|				И ГраницыОтчетногоПериода.ЗавершениеОП > энргЗначенияНормативовПотребления.Период
	|				И (энргЗначенияНормативовПотребления.Организация = &Организация)
	|				И (энргЗначенияНормативовПотребления.Район = &Район)
	|				И (энргЗначенияНормативовПотребления.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление))
	|				И (энргЗначенияНормативовПотребления.ТипНачисления = ЗНАЧЕНИЕ(Перечисление.энргТипыНачислений.ИндивидуальныеНачисления))
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.энргВидыУслуг КАК энргВидыУслуг
	|			ПО (энргЗначенияНормативовПотребления.Услуга = энргВидыУслуг.Ссылка)
	|				И (энргВидыУслуг.НормативДляИндивидуальных)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ГраницыОтчетногоПериода.ПериодНачисления,
	|		энргЗначенияНормативовПотребления.Организация,
	|		энргЗначенияНормативовПотребления.Район,
	|		энргЗначенияНормативовПотребления.КлючНорматива,
	|		энргЗначенияНормативовПотребления.Услуга) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначенияНормативовПотребления КАК энргЗначенияНормативовПотребления
	|		ПО ВложенныйЗапрос.Организация = энргЗначенияНормативовПотребления.Организация
	|			И ВложенныйЗапрос.Период = энргЗначенияНормативовПотребления.Период
	|			И (энргЗначенияНормативовПотребления.Организация = &Организация)
	|			И (энргЗначенияНормативовПотребления.Район = &Район)
	|			И (энргЗначенияНормативовПотребления.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление))
	|			И (ВЫБОР
	|				КОГДА ВложенныйЗапрос.НормативДляИндивидуальных
	|					ТОГДА ЗНАЧЕНИЕ(Перечисление.энргТипыНачислений.ИндивидуальныеНачисления)
	|				ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.энргТипыНачислений.ОбщедомовыеНачисления)
	|			КОНЕЦ = энргЗначенияНормативовПотребления.ТипНачисления)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.НаправлениеИспользованияТУ КАК НаправлениеИспользования,
	|	ВложенныйЗапрос.МКД КАК Строение,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	НастройкаСезонностиУслуг.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	НастройкаСезонностиУслуг.Коэффициент КАК КоэффициентНорматива,
	|	НастройкаСезонностиУслуг.КоэффициентНеПрименятьСезонность КАК КоэффициентНеПрименятьСезонность,
	|	НастройкаСезонностиУслуг.КорректироватьГодовойОбъем КАК КорректироватьГодовойОбъем,
	|	НастройкаСезонностиУслуг.ОбъемЗаПрошлыйГод КАК ОбъемЗаПрошлыйГод
	|ПОМЕСТИТЬ УслугиНеПрименятьСезонность
	|ИЗ
	|	(ВЫБРАТЬ
	|		НастройкаСезонностиУслуг.Организация КАК Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|		НастройкаСезонностиУслуг.Район КАК Район,
	|		НастройкаСезонностиУслуг.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|		НастройкаСезонностиУслуг.МКД КАК МКД,
	|		НастройкаСезонностиУслуг.Услуга КАК Услуга,
	|		МАКСИМУМ(НастройкаСезонностиУслуг.Период) КАК Период
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргНастройкаСезонностиУслуг КАК НастройкаСезонностиУслуг
	|			ПО ГраницыОтчетногоПериода.Организация = НастройкаСезонностиУслуг.Организация
	|				И (НастройкаСезонностиУслуг.Организация = &Организация)
	|				И (НастройкаСезонностиУслуг.Район = &Район)
	|				И (НастройкаСезонностиУслуг.МКД = &МКД
	|					ИЛИ НастройкаСезонностиУслуг.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка))
	|				И ГраницыОтчетногоПериода.ЗавершениеОП > НастройкаСезонностиУслуг.Период
	|	
	|	СГРУППИРОВАТЬ ПО
	|		НастройкаСезонностиУслуг.Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления,
	|		НастройкаСезонностиУслуг.Район,
	|		НастройкаСезонностиУслуг.НаправлениеИспользованияТУ,
	|		НастройкаСезонностиУслуг.МКД,
	|		НастройкаСезонностиУслуг.Услуга) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргНастройкаСезонностиУслуг КАК НастройкаСезонностиУслуг
	|		ПО ВложенныйЗапрос.Организация = НастройкаСезонностиУслуг.Организация
	|			И ВложенныйЗапрос.Район = НастройкаСезонностиУслуг.Район
	|			И ВложенныйЗапрос.НаправлениеИспользованияТУ = НастройкаСезонностиУслуг.НаправлениеИспользованияТУ
	|			И ВложенныйЗапрос.МКД = НастройкаСезонностиУслуг.МКД
	|			И ВложенныйЗапрос.Услуга = НастройкаСезонностиУслуг.Услуга
	|			И ВложенныйЗапрос.Период = НастройкаСезонностиУслуг.Период
	|			И (НастройкаСезонностиУслуг.Организация = &Организация)
	|			И (НастройкаСезонностиУслуг.Район = &Район)
	|			И (НастройкаСезонностиУслуг.МКД = &МКД
	|				ИЛИ НастройкаСезонностиУслуг.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка))
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.ДокРегистратор КАК ДокРегистратор,
	|	ВложенныйЗапрос.МКД КАК МКД,
	|	ВложенныйЗапрос.ТочкаУчета КАК ТочкаУчета,
	|	ВложенныйЗапрос.ПериодРегистрации КАК ПериодРегистрации,
	|	ВложенныйЗапрос.НачПер КАК НачПер,
	|	ВложенныйЗапрос.КонПер КАК КонПер
	|ПОМЕСТИТЬ ГраницыПериодов
	|ИЗ
	|	(ВЫБРАТЬ
	|		НаборПериодовНачало.ДокРегистратор КАК ДокРегистратор,
	|		НаборПериодовНачало.МКД КАК МКД,
	|		НаборПериодовНачало.ТочкаУчета КАК ТочкаУчета,
	|		НаборПериодовНачало.Период КАК НачПер,
	|		НаборПериодовНачало.ПериодРегистрации КАК ПериодРегистрации,
	|		МИНИМУМ(НаборПериодовКонец.Период) КАК КонПер
	|	ИЗ
	|		НаборПериодовТочкиУчета КАК НаборПериодовНачало
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ НаборПериодовТочкиУчета КАК НаборПериодовКонец
	|			ПО НаборПериодовНачало.МКД = НаборПериодовКонец.МКД
	|				И НаборПериодовНачало.ТочкаУчета = НаборПериодовКонец.ТочкаУчета
	|				И (ВЫБОР
	|					КОГДА НаборПериодовНачало.Период < НаборПериодовКонец.Период
	|						ТОГДА ИСТИНА
	|					КОГДА НаборПериодовНачало.Период = НаборПериодовКонец.Период
	|							И НаборПериодовНачало.ПериодРегистрации < НаборПериодовКонец.ПериодРегистрации
	|						ТОГДА ИСТИНА
	|					ИНАЧЕ НаборПериодовНачало.Период = НаборПериодовКонец.Период
	|							И НаборПериодовНачало.ПериодРегистрации = НаборПериодовКонец.ПериодРегистрации
	|							И НаборПериодовНачало.ДокРегистратор < НаборПериодовКонец.ДокРегистратор
	|				КОНЕЦ)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		НаборПериодовНачало.ДокРегистратор,
	|		НаборПериодовНачало.МКД,
	|		НаборПериодовНачало.ТочкаУчета,
	|		НаборПериодовНачало.ПериодРегистрации,
	|		НаборПериодовНачало.Период) КАК ВложенныйЗапрос
	|ГДЕ
	|	ВложенныйЗапрос.КонПер <> ДАТАВРЕМЯ(1, 1, 1)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.МКД КАК МКД,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	ВложенныйЗапрос.ТипСхемы КАК ТипСхемы,
	|	ВложенныйЗапрос.ПринадлежностьКТепловомуПункту КАК ПринадлежностьКТепловомуПункту,
	|	энргНастройкаНачисленияГВСМКД.ПредставлениеУслуги КАК ПредставлениеУслуги,
	|	энргНастройкаНачисленияГВСМКД.НеНачислять КАК НеНачислять
	|ПОМЕСТИТЬ МКДНеНачислятьТЭ
	|ИЗ
	|	(ВЫБРАТЬ
	|		энргНастройкаНачисленияГВСМКД.Организация КАК Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|		энргНастройкаНачисленияГВСМКД.Район КАК Район,
	|		энргНастройкаНачисленияГВСМКД.МКД КАК МКД,
	|		энргНастройкаНачисленияГВСМКД.Услуга КАК Услуга,
	|		энргНастройкаНачисленияГВСМКД.ТипСхемы КАК ТипСхемы,
	|		энргНастройкаНачисленияГВСМКД.ПринадлежностьКТепловомуПункту КАК ПринадлежностьКТепловомуПункту,
	|		МАКСИМУМ(энргНастройкаНачисленияГВСМКД.Период) КАК Период
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргНастройкаНачисленияГВСМКД КАК энргНастройкаНачисленияГВСМКД
	|			ПО ГраницыОтчетногоПериода.Организация = энргНастройкаНачисленияГВСМКД.Организация
	|				И (энргНастройкаНачисленияГВСМКД.Организация = &Организация)
	|				И (энргНастройкаНачисленияГВСМКД.Район = &Район)
	|				И (энргНастройкаНачисленияГВСМКД.МКД = &МКД
	|					ИЛИ энргНастройкаНачисленияГВСМКД.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка))
	|				И ГраницыОтчетногоПериода.ЗавершениеОП > энргНастройкаНачисленияГВСМКД.Период
	|	
	|	СГРУППИРОВАТЬ ПО
	|		энргНастройкаНачисленияГВСМКД.Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления,
	|		энргНастройкаНачисленияГВСМКД.Район,
	|		энргНастройкаНачисленияГВСМКД.МКД,
	|		энргНастройкаНачисленияГВСМКД.Услуга,
	|		энргНастройкаНачисленияГВСМКД.ТипСхемы,
	|		энргНастройкаНачисленияГВСМКД.ПринадлежностьКТепловомуПункту) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргНастройкаНачисленияГВСМКД КАК энргНастройкаНачисленияГВСМКД
	|		ПО ВложенныйЗапрос.Организация = энргНастройкаНачисленияГВСМКД.Организация
	|			И ВложенныйЗапрос.Район = энргНастройкаНачисленияГВСМКД.Район
	|			И ВложенныйЗапрос.МКД = энргНастройкаНачисленияГВСМКД.МКД
	|			И ВложенныйЗапрос.Услуга = энргНастройкаНачисленияГВСМКД.Услуга
	|			И ВложенныйЗапрос.ТипСхемы = энргНастройкаНачисленияГВСМКД.ТипСхемы
	|			И ВложенныйЗапрос.ПринадлежностьКТепловомуПункту = энргНастройкаНачисленияГВСМКД.ПринадлежностьКТепловомуПункту
	|			И ВложенныйЗапрос.Период = энргНастройкаНачисленияГВСМКД.Период
	|			И (энргНастройкаНачисленияГВСМКД.Организация = &Организация)
	|			И (энргНастройкаНачисленияГВСМКД.Район = &Район)
	|			И (энргНастройкаНачисленияГВСМКД.МКД = &МКД
	|				ИЛИ энргНастройкаНачисленияГВСМКД.МКД = ЗНАЧЕНИЕ(Справочник.энргСтроения.ПустаяСсылка))
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.НачалоОП КАК НачалоОП,
	|	энргПериодыПриемаПоказаний.ДатаС КАК ДатаС,
	|	энргПериодыПриемаПоказаний.ДатаПо КАК ДатаПо
	|ПОМЕСТИТЬ ПериодыПриемаПоказаний
	|ИЗ
	|	(ВЫБРАТЬ
	|		ГраницыОтчетногоПериода.Организация КАК Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|		ГраницыОтчетногоПериода.НачалоОП КАК НачалоОП,
	|		МАКСИМУМ(энргПериодыПриемаПоказаний.Период) КАК Период
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргПериодыПриемаПоказаний КАК энргПериодыПриемаПоказаний
	|			ПО ГраницыОтчетногоПериода.Организация = энргПериодыПриемаПоказаний.Организация
	|				И ГраницыОтчетногоПериода.ЗавершениеОП > энргПериодыПриемаПоказаний.Период
	|				И (энргПериодыПриемаПоказаний.Организация = &Организация)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ГраницыОтчетногоПериода.Организация,
	|		ГраницыОтчетногоПериода.ПериодНачисления,
	|		ГраницыОтчетногоПериода.НачалоОП) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргПериодыПриемаПоказаний КАК энргПериодыПриемаПоказаний
	|		ПО ВложенныйЗапрос.Организация = энргПериодыПриемаПоказаний.Организация
	|			И ВложенныйЗапрос.Период = энргПериодыПриемаПоказаний.Период
	|			И (энргПериодыПриемаПоказаний.Организация = &Организация)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&Организация КАК Организация,
	|	ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|	&Район КАК Район,
	|	ГраницыПериодов.МКД КАК МКД,
	|	ГраницыОтчетногоПериода.НачалоОП КАК НачалоОП,
	|	ГраницыОтчетногоПериода.ЗавершениеОП КАК ЗавершениеОП,
	|	ГраницыОтчетногоПериода.ДнейВПериоде КАК ДнейВПериоде,
	|	ГраницыПериодов.ДокРегистратор КАК ДокРегистратор,
	|	ГраницыПериодов.ПериодРегистрации КАК ПериодРегистрации,
	|	ГраницыПериодов.НачПер КАК НачПер,
	|	ГраницыПериодов.КонПер КАК КонПер,
	|	ГраницыПериодов.ТочкаУчета КАК ТочкаУчета,
	|	ЕСТЬNULL(НаборэнргСостояниеМКДГраницы.Состояние, ЛОЖЬ) КАК МКДОткрыт,
	|	ЗНАЧЕНИЕ(Перечисление.энргВидыТепловыхПунктов.ПустаяСсылка) КАК ВидТепловогоПункта,
	// ЕСТЬNULL(НаборэнргТипПринадлежностиМКДГраницы.ВидТепловогоПункта, ) КАК ВидТепловогоПункта,
	|	ЗНАЧЕНИЕ(Перечисление.энргТипыСхемТеплоснабжения.ПустаяСсылка) КАК ТипСхемы,
	// ЕСТЬNULL(НаборэнргТипСхемыГВСГраницы.ТипСхемы, ЗНАЧЕНИЕ(Перечисление.энргТипыСхемТеплоснабжения.ПустаяСсылка)) КАК ТипСхемы,
	|	ЕСТЬNULL(НаборэнргЗначениеПлощадейМКДГраницы.Площадь, 0) КАК ОбщаяПлощадь,
	|	ЛОЖЬ КАК НеРаспределятьНаАбонентов,
	//ЕСТЬNULL(НЕ НаборэнргСпособРаспределенияОбъемаМКДНаАбонентовГраницы.Распределять, ЛОЖЬ) КАК НеРаспределятьНаАбонентов,
	|	энргСтроения.КоличествоЭтажей КАК КоличествоЭтажей,
	|	энргСтроения.ГодПостройки КАК ГодПостройки
	|ПОМЕСТИТЬ ОбщиеДанные
	|ИЗ
	|	ГраницыПериодов КАК ГраницыПериодов
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргСостояниеМКДГраницы КАК НаборэнргСостояниеМКДГраницы
	|		ПО ГраницыПериодов.МКД = НаборэнргСостояниеМКДГраницы.МКД
	|			И (ВЫБОР
	|				КОГДА ГраницыПериодов.НачПер = ГраницыПериодов.КонПер
	|					ТОГДА ГраницыПериодов.ДокРегистратор = НаборэнргСостояниеМКДГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргСостояниеМКДГраницы.ПериодС <= ГраницыПериодов.НачПер
	|						И НаборэнргСостояниеМКДГраницы.ПериодПо >= ГраницыПериодов.КонПер
	|			КОНЕЦ)
	//|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргТипПринадлежностиМКДГраницы КАК НаборэнргТипПринадлежностиМКДГраницы
	//|		ПО ГраницыПериодов.МКД = НаборэнргТипПринадлежностиМКДГраницы.МКД
	//|			И (ВЫБОР
	//|				КОГДА ГраницыПериодов.НачПер = ГраницыПериодов.КонПер
	//|					ТОГДА ГраницыПериодов.ДокРегистратор = НаборэнргТипПринадлежностиМКДГраницы.ДокРегистратор
	//|				ИНАЧЕ НаборэнргТипПринадлежностиМКДГраницы.ПериодС <= ГраницыПериодов.НачПер
	//|						И НаборэнргТипПринадлежностиМКДГраницы.ПериодПо >= ГраницыПериодов.КонПер
	//|			КОНЕЦ)
	//|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргТипСхемыГВСГраницы КАК НаборэнргТипСхемыГВСГраницы
	//|		ПО ГраницыПериодов.МКД = НаборэнргТипСхемыГВСГраницы.МКД
	//|			И (ВЫБОР
	//|				КОГДА ГраницыПериодов.НачПер = ГраницыПериодов.КонПер
	//|					ТОГДА ГраницыПериодов.ДокРегистратор = НаборэнргТипСхемыГВСГраницы.ДокРегистратор
	//|				ИНАЧЕ НаборэнргТипСхемыГВСГраницы.ПериодС <= ГраницыПериодов.НачПер
	//|						И НаборэнргТипСхемыГВСГраницы.ПериодПо >= ГраницыПериодов.КонПер
	//|			КОНЕЦ)
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.энргСтроения КАК энргСтроения
	|		ПО ГраницыПериодов.МКД = энргСтроения.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргЗначениеПлощадейМКДГраницы КАК НаборэнргЗначениеПлощадейМКДГраницы
	|		ПО ГраницыПериодов.МКД = НаборэнргЗначениеПлощадейМКДГраницы.МКД
	|			И (ВЫБОР
	|				КОГДА ГраницыПериодов.НачПер = ГраницыПериодов.КонПер
	|					ТОГДА ГраницыПериодов.ДокРегистратор = НаборэнргЗначениеПлощадейМКДГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргЗначениеПлощадейМКДГраницы.ПериодС <= ГраницыПериодов.НачПер
	|						И НаборэнргЗначениеПлощадейМКДГраницы.ПериодПо >= ГраницыПериодов.КонПер
	|			КОНЕЦ)
	|			И (НаборэнргЗначениеПлощадейМКДГраницы.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ОбщаяПлощадьМКД))
	|			И (НаборэнргЗначениеПлощадейМКДГраницы.Услуга = ЗНАЧЕНИЕ(Справочник.энргВидыУслуг.ПустаяСсылка))
	//|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргСпособРаспределенияОбъемаМКДНаАбонентовГраницы КАК НаборэнргСпособРаспределенияОбъемаМКДНаАбонентовГраницы
	//|		ПО ГраницыПериодов.МКД = НаборэнргСпособРаспределенияОбъемаМКДНаАбонентовГраницы.МКД
	//|			И (ВЫБОР
	//|				КОГДА ГраницыПериодов.НачПер = ГраницыПериодов.КонПер
	//|					ТОГДА ГраницыПериодов.ДокРегистратор = НаборэнргСпособРаспределенияОбъемаМКДНаАбонентовГраницы.ДокРегистратор
	//|				ИНАЧЕ НаборэнргСпособРаспределенияОбъемаМКДНаАбонентовГраницы.ПериодС <= ГраницыПериодов.НачПер
	//|						И НаборэнргСпособРаспределенияОбъемаМКДНаАбонентовГраницы.ПериодПо >= ГраницыПериодов.КонПер
	//|			КОНЕЦ)
	//|			И ГраницыПериодов.ТочкаУчета = НаборэнргСпособРаспределенияОбъемаМКДНаАбонентовГраницы.ТочкаУчета
	|		ЛЕВОЕ СОЕДИНЕНИЕ ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|		ПО ГраницыПериодов.НачПер >= ГраницыОтчетногоПериода.НачалоОП
	|			И ГраницыПериодов.КонПер <= ГраницыОтчетногоПериода.ЗавершениеОП
	|ГДЕ
	|	НЕ ГраницыОтчетногоПериода.ПериодНачисления ЕСТЬ NULL
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.Район КАК Район,
	|	ВложенныйЗапрос.МКД КАК МКД,
	|	ВложенныйЗапрос.НачалоОП КАК НачалоОП,
	|	ВложенныйЗапрос.ЗавершениеОП КАК ЗавершениеОП,
	|	ВложенныйЗапрос.ДнейВПериоде КАК ДнейВПериоде,
	|	ВложенныйЗапрос.ДокРегистратор КАК ДокРегистратор,
	|	ВложенныйЗапрос.ПериодРегистрации КАК ПериодРегистрации,
	|	ВложенныйЗапрос.НачПер КАК НачПер,
	|	ВложенныйЗапрос.КонПер КАК КонПер,
	|	ВложенныйЗапрос.ТочкаУчета КАК ТочкаУчета,
	|	ВложенныйЗапрос.МКДОткрыт КАК МКДОткрыт,
	|	ВложенныйЗапрос.ВидТепловогоПункта КАК ВидТепловогоПункта,
	|	ВложенныйЗапрос.ТипСхемы КАК ТипСхемы,
	|	ВложенныйЗапрос.ОбщаяПлощадь КАК ОбщаяПлощадь,
	|	ВложенныйЗапрос.НеРаспределятьНаАбонентов КАК НеРаспределятьНаАбонентов,
	|	ВложенныйЗапрос.КоличествоЭтажей КАК КоличествоЭтажей,
	|	ВложенныйЗапрос.ГодПостройки КАК ГодПостройки,
	|	ВложенныйЗапрос.УслугаПодключена КАК УслугаПодключена,
	|	ВложенныйЗапрос.ПриборУчета КАК ПриборУчета,
	|	ВложенныйЗапрос.Услуга КАК Услуга,
	|	ВложенныйЗапрос.СоставнаяУслуга КАК СоставнаяУслуга,
	|	энргВидыУслуг.ВидПлощадиМКД КАК ВидПлощадиМКД
	|ПОМЕСТИТЬ ДанныеПриборовУчета
	|ИЗ
	|	(ВЫБРАТЬ
	|		ВложенныйЗапрос.Организация КАК Организация,
	|		ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|		ВложенныйЗапрос.Район КАК Район,
	|		ВложенныйЗапрос.МКД КАК МКД,
	|		ВложенныйЗапрос.НачалоОП КАК НачалоОП,
	|		ВложенныйЗапрос.ЗавершениеОП КАК ЗавершениеОП,
	|		ВложенныйЗапрос.ДнейВПериоде КАК ДнейВПериоде,
	|		ВложенныйЗапрос.ДокРегистратор КАК ДокРегистратор,
	|		ВложенныйЗапрос.ПериодРегистрации КАК ПериодРегистрации,
	|		ВложенныйЗапрос.НачПер КАК НачПер,
	|		ВложенныйЗапрос.КонПер КАК КонПер,
	|		ВложенныйЗапрос.ТочкаУчета КАК ТочкаУчета,
	|		ВложенныйЗапрос.МКДОткрыт КАК МКДОткрыт,
	|		ВложенныйЗапрос.ВидТепловогоПункта КАК ВидТепловогоПункта,
	|		ВложенныйЗапрос.ТипСхемы КАК ТипСхемы,
	|		ВложенныйЗапрос.ОбщаяПлощадь КАК ОбщаяПлощадь,
	|		ВложенныйЗапрос.НеРаспределятьНаАбонентов КАК НеРаспределятьНаАбонентов,
	|		ВложенныйЗапрос.КоличествоЭтажей КАК КоличествоЭтажей,
	|		ВложенныйЗапрос.ГодПостройки КАК ГодПостройки,
	|		ВложенныйЗапрос.УслугаПодключена КАК УслугаПодключена,
	|		ВложенныйЗапрос.ПриборУчета КАК ПриборУчета,
	|		ВЫБОР
	|			КОГДА энргВидыУслугСоставляющиеУслуг.Ссылка ЕСТЬ NULL
	|				ТОГДА ВложенныйЗапрос.Услуга
	|			ИНАЧЕ энргВидыУслугСоставляющиеУслуг.Услуга
	|		КОНЕЦ КАК Услуга,
	|		ЕСТЬNULL(энргВидыУслугСоставляющиеУслуг.Ссылка, ЗНАЧЕНИЕ(Справочник.энргВидыУслуг.ПустаяСсылка)) КАК СоставнаяУслуга
	|	ИЗ
	|		(ВЫБРАТЬ
	|			ОбщиеДанные.Организация КАК Организация,
	|			ОбщиеДанные.ПериодНачисления КАК ПериодНачисления,
	|			ОбщиеДанные.Район КАК Район,
	|			ОбщиеДанные.МКД КАК МКД,
	|			ОбщиеДанные.НачалоОП КАК НачалоОП,
	|			ОбщиеДанные.ЗавершениеОП КАК ЗавершениеОП,
	|			ОбщиеДанные.ДнейВПериоде КАК ДнейВПериоде,
	|			ОбщиеДанные.ДокРегистратор КАК ДокРегистратор,
	|			ОбщиеДанные.ПериодРегистрации КАК ПериодРегистрации,
	|			ОбщиеДанные.НачПер КАК НачПер,
	|			ОбщиеДанные.КонПер КАК КонПер,
	|			ОбщиеДанные.ТочкаУчета КАК ТочкаУчета,
	|			ОбщиеДанные.МКДОткрыт КАК МКДОткрыт,
	|			ОбщиеДанные.ВидТепловогоПункта КАК ВидТепловогоПункта,
	|			ОбщиеДанные.ТипСхемы КАК ТипСхемы,
	|			ОбщиеДанные.ОбщаяПлощадь КАК ОбщаяПлощадь,
	|			ОбщиеДанные.НеРаспределятьНаАбонентов КАК НеРаспределятьНаАбонентов,
	|			ОбщиеДанные.КоличествоЭтажей КАК КоличествоЭтажей,
	|			ОбщиеДанные.ГодПостройки КАК ГодПостройки,
	|			ВЫБОР
	|				КОГДА НаборэнргАктивностьТочекУчетаМКДГраницы.Состояние ЕСТЬ NULL
	|					ТОГДА ЛОЖЬ
	|				КОГДА НаборэнргАктивностьТочекУчетаМКДГраницы.Состояние = ЗНАЧЕНИЕ(Перечисление.энргСостояниеТочекУчета.Отключена)
	|					ТОГДА ЛОЖЬ
	|				ИНАЧЕ ИСТИНА
	|			КОНЕЦ КАК УслугаПодключена,
	|			ЕСТЬNULL(НаборэнргУслугиТочекУчетаМКДГраницы.Услуга, ЗНАЧЕНИЕ(Справочник.энргВидыУслуг.ПустаяСсылка)) КАК Услуга,
	|			ЕСТЬNULL(НаборэнргПриборыТочекМКДГраницы.ПриборУчета, ЗНАЧЕНИЕ(Справочник.энргПриборыУчетаАбонента.ПустаяСсылка)) КАК ПриборУчета
	|		ИЗ
	|			ОбщиеДанные КАК ОбщиеДанные
	|				ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргАктивностьТочекУчетаМКДГраницы КАК НаборэнргАктивностьТочекУчетаМКДГраницы
	|				ПО ОбщиеДанные.МКД = НаборэнргАктивностьТочекУчетаМКДГраницы.МКД
	|					И (ВЫБОР
	|						КОГДА ОбщиеДанные.НачПер = ОбщиеДанные.КонПер
	|							ТОГДА ОбщиеДанные.ДокРегистратор = НаборэнргАктивностьТочекУчетаМКДГраницы.ДокРегистратор
	|						ИНАЧЕ НаборэнргАктивностьТочекУчетаМКДГраницы.ПериодС <= ОбщиеДанные.НачПер
	|								И НаборэнргАктивностьТочекУчетаМКДГраницы.ПериодПо >= ОбщиеДанные.КонПер
	|					КОНЕЦ)
	|					И ОбщиеДанные.ТочкаУчета = НаборэнргАктивностьТочекУчетаМКДГраницы.ТочкаУчета
	|				ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргУслугиТочекУчетаМКДГраницы КАК НаборэнргУслугиТочекУчетаМКДГраницы
	|				ПО ОбщиеДанные.МКД = НаборэнргУслугиТочекУчетаМКДГраницы.МКД
	|					И (ВЫБОР
	|						КОГДА ОбщиеДанные.НачПер = ОбщиеДанные.КонПер
	|							ТОГДА ОбщиеДанные.ДокРегистратор = НаборэнргУслугиТочекУчетаМКДГраницы.ДокРегистратор
	|						ИНАЧЕ НаборэнргУслугиТочекУчетаМКДГраницы.ПериодС <= ОбщиеДанные.НачПер
	|								И НаборэнргУслугиТочекУчетаМКДГраницы.ПериодПо >= ОбщиеДанные.КонПер
	|					КОНЕЦ)
	|					И ОбщиеДанные.ТочкаУчета = НаборэнргУслугиТочекУчетаМКДГраницы.ТочкаУчета
	|				ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргПриборыТочекМКДГраницы КАК НаборэнргПриборыТочекМКДГраницы
	|				ПО ОбщиеДанные.МКД = НаборэнргПриборыТочекМКДГраницы.МКД
	|					И (ВЫБОР
	|						КОГДА ОбщиеДанные.НачПер = ОбщиеДанные.КонПер
	|							ТОГДА ОбщиеДанные.ДокРегистратор = НаборэнргПриборыТочекМКДГраницы.ДокРегистратор
	|						ИНАЧЕ НаборэнргПриборыТочекМКДГраницы.ПериодС <= ОбщиеДанные.НачПер
	|								И НаборэнргПриборыТочекМКДГраницы.ПериодПо >= ОбщиеДанные.КонПер
	|					КОНЕЦ)
	|					И ОбщиеДанные.ТочкаУчета = НаборэнргПриборыТочекМКДГраницы.ТочкаУчета) КАК ВложенныйЗапрос
	|			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.энргВидыУслуг.СоставляющиеУслуг КАК энргВидыУслугСоставляющиеУслуг
	|			ПО ВложенныйЗапрос.Услуга = энргВидыУслугСоставляющиеУслуг.Ссылка) КАК ВложенныйЗапрос
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.энргВидыУслуг КАК энргВидыУслуг
	|		ПО ВложенныйЗапрос.Услуга = энргВидыУслуг.Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеПриборовУчета.Организация КАК Организация,
	|	ДанныеПриборовУчета.ПериодНачисления КАК ПериодНачисления,
	|	ДанныеПриборовУчета.Район КАК Район,
	|	ДанныеПриборовУчета.МКД КАК МКД,
	|	ДанныеПриборовУчета.НачалоОП КАК НачалоОП,
	|	ДанныеПриборовУчета.ЗавершениеОП КАК ЗавершениеОП,
	|	ДанныеПриборовУчета.ДнейВПериоде КАК ДнейВПериоде,
	|	ДанныеПриборовУчета.ДокРегистратор КАК ДокРегистратор,
	|	ДанныеПриборовУчета.ПериодРегистрации КАК ПериодРегистрации,
	|	ДанныеПриборовУчета.НачПер КАК НачПер,
	|	ДанныеПриборовУчета.КонПер КАК КонПер,
	|	ДанныеПриборовУчета.ТочкаУчета КАК ТочкаУчета,
	|	ДанныеПриборовУчета.МКДОткрыт КАК МКДОткрыт,
	|	ДанныеПриборовУчета.ВидТепловогоПункта КАК ВидТепловогоПункта,
	|	ДанныеПриборовУчета.ТипСхемы КАК ТипСхемы,
	|	ДанныеПриборовУчета.ОбщаяПлощадь КАК ОбщаяПлощадь,
	|	ДанныеПриборовУчета.НеРаспределятьНаАбонентов КАК НеРаспределятьНаАбонентов,
	|	ДанныеПриборовУчета.КоличествоЭтажей КАК КоличествоЭтажей,
	|	ДанныеПриборовУчета.ГодПостройки КАК ГодПостройки,
	|	ДанныеПриборовУчета.УслугаПодключена КАК УслугаПодключена,
	|	ДанныеПриборовУчета.ПриборУчета КАК ПриборУчета,
	|	ДанныеПриборовУчета.Услуга КАК Услуга,
	|	ДанныеПриборовУчета.СоставнаяУслуга КАК СоставнаяУслуга,
	|	ДанныеПриборовУчета.ВидПлощадиМКД КАК ВидПлощадиМКД,
	|	ЕСТЬNULL(НаборэнргСостояниеПриборовМКДГраницы.Состояние, ЗНАЧЕНИЕ(Перечисление.энргСостояниеПриборовУчета.ПустаяСсылка)) = ЗНАЧЕНИЕ(Перечисление.энргСостояниеПриборовУчета.Ввод) КАК ПриборВведен,
	|	ЕСТЬNULL(НаборэнргСостояниеПриборовМКДГраницы.ПериодС, ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаСостоянияПрибора,
	|	ЕСТЬNULL(НаборэнргЗначениеПлощадейМКДГраницы.Площадь, 0) КАК ЗначениеПлощади,
	|	ЕСТЬNULL(НаборэнргПоставщикиУслугМКДГраницы.Поставщик, ЗНАЧЕНИЕ(Справочник.энргКонтрагенты.ПустаяСсылка)) КАК Поставщик,
	|	ЕСТЬNULL(НаборэнргВидБлагоустройствМКДГраницы.ВидБлагоустройства, ЗНАЧЕНИЕ(Справочник.энргВидыБлагоустройств.ПустаяСсылка)) КАК ВидБлагоустройства,
	|	НЕ НаборэнргФормулыРасчетаУслугМКДГраницы.ФормулаРасчета ЕСТЬ NULL КАК РасчетПоФормуле,
	|	ЕСТЬNULL(НаборэнргФормулыРасчетаУслугМКДГраницы.ФормулаРасчета, """") КАК ФормулаРасчета
	|ПОМЕСТИТЬ ВсеПараметрыРасчетаБезНомера
	|ИЗ
	|	ДанныеПриборовУчета КАК ДанныеПриборовУчета
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргСостояниеПриборовМКДГраницы КАК НаборэнргСостояниеПриборовМКДГраницы
	|		ПО ДанныеПриборовУчета.МКД = НаборэнргСостояниеПриборовМКДГраницы.МКД
	|			И (ВЫБОР
	|				КОГДА ДанныеПриборовУчета.НачПер = ДанныеПриборовУчета.КонПер
	|					ТОГДА ДанныеПриборовУчета.ДокРегистратор = НаборэнргСостояниеПриборовМКДГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргСостояниеПриборовМКДГраницы.ПериодС <= ДанныеПриборовУчета.НачПер
	|						И НаборэнргСостояниеПриборовМКДГраницы.ПериодПо >= ДанныеПриборовУчета.КонПер
	|			КОНЕЦ)
	|			И ДанныеПриборовУчета.ТочкаУчета = НаборэнргСостояниеПриборовМКДГраницы.ТочкаУчета
	|			И ДанныеПриборовУчета.ПриборУчета = НаборэнргСостояниеПриборовМКДГраницы.ПриборУчета
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргПоставщикиУслугМКДГраницы КАК НаборэнргПоставщикиУслугМКДГраницы
	|		ПО ДанныеПриборовУчета.МКД = НаборэнргПоставщикиУслугМКДГраницы.МКД
	|			И (ВЫБОР
	|				КОГДА ДанныеПриборовУчета.НачПер = ДанныеПриборовУчета.КонПер
	|					ТОГДА ДанныеПриборовУчета.ДокРегистратор = НаборэнргПоставщикиУслугМКДГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргПоставщикиУслугМКДГраницы.ПериодС <= ДанныеПриборовУчета.НачПер
	|						И НаборэнргПоставщикиУслугМКДГраницы.ПериодПо >= ДанныеПриборовУчета.КонПер
	|			КОНЕЦ)
	|			И ДанныеПриборовУчета.ТочкаУчета = НаборэнргПоставщикиУслугМКДГраницы.ТочкаУчета
	|			И ДанныеПриборовУчета.Услуга = НаборэнргПоставщикиУслугМКДГраницы.Услуга
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргЗначениеПлощадейМКДГраницы КАК НаборэнргЗначениеПлощадейМКДГраницы
	|		ПО ДанныеПриборовУчета.МКД = НаборэнргЗначениеПлощадейМКДГраницы.МКД
	|			И (ВЫБОР
	|				КОГДА ДанныеПриборовУчета.НачПер = ДанныеПриборовУчета.КонПер
	|					ТОГДА ДанныеПриборовУчета.ДокРегистратор = НаборэнргЗначениеПлощадейМКДГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргЗначениеПлощадейМКДГраницы.ПериодС <= ДанныеПриборовУчета.НачПер
	|						И НаборэнргЗначениеПлощадейМКДГраницы.ПериодПо >= ДанныеПриборовУчета.КонПер
	|			КОНЕЦ)
	|			И ДанныеПриборовУчета.Услуга = НаборэнргЗначениеПлощадейМКДГраницы.Услуга
	|			И ДанныеПриборовУчета.ВидПлощадиМКД = НаборэнргЗначениеПлощадейМКДГраницы.ВидПлощади
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргВидБлагоустройствМКДГраницы КАК НаборэнргВидБлагоустройствМКДГраницы
	|		ПО ДанныеПриборовУчета.МКД = НаборэнргВидБлагоустройствМКДГраницы.МКД
	|			И (ВЫБОР
	|				КОГДА ДанныеПриборовУчета.НачПер = ДанныеПриборовУчета.КонПер
	|					ТОГДА ДанныеПриборовУчета.ДокРегистратор = НаборэнргВидБлагоустройствМКДГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргВидБлагоустройствМКДГраницы.ПериодС <= ДанныеПриборовУчета.НачПер
	|						И НаборэнргВидБлагоустройствМКДГраницы.ПериодПо >= ДанныеПриборовУчета.КонПер
	|			КОНЕЦ)
	|			И ДанныеПриборовУчета.Услуга = НаборэнргВидБлагоустройствМКДГраницы.Услуга
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргФормулыРасчетаУслугМКДГраницы КАК НаборэнргФормулыРасчетаУслугМКДГраницы
	|		ПО ДанныеПриборовУчета.МКД = НаборэнргФормулыРасчетаУслугМКДГраницы.МКД
	|			И (ВЫБОР
	|				КОГДА ДанныеПриборовУчета.НачПер = ДанныеПриборовУчета.КонПер
	|					ТОГДА ДанныеПриборовУчета.ДокРегистратор = НаборэнргФормулыРасчетаУслугМКДГраницы.ДокРегистратор
	|				ИНАЧЕ НаборэнргФормулыРасчетаУслугМКДГраницы.ПериодС <= ДанныеПриборовУчета.НачПер
	|						И НаборэнргФормулыРасчетаУслугМКДГраницы.ПериодПо >= ДанныеПриборовУчета.КонПер
	|			КОНЕЦ)
	|			И ДанныеПриборовУчета.ТочкаУчета = НаборэнргФормулыРасчетаУслугМКДГраницы.ТочкаУчета
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СтабильныеПериодыБезНомераНачало.Организация КАК Организация,
	|	СтабильныеПериодыБезНомераНачало.ПериодНачисления КАК ПериодНачисления,
	|	СтабильныеПериодыБезНомераНачало.Район КАК Район,
	|	СтабильныеПериодыБезНомераНачало.МКД КАК МКД,
	|	СтабильныеПериодыБезНомераНачало.НачалоОП КАК НачалоОП,
	|	СтабильныеПериодыБезНомераНачало.ЗавершениеОП КАК ЗавершениеОП,
	|	СтабильныеПериодыБезНомераНачало.ДнейВПериоде КАК ДнейВПериоде,
	|	СтабильныеПериодыБезНомераНачало.ДокРегистратор КАК ДокРегистратор,
	|	СтабильныеПериодыБезНомераНачало.ПериодРегистрации КАК ПериодРегистрации,
	|	СтабильныеПериодыБезНомераНачало.НачПер КАК НачПер,
	|	СтабильныеПериодыБезНомераНачало.КонПер КАК КонПер,
	|	СтабильныеПериодыБезНомераНачало.ТочкаУчета КАК ТочкаУчета,
	|	СтабильныеПериодыБезНомераНачало.МКДОткрыт КАК МКДОткрыт,
	|	СтабильныеПериодыБезНомераНачало.ВидТепловогоПункта КАК ВидТепловогоПункта,
	|	СтабильныеПериодыБезНомераНачало.ТипСхемы КАК ТипСхемы,
	|	СтабильныеПериодыБезНомераНачало.ОбщаяПлощадь КАК ОбщаяПлощадь,
	|	СтабильныеПериодыБезНомераНачало.НеРаспределятьНаАбонентов КАК НеРаспределятьНаАбонентов,
	|	СтабильныеПериодыБезНомераНачало.КоличествоЭтажей КАК КоличествоЭтажей,
	|	СтабильныеПериодыБезНомераНачало.ГодПостройки КАК ГодПостройки,
	|	СтабильныеПериодыБезНомераНачало.УслугаПодключена КАК УслугаПодключена,
	|	СтабильныеПериодыБезНомераНачало.ПриборУчета КАК ПриборУчета,
	|	СтабильныеПериодыБезНомераНачало.Услуга КАК Услуга,
	|	СтабильныеПериодыБезНомераНачало.СоставнаяУслуга КАК СоставнаяУслуга,
	|	СтабильныеПериодыБезНомераНачало.ВидПлощадиМКД КАК ВидПлощадиМКД,
	|	СтабильныеПериодыБезНомераНачало.ПриборВведен КАК ПриборВведен,
	|	СтабильныеПериодыБезНомераНачало.ДатаСостоянияПрибора КАК ДатаСостоянияПрибора,
	|	СтабильныеПериодыБезНомераНачало.ЗначениеПлощади КАК ЗначениеПлощади,
	|	СтабильныеПериодыБезНомераНачало.Поставщик КАК Поставщик,
	|	СтабильныеПериодыБезНомераНачало.ВидБлагоустройства КАК ВидБлагоустройства,
	|	СтабильныеПериодыБезНомераНачало.РасчетПоФормуле КАК РасчетПоФормуле,
	|	СтабильныеПериодыБезНомераНачало.ФормулаРасчета КАК ФормулаРасчета,
	|	СУММА(ВЫБОР
	|			КОГДА СтабильныеПериодыБезНомераКонец.ПериодНачисления ЕСТЬ NULL
	|				ТОГДА 0
	|			ИНАЧЕ 1
	|		КОНЕЦ) КАК НомерПозиции,
	|	ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление) КАК НаправлениеИспользованияТУ,
	|	ЗНАЧЕНИЕ(Перечисление.энргТипыСобственниковЖилья.ПустаяСсылка) КАК ВидСобственности,
	|	0 КАК КоличествоКомнат,
	|	0 КАК КоличествоПрописанных,
	|	ЗНАЧЕНИЕ(Справочник.энргШкалыПриборовУчета.ПустаяСсылка) КАК Шкала,
	|	ЗНАЧЕНИЕ(Справочник.энргПриборыУчетаАбонента.ПустаяСсылка) КАК ЧастьУзлаУчета
	|ПОМЕСТИТЬ ВсеПараметрыРасчета
	|ИЗ
	|	ВсеПараметрыРасчетаБезНомера КАК СтабильныеПериодыБезНомераНачало
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВсеПараметрыРасчетаБезНомера КАК СтабильныеПериодыБезНомераКонец
	|		ПО СтабильныеПериодыБезНомераНачало.Организация = СтабильныеПериодыБезНомераКонец.Организация
	|			И СтабильныеПериодыБезНомераНачало.ПериодНачисления = СтабильныеПериодыБезНомераКонец.ПериодНачисления
	|			И СтабильныеПериодыБезНомераНачало.Район = СтабильныеПериодыБезНомераКонец.Район
	|			И СтабильныеПериодыБезНомераНачало.МКД = СтабильныеПериодыБезНомераКонец.МКД
	|			И СтабильныеПериодыБезНомераНачало.Услуга = СтабильныеПериодыБезНомераКонец.Услуга
	|			И СтабильныеПериодыБезНомераНачало.ТочкаУчета = СтабильныеПериодыБезНомераКонец.ТочкаУчета
	|			И (ВЫБОР
	|				КОГДА СтабильныеПериодыБезНомераНачало.ПериодРегистрации = СтабильныеПериодыБезНомераКонец.ПериодРегистрации
	|					ТОГДА СтабильныеПериодыБезНомераНачало.ДокРегистратор > СтабильныеПериодыБезНомераКонец.ДокРегистратор
	|				ИНАЧЕ СтабильныеПериодыБезНомераНачало.ПериодРегистрации > СтабильныеПериодыБезНомераКонец.ПериодРегистрации
	|			КОНЕЦ)
	|
	|СГРУППИРОВАТЬ ПО
	|	СтабильныеПериодыБезНомераНачало.ФормулаРасчета,
	|	СтабильныеПериодыБезНомераНачало.РасчетПоФормуле,
	|	СтабильныеПериодыБезНомераНачало.ЗавершениеОП,
	|	СтабильныеПериодыБезНомераНачало.ДокРегистратор,
	|	СтабильныеПериодыБезНомераНачало.УслугаПодключена,
	|	СтабильныеПериодыБезНомераНачало.КонПер,
	|	СтабильныеПериодыБезНомераНачало.СоставнаяУслуга,
	|	СтабильныеПериодыБезНомераНачало.ВидТепловогоПункта,
	|	СтабильныеПериодыБезНомераНачало.ПериодНачисления,
	|	СтабильныеПериодыБезНомераНачало.МКДОткрыт,
	|	СтабильныеПериодыБезНомераНачало.Организация,
	|	СтабильныеПериодыБезНомераНачало.ТипСхемы,
	|	СтабильныеПериодыБезНомераНачало.МКД,
	|	СтабильныеПериодыБезНомераНачало.ПриборУчета,
	|	СтабильныеПериодыБезНомераНачало.НачПер,
	|	СтабильныеПериодыБезНомераНачало.Услуга,
	|	СтабильныеПериодыБезНомераНачало.ВидПлощадиМКД,
	|	СтабильныеПериодыБезНомераНачало.ДатаСостоянияПрибора,
	|	СтабильныеПериодыБезНомераНачало.НачалоОП,
	|	СтабильныеПериодыБезНомераНачало.ПериодРегистрации,
	|	СтабильныеПериодыБезНомераНачало.ТочкаУчета,
	|	СтабильныеПериодыБезНомераНачало.ПриборВведен,
	|	СтабильныеПериодыБезНомераНачало.Поставщик,
	|	СтабильныеПериодыБезНомераНачало.Район,
	|	СтабильныеПериодыБезНомераНачало.ДнейВПериоде,
	|	СтабильныеПериодыБезНомераНачало.НеРаспределятьНаАбонентов,
	|	СтабильныеПериодыБезНомераНачало.ВидБлагоустройства,
	|	СтабильныеПериодыБезНомераНачало.ОбщаяПлощадь,
	|	СтабильныеПериодыБезНомераНачало.КоличествоЭтажей,
	|	СтабильныеПериодыБезНомераНачало.ГодПостройки,
	|	СтабильныеПериодыБезНомераНачало.ЗначениеПлощади
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВсеПараметрыРасчета.Организация КАК Организация,
	|	ВсеПараметрыРасчета.ПериодНачисления КАК ПериодНачисления,
	|	ВсеПараметрыРасчета.Район КАК Район,
	|	ВсеПараметрыРасчета.МКД КАК МКД,
	|	ВсеПараметрыРасчета.ТочкаУчета КАК ТочкаУчета,
	|	ВсеПараметрыРасчета.НомерПозиции КАК НомерПозиции,
	|	ВсеПараметрыРасчета.ПриборУчета КАК УзелУчета,
	|	ВсеПараметрыРасчета.НачПер КАК НачПер,
	|	ВсеПараметрыРасчета.КонПер КАК КонПер,
	|	ВсеПараметрыРасчета.ДокРегистратор КАК ДокРегистратор,
	|	НаборэнргСостояниеПриборовУзловУчетаМКДГраницы.ПриборУчета КАК ЧастьУзлаУчета,
	|	НаборэнргСостояниеПриборовУзловУчетаМКДГраницы.Состояние = ЗНАЧЕНИЕ(Перечисление.энргСостояниеПриборовУчета.Ввод) КАК ПриборВведен,
	|	НаборэнргСостояниеПриборовУзловУчетаМКДГраницы.ПериодС КАК ДатаСостоянияПрибора,
	|	1 КАК КоэффициентПУ
	|ПОМЕСТИТЬ СтабильныеПериодыСоставУзла
	|ИЗ
	|	ВсеПараметрыРасчета КАК ВсеПараметрыРасчета
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ НаборэнргСостояниеПриборовУзловУчетаМКДГраницы КАК НаборэнргСостояниеПриборовУзловУчетаМКДГраницы
	|		ПО ВсеПараметрыРасчета.МКД = НаборэнргСостояниеПриборовУзловУчетаМКДГраницы.МКД
	|			И ВсеПараметрыРасчета.ТочкаУчета = НаборэнргСостояниеПриборовУзловУчетаМКДГраницы.ТочкаУчета
	|			И ВсеПараметрыРасчета.ПриборУчета = НаборэнргСостояниеПриборовУзловУчетаМКДГраницы.УзелУчета
	|			И (ВЫБОР
	|				КОГДА ВсеПараметрыРасчета.НачПер = ВсеПараметрыРасчета.КонПер
	|					ТОГДА ВсеПараметрыРасчета.ДокРегистратор = НаборэнргСостояниеПриборовУзловУчетаМКДГраницы.ДокРегистратор
	|				ИНАЧЕ ВсеПараметрыРасчета.НачПер >= НаборэнргСостояниеПриборовУзловУчетаМКДГраницы.ПериодС
	|						И ВсеПараметрыРасчета.КонПер <= НаборэнргСостояниеПриборовУзловУчетаМКДГраницы.ПериодПо
	|			КОНЕЦ)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	СтабильныеПериодыСоставУзла.Организация КАК Организация,
	|	СтабильныеПериодыСоставУзла.ПериодНачисления КАК ПериодНачисления,
	|	СтабильныеПериодыСоставУзла.Район КАК Район,
	|	СтабильныеПериодыСоставУзла.МКД КАК МКД,
	|	СтабильныеПериодыСоставУзла.ТочкаУчета КАК ТочкаУчета,
	|	СтабильныеПериодыСоставУзла.НомерПозиции КАК НомерПозиции,
	|	СтабильныеПериодыСоставУзла.ЧастьУзлаУчета КАК ЧастьУзлаУчета,
	|	СтабильныеПериодыСоставУзла.ДокРегистратор КАК ДокРегистратор,
	|	ЕСТЬNULL(НаборэнргВидыДифференцированностиПриборовУчетаМКДГраницы.Шкала, ЗНАЧЕНИЕ(Справочник.энргШкалыПриборовУчета.ПустаяСсылка)) КАК Шкала,
	|	ЕСТЬNULL(НаборэнргВидыДифференцированностиПриборовУчетаМКДГраницы.ВидДифференцированности, ЗНАЧЕНИЕ(Справочник.энргВидыДифференцированности.Однотарифный)) КАК ВидДифференцированности
	|ПОМЕСТИТЬ СтабильныеПериодыШкалы
	|ИЗ
	|	СтабильныеПериодыСоставУзла КАК СтабильныеПериодыСоставУзла
	|		ЛЕВОЕ СОЕДИНЕНИЕ НаборэнргВидыДифференцированностиПриборовУчетаМКДГраницы КАК НаборэнргВидыДифференцированностиПриборовУчетаМКДГраницы
	|		ПО СтабильныеПериодыСоставУзла.МКД = НаборэнргВидыДифференцированностиПриборовУчетаМКДГраницы.МКД
	|			И СтабильныеПериодыСоставУзла.ЧастьУзлаУчета = НаборэнргВидыДифференцированностиПриборовУчетаМКДГраницы.ПриборУчета
	|			И (ВЫБОР
	|				КОГДА СтабильныеПериодыСоставУзла.НачПер = СтабильныеПериодыСоставУзла.КонПер
	|					ТОГДА СтабильныеПериодыСоставУзла.ДокРегистратор = НаборэнргВидыДифференцированностиПриборовУчетаМКДГраницы.ДокРегистратор
	|				ИНАЧЕ СтабильныеПериодыСоставУзла.НачПер >= НаборэнргВидыДифференцированностиПриборовУчетаМКДГраницы.ПериодС
	|						И СтабильныеПериодыСоставУзла.КонПер <= НаборэнргВидыДифференцированностиПриборовУчетаМКДГраницы.ПериодПо
	|			КОНЕЦ)";
	
	ИтоговыйТекст = ИтоговыйТекст + 
	"
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|";
	
	ИтоговыйТекст 	= ИтоговыйТекст + Справочники.энргКлючиНормативов.ТекстОпределенияКлючейНормативаПерерасчет(Ложь);
	
	ИтоговыйТекст 	= ИтоговыйТекст + 
	"
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|";
	
	ИтоговыйТекст 	= ИтоговыйТекст + 
	"ВЫБРАТЬ
	|	ВсеПараметрыРасчета.*,
	|	ЕСТЬNULL(КлючиНорматива.КлючНорматива,ЗНАЧЕНИЕ(Справочник.энргКлючиНормативов.ПустаяСсылка)) КАК КлючНорматива
	|ПОМЕСТИТЬ СтабильныеПериодыНачало
	|ИЗ
	|	ВсеПараметрыРасчета КАК ВсеПараметрыРасчета
	|		ЛЕВОЕ СОЕДИНЕНИЕ КлючиНорматива КАК КлючиНорматива
	|		ПО ВсеПараметрыРасчета.ПериодНачисления = КлючиНорматива.ПериодНачисления
	|		И (ВсеПараметрыРасчета.НачалоОП = КлючиНорматива.НачалоОП)
	|		И (ВсеПараметрыРасчета.ЗавершениеОП = КлючиНорматива.ЗавершениеОП)
	|		И (ВсеПараметрыРасчета.НачПер = КлючиНорматива.НачПер)
	|		И (ВсеПараметрыРасчета.КонПер = КлючиНорматива.КонПер)
	|		И (ВсеПараметрыРасчета.ДокРегистратор = КлючиНорматива.ДокРегистратор)	
	|		И (ВсеПараметрыРасчета.Услуга = КлючиНорматива.Услуга)
	|		И (ВсеПараметрыРасчета.НаправлениеИспользованияТУ = КлючиНорматива.НаправлениеИспользованияТУ)
	|		И (КлючиНорматива.Измеритель = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление))";
	
	Запрос  		= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = МВТ;
	Запрос.УстановитьПараметр("Организация",	Организация);
	Запрос.УстановитьПараметр("Район",			Район);
	Запрос.УстановитьПараметр("МКД",			 МКД);
	Запрос.УстановитьПараметр("НачалоПериода",	НачалоПериодаРасчета);
	Запрос.УстановитьПараметр("КонецПериода",	КонецПериодаРасчета); 
	Запрос.УстановитьПараметр("ТипНачисления",	Перечисления.энргТипыНачислений.ОбщедомовыеНачисления); 
	Запрос.Текст 	= ИтоговыйТекст;
	Запрос.Выполнить();
	
КонецПроцедуры

Процедура ПоказанияПерерасчетМКД(МВТ,Организация,ПериодНачисленияНачало,ПериодНачисленияКонец,Район,МКД,КорректировкаПоказаний)
		
	Запрос 							= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Запрос.Текст 					= "ВЫБРАТЬ * ИЗ ПериодыПриемаПоказаний";
	Результат 						= Запрос.Выполнить();
	Выборка  						= Результат.Выбрать();
	
	ПериодыПриемаПоказаний 			= Новый Соответствие;
	
	Пока Выборка.Следующий() Цикл
		ПериодыПриемаПоказаний.Вставить(Выборка.ПериодНачисления, Новый Структура("ДатаС,ДатаПо, НачалоПериодаРасчета", Выборка.ДатаС, Выборка.ДатаПо, Выборка.НачалоОП));
	КонецЦикла;
	
	Запрос 							= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Запрос.УстановитьПараметр("Организация",		Организация);
	Запрос.УстановитьПараметр("ПериодНачисления", 	НачалоМесяца(ПериодНачисленияНачало -1));
	Запрос.УстановитьПараметр("Район", 				Район);
	Запрос.УстановитьПараметр("МКД", 				МКД);																															 
	Запрос.Текст 					=
	"ВЫБРАТЬ
	|	энргМаксимальныеПоказанияСрезМКД.ПриборУчета КАК ПриборУчета,
	|	энргМаксимальныеПоказанияСрезМКД.Шкала КАК Шкала,
	|	энргМаксимальныеПоказанияСрезМКД.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргМаксимальныеПоказанияСрезМКД.Показания КАК Показания
	|ИЗ
	|	РегистрСведений.энргМаксимальныеПоказанияСрезМКД КАК энргМаксимальныеПоказанияСрезМКД
	|ГДЕ
	|	энргМаксимальныеПоказанияСрезМКД.Организация = &Организация
	|	И энргМаксимальныеПоказанияСрезМКД.ПериодНачисления = &ПериодНачисления
	|	И энргМаксимальныеПоказанияСрезМКД.Район = &Район
	|	И энргМаксимальныеПоказанияСрезМКД.МКД = &МКД";
	
	Результат 						= Запрос.Выполнить();
	тзМаксимальныеСрез 				= Результат.Выгрузить();
	
	ПредоставленныеПоказания 		= Новый ТаблицаЗначений;
	ПредоставленныеПоказания.Колонки.Добавить("МКД",						Новый ОписаниеТипов("СправочникСсылка.энргСтроения"));
	ПредоставленныеПоказания.Колонки.Добавить("ПериодНачисления",			Новый ОписаниеТипов("Дата"));
	ПредоставленныеПоказания.Колонки.Добавить("ПриборУчета",				Новый ОписаниеТипов("СправочникСсылка.энргПриборыУчетаАбонента"));
	ПредоставленныеПоказания.Колонки.Добавить("Шкала",						Новый ОписаниеТипов("СправочникСсылка.энргШкалыПриборовУчета"));
	ПредоставленныеПоказания.Колонки.Добавить("ТарифнаяЗона",				Новый ОписаниеТипов("СправочникСсылка.энргТарифныеЗоны"));
	ПредоставленныеПоказания.Колонки.Добавить("НомерПозиции",				Новый ОписаниеТипов("Число"));
	ПредоставленныеПоказания.Колонки.Добавить("Разделитель",				Новый ОписаниеТипов("Число"));
	ПредоставленныеПоказания.Колонки.Добавить("ДатаРегистратора",			Новый ОписаниеТипов("Дата"));
	ПредоставленныеПоказания.Колонки.Добавить("ДокРегистратор",				Новый ОписаниеТипов(Метаданные.РегистрыСведений.энргПредоставленныеПоказания.Измерения.ДокРегистратор.Тип.Типы()));
	ПредоставленныеПоказания.Колонки.Добавить("ВСрок",						Новый ОписаниеТипов("Булево"));
	ПредоставленныеПоказания.Колонки.Добавить("Показания",					Новый ОписаниеТипов("Число"));
	ПредоставленныеПоказания.Колонки.Добавить("ПоказанияТекущегоПериода",	Новый ОписаниеТипов("Булево"));
	  	
	КорректировкаПоказаний.Сортировать("ПериодНачисления,ПриборУчетаПосле,ШкалаПосле,ТарифнаяЗонаПосле,ДатаПоказаний,РегистраторПоказаний,Разделитель");
		
	ПредыдущиеПоказания 							= -1;
	
	текПериодНачисления								= Неопределено;
	текПриборУчета 									= Неопределено;
	текШкала	 									= Неопределено;
	текТарифнаяЗона									= Неопределено;
	ПоказанияПриняты 								= Перечисления.энргСостояниеПоказаний.Приняты;
	
	Для Каждого Строка Из КорректировкаПоказаний Цикл
		
		Если НЕ текПериодНачисления = Строка.ПериодНачисления
			ИЛИ НЕ текПриборУчета = Строка.ПриборУчетаПосле
			ИЛИ НЕ текШкала = Строка.ШкалаПосле
			ИЛИ НЕ текТарифнаяЗона = Строка.ТарифнаяЗонаПосле Тогда
			ТекНомерПозиции 						= 0;
		КонецЕсли;
		
		Если НЕ текПриборУчета = Строка.ПриборУчетаПосле
			ИЛИ НЕ текШкала = Строка.ШкалаПосле
			ИЛИ НЕ текТарифнаяЗона = Строка.ТарифнаяЗонаПосле Тогда
			
			СтрокиМаксимальныеСрез 					= тзМаксимальныеСрез.НайтиСтроки(Новый Структура("ПриборУчета,Шкала,ТарифнаяЗона",Строка.ПриборУчетаПосле, Строка.ШкалаПосле,Строка.ТарифнаяЗонаПосле));
			СтрокаСреза 							= Неопределено;
			Если СтрокиМаксимальныеСрез.Количество() = 0 Тогда
				МаксимальныеПоказания 				= 0; 
			Иначе
				СтрокаСреза 						= СтрокиМаксимальныеСрез[0];
				МаксимальныеПоказания 				= СтрокаСреза.Показания;
			КонецЕсли;
			
		КонецЕсли;
		
		Если ПериодыПриемаПоказаний[Строка.ПериодНачисления] = Неопределено Тогда
			ВСрок 									= Истина;
			ПоказанияТекущегоПериода 				= Истина;
		Иначе
			НачалоПериодаРасчета 					= ПериодыПриемаПоказаний[Строка.ПериодНачисления].НачалоПериодаРасчета;
			ПоказанияС 								= ПериодыПриемаПоказаний[Строка.ПериодНачисления].ДатаС;		
			ПоказанияПО 							= ПериодыПриемаПоказаний[Строка.ПериодНачисления].ДатаПо;
			ВСрок 									= Строка.ДатаПоказаний >= НачалоПериодаРасчета и День(Строка.ДатаПоказаний)>=ПоказанияС и День(Строка.ДатаПоказаний)<=ПоказанияПО;
			ПоказанияТекущегоПериода 				= Строка.ДатаПоказаний >= НачалоПериодаРасчета;
		КонецЕсли; 		
		
		Если Строка.СостояниеПоказанийПосле = ПоказанияПриняты Тогда
			МаксимальныеПоказания 					= Строка.ПоказанияПосле;
			Если СтрокаСреза = Неопределено Тогда
				СтрокаСреза  						= тзМаксимальныеСрез.Добавить();
				СтрокаСреза.ПриборУчета 			= Строка.ПриборУчетаПосле;
				СтрокаСреза.Шкала					= Строка.ШкалаПосле;
				СтрокаСреза.ТарифнаяЗона			= Строка.ТарифнаяЗонаПосле;
				СтрокаСреза.Показания 				= МаксимальныеПоказания;	
			Иначе
				 СтрокаСреза.Показания 				= МаксимальныеПоказания;
			КонецЕсли; 			
		КонецЕсли;
				
		Если Строка.СостояниеПоказанийПосле = ПоказанияПриняты или ВСрок тогда
			// Записываем набор.
			СтрокаНабор  							= ПредоставленныеПоказания.Добавить();
			СтрокаНабор.ПериодНачисления 			= Строка.ПериодНачисления;
			СтрокаНабор.ПриборУчета					= Строка.ПриборУчетаПосле;
			СтрокаНабор.Шкала						= Строка.ШкалаПосле;
			СтрокаНабор.ТарифнаяЗона				= Строка.ТарифнаяЗонаПосле;
			СтрокаНабор.НомерПозиции				= ТекНомерПозиции;
			СтрокаНабор.ДатаРегистратора  			= Строка.ДатаПоказаний;
			СтрокаНабор.ДокРегистратор  			= Строка.РегистраторПоказаний;
			СтрокаНабор.Разделитель		  			= Строка.Разделитель;
			СтрокаНабор.Показания  					= МаксимальныеПоказания;
			СтрокаНабор.ВСрок  						= ВСрок;
			СтрокаНабор.ПоказанияТекущегоПериода	= ПоказанияТекущегоПериода;
			ТекНомерПозиции 						= ТекНомерПозиции +1;			
		КонецЕсли;
		
		текПериодНачисления 						= Строка.ПериодНачисления;
		текПриборУчета 								= Строка.ПриборУчетаПосле;
		текШкала	 								= Строка.ШкалаПосле;
		текТарифнаяЗона								= Строка.ТарифнаяЗонаПосле;			
	КонецЦикла;
	
	Запрос 											= Новый Запрос;
	Запрос.УстановитьПараметр("Организация",				Организация);
	Запрос.УстановитьПараметр("ПериодНачисления", 			НачалоМесяца(ПериодНачисленияНачало -1));
	Запрос.УстановитьПараметр("Организация", 				Организация);
	Запрос.УстановитьПараметр("Район", 						Район);
	Запрос.УстановитьПараметр("МКД", 						МКД);
	Запрос.УстановитьПараметр("ПредоставленныеПоказания", 	ПредоставленныеПоказания);
	Запрос.МенеджерВременныхТаблиц 					= МВТ;
	Запрос.Текст  									= 
	"ВЫБРАТЬ
	|	ПредоставленныеПоказания.ПериодНачисления КАК ПериодНачисления,
	|	&Организация КАК Организация,
	|	&Район КАК Район,
	|	&МКД КАК МКД,
	|	ПредоставленныеПоказания.ПриборУчета КАК ПриборУчета,
	|	ПредоставленныеПоказания.Шкала КАК Шкала,
	|	ПредоставленныеПоказания.ТарифнаяЗона КАК ТарифнаяЗона,
	|	ПредоставленныеПоказания.НомерПозиции КАК НомерПозиции,
	|	ПредоставленныеПоказания.Разделитель КАК Разделитель,
	|	ПредоставленныеПоказания.ДатаРегистратора КАК ДатаРегистратора,
	|	ПредоставленныеПоказания.ДокРегистратор КАК ДокРегистратор,
	|	ПредоставленныеПоказания.ВСрок КАК ВСрок,
	|	ПредоставленныеПоказания.Показания КАК Показания,
	|	ПредоставленныеПоказания.ПоказанияТекущегоПериода КАК ПоказанияТекущегоПериода
	|ПОМЕСТИТЬ яПредоставленныеПоказания
	|ИЗ
	|	&ПредоставленныеПоказания КАК ПредоставленныеПоказания
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	яПредоставленныеПоказания.ПериодНачисления КАК ПериодНачисления,
	|	яПредоставленныеПоказания.Организация КАК Организация,
	|	яПредоставленныеПоказания.Район КАК Район,
	|	яПредоставленныеПоказания.МКД КАК МКД,
	|	яПредоставленныеПоказания.ПриборУчета КАК ПриборУчета,
	|	яПредоставленныеПоказания.Шкала КАК Шкала,
	|	яПредоставленныеПоказания.ТарифнаяЗона КАК ТарифнаяЗона,
	|	яПредоставленныеПоказания.НомерПозиции КАК НомерПозиции,
	|	яПредоставленныеПоказания.Разделитель КАК Разделитель,
	|	яПредоставленныеПоказания.ДатаРегистратора КАК ДатаРегистратора,
	|	яПредоставленныеПоказания.ДокРегистратор КАК ДокРегистратор,
	|	яПредоставленныеПоказания.ВСрок КАК ВСрок,
	|	яПредоставленныеПоказания.Показания КАК Показания,
	|	яПредоставленныеПоказания.ПоказанияТекущегоПериода КАК ПоказанияТекущегоПериода,
	|	ГраницыОтчетногоПериода.ЗавершениеОП КАК КонецПериодаРасчета
	|ПОМЕСТИТЬ ПредоставленныеПоказания
	|ИЗ
	|	яПредоставленныеПоказания КАК яПредоставленныеПоказания
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|		ПО яПредоставленныеПоказания.ПериодНачисления = ГраницыОтчетногоПериода.ПериодНачисления
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	&Организация КАК Организация,
	|	&Район КАК Район,
	|	ПредоставленныеПоказания.МКД КАК МКД,
	|	ВложенныйЗапрос.ПриборУчета КАК ПриборУчета,
	|	ВложенныйЗапрос.Шкала КАК Шкала,
	|	ВложенныйЗапрос.ТарифнаяЗона КАК ТарифнаяЗона,
	|	ПредоставленныеПоказания.Показания КАК Показания,
	|	ПредоставленныеПоказания.ДатаРегистратора КАК ДатаРегистратора,
	|	ПредоставленныеПоказания.ДокРегистратор КАК ДокРегистратор
	|ПОМЕСТИТЬ МаксимальныеПоказания
	|ИЗ
	|	(ВЫБРАТЬ
	|		ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|		ВложенныйЗапрос.ПриборУчета КАК ПриборУчета,
	|		ВложенныйЗапрос.Шкала КАК Шкала,
	|		ВложенныйЗапрос.ТарифнаяЗона КАК ТарифнаяЗона,
	|		ВложенныйЗапрос.ПериодНачисленияПоказаний КАК ПериодНачисленияПоказаний,
	|		МАКСИМУМ(ПредоставленныеПоказания.НомерПозиции) КАК НомерПозиции
	|	ИЗ
	|		(ВЫБРАТЬ
	|			ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|			ПредоставленныеПоказания.ПриборУчета КАК ПриборУчета,
	|			ПредоставленныеПоказания.Шкала КАК Шкала,
	|			ПредоставленныеПоказания.ТарифнаяЗона КАК ТарифнаяЗона,
	|			МАКСИМУМ(ПредоставленныеПоказания.ПериодНачисления) КАК ПериодНачисленияПоказаний
	|		ИЗ
	|			ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПредоставленныеПоказания КАК ПредоставленныеПоказания
	|				ПО ГраницыОтчетногоПериода.ПериодНачисления >= ПредоставленныеПоказания.ПериодНачисления
	|		
	|		СГРУППИРОВАТЬ ПО
	|			ГраницыОтчетногоПериода.ПериодНачисления,
	|			ПредоставленныеПоказания.ПриборУчета,
	|			ПредоставленныеПоказания.Шкала,
	|			ПредоставленныеПоказания.ТарифнаяЗона) КАК ВложенныйЗапрос
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПредоставленныеПоказания КАК ПредоставленныеПоказания
	|			ПО ВложенныйЗапрос.ПериодНачисленияПоказаний = ПредоставленныеПоказания.ПериодНачисления
	|				И ВложенныйЗапрос.ПриборУчета = ПредоставленныеПоказания.ПриборУчета
	|				И ВложенныйЗапрос.Шкала = ПредоставленныеПоказания.Шкала
	|				И ВложенныйЗапрос.ТарифнаяЗона = ПредоставленныеПоказания.ТарифнаяЗона
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ВложенныйЗапрос.ПериодНачисления,
	|		ВложенныйЗапрос.ПриборУчета,
	|		ВложенныйЗапрос.Шкала,
	|		ВложенныйЗапрос.ТарифнаяЗона,
	|		ВложенныйЗапрос.ПериодНачисленияПоказаний) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПредоставленныеПоказания КАК ПредоставленныеПоказания
	|		ПО ВложенныйЗапрос.ПериодНачисленияПоказаний = ПредоставленныеПоказания.ПериодНачисления
	|			И ВложенныйЗапрос.ПриборУчета = ПредоставленныеПоказания.ПриборУчета
	|			И ВложенныйЗапрос.Шкала = ПредоставленныеПоказания.Шкала
	|			И ВложенныйЗапрос.ТарифнаяЗона = ПредоставленныеПоказания.ТарифнаяЗона
	|			И ВложенныйЗапрос.НомерПозиции = ПредоставленныеПоказания.НомерПозиции
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	&Организация КАК Организация,
	|	&Район КАК Район,
	|	ВложенныйЗапрос.МКД КАК МКД,
	|	ВложенныйЗапрос.ПриборУчета КАК ПриборУчета,
	|	ВложенныйЗапрос.Шкала КАК Шкала,
	|	ВложенныйЗапрос.ТарифнаяЗона КАК ТарифнаяЗона,
	|	ВложенныйЗапрос.НомерПозиции КАК НомерПозиции,
	|	ВложенныйЗапрос.Показания КАК Показания,
	|	ВложенныйЗапрос.ДатаРегистратора КАК ДатаРегистратора,
	|	ВложенныйЗапрос.ДокРегистратор КАК ДокРегистратор,
	|	ГраницыОтчетногоПериода.НачалоОП КАК Период,
	|	ГраницыОтчетногоПериода.ЗавершениеОП КАК КонецПериодаРасчета
	|ПОМЕСТИТЬ МаксимальныеПоказанияСрез
	|ИЗ
	|	(ВЫБРАТЬ
	|		ДОБАВИТЬКДАТЕ(КОНЕЦПЕРИОДА(МаксимальныеПоказания.ПериодНачисления, МЕСЯЦ), СЕКУНДА, 1) КАК ПериодНачисления,
	|		МаксимальныеПоказания.МКД КАК МКД,
	|		МаксимальныеПоказания.ПриборУчета КАК ПриборУчета,
	|		МаксимальныеПоказания.Шкала КАК Шкала,
	|		МаксимальныеПоказания.ТарифнаяЗона КАК ТарифнаяЗона,
	|		-1 КАК НомерПозиции,
	|		МаксимальныеПоказания.Показания КАК Показания,
	|		МаксимальныеПоказания.ДатаРегистратора КАК ДатаРегистратора,
	|		МаксимальныеПоказания.ДокРегистратор КАК ДокРегистратор
	|	ИЗ
	|		МаксимальныеПоказания КАК МаксимальныеПоказания
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ДОБАВИТЬКДАТЕ(КОНЕЦПЕРИОДА(&ПериодНачисления, МЕСЯЦ), СЕКУНДА, 1),
	|		энргМаксимальныеПоказанияСрезМКД.МКД,
	|		энргМаксимальныеПоказанияСрезМКД.ПриборУчета,
	|		энргМаксимальныеПоказанияСрезМКД.Шкала,
	|		энргМаксимальныеПоказанияСрезМКД.ТарифнаяЗона,
	|		-1,
	|		энргМаксимальныеПоказанияСрезМКД.Показания,
	|		энргМаксимальныеПоказанияСрезМКД.ДатаРегистратора,
	|		энргМаксимальныеПоказанияСрезМКД.ДокРегистратор
	|	ИЗ
	|		РегистрСведений.энргМаксимальныеПоказанияСрезМКД КАК энргМаксимальныеПоказанияСрезМКД
	|	ГДЕ
	|		энргМаксимальныеПоказанияСрезМКД.Организация = &Организация
	|		И энргМаксимальныеПоказанияСрезМКД.ПериодНачисления = &ПериодНачисления
	|		И энргМаксимальныеПоказанияСрезМКД.Район = &Район
	|		И энргМаксимальныеПоказанияСрезМКД.МКД = &МКД) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|		ПО ВложенныйЗапрос.ПериодНачисления = ГраницыОтчетногоПериода.ПериодНачисления"; 
		
	Запрос.Выполнить();
	
КонецПроцедуры

Процедура ВспомогательныеДанныеПерерасчетМКД(МВТ,Организация,ПериодНачисленияНачало,ПериодНачисленияКонец,НачалоПериодаРасчета,КонецПериодаРасчета,Район,МКД)
	
	Текст  							= 
	"ВЫБРАТЬ
	|	энргДокументыНачислений.Организация КАК Организация,
	|	энргДокументыНачислений.ПериодНачисления КАК ПериодНачисления,
	|	энргДокументыНачислений.Район КАК Район,
	|	энргДокументыНачислений.МКД КАК МКД,
	|	энргДокументыНачислений.ДокументНачисления КАК ДокументНачисления,
	|	энргДокументыНачислений.ПометкаУдаления КАК ПометкаУдаления
	|ПОМЕСТИТЬ ДокументыНачислений
	|ИЗ
	|	РегистрСведений.энргДокументыНачислений КАК энргДокументыНачислений
	|ГДЕ
	|	ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВложенныйЗапрос.Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	ВложенныйЗапрос.НачалоОП КАК НачалоОП,
	|	ВложенныйЗапрос.ЗавершениеОП КАК ЗавершениеОП,
	|	ВложенныйЗапрос.Сезонность КАК Сезонность,
	|	ВложенныйЗапрос.НачалоФактическогоПериода КАК НачалоФактическогоПериода,
	|	ВложенныйЗапрос.КонецФактическогоПериода КАК КонецФактическогоПериода,
	|	энргВидыУслуг.Ссылка КАК Услуга,
	|	ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление) КАК НаправлениеИспользования,
	|	ЛОЖЬ КАК НормативПоДням
	|ПОМЕСТИТЬ ДлительностьПериодов
	|ИЗ
	|	(ВЫБРАТЬ
	|		ВложенныйЗапрос.Организация КАК Организация,
	|		ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|		ВложенныйЗапрос.НачалоОП КАК НачалоОП,
	|		ВложенныйЗапрос.ЗавершениеОП КАК ЗавершениеОП,
	|		ВложенныйЗапрос.Сезонность КАК Сезонность,
	|		ВЫБОР
	|			КОГДА ВложенныйЗапрос.НачалоОП МЕЖДУ ВложенныйЗапрос.НачалоПериодаДействия И ВложенныйЗапрос.КонецПериодаДействия
	|					ИЛИ ВложенныйЗапрос.ЗавершениеОП МЕЖДУ ВложенныйЗапрос.НачалоПериодаДействия И ВложенныйЗапрос.КонецПериодаДействия
	|				ТОГДА ВЫБОР
	|						КОГДА ВложенныйЗапрос.НачалоОП > ВложенныйЗапрос.НачалоПериодаДействия
	|							ТОГДА ВложенныйЗапрос.НачалоОП
	|						ИНАЧЕ ВложенныйЗапрос.НачалоПериодаДействия
	|					КОНЕЦ
	|			ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1)
	|		КОНЕЦ КАК НачалоФактическогоПериода,
	|		ВЫБОР
	|			КОГДА ВложенныйЗапрос.НачалоОП МЕЖДУ ВложенныйЗапрос.НачалоПериодаДействия И ВложенныйЗапрос.КонецПериодаДействия
	|					ИЛИ ВложенныйЗапрос.ЗавершениеОП МЕЖДУ ВложенныйЗапрос.НачалоПериодаДействия И ВложенныйЗапрос.КонецПериодаДействия
	|				ТОГДА ВЫБОР
	|						КОГДА ВложенныйЗапрос.ЗавершениеОП > ВложенныйЗапрос.КонецПериодаДействия
	|							ТОГДА ВложенныйЗапрос.КонецПериодаДействия
	|						ИНАЧЕ ВложенныйЗапрос.ЗавершениеОП
	|					КОНЕЦ
	|			ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1)
	|		КОНЕЦ КАК КонецФактическогоПериода,
	|		ВложенныйЗапрос.НачалоПериодаДействия КАК НачалоПериодаДействия,
	|		ВложенныйЗапрос.КонецПериодаДействия КАК КонецПериодаДействия
	|	ИЗ
	|		(ВЫБРАТЬ
	|			ВложенныйЗапрос.Организация КАК Организация,
	|			ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|			ВложенныйЗапрос.НачалоОП КАК НачалоОП,
	|			ВложенныйЗапрос.ЗавершениеОП КАК ЗавершениеОП,
	|			ВложенныйЗапрос.Сезонность КАК Сезонность,
	|			ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(ДАТАВРЕМЯ(1, 1, 1), ГОД, ВложенныйЗапрос.ГодНачало - 1), МЕСЯЦ, ВложенныйЗапрос.МесяцНачала - 1), ДЕНЬ, ВложенныйЗапрос.ДеньНачала - 1) КАК НачалоПериодаДействия,
	|			ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(ДАТАВРЕМЯ(1, 1, 1), ГОД, ВложенныйЗапрос.ГодОкончания - 1), МЕСЯЦ, ВложенныйЗапрос.МесяцОкончания - 1), ДЕНЬ, ВложенныйЗапрос.ДеньОкончания - 1) КАК КонецПериодаДействия
	|		ИЗ
	|			(ВЫБРАТЬ
	|				ГраницыОтчетногоПериода.Организация КАК Организация,
	|				ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|				энргДлительностиПериодов.Сезонность КАК Сезонность,
	|				ДЕНЬ(энргДлительностиПериодов.НачалоПериода) КАК ДеньНачала,
	|				МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) КАК МесяцНачала,
	|				ДЕНЬ(энргДлительностиПериодов.КонецПериода) + 1 КАК ДеньОкончания,
	|				МЕСЯЦ(энргДлительностиПериодов.КонецПериода) КАК МесяцОкончания,
	|				ВЫБОР
	|					КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(энргДлительностиПериодов.КонецПериода)
	|						ТОГДА ВЫБОР
	|								КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(ГраницыОтчетногоПериода.ЗавершениеОП)
	|									ТОГДА ГОД(ГраницыОтчетногоПериода.ЗавершениеОП) - 1
	|								ИНАЧЕ ГОД(ГраницыОтчетногоПериода.ЗавершениеОП)
	|							КОНЕЦ
	|					ИНАЧЕ ГОД(ГраницыОтчетногоПериода.ЗавершениеОП)
	|				КОНЕЦ КАК ГодНачало,
	|				ВЫБОР
	|					КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(энргДлительностиПериодов.КонецПериода)
	|						ТОГДА ВЫБОР
	|								КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(ГраницыОтчетногоПериода.ЗавершениеОП)
	|									ТОГДА ГОД(ГраницыОтчетногоПериода.ЗавершениеОП)
	|								ИНАЧЕ ГОД(ГраницыОтчетногоПериода.ЗавершениеОП) + 1
	|							КОНЕЦ
	|					ИНАЧЕ ГОД(ГраницыОтчетногоПериода.ЗавершениеОП)
	|				КОНЕЦ КАК ГодОкончания,
	|				ГраницыОтчетногоПериода.ЗавершениеОП КАК ЗавершениеОП,
	|				ГраницыОтчетногоПериода.НачалоОП КАК НачалоОП
	|			ИЗ
	|				ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|					ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргДлительностиПериодов.СрезПоследних(
	|							,
	|							Организация = &Организация
	|								И Район = &Район) КАК энргДлительностиПериодов
	|					ПО (ИСТИНА)) КАК ВложенныйЗапрос) КАК ВложенныйЗапрос) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.энргВидыУслуг КАК энргВидыУслуг
	|		ПО ВложенныйЗапрос.Сезонность = энргВидыУслуг.Сезонность
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	&Организация,
	|	ВложенныйЗапрос.ПериодНачисления,
	|	ВложенныйЗапрос.НачалоОП,
	|	ВложенныйЗапрос.ЗавершениеОП,
	|	ВложенныйЗапрос.Сезонность,
	|	ВложенныйЗапрос.НачалоФактическогоПериода,
	|	ВложенныйЗапрос.КонецФактическогоПериода,
	|	СпособыРасчетаПоНаправлениям.Услуга,
	|	СпособыРасчетаПоНаправлениям.НаправлениеИспользованияТУ,
	|	СпособыРасчетаПоНаправлениям.НормативПоДням
	|ИЗ
	|	(ВЫБРАТЬ
	|		ВложенныйЗапрос.Организация КАК Организация,
	|		ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|		ВложенныйЗапрос.НачалоОП КАК НачалоОП,
	|		ВложенныйЗапрос.ЗавершениеОП КАК ЗавершениеОП,
	|		ВложенныйЗапрос.Сезонность КАК Сезонность,
	|		ВЫБОР
	|			КОГДА ВложенныйЗапрос.НачалоОП МЕЖДУ ВложенныйЗапрос.НачалоПериодаДействия И ВложенныйЗапрос.КонецПериодаДействия
	|					ИЛИ ВложенныйЗапрос.ЗавершениеОП МЕЖДУ ВложенныйЗапрос.НачалоПериодаДействия И ВложенныйЗапрос.КонецПериодаДействия
	|				ТОГДА ВЫБОР
	|						КОГДА ВложенныйЗапрос.НачалоОП > ВложенныйЗапрос.НачалоПериодаДействия
	|							ТОГДА ВложенныйЗапрос.НачалоОП
	|						ИНАЧЕ ВложенныйЗапрос.НачалоПериодаДействия
	|					КОНЕЦ
	|			ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1)
	|		КОНЕЦ КАК НачалоФактическогоПериода,
	|		ВЫБОР
	|			КОГДА ВложенныйЗапрос.НачалоОП МЕЖДУ ВложенныйЗапрос.НачалоПериодаДействия И ВложенныйЗапрос.КонецПериодаДействия
	|					ИЛИ ВложенныйЗапрос.ЗавершениеОП МЕЖДУ ВложенныйЗапрос.НачалоПериодаДействия И ВложенныйЗапрос.КонецПериодаДействия
	|				ТОГДА ВЫБОР
	|						КОГДА ВложенныйЗапрос.ЗавершениеОП > ВложенныйЗапрос.КонецПериодаДействия
	|							ТОГДА ВложенныйЗапрос.КонецПериодаДействия
	|						ИНАЧЕ ВложенныйЗапрос.ЗавершениеОП
	|					КОНЕЦ
	|			ИНАЧЕ ДАТАВРЕМЯ(1, 1, 1)
	|		КОНЕЦ КАК КонецФактическогоПериода,
	|		ВложенныйЗапрос.НачалоПериодаДействия КАК НачалоПериодаДействия,
	|		ВложенныйЗапрос.КонецПериодаДействия КАК КонецПериодаДействия
	|	ИЗ
	|		(ВЫБРАТЬ
	|			ВложенныйЗапрос.Организация КАК Организация,
	|			ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|			ВложенныйЗапрос.НачалоОП КАК НачалоОП,
	|			ВложенныйЗапрос.ЗавершениеОП КАК ЗавершениеОП,
	|			ВложенныйЗапрос.Сезонность КАК Сезонность,
	|			ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(ДАТАВРЕМЯ(1, 1, 1), ГОД, ВложенныйЗапрос.ГодНачало - 1), МЕСЯЦ, ВложенныйЗапрос.МесяцНачала - 1), ДЕНЬ, ВложенныйЗапрос.ДеньНачала - 1) КАК НачалоПериодаДействия,
	|			ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(ДОБАВИТЬКДАТЕ(ДАТАВРЕМЯ(1, 1, 1), ГОД, ВложенныйЗапрос.ГодОкончания - 1), МЕСЯЦ, ВложенныйЗапрос.МесяцОкончания - 1), ДЕНЬ, ВложенныйЗапрос.ДеньОкончания - 1) КАК КонецПериодаДействия
	|		ИЗ
	|			(ВЫБРАТЬ
	|				ГраницыОтчетногоПериода.Организация КАК Организация,
	|				ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|				ГраницыОтчетногоПериода.НачалоОП КАК НачалоОП,
	|				ГраницыОтчетногоПериода.ЗавершениеОП КАК ЗавершениеОП,
	|				энргДлительностиПериодов.Сезонность КАК Сезонность,
	|				ДЕНЬ(энргДлительностиПериодов.НачалоПериода) КАК ДеньНачала,
	|				МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) КАК МесяцНачала,
	|				ДЕНЬ(энргДлительностиПериодов.КонецПериода) + 1 КАК ДеньОкончания,
	|				МЕСЯЦ(энргДлительностиПериодов.КонецПериода) КАК МесяцОкончания,
	|				ВЫБОР
	|					КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(энргДлительностиПериодов.КонецПериода)
	|						ТОГДА ВЫБОР
	|								КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(ГраницыОтчетногоПериода.ЗавершениеОП)
	|									ТОГДА ГОД(ГраницыОтчетногоПериода.ЗавершениеОП) - 1
	|								ИНАЧЕ ГОД(ГраницыОтчетногоПериода.ЗавершениеОП)
	|							КОНЕЦ
	|					ИНАЧЕ ГОД(ГраницыОтчетногоПериода.ЗавершениеОП)
	|				КОНЕЦ КАК ГодНачало,
	|				ВЫБОР
	|					КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(энргДлительностиПериодов.КонецПериода)
	|						ТОГДА ВЫБОР
	|								КОГДА МЕСЯЦ(энргДлительностиПериодов.НачалоПериода) > МЕСЯЦ(ГраницыОтчетногоПериода.ЗавершениеОП)
	|									ТОГДА ГОД(ГраницыОтчетногоПериода.ЗавершениеОП)
	|								ИНАЧЕ ГОД(ГраницыОтчетногоПериода.ЗавершениеОП) + 1
	|							КОНЕЦ
	|					ИНАЧЕ ГОД(ГраницыОтчетногоПериода.ЗавершениеОП)
	|				КОНЕЦ КАК ГодОкончания
	|			ИЗ
	|				ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|					ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргДлительностиПериодов.СрезПоследних(
	|							,
	|							Организация = &Организация
	|								И Район = &Район) КАК энргДлительностиПериодов
	|					ПО (ИСТИНА)) КАК ВложенныйЗапрос) КАК ВложенныйЗапрос) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргСпособыРасчетаПоНаправлениям.СрезПоследних(&НачалоПериода,) КАК СпособыРасчетаПоНаправлениям
	|		ПО (СпособыРасчетаПоНаправлениям.Организация = &Организация)
	|			И (СпособыРасчетаПоНаправлениям.Район = &Район)
	|			И ВложенныйЗапрос.Сезонность = СпособыРасчетаПоНаправлениям.Сезонность
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргВыводПриборовУчетаМКД.Организация КАК Организация,
	|	энргВыводПриборовУчетаМКД.ПериодНачисления КАК ПериодНачисления,
	|	энргВыводПриборовУчетаМКД.МКД КАК МКД,
	|	энргВыводПриборовУчетаМКД.Район КАК Район,
	|	энргВыводПриборовУчетаМКД.МКД КАК Строение,
	|	энргВыводПриборовУчетаМКД.ТочкаУчета КАК ТочкаУчета,
	|	энргВыводПриборовУчетаМКД.ПриборУчета КАК ПриборУчета
	|ПОМЕСТИТЬ ДанныеВыводаПрибораУчета
	|ИЗ
	|	ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргВыводПриборовУчетаМКД КАК энргВыводПриборовУчетаМКД
	|		ПО ГраницыОтчетногоПериода.Организация = энргВыводПриборовУчетаМКД.Организация
	|			И ГраницыОтчетногоПериода.ПериодНачисления = энргВыводПриборовУчетаМКД.ПериодНачисления
	|			И (энргВыводПриборовУчетаМКД.Организация = &Организация)
	|			И (энргВыводПриборовУчетаМКД.ПериодНачисления МЕЖДУ &ПериодНачисленияНачало И &ПериодНачисленияКонец)
	|			И (энргВыводПриборовУчетаМКД.Район = &Район)
	|			И (энргВыводПриборовУчетаМКД.МКД = &МКД)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргСреднийОбъемПотребленияМКД.Организация КАК Организация,
	|	энргСреднийОбъемПотребленияМКД.ПериодНачисления КАК ПериодНачисления,
	|	энргСреднийОбъемПотребленияМКД.Район КАК Район,
	|	энргСреднийОбъемПотребленияМКД.МКД КАК МКД,
	|	энргСреднийОбъемПотребленияМКД.Услуга КАК Услуга,
	|	энргСреднийОбъемПотребленияМКД.ТочкаУчета КАК ТочкаУчета,
	|	энргСреднийОбъемПотребленияМКД.Шкала КАК Шкала,
	|	энргСреднийОбъемПотребленияМКД.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргСреднийОбъемПотребленияМКД.Объем КАК СреднийОбъем
	|ПОМЕСТИТЬ СреднееПотреблениеМКД
	|ИЗ
	|	РегистрСведений.энргСреднийОбъемПотребленияМКД КАК энргСреднийОбъемПотребленияМКД
	|ГДЕ
	|	энргСреднийОбъемПотребленияМКД.Организация = &Организация
	|	И энргСреднийОбъемПотребленияМКД.ПериодНачисления МЕЖДУ &ПериодНачисленияНачало И &ПериодНачисленияКонец
	|	И энргСреднийОбъемПотребленияМКД.Район = &Район
	|	И энргСреднийОбъемПотребленияМКД.МКД = &МКД
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СтабильныеПериодыНачало.Организация КАК Организация,
	|	СтабильныеПериодыНачало.ПериодНачисления КАК ПериодНачисления,
	|	СтабильныеПериодыНачало.Район КАК Район,
	|	СтабильныеПериодыНачало.МКД КАК МКД,
	|	СтабильныеПериодыНачало.Услуга КАК Услуга,
	|	СтабильныеПериодыНачало.ТочкаУчета КАК ТочкаУчета,
	|	МАКСИМУМ(СтабильныеПериодыНачало.НомерПозиции) КАК НомерПозиции,
	|	ДлительностьПериодов.НаправлениеИспользования КАК НаправлениеИспользования,
	|	ДлительностьПериодов.НачалоФактическогоПериода КАК ПериодСезонности
	|ПОМЕСТИТЬ НомераСтрокНачалоСезонности
	|ИЗ
	|	СтабильныеПериодыНачало КАК СтабильныеПериодыНачало
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДлительностьПериодов КАК ДлительностьПериодов
	|		ПО СтабильныеПериодыНачало.Организация = ДлительностьПериодов.Организация
	|			И СтабильныеПериодыНачало.ПериодНачисления = ДлительностьПериодов.ПериодНачисления
	|			И СтабильныеПериодыНачало.Услуга = ДлительностьПериодов.Услуга
	|			И СтабильныеПериодыНачало.ПериодРегистрации < ДлительностьПериодов.НачалоФактическогоПериода
	|			И (ДлительностьПериодов.НачалоФактическогоПериода <> ДлительностьПериодов.НачалоОП)
	|			И (ДлительностьПериодов.НачалоФактическогоПериода <> ДлительностьПериодов.ЗавершениеОП)
	|
	|СГРУППИРОВАТЬ ПО
	|	СтабильныеПериодыНачало.Организация,
	|	СтабильныеПериодыНачало.ПериодНачисления,
	|	СтабильныеПериодыНачало.Район,
	|	СтабильныеПериодыНачало.МКД,
	|	СтабильныеПериодыНачало.Услуга,
	|	СтабильныеПериодыНачало.ТочкаУчета,
	|	ДлительностьПериодов.НаправлениеИспользования,
	|	ДлительностьПериодов.НачалоФактическогоПериода
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СтабильныеПериодыНачало.Организация КАК Организация,
	|	СтабильныеПериодыНачало.ПериодНачисления КАК ПериодНачисления,
	|	СтабильныеПериодыНачало.Район КАК Район,
	|	СтабильныеПериодыНачало.МКД КАК МКД,
	|	СтабильныеПериодыНачало.Услуга КАК Услуга,
	|	СтабильныеПериодыНачало.ТочкаУчета КАК ТочкаУчета,
	|	МАКСИМУМ(СтабильныеПериодыНачало.НомерПозиции) КАК НомерПозиции,
	|	ДлительностьПериодов.НаправлениеИспользования КАК НаправлениеИспользования,
	|	ДлительностьПериодов.КонецФактическогоПериода КАК ПериодСезонности
	|ПОМЕСТИТЬ НомераСтрокКонецСезонности
	|ИЗ
	|	СтабильныеПериодыНачало КАК СтабильныеПериодыНачало
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДлительностьПериодов КАК ДлительностьПериодов
	|		ПО СтабильныеПериодыНачало.Организация = ДлительностьПериодов.Организация
	|			И СтабильныеПериодыНачало.ПериодНачисления = ДлительностьПериодов.ПериодНачисления
	|			И СтабильныеПериодыНачало.Услуга = ДлительностьПериодов.Услуга
	|			И СтабильныеПериодыНачало.ПериодРегистрации < ДлительностьПериодов.КонецФактическогоПериода
	|			И (ДлительностьПериодов.КонецФактическогоПериода <> ДлительностьПериодов.НачалоОП)
	|			И (ДлительностьПериодов.КонецФактическогоПериода <> ДлительностьПериодов.ЗавершениеОП)
	|
	|СГРУППИРОВАТЬ ПО
	|	СтабильныеПериодыНачало.Организация,
	|	СтабильныеПериодыНачало.ПериодНачисления,
	|	СтабильныеПериодыНачало.Район,
	|	СтабильныеПериодыНачало.МКД,
	|	СтабильныеПериодыНачало.Услуга,
	|	СтабильныеПериодыНачало.ТочкаУчета,
	|	ДлительностьПериодов.НаправлениеИспользования,
	|	ДлительностьПериодов.КонецФактическогоПериода
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	&Район КАК Район,
	|	&МКД КАК МКД,
	|	энргВидыУслуг.Ссылка КАК Услуга,
	|	ВложенныйЗапрос.ПлощадьМОП КАК ПлощадьМОП
	|ПОМЕСТИТЬ ЗначениеПлощадейМКД
	|ИЗ
	|	(ВЫБРАТЬ
	|		ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|		ВложенныйЗапрос.ВидПлощади КАК ВидПлощади,
	|		энргЗначениеПлощадейМКД.Площадь КАК ПлощадьМОП
	|	ИЗ
	|		(ВЫБРАТЬ
	|			ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|			энргЗначениеПлощадейМКД.ВидПлощади КАК ВидПлощади,
	|			МАКСИМУМ(энргЗначениеПлощадейМКД.Период) КАК Период
	|		ИЗ
	|			ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначениеПлощадейМКД КАК энргЗначениеПлощадейМКД
	|				ПО ГраницыОтчетногоПериода.ЗавершениеОП > энргЗначениеПлощадейМКД.Период
	|					И (энргЗначениеПлощадейМКД.Организация = &Организация)
	|					И (энргЗначениеПлощадейМКД.Район = &Район)
	|					И (энргЗначениеПлощадейМКД.МКД = &МКД)
	|		
	|		СГРУППИРОВАТЬ ПО
	|			ГраницыОтчетногоПериода.ПериодНачисления,
	|			энргЗначениеПлощадейМКД.ВидПлощади) КАК ВложенныйЗапрос
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначениеПлощадейМКД КАК энргЗначениеПлощадейМКД
	|			ПО ВложенныйЗапрос.Период = энргЗначениеПлощадейМКД.Период
	|				И ВложенныйЗапрос.ВидПлощади = энргЗначениеПлощадейМКД.ВидПлощади
	|				И (энргЗначениеПлощадейМКД.Организация = &Организация)
	|				И (энргЗначениеПлощадейМКД.Район = &Район)
	|				И (энргЗначениеПлощадейМКД.МКД = &МКД)) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.энргВидыУслуг КАК энргВидыУслуг
	|		ПО ВложенныйЗапрос.ВидПлощади = энргВидыУслуг.ВидПлощадиМКД
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	&Район КАК Район,
	|	&МКД КАК Строение,
	|	энргВидыУслуг.Ссылка КАК Услуга,
	|	ВложенныйЗапрос.Площадь КАК ПлощадьАбонентов,
	|	0 КАК ПлощадьСобственнаяПоставка
	|ПОМЕСТИТЬ ЗначениеИндивидуальныхПлощадей
	|ИЗ
	|	(ВЫБРАТЬ
	|		ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|		СУММА(энргЗначенияПлощадей.Площадь) КАК Площадь
	|	ИЗ
	|		(ВЫБРАТЬ
	|			ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|			ВложенныйЗапрос.КлючПомещения КАК КлючПомещения,
	|			МАКСИМУМ(ВложенныйЗапрос.Период) КАК Период
	|		ИЗ
	|			ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|				ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	|					энргЗначенияПлощадей.Период КАК Период,
	|					энргЗначенияПлощадей.ВидПлощади КАК ВидПлощади,
	|					энргЗначенияПлощадей.КлючПомещения КАК КлючПомещения
	|				ИЗ
	|					РегистрСведений.энргЗначенияПлощадей КАК энргЗначенияПлощадей
	|						ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргКлючиПомещений КАК энргКлючиПомещений
	|						ПО энргЗначенияПлощадей.КлючПомещения = энргКлючиПомещений.КлючПомещения
	|							И (энргЗначенияПлощадей.Организация = &Организация)
	|							И (энргЗначенияПлощадей.Район = &Район)
	|							И (энргКлючиПомещений.Строение = &МКД)
	|							И (энргЗначенияПлощадей.ВидПлощади = ЗНАЧЕНИЕ(Перечисление.энргВидыПлощадей.ОбщаяПлощадь))) КАК ВложенныйЗапрос
	|				ПО ГраницыОтчетногоПериода.ЗавершениеОП > ВложенныйЗапрос.Период
	|		
	|		СГРУППИРОВАТЬ ПО
	|			ГраницыОтчетногоПериода.ПериодНачисления,
	|			ВложенныйЗапрос.КлючПомещения) КАК ВложенныйЗапрос
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначенияПлощадей КАК энргЗначенияПлощадей
	|			ПО ВложенныйЗапрос.Период = энргЗначенияПлощадей.Период
	|				И ВложенныйЗапрос.КлючПомещения = энргЗначенияПлощадей.КлючПомещения
	|				И (энргЗначенияПлощадей.Организация = &Организация)
	|				И (энргЗначенияПлощадей.Район = &Район)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ВложенныйЗапрос.ПериодНачисления) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.энргВидыУслуг КАК энргВидыУслуг
	|		ПО (НЕ энргВидыУслуг.СоставнаяУслуга)
	|			И (энргВидыУслуг.ТипУслуги = ЗНАЧЕНИЕ(Перечисление.энргТипыУслуг.КоммунальныеУслуги))";
	
	Запрос  						= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Запрос.УстановитьПараметр("Организация",			Организация);
	Запрос.УстановитьПараметр("Район",					Район);
	Запрос.УстановитьПараметр("МКД",					МКД);
	Запрос.УстановитьПараметр("НачалоПериода",			НачалоПериодаРасчета);
	Запрос.УстановитьПараметр("КонецПериода",			КонецПериодаРасчета);
	Запрос.УстановитьПараметр("ПериодНачисленияНачало",	ПериодНачисленияНачало);
	Запрос.УстановитьПараметр("ПериодНачисленияКонец",	ПериодНачисленияКонец);
	Запрос.Текст 					= Текст;  	
	Запрос.Выполнить();
КонецПроцедуры

#КонецОбласти

#Область НачислениеПоРассрочке_ВспомогательныеФункции

// Рассчет процентов происходит на остаток суммы
Процедура ДифференцированныйСпособРасчетаПроцентов(Организация, ПериодНачисления,Район,МКД,Документ,КонецПериодаРасчета)
	
	Запрос  								= Новый Запрос;
	Запрос.УстановитьПараметр("Организация",		Организация);
	Запрос.УстановитьПараметр("ПериодНачисления",	ПериодНачисления);
	Запрос.УстановитьПараметр("КонецПериодаРасчета",КонецПериодаРасчета);
	Запрос.УстановитьПараметр("Район",				Район);
	Запрос.УстановитьПараметр("Организация",			Организация);
	Текст  									= ТекстЗапросаДифференцированныйСпособРасчетаПроцентов();
	
	Если МКД = Неопределено тогда
		Текст 								= СтрЗаменить(Текст,"И энргСтабильныеПериоды.МКД = &МКД","");
		Текст 								= СтрЗаменить(Текст,"И (энргСтабильныеПериоды.МКД = &МКД)","");
		Текст 								= СтрЗаменить(Текст,"И МКД = &МКД","");
		Текст 								= СтрЗаменить(Текст,"И (энргНачислениеПоРассрочке.МКД = &МКД)","");
	иначе
		Запрос.УстановитьПараметр("МКД",МКД);
	КонецЕсли;
	
	Запрос.Текст 							= Текст;
	РезЗадолженность						= Запрос.Выполнить();
	
	// читаем ставку рефинансирования
	Запрос  		= Новый Запрос;
	Запрос.УстановитьПараметр("КонецПериодаРасчета",КонецПериодаРасчета);
	Запрос.Текст 	="ВЫБРАТЬ
	|	энргСтавкиРефинансированияСрезПоследних.Коэффициент
	|ИЗ
	|	РегистрСведений.энргСтавкиРефинансирования.СрезПоследних(&КонецПериодаРасчета, ) КАК энргСтавкиРефинансированияСрезПоследних";
	Результат 								= Запрос.Выполнить();
	
	Если Результат.Пустой() тогда
		Возврат;
	иначе
		Выборка  							= Результат.Выбрать();
		Выборка.Следующий();
		СтРеф  								= Выборка.Коэффициент;
	КонецЕсли;
	
	Выборка  								= РезЗадолженность.Выбрать();
	ТекДом 									= Неопределено;
	ДокументОбъект 							= Неопределено;
	Пока Выборка.Следующий() цикл
		Если Документ = Неопределено тогда
			ТабЧасть 						= Документ.НачисленияАбонентам;			 
		иначеЕсли ТекДом <>  Выборка.МКД тогда // первая строка выборки
			
			Если ТекДом<>Неопределено тогда
				ДокументОбъект.ДополнительныеСвойства.Вставить("ПроведениеРазрешено",Истина);
				ДокументОбъект.записать(РежимЗаписиДокумента.Проведение);
			КонецЕсли; 		
			
			Если ЗначениеЗаполнено(Выборка.ДокументНачисления) тогда
				ДокументОбъект  			= Выборка.ДокументНачисления.получитьОбъект();
			иначе
				ДокументОбъект  			= Документы.энргНачислениеПоРассрочке.СоздатьДокумент();
				ДокументОбъект.Дата 		= КонецПериодаРасчета;
			КонецЕсли;
			
			ДокументОбъект.ПометкаУдаления = ложь;
			ДокументОбъект.Район 			= Район;
			ДокументОбъект.МКД 			= Выборка.МКД;
			ТабЧасть 						= ДокументОбъект.НачисленияАбонентам
		КонецЕсли; 		
		СтрокаТЧ  							= ТабЧасть.Добавить();
		СтрокаТЧ.Абонент 					= Выборка.Абонент;
		СтрокаТЧ.СуммаНачисленныхПроцентов	= Выборка.Задолженность * СтРеф /(12* 100);
		ТекДом 								= Выборка.МКД;
	КонецЦикла;
	
	Если Документ = Неопределено и ДокументОбъект<>Неопределено тогда
		ДокументОбъект.ДополнительныеСвойства.Вставить("ПроведениеРазрешено",Истина);
		ДокументОбъект.Записать(РежимЗаписиДокумента.Проведение);
	КонецЕсли; 
	
КонецПроцедуры

// Применяется когда абонент платит одну и ту же сумму каждый месяц
Процедура АннуитетныйСпособРасчетаПроцентов(ПериодНачисления,Организация,Район,МКД)
	
	
	
КонецПроцедуры

Функция ТекстЗапросаДифференцированныйСпособРасчетаПроцентов()
	Текст 	=
	"ВЫБРАТЬ
	|	энргСтабильныеПериоды.Организация КАК Организация,
	|	энргСтабильныеПериоды.ПериодНачисления КАК ПериодНачисления,
	|	энргСтабильныеПериоды.Район КАК Район,
	|	энргСтабильныеПериоды.МКД КАК МКД,
	|	энргСтабильныеПериоды.Абонент КАК Абонент,
	|	энргСтабильныеПериоды.Услуга КАК Услуга,
	|	энргСтабильныеПериоды.ТочкаУчета КАК ТочкаУчета,
	|	МАКСИМУМ(энргСтабильныеПериоды.НомерПозиции) КАК НомерПозиции
	|ПОМЕСТИТЬ НомерПозиций
	|ИЗ
	|	РегистрСведений.энргСтабильныеПериоды КАК энргСтабильныеПериоды
	|ГДЕ
	|	энргСтабильныеПериоды.Организация = &Организация
	|	И энргСтабильныеПериоды.ПериодНачисления = &ПериодНачисления
	|	И энргСтабильныеПериоды.Район = &Район
	|	И энргСтабильныеПериоды.МКД = &МКД
	|
	|СГРУППИРОВАТЬ ПО
	|	энргСтабильныеПериоды.Организация,
	|	энргСтабильныеПериоды.ПериодНачисления,
	|	энргСтабильныеПериоды.МКД,
	|	энргСтабильныеПериоды.Район,
	|	энргСтабильныеПериоды.Услуга,
	|	энргСтабильныеПериоды.ТочкаУчета,
	|	энргСтабильныеПериоды.Абонент
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	энргСтабильныеПериоды.МКД КАК МКД,
	|	энргСтабильныеПериоды.Абонент КАК Абонент
	|ПОМЕСТИТЬ ОткрытыеЛС
	|ИЗ
	|	НомерПозиций КАК НомерПозиций
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргСтабильныеПериоды КАК энргСтабильныеПериоды
	|		ПО НомерПозиций.Организация = энргСтабильныеПериоды.Организация
	|			И НомерПозиций.ПериодНачисления = энргСтабильныеПериоды.ПериодНачисления
	|			И НомерПозиций.Район = энргСтабильныеПериоды.Район
	|			И НомерПозиций.МКД = энргСтабильныеПериоды.МКД
	|			И НомерПозиций.Абонент = энргСтабильныеПериоды.Абонент
	|			И НомерПозиций.Услуга = энргСтабильныеПериоды.Услуга
	|			И НомерПозиций.ТочкаУчета = энргСтабильныеПериоды.ТочкаУчета
	|			И НомерПозиций.НомерПозиции = энргСтабильныеПериоды.НомерПозиции
	|			И (энргСтабильныеПериоды.УслугаПодключена)
	|			И (энргСтабильныеПериоды.Организация = &Организация)
	|			И (энргСтабильныеПериоды.ПериодНачисления = &ПериодНачисления)
	|			И (энргСтабильныеПериоды.Район = &Район)
	|			И (энргСтабильныеПериоды.МКД = &МКД)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргЗадолженностьПоРассрочкеОстатки.МКД КАК МКД,
	|	энргЗадолженностьПоРассрочкеОстатки.Абонент КАК Абонент,
	|	энргЗадолженностьПоРассрочкеОстатки.СуммаЗадолженностиОстаток КАК СуммаЗадолженностиОстаток
	|ПОМЕСТИТЬ ЗадолженностьПоРассрочке
	|ИЗ
	|	РегистрНакопления.энргЗадолженностьПоРассрочке.Остатки(
	|			&ПериодНачисления,
	|			Организация = &Организация
	|				И Район = &Район
	|				И МКД = &МКД) КАК энргЗадолженностьПоРассрочкеОстатки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗадолженностьПоРассрочке.МКД КАК МКД,
	|	ЗадолженностьПоРассрочке.Абонент КАК Абонент,
	|	ЗадолженностьПоРассрочке.СуммаЗадолженностиОстаток КАК СуммаЗадолженностиОстаток
	|ПОМЕСТИТЬ ДанныеДляНачислений
	|ИЗ
	|	ОткрытыеЛС КАК ОткрытыеЛС
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ЗадолженностьПоРассрочке КАК ЗадолженностьПоРассрочке
	|		ПО ОткрытыеЛС.МКД = ЗадолженностьПоРассрочке.МКД
	|			И ОткрытыеЛС.Абонент = ЗадолженностьПоРассрочке.Абонент
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеДляНачислений.МКД КАК МКД,
	|	ДанныеДляНачислений.Абонент КАК Абонент,
	|	ДанныеДляНачислений.СуммаЗадолженностиОстаток КАК Задолженность,
	|	ЕСТЬNULL(энргНачислениеПоРассрочке.Ссылка, ЗНАЧЕНИЕ(Документ.энргНачислениеПоРассрочке.ПустаяСсылка)) КАК ДокументНачисления
	|ИЗ
	|	ДанныеДляНачислений КАК ДанныеДляНачислений
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.энргНачислениеПоРассрочке КАК энргНачислениеПоРассрочке
	|		ПО ДанныеДляНачислений.МКД = энргНачислениеПоРассрочке.МКД
	|			И (энргНачислениеПоРассрочке.Организация = &Организация)
	|			И (энргНачислениеПоРассрочке.Район = &Район)
	|			И (энргНачислениеПоРассрочке.Дата = &КонецПериодаРасчета)
	|			И (энргНачислениеПоРассрочке.МКД = &МКД)
	|
	|УПОРЯДОЧИТЬ ПО
	|	МКД
	|ИТОГИ
	|	МАКСИМУМ(ДокументНачисления)
	|ПО
	|	МКД";
	Возврат Текст;
КонецФункции

#КонецОбласти

#Область ЗакрытьПериодДляРедактирования_ВспомогательныеФункции

Функция ДокуметЗакрытияПериода(Организация,ПериодНачисления,Район)
	
	Запрос  		= Новый Запрос;
	Запрос.УстановитьПараметр("ПериодНачисления",	ПериодНачисления);
	Запрос.УстановитьПараметр("Организация",		Организация);
	Запрос.УстановитьПараметр("Район",				Район);
	Запрос.Текст 	="ВЫБРАТЬ ПЕРВЫЕ 1
	|	энргЗакрытиеПериода.Ссылка
	|ИЗ
	|	Документ.энргЗакрытиеПериода КАК энргЗакрытиеПериода
	|ГДЕ
	|	НЕ энргЗакрытиеПериода.ПометкаУдаления
	|	И энргЗакрытиеПериода.Район = &Район
	|	И энргЗакрытиеПериода.Организация = &Организация
	|	И энргЗакрытиеПериода.ПериодНачисления = &ПериодНачисления";
	Результат  		= Запрос.Выполнить();
	Выборка  		= Результат.Выбрать();
	Если Выборка.Следующий() тогда
		Возврат  Выборка.Ссылка;
	КонецЕсли;
	Возврат Документы.энргЗакрытиеПериода.ПустаяСсылка();	
КонецФункции

#КонецОбласти

#Область РаспредениеОбъемаМКД_ВспомогательныеПроцедуры

Процедура РаспределитьОбъемПоУслугеМКД(ПериодНачисления, Организация, Район, МКД, Услуга, ГраницыПериода, ЗначенияТарифов, ДанныеПоУслуге, ДокументОбъект, РаспределениеОбъемаПоУслугам, НаборЗаписей, НаборЗаписейПомещение,НаборЗаписейНП, НаборЗаписейСверхНорма, ИспользоватьТарифРек)
	
	// УсловиеОтопления - если есть начисления по прибору
	// и всего абонентов = всего с прибором
	ПустаяТочкаУчета 										= Справочники.энргТочкиУчета.ПустаяСсылка();
	ВидНачисления 											= Перечисления.энргВидыНачислений.Начисление;
	
	РаспределениеПоАбонентам 								= Новый Соответствие;
	
	
	ЕстьПотреблениеПоПрибору 								= ДанныеПоУслуге.ПоказанияПредоставлены <> 0;	
	ТочностьОбъемаНачислений 								= Метаданные.РегистрыНакопления.энргОбъемНачислений.Ресурсы.ОбъемУслуги.Тип.КвалификаторыЧисла.РазрядностьДробнойЧасти;
	
	// TODO
	// FIX ME
	// Добавить распределение в разбивки тарифных зон
	//НадоРаспределитьПоФакту									= ДанныеПоУслуге.ОбъемПотребленныйПоПрибору + ДанныеПоУслуге.ОбъемПотребленныйБезПрибора;
	
	Если ДанныеПоУслуге.НеНачислятьУслугуАбонентам Тогда
		НадоРаспределить									= ДанныеПоУслуге.ОбъемПотребленныйПоПрибору + ДанныеПоУслуге.ОбъемПотребленныйБезПрибора;
	Иначе
		НадоРаспределить 									= ДанныеПоУслуге.ОбъемПоПрибору + ДанныеПоУслуге.ОбъемБезПрибора;
	КонецЕсли;
	ВидНачисления 											= Перечисления.энргВидыНачислений.НачислениеОДН;	
	СпособНачисленияОДН 									= Перечисления.энргСпособНачислений.ПустаяСсылка();
	ОбщийОбъемНачислений 									= ДанныеПоУслуге.ОбщийОбъемНачислений;
	ОбщийОбъемНачисленийПомещений 							= ДанныеПоУслуге.ОбщийОбъемНачисленийПомещений;
	
	Если ДанныеПоУслуге.КорректироватьИндивидуальныйОбъемСУчетомОДПУ и ЕстьПотреблениеПоПрибору И ДанныеПоУслуге.ВсеПоПрибору Тогда
		ОсталосьРаспределить 								= НадоРаспределить - ДанныеПоУслуге.ПотреблениеАбонентов; 		
		СпособНачисленияОДН 								= Перечисления.энргСпособНачислений.ПоПриборам;
	ИначеЕсли ДанныеПоУслуге.КорректироватьИндивидуальныйОбъемСУчетомОДПУ и НЕ ЕстьПотреблениеПоПрибору Тогда
		// Списываем начисленный индивидуальный объем по прибору учета
		Для Каждого СтрокаНачисленийАбонента ИЗ ДанныеПоУслуге.ОбъемПоПриборуКорректировать Цикл 
			Если ЗначениеЗаполнено(СтрокаНачисленийАбонента.Абонент) Тогда
				яНабор 										= НаборЗаписей;
				яНаборОбщий 								= ОбщийОбъемНачислений;
			Иначе
				яНабор 										= НаборЗаписейПомещение;
				яНаборОбщий 								= ОбщийОбъемНачисленийПомещений;
			КонецЕсли;			
			
			Если СтрокаНачисленийАбонента.СпособНачисления  = Перечисления.энргСпособНачислений.ПоПриборам 
				ИЛИ СтрокаНачисленийАбонента.СпособНачисления  = Перечисления.энргСпособНачислений.НачислениеПоСреднему Тогда
				Если НЕ СтрокаНачисленийАбонента.ОбъемУслуги = 0 ИЛИ НЕ СтрокаНачисленийАбонента.Сумма = 0 Тогда
					СтрокаНабора  				= яНабор.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийАбонента,,"ОбъемУслугиПотребленный");
					СтрокаНабора.Распределение 				= Истина;
					СтрокаНабора.ОбъемУслуги 				= -СтрокаНабора.ОбъемУслуги;
					СтрокаНабора.Сумма 						= -СтрокаНабора.Сумма;
					СтрокаНабора.Период 					= ГраницыПериода.ЗавершениеОП-1;
					ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслугиПотребленный");
				КонецЕсли;
				
				Если СтрокаНачисленийАбонента.ПомещениеРодитель = СтрокаНачисленийАбонента.Помещение Тогда
					// добавляем новую строку начислений
					СтрокаНабора  							= яНабор.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийАбонента,,"ОбъемУслугиПотребленный");
					СтрокаНабора.Распределение 				= Истина;
					СтрокаНабора.СпособНачисления 			= Перечисления.энргСпособНачислений.ПоНормативу;
					ОбъемУслуги 							= СтрокаНабора.НормаПотребления * СтрокаНабора.ЗначениеПлощади * ((СтрокаНабора.ПлощадьАбонентов - СтрокаНабора.ПлощадьСобственнаяПоставка) / (СтрокаНабора.ПлощадьАбонентов - СтрокаНабора.ПлощадьСобственнаяПоставка + СтрокаНабора.ПлощадьМОП)) * (СтрокаНабора.КонецПериода - СтрокаНабора.НачалоПериода) / (ГраницыПериода.ДнейВПериоде * 86400);
					СтрокаНабора.ОбъемУслуги 				= ОбъемУслуги;
					СтрокаНабора.Сумма 						= СтрокаНабора.ОбъемУслуги * СтрокаНабора.ЗначениеТарифа;
					СтрокаНабора.Период 					= ГраницыПериода.ЗавершениеОП-1;
					ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслугиПотребленный");
					РазделенныеЛицевыеСчета 				= ДанныеПоУслуге.РазделенныеЛицевыеСчета;
					
					Если НЕ РазделенныеЛицевыеСчета[СтрокаНачисленийАбонента.Помещение] = Неопределено Тогда
						ОсталосьВнутриПомещения 			= ОбъемУслуги;
						ПомещенияПотомки					= РазделенныеЛицевыеСчета[СтрокаНачисленийАбонента.Помещение];
						СуммаПлощадейПомещения 				= 0;
						Для Каждого ПомещениеПотомок Из ПомещенияПотомки Цикл
							ДанныеПомещения  				= ПомещениеПотомок.Значение[Услуга];
							СуммаПлощадейПомещения 			= СуммаПлощадейПомещения + ДанныеПомещения.Значениеплощади; 
						КонецЦикла;		
						
						ПереасчитатьСтроки 					= Новый Массив;
						
						Для Каждого ПомещениеПотомок Из ПомещенияПотомки Цикл
							ДанныеПомещения  				= ПомещениеПотомок.Значение[Услуга];				                 		
							
							ХэшСтрокиТарифа 				= ХэшСтрокиТарифа(ДанныеПомещения.ТарифнаяГруппа,Услуга,ДанныеПомещения.Поставщик,Справочники.энргТарифныеЗоны.БезРазбивки); 
							ЗначениеТарифа 					= ?(ЗначенияТарифов[ХэшСтрокиТарифа] = Неопределено, Новый Структура("Значение", 0), ЗначенияТарифов[ХэшСтрокиТарифа]);
							СтрокаНабора  					= НаборЗаписей.Добавить();
							ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийАбонента,,"ОбъемУслугиПотребленный");
							СтрокаНабора.Распределение 		= Истина;
							СтрокаНабора.Период 			= ГраницыПериода.ЗавершениеОП-1;
							СтрокаНабора.Помещение			= ПомещениеПотомок.Ключ;
							СтрокаНабора.Абонент			= ДанныеПомещения.Абонент;						
							
							Если ДанныеПомещения.СпособРаспределенияОбъемаПомещения = Перечисления.энргСпособыРаспределенияОбъема.ФиксированныйОбъем Тогда
								СтрокаНабора.ОбъемУслуги 	= ДанныеПомещения.ФиксированныйОбъемПотребления;
								ОсталосьВнутриПомещения 	= ОсталосьВнутриПомещения - СтрокаНабора.ОбъемУслуги;
							ИначеЕсли ДанныеПомещения.СпособРаспределенияОбъемаПомещения = Перечисления.энргСпособыРаспределенияОбъема.ДолевоеРаспределение Тогда
								СтрокаНабора.ОбъемУслуги = ОбъемУслуги * ДанныеПомещения.ДоляПотребленияЧислитель / ДанныеПомещения.ДоляПотребленияЗнаменатель;
								ОсталосьВнутриПомещения 	= ОсталосьВнутриПомещения - СтрокаНабора.ОбъемУслуги;
							ИначеЕсли ДанныеПомещения.СпособРаспределенияОбъемаПомещения = Перечисления.энргСпособыРаспределенияОбъема.Остаток Тогда	
								ПереасчитатьСтроки.Добавить(НаборЗаписей.Индекс(СтрокаНабора));
							Иначе
								Если ЗначениеЗаполнено(ДанныеПоУслуге.ВидПлощади) Тогда
									СтрокаНабора.ОбъемУслуги = ?(НЕ СуммаПлощадейПомещения = 0, ОбъемУслуги * ДанныеПомещения.ЗначениеПлощади / СуммаПлощадейПомещения, 0);
								Иначе
									СтрокаНабора.ОбъемУслуги = ?(НЕ СтрокаНачисленийАбонента.КоличествоЖильцов = 0, ОбъемУслуги * ДанныеПомещения.КоличествоПроживающих / СтрокаНачисленийАбонента.КоличествоЖильцов, 0);
								КонецЕсли;
								ОсталосьВнутриПомещения 	= ОсталосьВнутриПомещения - СтрокаНабора.ОбъемУслуги;
							КонецЕсли;											
							
							СтрокаНабора.Сумма				= СтрокаНабора.ОбъемУслуги * ЗначениеТарифа.Значение;				
						КонецЦикла;
						
						Если ПереасчитатьСтроки.Количество() > 0 Тогда
							Для Сч = 0 По ПереасчитатьСтроки.ВГраница() Цикл
								СтрокаНабора 				= НаборЗаписей.Получить(ПереасчитатьСтроки[Сч]);
								СтрокаНабора.ОбъемУслуги 	= ОсталосьВнутриПомещения;
								СтрокаНабора.Сумма			= СтрокаНабора.ОбъемУслуги * ЗначениеТарифа.Значение;
							КонецЦикла;						
						КонецЕсли;					
					КонецЕсли;
				КонецЕсли;
			КонецЕсли;			
		КонецЦикла;
		
		Для Каждого СтрокаНачисленийНП ИЗ ДанныеПоУслуге.ОбъемПоПриборуНПКорректировать Цикл 
			Если ЗначениеЗаполнено(СтрокаНачисленийНП.ОбъектРасчета) Тогда
				яНабор 										= НаборЗаписейНП;
				яНаборОбщий 								= ОбщийОбъемНачислений;
			Иначе
				яНабор 										= НаборЗаписейПомещение;
				яНаборОбщий 								= ОбщийОбъемНачисленийПомещений;
			КонецЕсли;			
			
			Если СтрокаНачисленийНП.СпособНачисления  = Перечисления.энргСпособНачислений.ПоПриборам 
				ИЛИ СтрокаНачисленийНП.СпособНачисления  = Перечисления.энргСпособНачислений.НачислениеПоСреднему Тогда
				Если НЕ СтрокаНачисленийНП.ОбъемУслуги = 0 Тогда
					СтрокаНабора  				= яНабор.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийНП,,"ОбъемУслугиПотребленный");
					СтрокаНабора.Распределение 				= Истина;
					СтрокаНабора.ОбъемУслуги 				= -СтрокаНабора.ОбъемУслуги;
					СтрокаНабора.Период 					= ГраницыПериода.ЗавершениеОП-1;
					ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслугиПотребленный");
				КонецЕсли;
				
				
				// добавляем новую строку начислений
				СтрокаНабора  							= яНабор.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийНП,,"ОбъемУслугиПотребленный");
				СтрокаНабора.Распределение 				= Истина;
				СтрокаНабора.СпособНачисления 			= Перечисления.энргСпособНачислений.ПоНормативу;
				ОбъемУслуги 							= СтрокаНабора.НормаПотребления * СтрокаНабора.ЗначениеПлощади * ((СтрокаНабора.ПлощадьАбонентов - СтрокаНабора.ПлощадьСобственнаяПоставка) / (СтрокаНабора.ПлощадьАбонентов - СтрокаНабора.ПлощадьСобственнаяПоставка + СтрокаНабора.ПлощадьМОП)) * (СтрокаНабора.КонецПериода - СтрокаНабора.НачалоПериода) / (ГраницыПериода.ДнейВПериоде * 86400);

				СтрокаНабора.ОбъемУслуги 				= ОбъемУслуги;
				СтрокаНабора.Период 					= ГраницыПериода.ЗавершениеОП-1;
				ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслугиПотребленный");
				
			КонецЕсли;			
		КонецЦикла;
		
		// просто распределяем объем по нормативу
		ОсталосьРаспределить 								= НадоРаспределить;
		
	ИначеЕсли ДанныеПоУслуге.КорректироватьИндивидуальныйОбъемСУчетомОДПУ и ДанныеПоУслуге.ВсегоПлощадьАбонентовПоПрибору > 0 Тогда
		// Высчитываем потребление приборников на 1м2
		ОбъемНаКвМ 											= 0; 		
		СпособНачисленияОДН 								= Перечисления.энргСпособНачислений.ПоПриборам;
		Если  ДанныеПоУслуге.ВсегоПлощадьАбонентовПоПрибору <> 0 Тогда
			ОбъемНаКвМ 										= ДанныеПоУслуге.ПотреблениеАбонентовПоПрибору / ДанныеПоУслуге.ВсегоПлощадьАбонентовПоПрибору;			
		КонецЕсли;
		// Высчитываем "виртуальный" расход абонентов без прибора и корректируем объем потребления абонентов без прибора
		ПотреблениеАбонентов								= ДанныеПоУслуге.ПотреблениеАбонентовПоПрибору;
		Для Каждого СтрокаНачисленийАбонента ИЗ ДанныеПоУслуге.НачисленияАбонентовБезПрибора Цикл
			// снимаем начисленный ранее объем
			ЗначениеПлощади 								= ДанныеПоУслуге.ПлощадиАбонентов[СтрокаНачисленийАбонента.Помещение];
			ЕстьСуммаНачислений 							= Ложь;
			Если ЗначениеЗаполнено(СтрокаНачисленийАбонента.Абонент) Тогда
				яНабор 										= НаборЗаписей;
				яНаборОбщий 								= ОбщийОбъемНачислений;
				ЕстьСуммаНачислений 						= Истина;
			Иначе
				яНабор 										= НаборЗаписейПомещение;
				яНаборОбщий 								= ОбщийОбъемНачисленийПомещений;
			КонецЕсли;
			
			ИндексАбонента 									= Неопределено;
			
			// ищем строку в массиве
			Для Сч = 0 По ДанныеПоУслуге.АбонентыДляРаспределения.ВГраница() Цикл
				Если ДанныеПоУслуге.АбонентыДляРаспределения[Сч].Абонент = СтрокаНачисленийАбонента.Абонент или (ЗначениеЗаполнено(СтрокаНачисленийАбонента.ПомещениеРодитель) и ДанныеПоУслуге.АбонентыДляРаспределения[Сч].Помещение = СтрокаНачисленийАбонента.ПомещениеРодитель) Тогда
					ИндексАбонента 							= Сч;
					Прервать;
				КонецЕсли;					
			КонецЦикла;
						
			Если НЕ СтрокаНачисленийАбонента.ОбъемУслуги = 0 ИЛИ НЕ СтрокаНачисленийАбонента.Сумма = 0 Тогда
				СтрокаНабора  								= яНабор.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийАбонента,,"ОбъемУслугиПотребленный");
				СтрокаНабора.Период 						= ГраницыПериода.ЗавершениеОП-1;
				СтрокаНабора.Распределение 					= Истина;
				СтрокаНабора.ОбъемУслуги 					= -СтрокаНабора.ОбъемУслуги;
				СтрокаНабора.ОбъемУслугиСоцНорма 			= -СтрокаНабора.ОбъемУслугиСоцНорма;
				СтрокаНабора.ОбъемУслугиПотребленный 		= 0;
				
				Если ЕстьСуммаНачислений Тогда
					СтрокаНабора.Сумма 						= -СтрокаНабора.Сумма;
				КонецЕсли;
				
				ДанныеАбонента 								= ДанныеПоУслуге.АбонентыДляРаспределения[ИндексАбонента];
				ДанныеАбонента.ОбъемУслуги 					= ДанныеАбонента.ОбъемУслуги + СтрокаНабора.ОбъемУслуги;
				ДанныеАбонента.ОбъемУслугиСоцНорма 			= ДанныеАбонента.ОбъемУслугиСоцНорма + СтрокаНабора.ОбъемУслугиСоцНорма; 				
				
				ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслугиПотребленный");
			КонецЕсли;
			
			Если СтрокаНачисленийАбонента.СверхНорматива Тогда
				Продолжить;
			КонецЕсли;
				
			Если СтрокаНачисленийАбонента.ПомещениеРодитель = СтрокаНачисленийАбонента.Помещение и ЗначениеЗаполнено(СтрокаНачисленийАбонента.Абонент) Тогда
				
				КоэфДлительностиПериода 				= (СтрокаНачисленийАбонента.КонецПериода - СтрокаНачисленийАбонента.НачалоПериода)/(ГраницыПериода.ЗавершениеОП - ГраницыПериода.НачалоОП);
				ОбъемУслуги 							= Окр(ЗначениеПлощади * ОбъемНаКвМ * КоэфДлительностиПериода,ТочностьОбъемаНачислений);
				ПотреблениеАбонентов 					= ПотреблениеАбонентов + ОбъемУслуги;		
				
				СуммаПлощадейПомещения 					= 0;
				Если ОбъемУслуги > СтрокаНачисленийАбонента.ЗначениеСоциальнойНормы и СтрокаНачисленийАбонента.ЗначениеСоциальнойНормы <> -1 Тогда
					РазбитьПоСоцНорме(яНабор,яНаборОбщий,НаборЗаписей,СтрокаНачисленийАбонента,СтрокаНачисленийАбонента.ЗначениеСоциальнойНормы,СпособНачисленияОДН,ГраницыПериода,ДанныеПоУслуге,ЕстьСуммаНачислений,ЗначенияТарифов,Услуга,ПотреблениеАбонентов,СуммаПлощадейПомещения,Ложь, 0);
					РазбитьПоСоцНорме(яНабор,яНаборОбщий,НаборЗаписей,СтрокаНачисленийАбонента,ОбъемУслуги - СтрокаНачисленийАбонента.ЗначениеСоциальнойНормы,СпособНачисленияОДН,ГраницыПериода,ДанныеПоУслуге,ЕстьСуммаНачислений,ЗначенияТарифов,Услуга,ПотреблениеАбонентов,СуммаПлощадейПомещения,Истина, 0);
				Иначе
					РазбитьПоСоцНорме(яНабор,яНаборОбщий,НаборЗаписей,СтрокаНачисленийАбонента,ОбъемУслуги,СпособНачисленияОДН,ГраницыПериода,ДанныеПоУслуге,ЕстьСуммаНачислений,ЗначенияТарифов,Услуга,ПотреблениеАбонентов,СуммаПлощадейПомещения,Ложь, 0)
				КонецЕсли;

				
				
				//ЗначениеПлощади 							= ДанныеПоУслуге.ПлощадиАбонентов[СтрокаНачисленийАбонента.Помещение];			
				//СтрокаНабора  								= яНабор.Добавить();
				//ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийАбонента,,"ОбъемУслугиПотребленный");
				//СтрокаНабора.Распределение 					= Истина;
				//СтрокаНабора.СпособНачисления				= СпособНачисленияОДН;
				//КоэфДлительностиПериода 					= (СтрокаНачисленийАбонента.КонецПериода - СтрокаНачисленийАбонента.НачалоПериода)/(День(ГраницыПериода.ЗавершениеОП-1) * 86400);
				////ОбъемУслуги 								= СтрокаНабора.НормаПотребления * СтрокаНабора.ЗначениеПлощади * ((СтрокаНабора.ПлощадьАбонентов - СтрокаНабора.ПлощадьСобственнаяПоставка) / (СтрокаНабора.ПлощадьАбонентов - СтрокаНабора.ПлощадьСобственнаяПоставка + СтрокаНабора.ПлощадьМОП)) * (СтрокаНабора.КонецПериода - СтрокаНабора.НачалоПериода) / (ГраницыПериода.ДнейВПериоде * 86400);
				//ОбъемУслуги 								= ЗначениеПлощади * ОбъемНаКвМ * КоэфДлительностиПериода;
				//
				//СтрокаНабора.ОбъемУслуги 					= ОбъемУслуги;
				//СтрокаНабора.ОбъемУслугиПотребленный 		= 0;
				//СтрокаНабора.ОбъемУслугиСоцНорма 			= Мин(СтрокаНабора.ЗначениеСоциальнойНормы, ОбъемУслуги);
				//
				//СтрокаНабора.Период 						= ГраницыПериода.ЗавершениеОП-1;			
				//ПотреблениеАбонентов 						= ПотреблениеАбонентов + СтрокаНабора.ОбъемУслуги;
				//
				////отэк
				////СтрокаНабора  								= яНабор.Добавить();
				////ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийАбонента,,"ОбъемУслугиПотребленный");
				////СтрокаНабора.Распределение 					= Истина;
				////СтрокаНабора.СпособНачисления				= СпособНачисленияОДН;
				////КоэфДлительностиПериода 					= (СтрокаНачисленийАбонента.КонецПериода - СтрокаНачисленийАбонента.НачалоПериода)/(День(ГраницыПериода.ЗавершениеОП-1) * 86400);
				////ОбъемУслуги 								= СтрокаНабора.ПлощадьМОП*СтрокаНабора.НормаПотребления * СтрокаНабора.ЗначениеПлощади * ((СтрокаНабора.ПлощадьАбонентов - СтрокаНабора.ПлощадьСобственнаяПоставка) / (СтрокаНабора.ПлощадьАбонентов - СтрокаНабора.ПлощадьСобственнаяПоставка + СтрокаНабора.ПлощадьМОП)) * (СтрокаНабора.КонецПериода - СтрокаНабора.НачалоПериода) / (ГраницыПериода.ДнейВПериоде * 86400) / СтрокаНабора.ПлощадьАбонентов;
				//////ОбъемУслуги 								= ЗначениеПлощади * ОбъемНаКвМ * КоэфДлительностиПериода;
				////
				////СтрокаНабора.ОбъемУслуги 					= ОбъемУслуги;
				////СтрокаНабора.ОбъемУслугиПотребленный 		= 0;
				////СтрокаНабора.ОбъемУслугиСоцНорма 			= Мин(СтрокаНабора.ЗначениеСоциальнойНормы, ОбъемУслуги);
				////
				////СтрокаНабора.Период 						= ГраницыПериода.ЗавершениеОП-1;			
				////ПотреблениеАбонентов 						= ПотреблениеАбонентов + СтрокаНабора.ОбъемУслуги;
				////отэк

				////---
				//
				//
				//
				//Если СтрокаНабора.ОбъемУслуги > СтрокаНабора.ОбъемУслугиСоцНорма и СтрокаНабора.ОбъемУслугиСоцНорма > 0 Тогда
				//	ОбъемСверхНормы 						= СтрокаНабора.ОбъемУслуги - СтрокаНабора.ОбъемУслугиСоцНорма; 
				//	СтрокаНабора.ОбъемУслуги 				= ОбъемСверхНормы;
				//	
				//	СтрокаСверхНормы 						= яНабор.Добавить();
				//	ЗаполнитьЗначенияСвойств(СтрокаСверхНормы, СтрокаНабора,,"ОбъемУслугиПотребленный");
				//	СтрокаСверхНормы.ОбъемУслуги 			= ОбъемСверхНормы;
				//	СтрокаСверхНормы.СверхНорматива 		= Истина;
				//	СтрокаСверхНормы.ЗначениеТарифа 		= СтрокаСверхНормы.ЗначениеТарифаСверхНорматива;
				//	СтрокаСверхНормы.ОбъемУслугиСоцНорма 	= 0;
				//	СтрокаСверхНормы.ОбъемУслугиПотребленный= 0;
				//	
				//	Если ЕстьСуммаНачислений Тогда
				//		СтрокаСверхНормы.Сумма 				= СтрокаНабора.ОбъемУслуги * СтрокаНачисленийАбонента.ЗначениеТарифа;
				//	КонецЕсли;
				//	ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаСверхНормы,,"ОбъемУслугиПотребленный");
				//КонецЕсли;				
				//
				//ДанныеАбонента 								= ДанныеПоУслуге.АбонентыДляРаспределения[ИндексАбонента];
				//ДанныеАбонента.ОбъемУслугиСоцНорма 			= ДанныеАбонента.ОбъемУслугиСоцНорма + СтрокаНабора.ОбъемУслугиСоцНорма;								
				////---
				//
				//Если ЕстьСуммаНачислений Тогда
				//	СтрокаНабора.Сумма 						= СтрокаНабора.ОбъемУслуги * СтрокаНачисленийАбонента.ЗначениеТарифа;
				//КонецЕсли;
				//ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслугиПотребленный");
				//
				//РазделенныеЛицевыеСчета 					= ДанныеПоУслуге.РазделенныеЛицевыеСчета;
				//
				//Если НЕ РазделенныеЛицевыеСчета[СтрокаНачисленийАбонента.Помещение] = Неопределено Тогда
				//	ОсталосьВнутриПомещения 				= ОбъемУслуги;
				//	ПомещенияПотомки						= РазделенныеЛицевыеСчета[СтрокаНачисленийАбонента.Помещение];
				//	СуммаПлощадейПомещения 					= 0;
				//	
				//	Для Каждого ПомещениеПотомок Из ПомещенияПотомки Цикл
				//		ДанныеПомещения  					= ПомещениеПотомок.Значение[Услуга];
				//		СуммаПлощадейПомещения 				= СуммаПлощадейПомещения + ДанныеПомещения.Значениеплощади; 
				//	КонецЦикла;		
				//	
				//	ПереасчитатьСтроки 						= Новый Массив;
				//	
				//	Для Каждого ПомещениеПотомок Из ПомещенияПотомки Цикл
				//		ДанныеПомещения  					= ПомещениеПотомок.Значение[Услуга];				                 		
				//		
				//		ХэшСтрокиТарифа 					= ХэшСтрокиТарифа(ДанныеПомещения.ТарифнаяГруппа,Услуга,ДанныеПомещения.Поставщик,Справочники.энргТарифныеЗоны.БезРазбивки); 
				//		ЗначениеТарифа 						= ?(ЗначенияТарифов[ХэшСтрокиТарифа] = Неопределено, Новый Структура("Значение", 0), ЗначенияТарифов[ХэшСтрокиТарифа]);
				//		СтрокаНабора  						= НаборЗаписей.Добавить();
				//		ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийАбонента,,"ОбъемУслугиПотребленный");
				//		СтрокаНабора.Распределение 			= Истина;
				//		СтрокаНабора.СпособНачисления		= СпособНачисленияОДН;
				//		СтрокаНабора.Период 				= ГраницыПериода.ЗавершениеОП-1;
				//		СтрокаНабора.Помещение				= ПомещениеПотомок.Ключ;
				//		СтрокаНабора.Абонент				= ДанныеПомещения.Абонент;						
				//		
				//		Если ДанныеПомещения.СпособРаспределенияОбъемаПомещения = Перечисления.энргСпособыРаспределенияОбъема.ФиксированныйОбъем Тогда
				//			СтрокаНабора.ОбъемУслуги 		= ДанныеПомещения.ФиксированныйОбъемПотребления;
				//			ОсталосьВнутриПомещения 		= ОсталосьВнутриПомещения - СтрокаНабора.ОбъемУслуги;
				//		ИначеЕсли ДанныеПомещения.СпособРаспределенияОбъемаПомещения = Перечисления.энргСпособыРаспределенияОбъема.ДолевоеРаспределение Тогда
				//			СтрокаНабора.ОбъемУслуги = ОбъемУслуги * ДанныеПомещения.ДоляПотребленияЧислитель / ДанныеПомещения.ДоляПотребленияЗнаменатель;
				//			ОсталосьВнутриПомещения 		= ОсталосьВнутриПомещения - СтрокаНабора.ОбъемУслуги;
				//		ИначеЕсли ДанныеПомещения.СпособРаспределенияОбъемаПомещения = Перечисления.энргСпособыРаспределенияОбъема.Остаток Тогда	
				//			ПереасчитатьСтроки.Добавить(НаборЗаписей.Индекс(СтрокаНабора));
				//		Иначе
				//			Если ЗначениеЗаполнено(ДанныеПоУслуге.ВидПлощади) Тогда
				//				СтрокаНабора.ОбъемУслуги 	= ?(НЕ СуммаПлощадейПомещения = 0, ОбъемУслуги * ДанныеПомещения.ЗначениеПлощади / СуммаПлощадейПомещения, 0);
				//			Иначе
				//				СтрокаНабора.ОбъемУслуги 	= ?(НЕ СтрокаНачисленийАбонента.КоличествоЖильцов = 0, ОбъемУслуги * ДанныеПомещения.КоличествоПроживающих / СтрокаНачисленийАбонента.КоличествоЖильцов, 0);
				//			КонецЕсли;
				//			ОсталосьВнутриПомещения 		= ОсталосьВнутриПомещения - СтрокаНабора.ОбъемУслуги;
				//		КонецЕсли;											
				//		
				//		СтрокаНабора.Сумма					= СтрокаНабора.ОбъемУслуги * ЗначениеТарифа.Значение;				
				//	КонецЦикла;
				//	
				//	Если ПереасчитатьСтроки.Количество() > 0 Тогда
				//		Для Сч = 0 По ПереасчитатьСтроки.ВГраница() Цикл
				//			СтрокаНабора 					= НаборЗаписей.Получить(ПереасчитатьСтроки[Сч]);
				//			СтрокаНабора.ОбъемУслуги 		= ОсталосьВнутриПомещения;
				//			СтрокаНабора.Сумма				= СтрокаНабора.ОбъемУслуги * ЗначениеТарифа.Значение;
				//		КонецЦикла;						
				//	КонецЕсли;					
				//КонецЕсли;
			КонецЕсли;			
		КонецЦикла;
		
		//объем потребления НП без прибора
		Для Каждого СтрокаНачисленийНП ИЗ ДанныеПоУслуге.НачисленияНПБезПрибора Цикл
			// снимаем начисленный ранее объем
			ЗначениеПлощади 								= ДанныеПоУслуге.ПлощадиАбонентов[СтрокаНачисленийНП.ОбъектРасчета];
			ЕстьСуммаНачислений 							= Ложь;
			Если ЗначениеЗаполнено(СтрокаНачисленийНП.ОбъектРасчета) Тогда
				яНабор 										= НаборЗаписейНП;
				яНаборОбщий 								= ОбщийОбъемНачислений;
				ЕстьСуммаНачислений 						= Истина;
			Иначе
				яНабор 										= НаборЗаписейПомещение;
				яНаборОбщий 								= ОбщийОбъемНачисленийПомещений;
			КонецЕсли;		
			
			Если НЕ СтрокаНачисленийНП.ОбъемУслуги = 0 Тогда
				СтрокаНабора  								= яНабор.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийНП,,"ОбъемУслугиПотребленный");
				СтрокаНабора.Период 						= ГраницыПериода.ЗавершениеОП-1;
				СтрокаНабора.Распределение 					= Истина;
				СтрокаНабора.ОбъемУслуги 					= -СтрокаНабора.ОбъемУслуги;				
				ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслугиПотребленный");
			КонецЕсли;
			
			
			СтрокаНабора  								= яНабор.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийНП,,"ОбъемУслугиПотребленный");
			СтрокаНабора.Распределение 					= Истина;
			СтрокаНабора.СпособНачисления				= СпособНачисленияОДН;
			КоэфДлительностиПериода 					= (СтрокаНачисленийНП.КонецПериода - СтрокаНачисленийНП.НачалоПериода)/(День(ГраницыПериода.ЗавершениеОП-1) * 86400);
			ОбъемУслуги 								= ЗначениеПлощади * ОбъемНаКвМ * КоэфДлительностиПериода; 			
			СтрокаНабора.ОбъемУслуги 					= ОбъемУслуги;			
			СтрокаНабора.ОбъемУслугиПотребленный 		= 0;			
			СтрокаНабора.Период 						= ГраницыПериода.ЗавершениеОП-1;			
			ПотреблениеАбонентов 						= ПотреблениеАбонентов + СтрокаНабора.ОбъемУслуги;
						
			ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслугиПотребленный");
			
		КонецЦикла;

		
		ОсталосьРаспределить 								= НадоРаспределить - ПотреблениеАбонентов;		
	ИначеЕсли ДанныеПоУслуге.КорректироватьИндивидуальныйОбъемСУчетомОДПУ и ЕстьПотреблениеПоПрибору Тогда
		ОтапливаемаяПлощадь									= ДанныеПоУслуге.ВсегоПлощадьАбонентов - ДанныеПоУслуге.ВсегоПлощадьАбонентовСобственнаяПоставка + ДанныеПоУслуге.ПлощадьМОП;
		Если ДанныеПоУслуге.НеНачислятьУслугуАбонентам Тогда
			ОбъемНаКвМ 										= ?(ОтапливаемаяПлощадь = 0, 0, ДанныеПоУслуге.ОбъемПотребленныйПоПрибору / ОтапливаемаяПлощадь);
		Иначе
			ОбъемНаКвМ 										= ?(ОтапливаемаяПлощадь = 0, 0, ДанныеПоУслуге.ОбъемПоПрибору / ОтапливаемаяПлощадь);
		КонецЕсли; 	
		
		СпособНачисленияОДН 								= Перечисления.энргСпособНачислений.ПоПриборам;
		ПотреблениеАбонентов								= 0; 		
		Для Каждого СтрокаНачисленийАбонента ИЗ ДанныеПоУслуге.НачисленияАбонентовБезПрибора Цикл
			
				ЕстьСуммаНачислений 							= Ложь;
				Если ЗначениеЗаполнено(СтрокаНачисленийАбонента.Абонент) Тогда
					яНабор 										= НаборЗаписей;
					яНаборОбщий 								= ОбщийОбъемНачислений;
					ЕстьСуммаНачислений 						= Истина;
				Иначе
					яНабор 										= НаборЗаписейПомещение;
					яНаборОбщий 								= ОбщийОбъемНачисленийПомещений;
				КонецЕсли;
				
				ЗначениеПлощади 								= ДанныеПоУслуге.ПлощадиАбонентов[СтрокаНачисленийАбонента.Помещение];
				
				// снимаем начисленный ранее объем
				Если НЕ СтрокаНачисленийАбонента.ОбъемУслуги = 0 ИЛИ НЕ СтрокаНачисленийАбонента.Сумма = 0 Тогда
					СтрокаНабора  								= яНабор.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийАбонента,,"ОбъемУслугиПотребленный");
					СтрокаНабора.Распределение 					= Истина;
					СтрокаНабора.ОбъемУслуги 					= -СтрокаНабора.ОбъемУслуги;
					//Снятие объема потребленного при сторнировании объема услуги
					СтрокаНабора.ОбъемУслугиПотребленный 		= 0;
					//Снятие объема потребленного при сторнировании объема услуги
					СтрокаНабора.Период 						= ГраницыПериода.ЗавершениеОП-1;
					Если ЕстьСуммаНачислений Тогда
						СтрокаНабора.Сумма 						= -СтрокаНабора.Сумма;
					КонецЕсли;
					ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслугиПотребленный");
				КонецЕсли;
				
				
				Если СтрокаНачисленийАбонента.СверхНорматива Тогда
					Продолжить;
				КонецЕсли;
				
				Если СтрокаНачисленийАбонента.ПомещениеРодитель = СтрокаНачисленийАбонента.Помещение Тогда
					КоэфДлительностиПериода 				= (СтрокаНачисленийАбонента.КонецПериода - СтрокаНачисленийАбонента.НачалоПериода)/(ГраницыПериода.ЗавершениеОП - ГраницыПериода.НачалоОП);
					ОбъемУслуги 							= Окр(ЗначениеПлощади * ОбъемНаКвМ * КоэфДлительностиПериода,ТочностьОбъемаНачислений);
					ПотреблениеАбонентов 					= ПотреблениеАбонентов + ОбъемУслуги;		
					
					СуммаПлощадейПомещения 					= 0;
					Если ОбъемУслуги > СтрокаНачисленийАбонента.ЗначениеСоциальнойНормы и СтрокаНачисленийАбонента.ЗначениеСоциальнойНормы <> -1 Тогда
						РазбитьПоСоцНорме(яНабор,яНаборОбщий,НаборЗаписей,СтрокаНачисленийАбонента,СтрокаНачисленийАбонента.ЗначениеСоциальнойНормы,СпособНачисленияОДН,ГраницыПериода,ДанныеПоУслуге,ЕстьСуммаНачислений,ЗначенияТарифов,Услуга,ПотреблениеАбонентов,СуммаПлощадейПомещения,Ложь, 0);
						РазбитьПоСоцНорме(яНабор,яНаборОбщий,НаборЗаписей,СтрокаНачисленийАбонента,ОбъемУслуги - СтрокаНачисленийАбонента.ЗначениеСоциальнойНормы,СпособНачисленияОДН,ГраницыПериода,ДанныеПоУслуге,ЕстьСуммаНачислений,ЗначенияТарифов,Услуга,ПотреблениеАбонентов,СуммаПлощадейПомещения,Истина, 0);
					Иначе
						РазбитьПоСоцНорме(яНабор,яНаборОбщий,НаборЗаписей,СтрокаНачисленийАбонента,ОбъемУслуги,СпособНачисленияОДН,ГраницыПериода,ДанныеПоУслуге,ЕстьСуммаНачислений,ЗначенияТарифов,Услуга,ПотреблениеАбонентов,СуммаПлощадейПомещения,Ложь, 0)
					КонецЕсли;
					
				КонецЕсли;
				
		КонецЦикла;
		
		Для Каждого СтрокаНачисленийНП ИЗ ДанныеПоУслуге.НачисленияНПБезПрибора Цикл
			ЕстьСуммаНачислений 							= Ложь;
					
			Если ЗначениеЗаполнено(СтрокаНачисленийНП.ОбъектРасчета) Тогда
				яНабор 										= НаборЗаписейНП;
				яНаборОбщий 								= ОбщийОбъемНачислений;
				ЕстьСуммаНачислений 						= Истина;
			Иначе
				яНабор 										= НаборЗаписейПомещение;
				яНаборОбщий 								= ОбщийОбъемНачисленийПомещений;
			КонецЕсли;	
			
			ЗначениеПлощади 								= ДанныеПоУслуге.ПлощадиАбонентов[СтрокаНачисленийНП.ОбъектРасчета];
			
			// снимаем начисленный ранее объем
			Если НЕ СтрокаНачисленийНП.ОбъемУслуги = 0  Тогда
				СтрокаНабора  								= яНабор.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийНП,,"ОбъемУслугиПотребленный");
				СтрокаНабора.Распределение 					= Истина;
				СтрокаНабора.ОбъемУслуги 					= -СтрокаНабора.ОбъемУслуги;				
				СтрокаНабора.Период 						= ГраницыПериода.ЗавершениеОП-1;
				
				ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслугиПотребленный");
			КонецЕсли;
			
			СтрокаНабора  								= яНабор.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийНП,,"ОбъемУслугиПотребленный");
			СтрокаНабора.Распределение 					= Истина;
			СтрокаНабора.СпособНачисления				= СпособНачисленияОДН;
			ОбъемУслуги 								= ЗначениеПлощади * ОбъемНаКвМ;			
			КоэфДлительностиПериода 					= (СтрокаНачисленийНП.КонецПериода - СтрокаНачисленийНП.НачалоПериода)/(День(ГраницыПериода.ЗавершениеОП-1) * 86400);
			СтрокаНабора.ОбъемУслуги 					= ОбъемУслуги * КоэфДлительностиПериода;			
			СтрокаНабора.ОбъемУслугиПотребленный 		= 0;			
			СтрокаНабора.Период 						= ГраницыПериода.ЗавершениеОП-1;			
			ПотреблениеАбонентов 						= ПотреблениеАбонентов + СтрокаНабора.ОбъемУслуги;			
			ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслугиПотребленный");
			
		КонецЦикла;

		ОсталосьРаспределить 								= НадоРаспределить - ПотреблениеАбонентов;		
	ИначеЕсли ЕстьПотреблениеПоПрибору Тогда
		ОсталосьРаспределить 								= НадоРаспределить - ДанныеПоУслуге.ПотреблениеАбонентов;		
		СпособНачисленияОДН 								= Перечисления.энргСпособНачислений.ПоПриборам;
	Иначе
		ОсталосьРаспределить 								= НадоРаспределить; 		
		СпособНачисленияОДН 								= Перечисления.энргСпособНачислений.ПоНормативу;
	КонецЕсли;
	
	Если Не ДанныеПоУслуге.РаспределятьПолностью И Не ДанныеПоУслуге.НеРаспределятьСверхнорматив Тогда
		Если ОсталосьРаспределить > ДанныеПоУслуге.ОбъемУслугиНорматив  Тогда
			СверхнормативМКД 								= ОсталосьРаспределить - ДанныеПоУслуге.ОбъемУслугиНорматив;
			СпособНачисленияОДН 							= Перечисления.энргСпособНачислений.ПоНормативу;
			ОсталосьРаспределить 							= ДанныеПоУслуге.ОбъемУслугиНорматив;
			//добавить сверх в регистр
			
			СтрокаНабора  									= НаборЗаписейСверхНорма.Добавить();
			СтрокаНабора.Период 							= ГраницыПериода.ЗавершениеОП-1;
			СтрокаНабора.Район 								= Район;
			СтрокаНабора.Организация						= Организация;
			СтрокаНабора.МКД								= МКД;
			СтрокаНабора.Услуга								= Услуга;
			СтрокаНабора.ОбъемУслуги						= СверхнормативМКД;			
		КонецЕсли; 
		
	КонецЕсли;  
	
	Если ОсталосьРаспределить <= 0 Тогда
		Возврат;
	КонецЕсли;	
	
	АбонентыДляРаспределения 								= ДанныеПоУслуге.АбонентыДляРаспределения;
	Распределили 											= 0; 	
	Для Сч = 0 По АбонентыДляРаспределения.ВГраница() Цикл
		ДанныеАбонента 										= АбонентыДляРаспределения[Сч];		
		Если ЗначениеЗаполнено(ДанныеПоУслуге.ЗависитОтУслуги) Тогда
			ОбъемУслуги 									= 0;			
			Если РаспределениеОбъемаПоУслугам[ДанныеПоУслуге.ЗависитОтУслуги] = Неопределено Тогда
				ОбъемУслуги 								= 0; 
			ИначеЕсли РаспределениеОбъемаПоУслугам[ДанныеПоУслуге.ЗависитОтУслуги][ДанныеАбонента.Абонент] = Неопределено Тогда
				ОбъемУслуги 								= 0;
			Иначе
				ОбъемУслуги 								= РаспределениеОбъемаПоУслугам[ДанныеПоУслуге.ЗависитОтУслуги][ДанныеАбонента.Абонент] * ДанныеПоУслуге.ЗначениеНорматива;
			КонецЕсли;
			
			
		ИначеЕсли Сч = АбонентыДляРаспределения.ВГраница() Тогда
			ОбъемУслуги 									= ОсталосьРаспределить - Распределили;
			
		ИначеЕсли ДанныеПоУслуге.ВсегоПлощадьАбонентов = 0 Тогда
			ВызватьИсключение "Для МКД " + СокрЛП(МКД) + " не задана площадь помещений";	
		Иначе			
			кПлощади 										= ДанныеАбонента.ЗначениеПлощади / ДанныеПоУслуге.ВсегоПлощадьАбонентов;
			ОбъемУслуги 									= ОсталосьРаспределить * кПлощади;
			
		КонецЕсли; 				
		
		РаспределениеПоАбонентам.Вставить(ДанныеАбонента.Абонент, ОбъемУслуги);
		
		
		Если ДанныеАбонента.НП Тогда  
			СтрокаНабора  									= НаборЗаписейНП.Добавить();
			СтрокаНабора.Период 							= ГраницыПериода.ЗавершениеОП-1;
			СтрокаНабора.Район 								= Район;
			СтрокаНабора.Распределение 						= Истина;
			СтрокаНабора.Организация						= Организация;
			СтрокаНабора.МКД 								= МКД;
			СтрокаНабора.Договор							= ДанныеАбонента.Договор;
			СтрокаНабора.ОбъектРасчета						= ДанныеАбонента.Абонент;
			СтрокаНабора.Услуга								= Услуга;
			СтрокаНабора.ТочкаУчета							= ПустаяТочкаУчета;
			СтрокаНабора.ВидНачисления 						= ВидНачисления;
			СтрокаНабора.СпособНачисления 					= СпособНачисленияОДН;			
			СтрокаНабора.Поставщик 							= ДанныеАбонента.Поставщик;
			СтрокаНабора.ПериодРасчета						= ПериодНачисления;
			СтрокаНабора.ПериодНачисления					= ПериодНачисления;
			СтрокаНабора.ОбъемУслуги						= ОбъемУслуги;
			СтрокаНабора.ОбъемУслугиПотребленный			= 0;
			СтрокаНабора.ЗначениеПлощади 					= ДанныеАбонента.ЗначениеПлощади;
			Распределили 									= Распределили + СтрокаНабора.ОбъемУслуги;
			
						
		ИначеЕсли ЗначениеЗаполнено(ДанныеАбонента.Абонент) Тогда			
			ХэшСтрокиТарифа 								= ХэшСтрокиТарифа(ДанныеАбонента.ТарифнаяГруппа,Услуга,ДанныеАбонента.Поставщик,Справочники.энргТарифныеЗоны.БезРазбивки); 
			ОписаниеЗначениеТарифа 							= ?(ЗначенияТарифов[ХэшСтрокиТарифа] = Неопределено, Новый Структура("Значение,ЗначениеТарифаРЭК, ЗначениеСверхНорматива", 0,0,0), ЗначенияТарифов[ХэшСтрокиТарифа]);
			СтрокаНабора  									= НаборЗаписей.Добавить();
			СтрокаНабора.Период 							= ГраницыПериода.ЗавершениеОП-1;
			СтрокаНабора.Район 								= Район;
			СтрокаНабора.Распределение 						= Истина;
			СтрокаНабора.Организация						= Организация;
			СтрокаНабора.ЧастныйСектор 						= Ложь;
			СтрокаНабора.Строение							= МКД;
			СтрокаНабора.Помещение							= ДанныеАбонента.Помещение;
			СтрокаНабора.Абонент							= ДанныеАбонента.Абонент;
			СтрокаНабора.Услуга								= Услуга;
			СтрокаНабора.ТочкаУчета							= ПустаяТочкаУчета;
			СтрокаНабора.ВидНачисления 						= ВидНачисления;
			СтрокаНабора.НаправлениеИспользованияТУ 		= Справочники.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление;
			СтрокаНабора.Измеритель 						= Справочники.энргНаправлениеИспользованияТочекУчета.ПустаяСсылка();
			СтрокаНабора.СпособНачисления 					= СпособНачисленияОДН;
			СтрокаНабора.Поставщик 							= ДанныеАбонента.Поставщик;
			СтрокаНабора.ПериодРасчета						= ПериодНачисления;
			СтрокаНабора.ПериодНачисления					= ПериодНачисления;
			СтрокаНабора.ЗначениеПлощади 					= ДанныеАбонента.ЗначениеПлощади;
			
			ЗначениеТарифа 									= ?(НЕ ИспользоватьТарифРек, ОписаниеЗначениеТарифа.Значение, ОписаниеЗначениеТарифа.ЗначениеТарифаРЭК);
			ЗначениеТарифаСверхНормы						= ?(НЕ ИспользоватьТарифРек, ОписаниеЗначениеТарифа.ЗначениеСверхНорматива, ОписаниеЗначениеТарифа.ЗначениеТарифаРЭК);
			
			Распределили 									= Распределили + Окр(ОбъемУслуги,ТочностьОбъемаНачислений);
			
			
			ОбъемУслугиСверхНормы 							= 0;
			Если ДанныеПоУслуге.КорректироватьИндивидуальныйОбъемСУчетомОДПУ Тогда
				Если ДанныеАбонента.ОбъемУслуги  + ОбъемУслуги > ДанныеАбонента.ОбъемУслугиСоцНорма И ДанныеАбонента.ЗначениеСоциальнойНормы >= 0 Тогда
					ОстатокСоцНорма 						= ДанныеАбонента.ОбъемУслугиСоцНорма - ДанныеАбонента.ОбъемУслуги;
					ОбъемРаспределяем 						= ОбъемУслуги;
					Если ОстатокСоцНорма > 0 Тогда 
						ОбъемУслуги 						= Мин(ОстатокСоцНорма,ОбъемРаспределяем);
					Иначе
						ОбъемУслуги 						= 0;	
					КонецЕсли;
					ОбъемУслугиСверхНормы 					= ОбъемРаспределяем - Макс(ОстатокСоцНорма, 0);
				КонецЕсли; 			
			КонецЕсли;		
			
			Если НЕ ОбъемУслуги = 0 Тогда 				
				СтрокаНабора.ЗначениеТарифа 				= ЗначениеТарифа;			
				СтрокаНабора.ОбъемУслугиПотребленный		= 0;//ОбъемУслуги;
				Если ДанныеПоУслуге.НеНачислятьУслугуАбонентам Тогда
					СтрокаНабора.ОбъемУслуги 				= 0;
				Иначе
					СтрокаНабора.ОбъемУслуги 				= ОбъемУслуги;
				КонецЕсли;
				СтрокаНабора.Сумма							= СтрокаНабора.ОбъемУслуги * СтрокаНабора.ЗначениеТарифа;
			ИначеЕсли ОбъемУслугиСверхНормы > 0 Тогда
				СтрокаНабора.СверхНорматива 				= Истина;
				СтрокаНабора.ЗначениеТарифа 				= ЗначениеТарифаСверхНормы;			
				СтрокаНабора.ОбъемУслуги					= ОбъемУслугиСверхНормы;
				СтрокаНабора.ОбъемУслугиПотребленный		= 0;
				СтрокаНабора.Сумма							= СтрокаНабора.ОбъемУслуги * СтрокаНабора.ЗначениеТарифа;
			КонецЕсли;
			
			Если НЕ ОбъемУслуги = 0 и НЕ ОбъемУслугиСверхНормы = 0 Тогда
				СтрокаСверхНормы 							= НаборЗаписей.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаСверхНормы,СтрокаНабора);
				СтрокаСверхНормы.СверхНорматива 			= Истина;
				СтрокаСверхНормы.ЗначениеТарифа 			= ЗначениеТарифаСверхНормы;			
				СтрокаСверхНормы.ОбъемУслуги				= ОбъемУслугиСверхНормы;
				СтрокаСверхНормы.ОбъемУслугиПотребленный	= 0;
				СтрокаСверхНормы.Сумма						= СтрокаНабора.ОбъемУслуги * СтрокаНабора.ЗначениеТарифа;
			КонецЕсли;			
			
			
			ЗаполнитьЗначенияСвойств(ОбщийОбъемНачислений.Добавить(), СтрокаНабора);			
		Иначе
			СтрокаНабора  									= НаборЗаписейПомещение.Добавить();
			СтрокаНабора.Период 							= ГраницыПериода.ЗавершениеОП-1;
			СтрокаНабора.Район 								= Район;
			СтрокаНабора.Распределение 						= Истина;
			СтрокаНабора.Организация						= Организация;
			СтрокаНабора.ЧастныйСектор 						= Ложь;
			СтрокаНабора.Строение							= МКД;
			СтрокаНабора.Помещение							= ДанныеАбонента.Помещение; // TODO FIX ME
			СтрокаНабора.Услуга								= Услуга;
			СтрокаНабора.ТочкаУчета							= ПустаяТочкаУчета;
			СтрокаНабора.ВидНачисления 						= ВидНачисления;
			СтрокаНабора.Поставщик 							= ДанныеАбонента.Поставщик;
			СтрокаНабора.ПериодРасчета						= ПериодНачисления;
			СтрокаНабора.ПериодНачисления					= ПериодНачисления;
			СтрокаНабора.ОбъемУслуги						= ОбъемУслуги;
			СтрокаНабора.ЗначениеПлощади 					= ДанныеАбонента.ЗначениеПлощади;
			СтрокаНабора.СпособНачисления 					= СпособНачисленияОДН;
			ЗаполнитьЗначенияСвойств(ОбщийОбъемНачисленийПомещений.Добавить(), СтрокаНабора);
			
			Распределили 									= Распределили + СтрокаНабора.ОбъемУслуги;
			
			
			РазделенныеЛицевыеСчета 						= ДанныеПоУслуге.РазделенныеЛицевыеСчета;
			ПомещенияПотомки								= РазделенныеЛицевыеСчета[ДанныеАбонента.Помещение];
			СуммаПлощадейПомещения 							= 0;
			Для Каждого ПомещениеПотомок Из ПомещенияПотомки Цикл
				ДанныеПомещения  							= ПомещениеПотомок.Значение[Услуга];
				СуммаПлощадейПомещения 						= СуммаПлощадейПомещения + ДанныеПомещения.Значениеплощади; 
			КонецЦикла;		
			
			Для Каждого ПомещениеПотомок Из ПомещенияПотомки Цикл
				ДанныеПомещения  							= ПомещениеПотомок.Значение[Услуга];				                 		
				
				ХэшСтрокиТарифа 							= ХэшСтрокиТарифа(ДанныеПомещения.ТарифнаяГруппа,Услуга,ДанныеПомещения.Поставщик,Справочники.энргТарифныеЗоны.БезРазбивки); 
				ЗначениеТарифа 								= ?(ЗначенияТарифов[ХэшСтрокиТарифа] = Неопределено, Новый Структура("Значение,ЗначениеТарифаРЭК", 0, 0), ЗначенияТарифов[ХэшСтрокиТарифа]);
				СтрокаНабора  								= НаборЗаписей.Добавить();
				СтрокаНабора.Период 						= ГраницыПериода.ЗавершениеОП-1;
				СтрокаНабора.Район 							= Район;
				СтрокаНабора.Распределение 					= Истина;
				СтрокаНабора.Организация					= Организация;
				СтрокаНабора.ЧастныйСектор 					= Ложь;
				СтрокаНабора.Строение						= МКД;
				СтрокаНабора.Помещение						= ПомещениеПотомок.Ключ;
				СтрокаНабора.Абонент						= ДанныеПомещения.Абонент;
				СтрокаНабора.Услуга							= Услуга;
				СтрокаНабора.ТочкаУчета						= ПустаяТочкаУчета;
				СтрокаНабора.ВидНачисления 					= ВидНачисления;
				СтрокаНабора.СпособНачисления 				= СпособНачисленияОДН;
				СтрокаНабора.ЗначениеТарифа 				= ?(НЕ ИспользоватьТарифРек, ЗначениеТарифа.Значение, ЗначениеТарифа.ЗначениеТарифаРЭК);
				СтрокаНабора.Поставщик 						= ДанныеПомещения.Поставщик;
				СтрокаНабора.ПериодРасчета					= ПериодНачисления;
				СтрокаНабора.ПериодНачисления				= ПериодНачисления;
				СтрокаНабора.ЗначениеПлощади 				= ДанныеПомещения.ЗначениеПлощади;				
				СтрокаНабора.ОбъемУслуги 					= ?(НЕ СуммаПлощадейПомещения = 0, ОбъемУслуги * ДанныеПомещения.ЗначениеПлощади / СуммаПлощадейПомещения, 0);									
				СтрокаНабора.Сумма							= СтрокаНабора.ОбъемУслуги * СтрокаНабора.ЗначениеТарифа;				
			КонецЦикла;
			
		КонецЕсли;
	КонецЦикла;	  
	
	Если РаспределениеОбъемаПоУслугам[Услуга] = Неопределено Тогда
		РаспределениеОбъемаПоУслугам.Вставить(Услуга, РаспределениеПоАбонентам);
	КонецЕсли;	
	
	ДанныеПоУслуге.ОбщийОбъемНачислений						= ОбщийОбъемНачислений;
	ДанныеПоУслуге.ОбщийОбъемНачисленийПомещений			= ОбщийОбъемНачисленийПомещений;
	
КонецПроцедуры

Процедура РаспределитьОбъемПотребленныйПоУслугеМКД(ПериодНачисления, Организация, Район, МКД, Услуга, ГраницыПериода, ЗначенияТарифов, ДанныеПоУслуге, ДокументОбъект, РаспределениеОбъемаПоУслугам, НаборЗаписей, НаборЗаписейПомещение,НаборЗаписейНП, НаборЗаписейСверхНорма, ИспользоватьТарифРек)
	
	// УсловиеОтопления - если есть начисления по прибору
	// и всего абонентов = всего с прибором
	ПустаяТочкаУчета 										= Справочники.энргТочкиУчета.ПустаяСсылка();
	ВидНачисления 											= Перечисления.энргВидыНачислений.Начисление;
	
	РаспределениеПоАбонентам 								= Новый Соответствие;
	
	ТочностьОбъемаНачислений 								= Метаданные.РегистрыНакопления.энргОбъемНачислений.Ресурсы.ОбъемУслуги.Тип.КвалификаторыЧисла.РазрядностьДробнойЧасти;
	ЕстьПотреблениеПоПрибору 								= ДанныеПоУслуге.ПоказанияПредоставленыПотребленный <> 0;	
	
	// TODO
	// FIX ME
	// Добавить распределение в разбивки тарифных зон
	//НадоРаспределитьПоФакту									= ДанныеПоУслуге.ОбъемПотребленныйПоПрибору + ДанныеПоУслуге.ОбъемПотребленныйБезПрибора;
	
	НадоРаспределить										= ДанныеПоУслуге.ОбъемПотребленныйПоПрибору + ДанныеПоУслуге.ОбъемПотребленныйБезПрибора;
	
	ВидНачисления 											= Перечисления.энргВидыНачислений.НачислениеОДН;	
	СпособНачисленияОДН 									= Перечисления.энргСпособНачислений.ПустаяСсылка();
	ОбщийОбъемНачислений 									= ДанныеПоУслуге.ОбщийОбъемНачисленийПотребленный;
	ОбщийОбъемНачисленийПомещений 							= ДанныеПоУслуге.ОбщийОбъемНачисленийПомещенийПотребленный;
	
	Если ДанныеПоУслуге.КорректироватьИндивидуальныйОбъемСУчетомОДПУ и ЕстьПотреблениеПоПрибору И ДанныеПоУслуге.ВсеПоПриборуПотребленный Тогда
		ОсталосьРаспределить 								= НадоРаспределить - ДанныеПоУслуге.ПотреблениеАбонентовПотребленный; 		
		СпособНачисленияОДН 								= Перечисления.энргСпособНачислений.ПоПриборам;
	ИначеЕсли ДанныеПоУслуге.КорректироватьИндивидуальныйОбъемСУчетомОДПУ и НЕ ЕстьПотреблениеПоПрибору Тогда
		// Списываем начисленный индивидуальный объем по прибору учета
		Для Каждого СтрокаНачисленийАбонента ИЗ ДанныеПоУслуге.ОбъемПоПриборуКорректироватьПотребленный Цикл 
			Если ЗначениеЗаполнено(СтрокаНачисленийАбонента.Абонент) Тогда
				яНабор 										= НаборЗаписей;
				яНаборОбщий 								= ОбщийОбъемНачислений;
			Иначе
				яНабор 										= НаборЗаписейПомещение;
				яНаборОбщий 								= ОбщийОбъемНачисленийПомещений;
			КонецЕсли;			
			
			Если СтрокаНачисленийАбонента.СпособНачисления  = Перечисления.энргСпособНачислений.ПоПриборам 
				ИЛИ СтрокаНачисленийАбонента.СпособНачисления  = Перечисления.энргСпособНачислений.НачислениеПоСреднему Тогда
				Если НЕ СтрокаНачисленийАбонента.ОбъемУслугиПотребленный = 0 Тогда
					СтрокаНабора  				= яНабор.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийАбонента,,"ОбъемУслуги,Сумма");
					СтрокаНабора.Распределение 				= Истина;
					СтрокаНабора.ОбъемУслугиПотребленный	= -СтрокаНабора.ОбъемУслугиПотребленный;
					СтрокаНабора.Сумма 						= 0;
					СтрокаНабора.Период 					= ГраницыПериода.ЗавершениеОП-1;
					ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслуги,Сумма");
				КонецЕсли;
				
				Если СтрокаНачисленийАбонента.ПомещениеРодитель = СтрокаНачисленийАбонента.Помещение Тогда
					// добавляем новую строку начислений
					СтрокаНабора  							= яНабор.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийАбонента,,"ОбъемУслуги,Сумма");
					СтрокаНабора.Распределение 				= Истина;
					СтрокаНабора.СпособНачисления 			= Перечисления.энргСпособНачислений.ПоНормативу;
					ОбъемУслугиПотребленный 				= СтрокаНабора.НормаПотребления * СтрокаНабора.ЗначениеПлощади * ((СтрокаНабора.ПлощадьАбонентов - СтрокаНабора.ПлощадьСобственнаяПоставка) / (СтрокаНабора.ПлощадьАбонентов - СтрокаНабора.ПлощадьСобственнаяПоставка + СтрокаНабора.ПлощадьМОП)) * (СтрокаНабора.КонецПериода - СтрокаНабора.НачалоПериода) / (ГраницыПериода.ДнейВПериоде * 86400);
					СтрокаНабора.ОбъемУслугиПотребленный 	= ОбъемУслугиПотребленный;
					СтрокаНабора.Сумма 						= 0;
					СтрокаНабора.Период 					= ГраницыПериода.ЗавершениеОП-1;
					ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслуги,Сумма");
					РазделенныеЛицевыеСчета 				= ДанныеПоУслуге.РазделенныеЛицевыеСчета;
					
					Если НЕ РазделенныеЛицевыеСчета[СтрокаНачисленийАбонента.Помещение] = Неопределено Тогда
						ОсталосьВнутриПомещения 			= ОбъемУслугиПотребленный;
						ПомещенияПотомки					= РазделенныеЛицевыеСчета[СтрокаНачисленийАбонента.Помещение];
						СуммаПлощадейПомещения 				= 0;
						Для Каждого ПомещениеПотомок Из ПомещенияПотомки Цикл
							ДанныеПомещения  				= ПомещениеПотомок.Значение[Услуга];
							СуммаПлощадейПомещения 			= СуммаПлощадейПомещения + ДанныеПомещения.Значениеплощади; 
						КонецЦикла;		
						
						ПереасчитатьСтроки 					= Новый Массив;
						
						Для Каждого ПомещениеПотомок Из ПомещенияПотомки Цикл
							ДанныеПомещения  				= ПомещениеПотомок.Значение[Услуга];       		
							
							
							СтрокаНабора  					= НаборЗаписей.Добавить();
							ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийАбонента,,"ОбъемУслуги,Сумма");
							СтрокаНабора.Распределение 		= Истина;
							СтрокаНабора.Период 			= ГраницыПериода.ЗавершениеОП-1;
							СтрокаНабора.Помещение			= ПомещениеПотомок.Ключ;
							СтрокаНабора.Абонент			= ДанныеПомещения.Абонент;						
							
							Если ДанныеПомещения.СпособРаспределенияОбъемаПомещения = Перечисления.энргСпособыРаспределенияОбъема.ФиксированныйОбъем Тогда
								СтрокаНабора.ОбъемУслугиПотребленный 	= ДанныеПомещения.ФиксированныйОбъемПотребления;
								ОсталосьВнутриПомещения 	= ОсталосьВнутриПомещения - СтрокаНабора.ОбъемУслугиПотребленный;
							ИначеЕсли ДанныеПомещения.СпособРаспределенияОбъемаПомещения = Перечисления.энргСпособыРаспределенияОбъема.ДолевоеРаспределение Тогда
								СтрокаНабора.ОбъемУслугиПотребленный = ОбъемУслугиПотребленный * ДанныеПомещения.ДоляПотребленияЧислитель / ДанныеПомещения.ДоляПотребленияЗнаменатель;
								ОсталосьВнутриПомещения 	= ОсталосьВнутриПомещения - СтрокаНабора.ОбъемУслугиПотребленный;
							ИначеЕсли ДанныеПомещения.СпособРаспределенияОбъемаПомещения = Перечисления.энргСпособыРаспределенияОбъема.Остаток Тогда	
								ПереасчитатьСтроки.Добавить(НаборЗаписей.Индекс(СтрокаНабора));
							Иначе
								Если ЗначениеЗаполнено(ДанныеПоУслуге.ВидПлощади) Тогда
									СтрокаНабора.ОбъемУслугиПотребленный = ?(НЕ СуммаПлощадейПомещения = 0, ОбъемУслугиПотребленный * ДанныеПомещения.ЗначениеПлощади / СуммаПлощадейПомещения, 0);
								Иначе
									СтрокаНабора.ОбъемУслугиПотребленный = ?(НЕ СтрокаНачисленийАбонента.КоличествоЖильцов = 0, ОбъемУслугиПотребленный * ДанныеПомещения.КоличествоПроживающих / СтрокаНачисленийАбонента.КоличествоЖильцов, 0);
								КонецЕсли;
								ОсталосьВнутриПомещения 	= ОсталосьВнутриПомещения - СтрокаНабора.ОбъемУслугиПотребленный;
							КонецЕсли;											
							
							СтрокаНабора.Сумма				= 0;				
						КонецЦикла;
						
						Если ПереасчитатьСтроки.Количество() > 0 Тогда
							Для Сч = 0 По ПереасчитатьСтроки.ВГраница() Цикл
								СтрокаНабора 							= НаборЗаписей.Получить(ПереасчитатьСтроки[Сч]);
								СтрокаНабора.ОбъемУслугиПотребленный 	= ОсталосьВнутриПомещения;
								СтрокаНабора.Сумма						= 0;
							КонецЦикла;						
						КонецЕсли;					
					КонецЕсли;
				КонецЕсли;
			КонецЕсли;			
		КонецЦикла;
		
		Для Каждого СтрокаНачисленийНП ИЗ ДанныеПоУслуге.ОбъемПоПриборуНПКорректироватьПотребленный Цикл 
			Если ЗначениеЗаполнено(СтрокаНачисленийНП.ОбъектРасчета) Тогда
				яНабор 										= НаборЗаписейНП;
				яНаборОбщий 								= ОбщийОбъемНачислений;
			Иначе
				яНабор 										= НаборЗаписейПомещение;
				яНаборОбщий 								= ОбщийОбъемНачисленийПомещений;
			КонецЕсли;			
			
			Если СтрокаНачисленийНП.СпособНачисления  = Перечисления.энргСпособНачислений.ПоПриборам 
				ИЛИ СтрокаНачисленийНП.СпособНачисления  = Перечисления.энргСпособНачислений.НачислениеПоСреднему Тогда
				Если НЕ СтрокаНачисленийНП.ОбъемУслугиПотребленный = 0 Тогда
					СтрокаНабора  				= яНабор.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийНП,,"ОбъемУслуги");
					СтрокаНабора.Распределение 				= Истина;
					СтрокаНабора.ОбъемУслугиПотребленный 	= -СтрокаНабора.ОбъемУслугиПотребленный;
					СтрокаНабора.Период 					= ГраницыПериода.ЗавершениеОП-1;
					ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслуги");
				КонецЕсли;
				
				
				// добавляем новую строку начислений
				СтрокаНабора  							= яНабор.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийНП,,"ОбъемУслуги");
				СтрокаНабора.Распределение 				= Истина;
				СтрокаНабора.СпособНачисления 			= Перечисления.энргСпособНачислений.ПоНормативу;
				ОбъемУслугиПотребленный 				= СтрокаНабора.НормаПотребления * СтрокаНабора.ЗначениеПлощади * ((СтрокаНабора.ПлощадьАбонентов - СтрокаНабора.ПлощадьСобственнаяПоставка) / (СтрокаНабора.ПлощадьАбонентов - СтрокаНабора.ПлощадьСобственнаяПоставка + СтрокаНабора.ПлощадьМОП)) * (СтрокаНабора.КонецПериода - СтрокаНабора.НачалоПериода) / (ГраницыПериода.ДнейВПериоде * 86400);

				СтрокаНабора.ОбъемУслугиПотребленный 	= ОбъемУслугиПотребленный;
				СтрокаНабора.Период 					= ГраницыПериода.ЗавершениеОП-1;
				ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслуги");
				
			КонецЕсли;			
		КонецЦикла;
		
		// просто распределяем объем по нормативу
		ОсталосьРаспределить 								= НадоРаспределить;
		
	ИначеЕсли ДанныеПоУслуге.КорректироватьИндивидуальныйОбъемСУчетомОДПУ и ДанныеПоУслуге.ВсегоПлощадьАбонентовПоПриборуПотребленный > 0 Тогда
		// Высчитываем потребление приборников на 1м2
		ОбъемНаКвМ 											= 0; 		
		СпособНачисленияОДН 								= Перечисления.энргСпособНачислений.ПоПриборам;
		Если  ДанныеПоУслуге.ВсегоПлощадьАбонентовПоПриборуПотребленный <> 0 Тогда
			ОбъемНаКвМ 										= ДанныеПоУслуге.ПотреблениеАбонентовПоПриборуПотребленный / ДанныеПоУслуге.ВсегоПлощадьАбонентовПоПриборуПотребленный;			
		КонецЕсли;
		// Высчитываем "виртуальный" расход абонентов без прибора и корректируем объем потребления абонентов без прибора
		ПотреблениеАбонентов								= ДанныеПоУслуге.ПотреблениеАбонентовПоПриборуПотребленный;
		Для Каждого СтрокаНачисленийАбонента ИЗ ДанныеПоУслуге.НачисленияАбонентовБезПрибораПотребленный Цикл
			// снимаем начисленный ранее объем
			ЗначениеПлощади 								= ДанныеПоУслуге.ПлощадиАбонентов[СтрокаНачисленийАбонента.Помещение];
			ЕстьСуммаНачислений 							= Ложь;
			Если ЗначениеЗаполнено(СтрокаНачисленийАбонента.Абонент) Тогда
				яНабор 										= НаборЗаписей;
				яНаборОбщий 								= ОбщийОбъемНачислений;
				ЕстьСуммаНачислений 						= Истина;
			Иначе
				яНабор 										= НаборЗаписейПомещение;
				яНаборОбщий 								= ОбщийОбъемНачисленийПомещений;
			КонецЕсли;
			
			ИндексАбонента 									= Неопределено;
			
			// ищем строку в массиве
			Для Сч = 0 По ДанныеПоУслуге.АбонентыДляРаспределения.ВГраница() Цикл
				Если ДанныеПоУслуге.АбонентыДляРаспределения[Сч].Абонент = СтрокаНачисленийАбонента.Абонент или (ЗначениеЗаполнено(СтрокаНачисленийАбонента.ПомещениеРодитель) и ДанныеПоУслуге.АбонентыДляРаспределения[Сч].Помещение = СтрокаНачисленийАбонента.ПомещениеРодитель) Тогда
					ИндексАбонента 							= Сч;
					Прервать;
				КонецЕсли;					
			КонецЦикла;
						
			Если НЕ СтрокаНачисленийАбонента.ОбъемУслугиПотребленный = 0 Тогда
				СтрокаНабора  								= яНабор.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийАбонента,,"ОбъемУслуги,Сумма");
				СтрокаНабора.Период 						= ГраницыПериода.ЗавершениеОП-1;
				СтрокаНабора.Распределение 					= Истина;
				СтрокаНабора.ОбъемУслуги 					= 0;
				СтрокаНабора.ОбъемУслугиСоцНорма 			= 0;
				СтрокаНабора.ОбъемУслугиПотребленный 		= -СтрокаНабора.ОбъемУслугиПотребленный;	
				
				
				ДанныеАбонента 								= ДанныеПоУслуге.АбонентыДляРаспределения[ИндексАбонента];
				ДанныеАбонента.ОбъемУслугиПотребленный 		= ДанныеАбонента.ОбъемУслугиПотребленный + СтрокаНабора.ОбъемУслугиПотребленный;
				
				ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслуги,Сумма");
			КонецЕсли;
									
			Если СтрокаНачисленийАбонента.ПомещениеРодитель = СтрокаНачисленийАбонента.Помещение Тогда
				ЗначениеПлощади 							= ДанныеПоУслуге.ПлощадиАбонентов[СтрокаНачисленийАбонента.Помещение];			
				СтрокаНабора  								= яНабор.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийАбонента,,"ОбъемУслуги,Сумма");
				СтрокаНабора.Распределение 					= Истина;
				СтрокаНабора.СпособНачисления				= СпособНачисленияОДН;
				КоэфДлительностиПериода 					= (СтрокаНачисленийАбонента.КонецПериода - СтрокаНачисленийАбонента.НачалоПериода)/(День(ГраницыПериода.ЗавершениеОП-1) * 86400);
				ОбъемУслугиПотребленный 					= ЗначениеПлощади * ОбъемНаКвМ * КоэфДлительностиПериода;
				
				СтрокаНабора.ОбъемУслуги 					= 0;
				СтрокаНабора.ОбъемУслугиПотребленный 		= ОбъемУслугиПотребленный;
				СтрокаНабора.ОбъемУслугиСоцНорма 			= 0;
				
				СтрокаНабора.Период 						= ГраницыПериода.ЗавершениеОП-1;			
				ПотреблениеАбонентов 						= ПотреблениеАбонентов + СтрокаНабора.ОбъемУслугиПотребленный;			
								
				ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслуги,Сумма");
				
				РазделенныеЛицевыеСчета 					= ДанныеПоУслуге.РазделенныеЛицевыеСчета;
				
				Если НЕ РазделенныеЛицевыеСчета[СтрокаНачисленийАбонента.Помещение] = Неопределено Тогда
					ОсталосьВнутриПомещения 				= ОбъемУслугиПотребленный;
					ПомещенияПотомки						= РазделенныеЛицевыеСчета[СтрокаНачисленийАбонента.Помещение];
					СуммаПлощадейПомещения 					= 0;
					Для Каждого ПомещениеПотомок Из ПомещенияПотомки Цикл
						ДанныеПомещения  					= ПомещениеПотомок.Значение[Услуга];
						СуммаПлощадейПомещения 				= СуммаПлощадейПомещения + ДанныеПомещения.Значениеплощади; 
					КонецЦикла;		
					
					ПереасчитатьСтроки 						= Новый Массив;
					
					Для Каждого ПомещениеПотомок Из ПомещенияПотомки Цикл
						ДанныеПомещения  					= ПомещениеПотомок.Значение[Услуга];      		
						
						
						СтрокаНабора  						= НаборЗаписей.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийАбонента,,"ОбъемУслуги,Сумма");
						СтрокаНабора.Распределение 			= Истина;
						СтрокаНабора.СпособНачисления		= СпособНачисленияОДН;
						СтрокаНабора.Период 				= ГраницыПериода.ЗавершениеОП-1;
						СтрокаНабора.Помещение				= ПомещениеПотомок.Ключ;
						СтрокаНабора.Абонент				= ДанныеПомещения.Абонент;						
						
						Если ДанныеПомещения.СпособРаспределенияОбъемаПомещения = Перечисления.энргСпособыРаспределенияОбъема.ФиксированныйОбъем Тогда
							СтрокаНабора.ОбъемУслугиПотребленный 	= ДанныеПомещения.ФиксированныйОбъемПотребления;
							ОсталосьВнутриПомещения 				= ОсталосьВнутриПомещения - СтрокаНабора.ОбъемУслугиПотребленный;
						ИначеЕсли ДанныеПомещения.СпособРаспределенияОбъемаПомещения = Перечисления.энргСпособыРаспределенияОбъема.ДолевоеРаспределение Тогда
							СтрокаНабора.ОбъемУслугиПотребленный 	= ОбъемУслугиПотребленный * ДанныеПомещения.ДоляПотребленияЧислитель / ДанныеПомещения.ДоляПотребленияЗнаменатель;
							ОсталосьВнутриПомещения 				= ОсталосьВнутриПомещения - СтрокаНабора.ОбъемУслугиПотребленный;
						ИначеЕсли ДанныеПомещения.СпособРаспределенияОбъемаПомещения = Перечисления.энргСпособыРаспределенияОбъема.Остаток Тогда	
							ПереасчитатьСтроки.Добавить(НаборЗаписей.Индекс(СтрокаНабора));
						Иначе
							Если ЗначениеЗаполнено(ДанныеПоУслуге.ВидПлощади) Тогда
								СтрокаНабора.ОбъемУслугиПотребленный 	= ?(НЕ СуммаПлощадейПомещения = 0, ОбъемУслугиПотребленный * ДанныеПомещения.ЗначениеПлощади / СуммаПлощадейПомещения, 0);
							Иначе
								СтрокаНабора.ОбъемУслугиПотребленный 	= ?(НЕ СтрокаНачисленийАбонента.КоличествоЖильцов = 0, ОбъемУслугиПотребленный * ДанныеПомещения.КоличествоПроживающих / СтрокаНачисленийАбонента.КоличествоЖильцов, 0);
							КонецЕсли;
							ОсталосьВнутриПомещения 		= ОсталосьВнутриПомещения - СтрокаНабора.ОбъемУслугиПотребленный;
						КонецЕсли;											
						
						СтрокаНабора.Сумма					= 0;				
					КонецЦикла;
					
					Если ПереасчитатьСтроки.Количество() > 0 Тогда
						Для Сч = 0 По ПереасчитатьСтроки.ВГраница() Цикл
							СтрокаНабора 							= НаборЗаписей.Получить(ПереасчитатьСтроки[Сч]);
							СтрокаНабора.ОбъемУслугиПотребленный 	= ОсталосьВнутриПомещения;
							СтрокаНабора.Сумма						= 0;
						КонецЦикла;						
					КонецЕсли;					
				КонецЕсли;
			КонецЕсли;			
		КонецЦикла;
		
		//объем потребления НП без прибора
		Для Каждого СтрокаНачисленийНП ИЗ ДанныеПоУслуге.НачисленияНПБезПрибораПотребленный Цикл
			// снимаем начисленный ранее объем
			ЗначениеПлощади 								= ДанныеПоУслуге.ПлощадиАбонентов[СтрокаНачисленийНП.ОбъектРасчета];
			ЕстьСуммаНачислений 							= Ложь;
			Если ЗначениеЗаполнено(СтрокаНачисленийНП.ОбъектРасчета) Тогда
				яНабор 										= НаборЗаписейНП;
				яНаборОбщий 								= ОбщийОбъемНачислений;
				ЕстьСуммаНачислений 						= Истина;
			Иначе
				яНабор 										= НаборЗаписейПомещение;
				яНаборОбщий 								= ОбщийОбъемНачисленийПомещений;
			КонецЕсли;		
			
			Если НЕ СтрокаНачисленийНП.ОбъемУслуги = 0 Тогда
				СтрокаНабора  								= яНабор.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийНП,,"ОбъемУслуги");
				СтрокаНабора.Период 						= ГраницыПериода.ЗавершениеОП-1;
				СтрокаНабора.Распределение 					= Истина;
				СтрокаНабора.ОбъемУслугиПотребленный 		= -СтрокаНабора.ОбъемУслугиПотребленный;
				СтрокаНабора.ОбъемУслуги 					= 0;				
				//СтрокаНабора.Сумма 							= 0;				
				
				ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслуги");
			КонецЕсли;
			
			
			СтрокаНабора  								= яНабор.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийНП,,"ОбъемУслуги");
			СтрокаНабора.Распределение 					= Истина;
			СтрокаНабора.СпособНачисления				= СпособНачисленияОДН;
			КоэфДлительностиПериода 					= (СтрокаНачисленийНП.КонецПериода - СтрокаНачисленийНП.НачалоПериода)/(День(ГраницыПериода.ЗавершениеОП-1) * 86400);
			ОбъемУслугиПотребленный 					= ЗначениеПлощади * ОбъемНаКвМ * КоэфДлительностиПериода; 			
			СтрокаНабора.ОбъемУслуги 					= 0;			
			СтрокаНабора.ОбъемУслугиПотребленный 		= ОбъемУслугиПотребленный;			
			СтрокаНабора.Период 						= ГраницыПериода.ЗавершениеОП-1;			
			ПотреблениеАбонентов 						= ПотреблениеАбонентов + СтрокаНабора.ОбъемУслугиПотребленный;
						
			ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслуги");
			
		КонецЦикла;

		
		ОсталосьРаспределить 								= НадоРаспределить - ПотреблениеАбонентов;		
	ИначеЕсли ДанныеПоУслуге.КорректироватьИндивидуальныйОбъемСУчетомОДПУ и ЕстьПотреблениеПоПрибору Тогда
		ОтапливаемаяПлощадь									= ДанныеПоУслуге.ВсегоПлощадьАбонентов - ДанныеПоУслуге.ВсегоПлощадьАбонентовСобственнаяПоставка + ДанныеПоУслуге.ПлощадьМОП;
		ОбъемНаКвМ 											= ?(ОтапливаемаяПлощадь = 0, 0, ДанныеПоУслуге.ОбъемПотребленныйПоПрибору / ОтапливаемаяПлощадь);	
		
		СпособНачисленияОДН 								= Перечисления.энргСпособНачислений.ПоПриборам;
		ПотреблениеАбонентов								= 0; 		
		Для Каждого СтрокаНачисленийАбонента ИЗ ДанныеПоУслуге.НачисленияАбонентовБезПрибораПотребленный Цикл
			
				ЕстьСуммаНачислений 							= Ложь;
				Если ЗначениеЗаполнено(СтрокаНачисленийАбонента.Абонент) Тогда
					яНабор 										= НаборЗаписей;
					яНаборОбщий 								= ОбщийОбъемНачислений;
					ЕстьСуммаНачислений 						= Истина;
				Иначе
					яНабор 										= НаборЗаписейПомещение;
					яНаборОбщий 								= ОбщийОбъемНачисленийПомещений;
				КонецЕсли;
				
				ЗначениеПлощади 								= ДанныеПоУслуге.ПлощадиАбонентов[СтрокаНачисленийАбонента.Помещение];
				
				// снимаем начисленный ранее объем
				
				СтрокаНабора  								= яНабор.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийАбонента,,"ОбъемУслуги,Сумма");
				СтрокаНабора.Распределение 					= Истина;
				Если ЗначениеЗаполнено(СтрокаНачисленийАбонента.Абонент) Тогда					
					СтрокаНабора.Сумма		 			= 0;
					СтрокаНабора.ЗначениеТарифа		 	= СтрокаНачисленийАбонента.ЗначениеТарифа;					  
				КонецЕсли;
				СтрокаНабора.ОбъемУслуги 					= 0;
				//Снятие объема потребленного при сторнировании объема услуги
				СтрокаНабора.ОбъемУслугиПотребленный 		= -СтрокаНабора.ОбъемУслугиПотребленный;
				//Снятие объема потребленного при сторнировании объема услуги
				СтрокаНабора.Период 						= ГраницыПериода.ЗавершениеОП-1;
				
				ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслуги,Сумма");
				
				
				Если СтрокаНачисленийАбонента.ПомещениеРодитель = СтрокаНачисленийАбонента.Помещение Тогда
					КоэфДлительностиПериода 					= (СтрокаНачисленийАбонента.КонецПериода - СтрокаНачисленийАбонента.НачалоПериода)/((ГраницыПериода.ЗавершениеОП)- ГраницыПериода.НачалоОП);
					ОбъемУслугиПотребленный 					= Окр(ЗначениеПлощади * ОбъемНаКвМ * КоэфДлительностиПериода,ТочностьОбъемаНачислений);					
					ПотреблениеАбонентов 						= ПотреблениеАбонентов + ОбъемУслугиПотребленный;					
					СуммаПлощадейПомещения 						= 0; 		
				
					
					СтрокаНачисляем = яНабор.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаНачисляем,СтрокаНабора,,"ОбъемУслуги,Сумма");
					СтрокаНачисляем.ОбъемУслугиПотребленный 	= ОбъемУслугиПотребленный;				
					
				КонецЕсли;
				
				РазделенныеЛицевыеСчета 					= ДанныеПоУслуге.РазделенныеЛицевыеСчета;
				
				Если НЕ РазделенныеЛицевыеСчета[СтрокаНачисленийАбонента.Помещение] = Неопределено Тогда
					ОсталосьВнутриПомещения 				= ОбъемУслугиПотребленный;
					ПомещенияПотомки						= РазделенныеЛицевыеСчета[СтрокаНачисленийАбонента.Помещение];
					СуммаПлощадейПомещения 					= 0;
					Для Каждого ПомещениеПотомок Из ПомещенияПотомки Цикл
						ДанныеПомещения  					= ПомещениеПотомок.Значение[Услуга];
						СуммаПлощадейПомещения 				= СуммаПлощадейПомещения + ДанныеПомещения.Значениеплощади; 
					КонецЦикла;		
					
					ПереасчитатьСтроки 						= Новый Массив;
					
					Для Каждого ПомещениеПотомок Из ПомещенияПотомки Цикл
						ДанныеПомещения  					= ПомещениеПотомок.Значение[Услуга];      		
						
						ХэшСтрокиТарифа 							= ХэшСтрокиТарифа(ДанныеПомещения.ТарифнаяГруппа,Услуга,ДанныеПомещения.Поставщик,Справочники.энргТарифныеЗоны.БезРазбивки); 
						ЗначениеТарифа 								= ?(ЗначенияТарифов[ХэшСтрокиТарифа] = Неопределено, Новый Структура("Значение,ЗначениеТарифаРЭК", 0, 0), ЗначенияТарифов[ХэшСтрокиТарифа]);
						
						
						СтрокаНабора  						= НаборЗаписей.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийАбонента,,"ОбъемУслуги,Сумма");
						СтрокаНабора.Распределение 			= Истина;
						СтрокаНабора.СпособНачисления		= СпособНачисленияОДН;
						СтрокаНабора.Период 				= ГраницыПериода.ЗавершениеОП-1;
						СтрокаНабора.Помещение				= ПомещениеПотомок.Ключ;
						СтрокаНабора.Абонент				= ДанныеПомещения.Абонент;
						
						СтрокаНабора.ЗначениеТарифа			= ?(НЕ ИспользоватьТарифРек, ЗначениеТарифа.Значение, ЗначениеТарифа.ЗначениеТарифаРЭК);
						
						Если ДанныеПомещения.СпособРаспределенияОбъемаПомещения = Перечисления.энргСпособыРаспределенияОбъема.ФиксированныйОбъем Тогда
							СтрокаНабора.ОбъемУслугиПотребленный 	= ДанныеПомещения.ФиксированныйОбъемПотребления;
							ОсталосьВнутриПомещения 				= ОсталосьВнутриПомещения - СтрокаНабора.ОбъемУслугиПотребленный;
						ИначеЕсли ДанныеПомещения.СпособРаспределенияОбъемаПомещения = Перечисления.энргСпособыРаспределенияОбъема.ДолевоеРаспределение Тогда
							СтрокаНабора.ОбъемУслугиПотребленный 	= ОбъемУслугиПотребленный * ДанныеПомещения.ДоляПотребленияЧислитель / ДанныеПомещения.ДоляПотребленияЗнаменатель;
							ОсталосьВнутриПомещения 				= ОсталосьВнутриПомещения - СтрокаНабора.ОбъемУслугиПотребленный;
						ИначеЕсли ДанныеПомещения.СпособРаспределенияОбъемаПомещения = Перечисления.энргСпособыРаспределенияОбъема.Остаток Тогда	
							ПереасчитатьСтроки.Добавить(НаборЗаписей.Индекс(СтрокаНабора));
						Иначе
							Если ЗначениеЗаполнено(ДанныеПоУслуге.ВидПлощади) Тогда
								СтрокаНабора.ОбъемУслугиПотребленный 	= ?(НЕ СуммаПлощадейПомещения = 0, ОбъемУслугиПотребленный * ДанныеПомещения.ЗначениеПлощади / СуммаПлощадейПомещения, 0);
							Иначе
								СтрокаНабора.ОбъемУслугиПотребленный 	= ?(НЕ СтрокаНачисленийАбонента.КоличествоЖильцов = 0, ОбъемУслугиПотребленный * ДанныеПомещения.КоличествоПроживающих / СтрокаНачисленийАбонента.КоличествоЖильцов, 0);
							КонецЕсли;
							ОсталосьВнутриПомещения 		= ОсталосьВнутриПомещения - СтрокаНабора.ОбъемУслугиПотребленный;
						КонецЕсли;											
						
						СтрокаНабора.Сумма					= 0;				
					КонецЦикла;
					
					Если ПереасчитатьСтроки.Количество() > 0 Тогда
						Для Сч = 0 По ПереасчитатьСтроки.ВГраница() Цикл
							СтрокаНабора 							= НаборЗаписей.Получить(ПереасчитатьСтроки[Сч]);
							СтрокаНабора.ОбъемУслугиПотребленный 	= ОсталосьВнутриПомещения;
							СтрокаНабора.Сумма						= 0;
						КонецЦикла;						
					КонецЕсли;					
				КонецЕсли;
				
				
		КонецЦикла;
		
		Для Каждого СтрокаНачисленийНП ИЗ ДанныеПоУслуге.НачисленияНПБезПрибораПотребленный Цикл
			ЕстьСуммаНачислений 							= Ложь;
					
			Если ЗначениеЗаполнено(СтрокаНачисленийНП.ОбъектРасчета) Тогда
				яНабор 										= НаборЗаписейНП;
				яНаборОбщий 								= ОбщийОбъемНачислений;
				ЕстьСуммаНачислений 						= Истина;
			Иначе
				яНабор 										= НаборЗаписейПомещение;
				яНаборОбщий 								= ОбщийОбъемНачисленийПомещений;
			КонецЕсли;	
			
			ЗначениеПлощади 								= ДанныеПоУслуге.ПлощадиАбонентов[СтрокаНачисленийНП.ОбъектРасчета];
			
			// снимаем начисленный ранее объем
			Если НЕ СтрокаНачисленийНП.ОбъемУслугиПотребленный = 0 Тогда
				СтрокаНабора  								= яНабор.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийНП,,"ОбъемУслуги");
				СтрокаНабора.Распределение 					= Истина;
				//СтрокаНабора.Сумма		 				= 0;
				СтрокаНабора.ОбъемУслуги 					= 0;				
				СтрокаНабора.ОбъемУслугиПотребленный 		= -СтрокаНабора.ОбъемУслугиПотребленный;				
				СтрокаНабора.Период 						= ГраницыПериода.ЗавершениеОП-1;
				
				ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслуги");
			КонецЕсли;
			
			СтрокаНабора  								= яНабор.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийНП,,"ОбъемУслуги");
			СтрокаНабора.Распределение 					= Истина;
			СтрокаНабора.СпособНачисления				= СпособНачисленияОДН;
			ОбъемУслугиПотребленный 					= ЗначениеПлощади * ОбъемНаКвМ;			
			КоэфДлительностиПериода 					= (СтрокаНачисленийНП.КонецПериода - СтрокаНачисленийНП.НачалоПериода)/(День(ГраницыПериода.ЗавершениеОП-1) * 86400);
			СтрокаНабора.ОбъемУслуги 					= 0;			
			СтрокаНабора.ОбъемУслугиПотребленный 		= ОбъемУслугиПотребленный * КоэфДлительностиПериода;			
			СтрокаНабора.Период 						= ГраницыПериода.ЗавершениеОП-1;			
			ПотреблениеАбонентов 						= ПотреблениеАбонентов + СтрокаНабора.ОбъемУслугиПотребленный;			
			ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслуги");
			
		КонецЦикла;

		ОсталосьРаспределить 								= НадоРаспределить - ПотреблениеАбонентов;		
	ИначеЕсли ЕстьПотреблениеПоПрибору Тогда
		ОсталосьРаспределить 								= НадоРаспределить - ДанныеПоУслуге.ПотреблениеАбонентовПотребленный;		
		СпособНачисленияОДН 								= Перечисления.энргСпособНачислений.ПоПриборам;
	Иначе
		ОсталосьРаспределить 								= НадоРаспределить; 		
		СпособНачисленияОДН 								= Перечисления.энргСпособНачислений.ПоНормативу;
	КонецЕсли;
	
	Если Не ДанныеПоУслуге.РаспределятьПолностью И Не ДанныеПоУслуге.НеРаспределятьСверхнорматив Тогда
		Если ОсталосьРаспределить > ДанныеПоУслуге.ОбъемУслугиНорматив  Тогда
			СверхнормативМКД 								= ОсталосьРаспределить - ДанныеПоУслуге.ОбъемУслугиНорматив;
			СпособНачисленияОДН 							= Перечисления.энргСпособНачислений.ПоНормативу;
			ОсталосьРаспределить 							= ДанныеПоУслуге.ОбъемУслугиНорматив;
			//добавить сверх в регистр
			
			//отэк эта часть закомментирована
			СтрокаНабора  									= НаборЗаписейСверхНорма.Добавить();
			СтрокаНабора.Период 							= ГраницыПериода.ЗавершениеОП-1;
			СтрокаНабора.Район 								= Район;
			СтрокаНабора.Организация						= Организация;
			СтрокаНабора.МКД								= МКД;
			СтрокаНабора.Услуга								= Услуга;
			СтрокаНабора.ОбъемУслуги						= СверхнормативМКД;
			//отэк эта часть закомментирована

		КонецЕсли; 
		
	КонецЕсли;  
	
	Если ОсталосьРаспределить <= 0 Тогда
		Возврат;
	КонецЕсли;	
	
	АбонентыДляРаспределения 								= ДанныеПоУслуге.АбонентыДляРаспределения;
	Распределили 											= 0; 	
	Для Сч = 0 По АбонентыДляРаспределения.ВГраница() Цикл
		ДанныеАбонента 										= АбонентыДляРаспределения[Сч];		
			
		Если ЗначениеЗаполнено(ДанныеПоУслуге.ЗависитОтУслуги) Тогда
			ОбъемУслугиПотребленный 									= 0;			
			Если РаспределениеОбъемаПоУслугам[ДанныеПоУслуге.ЗависитОтУслуги] = Неопределено Тогда
				ОбъемУслугиПотребленный 								= 0; 
			ИначеЕсли РаспределениеОбъемаПоУслугам[ДанныеПоУслуге.ЗависитОтУслуги][ДанныеАбонента.Абонент] = Неопределено Тогда
				ОбъемУслугиПотребленный 								= 0;
			Иначе
				ОбъемУслугиПотребленный 								= РаспределениеОбъемаПоУслугам[ДанныеПоУслуге.ЗависитОтУслуги][ДанныеАбонента.Абонент] * ДанныеПоУслуге.ЗначениеНорматива;
			КонецЕсли;
			
			
		ИначеЕсли Сч = АбонентыДляРаспределения.ВГраница() Тогда
			ОбъемУслугиПотребленный 									= ОсталосьРаспределить - Распределили;
			
		ИначеЕсли ДанныеПоУслуге.ВсегоПлощадьАбонентов = 0 Тогда
			ВызватьИсключение "Для МКД " + СокрЛП(МКД) + " не задана площадь помещений";	
		Иначе			
			кПлощади 										= ДанныеАбонента.ЗначениеПлощади / ДанныеПоУслуге.ВсегоПлощадьАбонентов;
			ОбъемУслугиПотребленный 						= ОсталосьРаспределить * кПлощади;
			
		КонецЕсли; 				
		
		РаспределениеПоАбонентам.Вставить(ДанныеАбонента.Абонент, ОбъемУслугиПотребленный);
		
		
		Если ДанныеАбонента.НП Тогда
			
			СтрокаНабора  									= НаборЗаписейНП.Добавить();
			СтрокаНабора.Период 							= ГраницыПериода.ЗавершениеОП-1;
			СтрокаНабора.Район 								= Район;
			СтрокаНабора.Распределение 						= Истина;
			СтрокаНабора.Организация						= Организация;
			СтрокаНабора.МКД 								= МКД;
			СтрокаНабора.Договор							= ДанныеАбонента.Договор;
			СтрокаНабора.ОбъектРасчета						= ДанныеАбонента.Абонент;
			СтрокаНабора.Услуга								= Услуга;
			СтрокаНабора.ТочкаУчета							= ПустаяТочкаУчета;
			СтрокаНабора.ВидНачисления 						= ВидНачисления;
			СтрокаНабора.СпособНачисления 					= СпособНачисленияОДН;			
			СтрокаНабора.Поставщик 							= ДанныеАбонента.Поставщик;
			СтрокаНабора.ПериодРасчета						= ПериодНачисления;
			СтрокаНабора.ПериодНачисления					= ПериодНачисления;
			СтрокаНабора.ОбъемУслуги						= 0;
			СтрокаНабора.ОбъемУслугиПотребленный			= ОбъемУслугиПотребленный;
			СтрокаНабора.ЗначениеПлощади 					= ДанныеАбонента.ЗначениеПлощади;
			Распределили 									= Распределили + СтрокаНабора.ОбъемУслугиПотребленный;
			
						
		ИначеЕсли ЗначениеЗаполнено(ДанныеАбонента.Абонент) Тогда
			ХэшСтрокиТарифа 								= ХэшСтрокиТарифа(ДанныеАбонента.ТарифнаяГруппа,Услуга,ДанныеАбонента.Поставщик,Справочники.энргТарифныеЗоны.БезРазбивки); 
			ОписаниеЗначениеТарифа 							= ?(ЗначенияТарифов[ХэшСтрокиТарифа] = Неопределено, Новый Структура("Значение,ЗначениеТарифаРЭК, ЗначениеСверхНорматива", 0,0,0), ЗначенияТарифов[ХэшСтрокиТарифа]);
			
			СтрокаНабора  									= НаборЗаписей.Добавить();
			СтрокаНабора.Период 							= ГраницыПериода.ЗавершениеОП-1;
			СтрокаНабора.Район 								= Район;
			СтрокаНабора.Распределение 						= Истина;
			СтрокаНабора.Организация						= Организация;
			СтрокаНабора.ЧастныйСектор 						= Ложь;
			СтрокаНабора.Строение							= МКД;
			СтрокаНабора.Помещение							= ДанныеАбонента.Помещение;
			СтрокаНабора.Абонент							= ДанныеАбонента.Абонент;
			СтрокаНабора.Услуга								= Услуга;
			СтрокаНабора.ТочкаУчета							= ПустаяТочкаУчета;
			СтрокаНабора.ВидНачисления 						= ВидНачисления;
			СтрокаНабора.НаправлениеИспользованияТУ 		= Справочники.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление;
			СтрокаНабора.Измеритель 						= Справочники.энргНаправлениеИспользованияТочекУчета.ПустаяСсылка();
			СтрокаНабора.СпособНачисления 					= СпособНачисленияОДН;
			СтрокаНабора.Поставщик 							= ДанныеАбонента.Поставщик;
			СтрокаНабора.ПериодРасчета						= ПериодНачисления;
			СтрокаНабора.ПериодНачисления					= ПериодНачисления;
			СтрокаНабора.ЗначениеПлощади 					= ДанныеАбонента.ЗначениеПлощади;
			СтрокаНабора.ОбъемУслуги						= 0;
			СтрокаНабора.ОбъемУслугиПотребленный			= ОбъемУслугиПотребленный;
		
			Распределили 									= Распределили + СтрокаНабора.ОбъемУслугиПотребленный;
			
			ЗначениеТарифа 									= ?(НЕ ИспользоватьТарифРек, ОписаниеЗначениеТарифа.Значение, ОписаниеЗначениеТарифа.ЗначениеТарифаРЭК);
			СтрокаНабора.ЗначениеТарифа						= ЗначениеТарифа;
			 			
			ЗаполнитьЗначенияСвойств(ОбщийОбъемНачислений.Добавить(), СтрокаНабора);			
		Иначе
			
			//ХэшСтрокиТарифа 								= ХэшСтрокиТарифа(ДанныеАбонента.ТарифнаяГруппа,Услуга,ДанныеАбонента.Поставщик,Справочники.энргТарифныеЗоны.БезРазбивки); 
			//ОписаниеЗначениеТарифа 							= ?(ЗначенияТарифов[ХэшСтрокиТарифа] = Неопределено, Новый Структура("Значение,ЗначениеТарифаРЭК, ЗначениеСверхНорматива", 0,0,0), ЗначенияТарифов[ХэшСтрокиТарифа]); 			
			
			СтрокаНабора  									= НаборЗаписейПомещение.Добавить();
			СтрокаНабора.Период 							= ГраницыПериода.ЗавершениеОП-1;
			СтрокаНабора.Район 								= Район;
			СтрокаНабора.Распределение 						= Истина;
			СтрокаНабора.Организация						= Организация;
			СтрокаНабора.ЧастныйСектор 						= Ложь;
			СтрокаНабора.Строение							= МКД;
			СтрокаНабора.Помещение							= ДанныеАбонента.Помещение; // TODO FIX ME
			СтрокаНабора.Услуга								= Услуга;
			СтрокаНабора.ТочкаУчета							= ПустаяТочкаУчета;
			СтрокаНабора.ВидНачисления 						= ВидНачисления;
			СтрокаНабора.Поставщик 							= ДанныеАбонента.Поставщик;
			СтрокаНабора.ПериодРасчета						= ПериодНачисления;
			СтрокаНабора.ПериодНачисления					= ПериодНачисления;
			СтрокаНабора.ОбъемУслуги						= 0;
			СтрокаНабора.ОбъемУслугиПотребленный			= ОбъемУслугиПотребленный;
			СтрокаНабора.ЗначениеПлощади 					= ДанныеАбонента.ЗначениеПлощади;
			СтрокаНабора.СпособНачисления 					= СпособНачисленияОДН;
			//СтрокаНабора.ЗначениеТарифа 					= ?(НЕ ИспользоватьТарифРек, ОписаниеЗначениеТарифа.Значение, ОписаниеЗначениеТарифа.ЗначениеТарифаРЭК);
			
			ЗаполнитьЗначенияСвойств(ОбщийОбъемНачисленийПомещений.Добавить(), СтрокаНабора);
			
			Распределили 									= Распределили + СтрокаНабора.ОбъемУслугиПотребленный;
			
			
			РазделенныеЛицевыеСчета 						= ДанныеПоУслуге.РазделенныеЛицевыеСчета;
			ПомещенияПотомки								= РазделенныеЛицевыеСчета[ДанныеАбонента.Помещение];
			СуммаПлощадейПомещения 							= 0;
			Для Каждого ПомещениеПотомок Из ПомещенияПотомки Цикл
				ДанныеПомещения  							= ПомещениеПотомок.Значение[Услуга];
				СуммаПлощадейПомещения 						= СуммаПлощадейПомещения + ДанныеПомещения.Значениеплощади; 
			КонецЦикла;		
			
			Для Каждого ПомещениеПотомок Из ПомещенияПотомки Цикл
				ДанныеПомещения  							= ПомещениеПотомок.Значение[Услуга];				                 		
				
				ХэшСтрокиТарифа 							= ХэшСтрокиТарифа(ДанныеПомещения.ТарифнаяГруппа,Услуга,ДанныеПомещения.Поставщик,Справочники.энргТарифныеЗоны.БезРазбивки); 
				ЗначениеТарифа 								= ?(ЗначенияТарифов[ХэшСтрокиТарифа] = Неопределено, Новый Структура("Значение,ЗначениеТарифаРЭК", 0, 0), ЗначенияТарифов[ХэшСтрокиТарифа]);
				
				СтрокаНабора  								= НаборЗаписей.Добавить();
				СтрокаНабора.Период 						= ГраницыПериода.ЗавершениеОП-1;
				СтрокаНабора.Район 							= Район;
				СтрокаНабора.Распределение 					= Истина;
				СтрокаНабора.Организация					= Организация;
				СтрокаНабора.ЧастныйСектор 					= Ложь;
				СтрокаНабора.Строение						= МКД;
				СтрокаНабора.Помещение						= ПомещениеПотомок.Ключ;
				СтрокаНабора.Абонент						= ДанныеПомещения.Абонент;
				СтрокаНабора.Услуга							= Услуга;
				СтрокаНабора.ТочкаУчета						= ПустаяТочкаУчета;
				СтрокаНабора.ВидНачисления 					= ВидНачисления;
				СтрокаНабора.СпособНачисления 				= СпособНачисленияОДН;
				СтрокаНабора.ЗначениеТарифа 				= ?(НЕ ИспользоватьТарифРек, ЗначениеТарифа.Значение, ЗначениеТарифа.ЗначениеТарифаРЭК);
				//СтрокаНабора.ЗначениеТарифа 				= 0; было
				СтрокаНабора.Поставщик 						= ДанныеПомещения.Поставщик;
				СтрокаНабора.ПериодРасчета					= ПериодНачисления;
				СтрокаНабора.ПериодНачисления				= ПериодНачисления;
				СтрокаНабора.ЗначениеПлощади 				= ДанныеПомещения.ЗначениеПлощади;
				СтрокаНабора.ОбъемУслуги						= 0;
				СтрокаНабора.ОбъемУслугиПотребленный		= ?(НЕ СуммаПлощадейПомещения = 0, ОбъемУслугиПотребленный * ДанныеПомещения.ЗначениеПлощади / СуммаПлощадейПомещения, 0);									
				СтрокаНабора.Сумма							= 0;				
			КонецЦикла;
			
		КонецЕсли;
	КонецЦикла;	  
	
	Если РаспределениеОбъемаПоУслугам[Услуга] = Неопределено Тогда
		РаспределениеОбъемаПоУслугам.Вставить(Услуга, РаспределениеПоАбонентам);
	КонецЕсли;	
	
	ДанныеПоУслуге.ОбщийОбъемНачисленийПотребленный						= ОбщийОбъемНачислений;
	ДанныеПоУслуге.ОбщийОбъемНачисленийПомещенийПотребленный			= ОбщийОбъемНачисленийПомещений;
	
КонецПроцедуры

Процедура ПрочитатьВспомогательныеДанныеРаспределениеМКД(МВТ, Организация,ПериодНачисления,Район,Строение )	
	Запрос  						= Новый Запрос;
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Запрос.УстановитьПараметр("Организация",		Организация);
	Запрос.УстановитьПараметр("ПериодНачисления",	ПериодНачисления);
	Запрос.УстановитьПараметр("Район",				Район);
	Запрос.УстановитьПараметр("Строение",			Строение);
	Запрос.УстановитьПараметр("Поставщик",			Константы.энргПоставщикПоУмолчанию.Получить());
	Запрос.Текст 					= ТекстЗапросаВспомогательныеДанныеРаспределениеМКД(Строение);
	Запрос.Выполнить();
КонецПроцедуры

Процедура ЗаполнитьРазделенныеЛицевыеСчета(КлючРазделенныеЛицевыеСчета, РазделенныеЛицевыеСчета, ВыборкаРазделенныеЛицевыеСчета, ВыборкаОбъемМКД)
	
	Пока ВыборкаРазделенныеЛицевыеСчета.Строение  = ВыборкаОбъемМКД.Строение Цикл
		
		Если ВыборкаРазделенныеЛицевыеСчета.ПомещениеРодитель = null Тогда
			Если НЕ ВыборкаРазделенныеЛицевыеСчета.Следующий() Тогда
				Прервать;
			КонецЕсли;
			Продолжить;
		КонецЕсли;
		
		Если РазделенныеЛицевыеСчета[ВыборкаРазделенныеЛицевыеСчета.ПомещениеРодитель] = Неопределено Тогда													
			ЗначениеСоотвествия 			= Новый Структура(КлючРазделенныеЛицевыеСчета);
			ЗаполнитьЗначенияСвойств(ЗначениеСоотвествия,ВыборкаРазделенныеЛицевыеСчета);							
			СоотвествиеУслуга  				= Новый Соответствие;
			СоотвествиеУслуга.Вставить(ВыборкаРазделенныеЛицевыеСчета.Услуга,ЗначениеСоотвествия);
			СоотвествиеПомещение 			= Новый Соответствие;
			СоотвествиеПомещение.Вставить(ВыборкаРазделенныеЛицевыеСчета.Помещение,СоотвествиеУслуга);
			РазделенныеЛицевыеСчета.Вставить(ВыборкаРазделенныеЛицевыеСчета.ПомещениеРодитель, СоотвествиеПомещение);
		ИначеЕсли РазделенныеЛицевыеСчета[ВыборкаРазделенныеЛицевыеСчета.ПомещениеРодитель][ВыборкаРазделенныеЛицевыеСчета.Помещение] = Неопределено Тогда
			ЗначениеСоотвествия 			= Новый Структура(КлючРазделенныеЛицевыеСчета);
			ЗаполнитьЗначенияСвойств(ЗначениеСоотвествия,ВыборкаРазделенныеЛицевыеСчета);
			СоотвествиеУслуга  				= Новый Соответствие;
			СоотвествиеУслуга.Вставить(ВыборкаРазделенныеЛицевыеСчета.Услуга,ЗначениеСоотвествия);
			РазделенныеЛицевыеСчета[ВыборкаРазделенныеЛицевыеСчета.ПомещениеРодитель].Вставить(ВыборкаРазделенныеЛицевыеСчета.Помещение,СоотвествиеУслуга);
		Иначе 	
			ЗначениеСоотвествия 			= Новый Структура(КлючРазделенныеЛицевыеСчета);
			ЗаполнитьЗначенияСвойств(ЗначениеСоотвествия,ВыборкаРазделенныеЛицевыеСчета);
			РазделенныеЛицевыеСчета[ВыборкаРазделенныеЛицевыеСчета.ПомещениеРодитель][ВыборкаРазделенныеЛицевыеСчета.Помещение].Вставить(ВыборкаРазделенныеЛицевыеСчета.Услуга, ЗначениеСоотвествия);
		КонецЕсли;					
		
		Если НЕ ВыборкаРазделенныеЛицевыеСчета.Следующий() Тогда
			Прервать;
		КонецЕсли;						
	КонецЦикла;
	
КонецПроцедуры

Процедура ЗаписатьНаборыЗаписейПриРаспределении(Отказ, ДокументОбъект, ТекстИсключения, НаборВыполненные, НаборЗаписей, НаборЗаписейНП, НаборЗаписейПомещений, НаборЗаписейСверхНорма)
	
	Если Отказ Тогда
		ОтменитьТранзакцию();
		Возврат
	КонецЕсли;
	
	Если (Не НаборЗаписей = Неопределено и НаборЗаписей.Количество() > 0) ИЛИ 
		(Не НаборЗаписейНП = Неопределено и НаборЗаписейНП.Количество() > 0) ИЛИ  
		(НЕ НаборЗаписейПомещений = Неопределено И НаборЗаписейПомещений.Количество() > 0) Или
		(НЕ НаборЗаписейСверхНорма = Неопределено И НаборЗаписейСверхНорма.Количество() > 0) Тогда
		
		НаборОтложенныхДвижений	= РегистрыСведений.энргОтложенныеДвиженияДокументов.СоздатьНаборЗаписей();
		НаборОтложенныхДвижений.Отбор.Организация.Установить(НаборЗаписей.ДополнительныеСвойства.Организация);
		НаборОтложенныхДвижений.Отбор.ПериодНачисления.Установить(НаборЗаписей.ДополнительныеСвойства.ПериодНачисления);
		НаборОтложенныхДвижений.Отбор.Район.Установить(НаборЗаписей.ДополнительныеСвойства.Район);
		НаборОтложенныхДвижений.Отбор.РазделЗаписи.Установить(Перечисления.энргРазделыЗаписи.РаспределениеМКД);
		НаборОтложенныхДвижений.Отбор.ЧастныйСектор.Установить(Ложь);
		НаборОтложенныхДвижений.Отбор.Строение.Установить(НаборЗаписей.ДополнительныеСвойства.Строение);
		НаборОтложенныхДвижений.Записать();					
		
		Попытка 					
			Если Не ДокументОбъект = Неопределено Тогда
				ДокументОбъект.ДополнительныеСвойства.Вставить("ПроведениеРазрешено",Истина);
				ДокументОбъект.записать(РежимЗаписиДокумента.Запись);
			КонецЕсли;  			
			
			НаборЗаписей.Записать(); 			
			НаборЗаписейПомещений.Записать();		
			НаборЗаписейНП.Записать(); 			
			НаборЗаписейСверхНорма.Записать();			
			
			Если НЕ НаборВыполненные = Неопределено Тогда
				НаборВыполненные.Записать(НаборВыполненные.ДополнительныеСвойства.Замещать);
			КонецЕсли;
			
			ЗафиксироватьТранзакцию();
		Исключение
			Отказ 									= Истина;
			ИнформацияОбОшибке 						= ИнформацияОбОшибке();
			ТекстИсключения 						= ТекстИсключения + ?(ПустаяСтрока(ТекстИсключения),"",Символы.ПС) + ПодробноеПредставлениеОшибки(ИнформацияОбОшибке);
			ОтменитьТранзакцию();
		КонецПопытки;
	Иначе
		Попытка
			НаборОтложенныхДвижений					= РегистрыСведений.энргОтложенныеДвиженияДокументов.СоздатьНаборЗаписей();
			НаборОтложенныхДвижений.Отбор.Организация.Установить(НаборЗаписей.ДополнительныеСвойства.Организация);
			НаборОтложенныхДвижений.Отбор.ПериодНачисления.Установить(НаборЗаписей.ДополнительныеСвойства.ПериодНачисления);
			НаборОтложенныхДвижений.Отбор.Район.Установить(НаборЗаписей.ДополнительныеСвойства.Район);
			НаборОтложенныхДвижений.Отбор.РазделЗаписи.Установить(Перечисления.энргРазделыЗаписи.РаспределениеМКД);
			НаборОтложенныхДвижений.Отбор.ЧастныйСектор.Установить(Ложь);
			НаборОтложенныхДвижений.Отбор.Строение.Установить(НаборЗаписей.ДополнительныеСвойства.Строение);
			НаборОтложенныхДвижений.Записать();
			ЗафиксироватьТранзакцию();			
		Исключение
			ОтменитьТранзакцию();
		КонецПопытки;
	КонецЕсли;
	
КонецПроцедуры

Процедура ЗаполнитьДанныеАбонентовДляРаспределения(ДанныеПоУслуге, ВыборкаАбоненты, ВыборкаОбъемМКД, ВыборкаОбъемПоПриборуКорректировать, ВыборкаОбъемПоПриборуНПКорректировать)
	перем ТекПомещение,ДанныеАбонента;
	
	мАбонентыДляРаспределения 								= ДанныеПоУслуге.АбонентыДляРаспределения;
	ПотреблениеАбонентов 									= ДанныеПоУслуге.ПотреблениеАбонентов;
	ПотреблениеАбонентовПоПрибору 							= ДанныеПоУслуге.ПотреблениеАбонентовПоПрибору;
	ПотреблениеАбонентовПоФакту 							= ДанныеПоУслуге.ПотреблениеАбонентовПотребленный;
	ПотреблениеАбонентовПоПриборуПоФакту 					= ДанныеПоУслуге.ПотреблениеАбонентовПоПриборуПотребленный;
	ВсегоПлощадьАбонентовПоПрибору 							= ДанныеПоУслуге.ВсегоПлощадьАбонентовПоПрибору;
	
	ДанныеПоУслуге.ПоказанияПредоставлены 					= ВыборкаОбъемМКД.ПоказанияПредоставлены;
	
	// Двигаем выборку абонентов
	Пока НЕ ВыборкаАбоненты.Строение = ВыборкаОбъемМКД.Строение ИЛИ НЕ ВыборкаАбоненты.Услуга = ВыборкаОбъемМКД.Услуга Цикл
		Если НЕ ВыборкаАбоненты.Следующий() Тогда
			Прервать;
			ВыборкаАбоненты.сбросить();
		КонецЕсли;				
	КонецЦикла;
	
	ОбщийОбъемНачислений 									= ДанныеПоУслуге.ОбщийОбъемНачислений;
	ОбщийОбъемНачисленийПомещений							= ДанныеПоУслуге.ОбщийОбъемНачисленийПомещений;
	ОбщийОбъемНачисленийПотребленный 									= ДанныеПоУслуге.ОбщийОбъемНачисленийПотребленный;
	ОбщийОбъемНачисленийПомещенийПотребленный							= ДанныеПоУслуге.ОбщийОбъемНачисленийПомещенийПотребленный;
	ВсеПоПрибору 											= ДанныеПоУслуге.УВсехАбонентовПоПрибору;
	ВсеПоПриборуПотребленный 								= ДанныеПоУслуге.УВсехАбонентовПоПриборуПотребленный;
	ВсегоПлощадьАбонентовПоПрибору 							= ДанныеПоУслуге.ВсегоПлощадьАбонентовПоПрибору;
	ВсегоПлощадьАбонентовПоПриборуПотребленный 				= ДанныеПоУслуге.ВсегоПлощадьАбонентовПоПриборуПотребленный;
	ЕстьРасходПоПрибору 									= Ложь;
	ЕстьРасходПоПриборуПотребленный 						= Ложь;
	
	Пока ВыборкаАбоненты.Строение = ВыборкаОбъемМКД.Строение и ВыборкаАбоненты.Услуга = ВыборкаОбъемМКД.Услуга Цикл
		Если ЗначениеЗаполнено(ВыборкаАбоненты.Абонент) Тогда
			Если ВыборкаАбоненты.ОбъемУслуги <> 0 Тогда
				ЗаполнитьЗначенияСвойств(ОбщийОбъемНачислений.Добавить(), ВыборкаАбоненты,,"ОбъемУслугиПотребленный");
			КонецЕсли;
			Если ВыборкаАбоненты.ОбъемУслугиПотребленный <> 0 Тогда
				ЗаполнитьЗначенияСвойств(ОбщийОбъемНачисленийПотребленный.Добавить(), ВыборкаАбоненты,,"ОбъемУслуги");
			КонецЕсли;
		Иначе
			Если ВыборкаАбоненты.ОбъемУслуги <> 0 Тогда
				ЗаполнитьЗначенияСвойств(ОбщийОбъемНачисленийПомещений.Добавить(), ВыборкаАбоненты,,"ОбъемУслугиПотребленный");
			КонецЕсли;
			Если ВыборкаАбоненты.ОбъемУслугиПотребленный <> 0 Тогда
				ЗаполнитьЗначенияСвойств(ОбщийОбъемНачисленийПомещенийПотребленный.Добавить(), ВыборкаАбоненты,,"ОбъемУслуги");
			КонецЕсли;			
		КонецЕсли;
		
		Если НЕ ТекПомещение = ВыборкаАбоненты.Помещение Тогда
			Если Не ТекПомещение = Неопределено Тогда
				Если НЕ ДанныеАбонента.ПомещениеСРазделенными Тогда
					мАбонентыДляРаспределения.Добавить(ДанныеАбонента);
					ДанныеПоУслуге.ПлощадиАбонентов.Вставить(ТекПомещение,ДанныеАбонента.ЗначениеПлощади); 					
					
					Если ЕстьРасходПоПрибору Тогда
						ВсегоПлощадьАбонентовПоПрибору 		= ВсегоПлощадьАбонентовПоПрибору + ДанныеАбонента.ЗначениеПлощади; 
					КонецЕсли;
					
					Если ЕстьРасходПоПриборуПотребленный Тогда
						ВсегоПлощадьАбонентовПоПриборуПотребленный 		= ВсегоПлощадьАбонентовПоПриборуПотребленный + ДанныеАбонента.ЗначениеПлощади; 
					КонецЕсли;
					
				КонецЕсли;
			КонецЕсли;
			
			ДанныеАбонента 									= Новый Структура("
			|Договор, Абонент, Помещение,ЗначениеПлощади,
			|ТарифнаяГруппа, Поставщик, ОбъемУслуги, ОбъемУслугиСоцНорма, 
			|ЗначениеСоциальнойНормы, КоличествоЖильцов, НП, ПомещениеСРазделенными, ОбъемУслугиПотребленный",
			ВыборкаАбоненты.Договор, ВыборкаАбоненты.Абонент, ВыборкаАбоненты.Помещение,ВыборкаАбоненты.ЗначениеПлощадиДляРаспределения,
			ВыборкаАбоненты.ТарифнаяГруппаДляРаспределения,	ВыборкаАбоненты.ПоставщикДляРаспределения, 0, ВыборкаАбоненты.ОбъемУслугиСоцНорма,
			ВыборкаАбоненты.ЗначениеСоциальнойНормы,ВыборкаАбоненты.КоличествоЖильцов, ВыборкаАбоненты.НП, ВыборкаАбоненты.ПомещениеСРазделенными,0);
			
			ЕстьРасходПоПрибору 							= Ложь;					
			ЕстьРасходПоПриборуПотребленный					= Ложь;					
		КонецЕсли;				
		
		Если ВыборкаАбоненты.ЕстьИндивидуальныеНачисления Тогда 
			Если ВыборкаАбоненты.НП Тогда
				Если ВыборкаАбоненты.Договор.Контрагент <> ВыборкаАбоненты.Поставщик Тогда
					Если ВыборкаАбоненты.ОбъемУслуги <> 0 Тогда 
						СтрокаСписатьИндивидуальные  				= ДанныеПоУслуге.ДанныеНачисленийДоговоров.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаСписатьИндивидуальные, ВыборкаАбоненты,,"ОбъемУслугиПотребленный");						
						СтрокаСписатьИндивидуальные.ОбъектРасчета	= ВыборкаАбоненты.Абонент;
					КонецЕсли;
					
					Если ВыборкаАбоненты.ОбъемУслугиПотребленный <> 0 Тогда 
						СтрокаСписатьИндивидуальные  				= ДанныеПоУслуге.ДанныеНачисленийДоговоровПотребленный.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаСписатьИндивидуальные, ВыборкаАбоненты,,"ОбъемУслуги");						
						СтрокаСписатьИндивидуальные.ОбъектРасчета	= ВыборкаАбоненты.Абонент;
					КонецЕсли;
					
					
					Если НЕ ВыборкаАбоненты.СпособНачисления = Перечисления.энргСпособНачислений.ПоПриборам
						И НЕ ВыборкаАбоненты.СпособНачисления = Перечисления.энргСпособНачислений.НачислениеПоСреднему Тогда							
						
						СтрокаНачисленияБезПрибора 				= ДанныеПоУслуге.НачисленияНПБезПрибора.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаНачисленияБезПрибора,ВыборкаАбоненты);	
						СтрокаНачисленияБезПрибора.ОбъектРасчета 	= ВыборкаАбоненты.Абонент;
						СтрокаНачисленияБезПрибора.МКД 				= ВыборкаАбоненты.Строение;
						
					КонецЕсли;
					
					Если НЕ ВыборкаАбоненты.СпособНачисления = Перечисления.энргСпособНачислений.ПоПриборам
						И НЕ ВыборкаАбоненты.СпособНачисления = Перечисления.энргСпособНачислений.НачислениеПоСреднему и ВыборкаАбоненты.ОбъемУслугиПотребленный <> 0 Тогда							
						
						СтрокаНачисленияБезПрибора 					= ДанныеПоУслуге.НачисленияНПБезПрибораПотребленный.Добавить();
						ЗаполнитьЗначенияСвойств(СтрокаНачисленияБезПрибора,ВыборкаАбоненты);	
						СтрокаНачисленияБезПрибора.ОбъектРасчета 	= ВыборкаАбоненты.Абонент;
						СтрокаНачисленияБезПрибора.МКД 				= ВыборкаАбоненты.Строение;
						
					КонецЕсли;
				КонецЕсли;
			Иначе
				Если ВыборкаАбоненты.ОбъемУслуги <> 0 Тогда
					СтрокаСписатьИндивидуальные  				= ДанныеПоУслуге.ДанныеНачисленийАбонентов.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаСписатьИндивидуальные, ВыборкаАбоненты,,"ОбъемУслугиПотребленный");
					СтрокаСписатьИндивидуальные.ОбъемУслуги		= ВыборкаАбоненты.ОбъемУслуги;
					СтрокаСписатьИндивидуальные.Сумма			= ВыборкаАбоненты.Сумма; 					
				КонецЕсли;
				
				Если ВыборкаАбоненты.ОбъемУслугиПотребленный <> 0 Тогда
					СтрокаСписатьИндивидуальные  				= ДанныеПоУслуге.ДанныеНачисленийАбонентовПотребленный.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаСписатьИндивидуальные, ВыборкаАбоненты,,"ОбъемУслуги");
					СтрокаСписатьИндивидуальные.ОбъемУслугиПотребленный		= ВыборкаАбоненты.ОбъемУслугиПотребленный;
					СтрокаСписатьИндивидуальные.Сумма						= 0; 					
				КонецЕсли;
				
				Если НЕ ВыборкаАбоненты.СпособНачисления = Перечисления.энргСпособНачислений.ПоПриборам
					И НЕ ВыборкаАбоненты.СпособНачисления = Перечисления.энргСпособНачислений.НачислениеПоСреднему и ВыборкаАбоненты.ОбъемУслуги <> 0 Тогда							
					СтрокаНачисленияБезПрибора 				= ДанныеПоУслуге.НачисленияАбонентовБезПрибора.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаНачисленияБезПрибора,ВыборкаАбоненты);							
				КонецЕсли;
				
				
				Если НЕ ВыборкаАбоненты.СпособНачисления = Перечисления.энргСпособНачислений.ПоПриборам
					И НЕ ВыборкаАбоненты.СпособНачисления = Перечисления.энргСпособНачислений.НачислениеПоСреднему и ВыборкаАбоненты.ОбъемУслугиПотребленный <> 0 Тогда							
					СтрокаНачисленияБезПрибора 				= ДанныеПоУслуге.НачисленияАбонентовБезПрибораПотребленный.Добавить();
					ЗаполнитьЗначенияСвойств(СтрокаНачисленияБезПрибора,ВыборкаАбоненты);							
				КонецЕсли;
				
			КонецЕсли;
		Иначе
			
			Если ВыборкаАбоненты.ОбъемУслуги <> 0 Тогда
				СтрокаНачисленияБезПрибора 						= ДанныеПоУслуге.НачисленияАбонентовБезПрибора.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаНачисленияБезПрибора,ВыборкаАбоненты,,"ОбъемУслугиПотребленный");
			КонецЕсли;
			
			Если ВыборкаАбоненты.ОбъемУслугиПотребленный <> 0 Тогда
				СтрокаНачисленияБезПрибора 						= ДанныеПоУслуге.НачисленияАбонентовБезПрибораПотребленный.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаНачисленияБезПрибора,ВыборкаАбоненты,,"ОбъемУслуги");
			КонецЕсли;
			
		КонецЕсли;
		ДанныеАбонента.ОбъемУслуги 							= ДанныеАбонента.ОбъемУслуги + ВыборкаАбоненты.ОбъемУслуги; 
		ДанныеАбонента.ОбъемУслугиПотребленный 				= ДанныеАбонента.ОбъемУслугиПотребленный + ВыборкаАбоненты.ОбъемУслугиПотребленный; 
		
		Если НЕ ВыборкаАбоненты.ПомещениеСРазделенными Тогда 
			ПотреблениеАбонентов 							= ПотреблениеАбонентов + ВыборкаАбоненты.ОбъемУслуги;
			ПотреблениеАбонентовПоФакту						= ПотреблениеАбонентов + ВыборкаАбоненты.ОбъемУслугиПотребленный;
		КонецЕсли;
		
		Если НЕ ВыборкаАбоненты.СпособНачисления = Перечисления.энргСпособНачислений.ПоПриборам
			И НЕ ВыборкаАбоненты.СпособНачисления = Перечисления.энргСпособНачислений.НачислениеПоСреднему
			И НЕ ВыборкаАбоненты.ПомещениеСРазделенными Тогда
			
			Если НЕ ВыборкаАбоненты.ОбъемУслуги = 0 Тогда
				ВсеПоПрибору 									= Ложь;
			КонецЕсли;
			
			Если НЕ ВыборкаАбоненты.ОбъемУслугиПотребленный = 0 Тогда
				ВсеПоПриборуПотребленный						= Ложь;
			КонецЕсли;
			
		ИначеЕсли НЕ ВыборкаАбоненты.ПомещениеСРазделенными Тогда
			ПотреблениеАбонентовПоПрибору 					= ПотреблениеАбонентовПоПрибору + ВыборкаАбоненты.ОбъемУслуги;
			ПотреблениеАбонентовПоПриборуПоФакту			= ПотреблениеАбонентовПоПриборуПоФакту + ВыборкаАбоненты.ОбъемУслугиПотребленный;
			ЕстьРасходПоПрибору 							= Истина;
			ЕстьРасходПоПриборуПотребленный					= Истина;
		КонецЕсли;
		
		ТекПомещение 										= ВыборкаАбоненты.Помещение;
		
		Если НЕ ВыборкаАбоненты.Следующий() Тогда
			Прервать;
			ВыборкаАбоненты.сбросить();
		КонецЕсли; 				
	КонецЦикла; 			
	
	Если Не ТекПомещение = Неопределено Тогда
		Если НЕ ДанныеАбонента.ПомещениеСРазделенными Тогда
			мАбонентыДляРаспределения.Добавить(ДанныеАбонента);
			ДанныеПоУслуге.ПлощадиАбонентов.Вставить(ТекПомещение,ДанныеАбонента.ЗначениеПлощади);
			
			Если ЕстьРасходПоПрибору Тогда
				ВсегоПлощадьАбонентовПоПрибору 				= ВсегоПлощадьАбонентовПоПрибору + ДанныеАбонента.ЗначениеПлощади; 
			КонецЕсли;
			
			Если ЕстьРасходПоПриборуПотребленный Тогда
				ВсегоПлощадьАбонентовПоПриборуПотребленный	= ВсегоПлощадьАбонентовПоПриборуПотребленный + ДанныеАбонента.ЗначениеПлощади; 
			КонецЕсли;
			
		КонецЕсли;
	КонецЕсли;
	
	Пока ВыборкаОбъемПоПриборуКорректировать.Строение = ВыборкаОбъемМКД.Строение и ВыборкаОбъемПоПриборуКорректировать.Услуга = ВыборкаОбъемМКД.Услуга Цикл
		Если НЕ ВыборкаОбъемПоПриборуКорректировать.Помещение = null Тогда		
			
			Если ВыборкаОбъемПоПриборуКорректировать.ОбъемУслуги <> 0 Тогда
				ЗаполнитьЗначенияСвойств(ДанныеПоУслуге.ОбъемПоПриборуКорректировать.Добавить(), ВыборкаОбъемПоПриборуКорректировать);
			КонецЕсли;
			
			Если ВыборкаОбъемПоПриборуКорректировать.ОбъемУслугиПотребленный <> 0 Тогда
				ЗаполнитьЗначенияСвойств(ДанныеПоУслуге.ОбъемПоПриборуКорректироватьПотребленный.Добавить(), ВыборкаОбъемПоПриборуКорректировать);
			КонецЕсли;
			
		КонецЕсли; 				
		Если НЕ ВыборкаОбъемПоПриборуКорректировать.Следующий() Тогда
			Прервать;
			ВыборкаОбъемПоПриборуКорректировать.сбросить();
		КонецЕсли; 				
	КонецЦикла;
	
	Пока ВыборкаОбъемПоПриборуНПКорректировать.Строение = ВыборкаОбъемМКД.Строение и ВыборкаОбъемПоПриборуНПКорректировать.Услуга = ВыборкаОбъемМКД.Услуга Цикл
		Если НЕ ВыборкаОбъемПоПриборуНПКорректировать.ОбъектРасчета = null Тогда		
			
			Если ВыборкаОбъемПоПриборуКорректировать.ОбъемУслуги <> 0 Тогда
				ЗаполнитьЗначенияСвойств(ДанныеПоУслуге.ОбъемПоПриборуНПКорректировать.Добавить(), ВыборкаОбъемПоПриборуНПКорректировать);				
			КонецЕсли;
			
			Если ВыборкаОбъемПоПриборуКорректировать.ОбъемУслугиПотребленный <> 0 Тогда
				ЗаполнитьЗначенияСвойств(ДанныеПоУслуге.ОбъемПоПриборуНПКорректироватьПотребленный.Добавить(), ВыборкаОбъемПоПриборуНПКорректировать);				
			КонецЕсли; 		
			
		КонецЕсли; 				
		Если НЕ ВыборкаОбъемПоПриборуНПКорректировать.Следующий() Тогда
			Прервать;
			ВыборкаОбъемПоПриборуНПКорректировать.сбросить();
		КонецЕсли; 				
	КонецЦикла;
	
	ДанныеПоУслуге.Вставить("ВсеПоПрибору", 				ВсеПоПрибору);
	ДанныеПоУслуге.Вставить("ВсеПоПриборуПотребленный", 				ВсеПоПриборуПотребленный);
	ДанныеПоУслуге.ПотреблениеАбонентов 						= ПотреблениеАбонентов;
	ДанныеПоУслуге.ПотреблениеАбонентовПотребленный				= ПотреблениеАбонентовПоФакту;
	ДанныеПоУслуге.ВсегоПлощадьАбонентовПоПрибору 				= ВсегоПлощадьАбонентовПоПрибору;
	ДанныеПоУслуге.ВсегоПлощадьАбонентовПоПриборуПотребленный 	= ВсегоПлощадьАбонентовПоПриборуПотребленный;
	ДанныеПоУслуге.ПотреблениеАбонентовПоПрибору 				= ПотреблениеАбонентовПоПрибору;
	ДанныеПоУслуге.ПотреблениеАбонентовПоПриборуПотребленный	= ПотреблениеАбонентовПоПриборуПоФакту;
	ДанныеПоУслуге.ОбщийОбъемНачислений							= ОбщийОбъемНачислений;
	ДанныеПоУслуге.ОбщийОбъемНачисленийПомещений				= ОбщийОбъемНачисленийПомещений;
	
	ДанныеПоУслуге.ОбщийОбъемНачисленийПотребленный				= ОбщийОбъемНачисленийПотребленный;
	ДанныеПоУслуге.ОбщийОбъемНачисленийПомещенийПотребленный	= ОбщийОбъемНачисленийПомещенийПотребленный;
КонецПроцедуры

Процедура ПрочитатьНаборыДляЗаписиПриРаспределении(ВыборкаОбъемМКД, ДокументОбъект, НаборВыполненные, НаборЗаписей, НаборЗаписейПомещений, НаборЗаписейНП, НаборЗаписейСверхНорма, ГраницыПериода)
	
	ДокументСсылка 								= ВыборкаОбъемМКД.ДокументРаспределения;
	ДокументОбъект 								= Неопределено;
	НаборВыполненные 							= Неопределено;
	НаборЗаписей 								= Неопределено;
	НаборЗаписейПомещений 						= Неопределено;
	НаборЗаписейНП 								= Неопределено;
	НаборЗаписейСверхНорма 						= Неопределено;
	
	Если НЕ ЗначениеЗаполнено(ДокументСсылка) Тогда			
		ДокументСсылка 							= Документы.энргРаспределениеМКД.ПолучитьСсылку(Новый УникальныйИдентификатор());
		ДокументОбъект 							= Документы.энргРаспределениеМКД.СоздатьДокумент();
		ДокументОбъект.Организация				= ВыборкаОбъемМКД.Организация;
		ДокументОбъект.Район 					= ВыборкаОбъемМКД.Район;
		ДокументОбъект.МКД 						= ВыборкаОбъемМКД.Строение;
		ДокументОбъект.Дата 					= ГраницыПериода.ЗавершениеОП - 1;		
																				  
		ДокументОбъект.УстановитьСсылкуНового(ДокументСсылка);
		
		НаборВыполненные 						= РегистрыСведений.энргДокументыНачислений.СоздатьНаборЗаписей();
		НаборВыполненныеДопСвойства 			= НаборВыполненные.ДополнительныеСвойства;
		НаборВыполненныеДопСвойства.Вставить("Замещать", Ложь);
			
		ЗаписьВыполненные						= НаборВыполненные.Добавить();
		ЗаписьВыполненные.Организация 			= ВыборкаОбъемМКД.Организация;
		ЗаписьВыполненные.Район		 			= ВыборкаОбъемМКД.Район;
		ЗаписьВыполненные.ПериодНачисления 		= ВыборкаОбъемМКД.ПериодНачисления;
		ЗаписьВыполненные.ВидОперацийНачисления	= Перечисления.энргВидыОперацийНачисления.РаспределениеМКД;
		ЗаписьВыполненные.МКД 					= ВыборкаОбъемМКД.Строение;
		ЗаписьВыполненные.ДокументНачисления 	= ДокументСсылка;
							
	Иначе
		ДокументОбъект 							= ДокументСсылка.ПолучитьОбъект();
		ДокументОбъект.ПометкаУдаления 			= Ложь;
		
		НаборВыполненные 						= РегистрыСведений.энргДокументыНачислений.СоздатьНаборЗаписей();
		НаборВыполненныеДопСвойства 			= НаборВыполненные.ДополнительныеСвойства;
		НаборВыполненныеДопСвойства.Вставить("Замещать", Истина);
		
		НаборВыполненные.Отбор.Организация.Установить(ВыборкаОбъемМКД.Организация);
		НаборВыполненные.Отбор.ПериодНачисления.Установить(ВыборкаОбъемМКД.ПериодНачисления);
		НаборВыполненные.Отбор.Район.Установить(ВыборкаОбъемМКД.Район);					
		НаборВыполненные.Отбор.ВидОперацийНачисления.Установить(Перечисления.энргВидыОперацийНачисления.РаспределениеМКД);
		НаборВыполненные.Отбор.МКД.Установить(ВыборкаОбъемМКД.Строение);
				
  
		ЗаписьВыполненные						= НаборВыполненные.Добавить();
		ЗаписьВыполненные.Организация 			= ВыборкаОбъемМКД.Организация;
		ЗаписьВыполненные.Район		 			= ВыборкаОбъемМКД.Район;
		ЗаписьВыполненные.ПериодНачисления 		= ВыборкаОбъемМКД.ПериодНачисления;
		ЗаписьВыполненные.ВидОперацийНачисления = Перечисления.энргВидыОперацийНачисления.РаспределениеМКД;
		ЗаписьВыполненные.МКД 					= ВыборкаОбъемМКД.Строение;
		ЗаписьВыполненные.ДокументНачисления 	= ДокументСсылка;
		ЗаписьВыполненные.ПометкаУдаления	 	= Ложь;
		
		НаборЗаписей 							= РегистрыНакопления.энргОбъемНачислений.СоздатьНаборЗаписей();
		НаборЗаписей.Отбор.Регистратор.Установить(ДокументСсылка);
		НаборЗаписей.Записать(); // очищаем набор записей
		
		НаборЗаписейПомещений					= РегистрыНакопления.энргОбъемНачисленийПомещенийСРазделеннымиЛС.СоздатьНаборЗаписей();
		НаборЗаписейПомещений.Отбор.Регистратор.Установить(ДокументСсылка);
		НаборЗаписейПомещений.Записать(); // очищаем набор записей
		
		НаборЗаписейНП 							= РегистрыНакопления.бестОбъемНачисленийНП.СоздатьНаборЗаписей();
		НаборЗаписейНП.Отбор.Регистратор.Установить(ДокументСсылка);
		НаборЗаписейНП.Записать(); // очищаем набор записей
		
		НаборЗаписейСверхНорма 					= РегистрыНакопления.энргОбъемНачисленийСверхнормативаМКД.СоздатьНаборЗаписей();
		НаборЗаписейСверхНорма.Отбор.Регистратор.Установить(ДокументСсылка);
		НаборЗаписейСверхНорма.Записать(); // очищаем набор записей
	КонецЕсли;
	
	НаборЗаписей 								= РегистрыНакопления.энргОбъемНачислений.СоздатьНаборЗаписей();
	НаборЗаписей.Отбор.Регистратор.Установить(ДокументСсылка);
	НаборЗаписей.ДополнительныеСвойства.Вставить("ПериодНачисления",	ВыборкаОбъемМКД.ПериодНачисления);
	НаборЗаписей.ДополнительныеСвойства.Вставить("Организация", 		ВыборкаОбъемМКД.Организация);
	НаборЗаписей.ДополнительныеСвойства.Вставить("Район",  				ВыборкаОбъемМКД.Район);
	НаборЗаписей.ДополнительныеСвойства.Вставить("Строение",    		ВыборкаОбъемМКД.Строение);
	НаборЗаписей.ДополнительныеСвойства.Вставить("ЧастныйСектор",  		Ложь);
	НаборЗаписей.ДополнительныеСвойства.Вставить("ДатаРегистратора",	ГраницыПериода.ЗавершениеОП-1);
	
	НаборЗаписейПомещений						= РегистрыНакопления.энргОбъемНачисленийПомещенийСРазделеннымиЛС.СоздатьНаборЗаписей();
	НаборЗаписейПомещений.Отбор.Регистратор.Установить(ДокументСсылка);
	НаборЗаписейПомещений.ДополнительныеСвойства.Вставить("ПериодНачисления",	ВыборкаОбъемМКД.ПериодНачисления);
	НаборЗаписейПомещений.ДополнительныеСвойства.Вставить("Организация", 		ВыборкаОбъемМКД.Организация);
	НаборЗаписейПомещений.ДополнительныеСвойства.Вставить("Район",  			ВыборкаОбъемМКД.Район);
	НаборЗаписейПомещений.ДополнительныеСвойства.Вставить("Строение",    		ВыборкаОбъемМКД.Строение);
	НаборЗаписейПомещений.ДополнительныеСвойства.Вставить("ЧастныйСектор",  	Ложь);
	НаборЗаписейПомещений.ДополнительныеСвойства.Вставить("ДатаРегистратора",	ГраницыПериода.ЗавершениеОП-1);
			
	НаборЗаписейНП 								= РегистрыНакопления.бестОбъемНачисленийНП.СоздатьНаборЗаписей();	
	НаборЗаписейНП.Отбор.Регистратор.Установить(ДокументСсылка);
	НаборЗаписейНП.ДополнительныеСвойства.Вставить("ПериодНачисления",	ВыборкаОбъемМКД.ПериодНачисления);
	НаборЗаписейНП.ДополнительныеСвойства.Вставить("Организация", 		ВыборкаОбъемМКД.Организация);
	НаборЗаписейНП.ДополнительныеСвойства.Вставить("Район",  			ВыборкаОбъемМКД.Район);
	НаборЗаписейНП.ДополнительныеСвойства.Вставить("Строение",    		ВыборкаОбъемМКД.Строение);
	НаборЗаписейНП.ДополнительныеСвойства.Вставить("ДатаРегистратора",	ГраницыПериода.ЗавершениеОП-1);
			
	НаборЗаписейСверхНорма 						= РегистрыНакопления.энргОбъемНачисленийСверхнормативаМКД.СоздатьНаборЗаписей();
	НаборЗаписейСверхНорма.Отбор.Регистратор.Установить(ДокументСсылка);
	НаборЗаписейСверхНорма.ДополнительныеСвойства.Вставить("ПериодНачисления",	ВыборкаОбъемМКД.ПериодНачисления);
	НаборЗаписейСверхНорма.ДополнительныеСвойства.Вставить("Организация", 		ВыборкаОбъемМКД.Организация);
	НаборЗаписейСверхНорма.ДополнительныеСвойства.Вставить("Район",  			ВыборкаОбъемМКД.Район);
	НаборЗаписейСверхНорма.ДополнительныеСвойства.Вставить("Строение",    		ВыборкаОбъемМКД.Строение);
	НаборЗаписейСверхНорма.ДополнительныеСвойства.Вставить("ДатаРегистратора",	ГраницыПериода.ЗавершениеОП-1);
	
КонецПроцедуры

Процедура ЗаполнитьОбъемыМКДПриРаспределении(ВыборкаОбъемМКД, ДанныеПоУслуге)
	Если НЕ ВыборкаОбъемМКД.СпособНачисления = Перечисления.энргСпособНачислений.ПоПриборам 
		И НЕ ВыборкаОбъемМКД.СпособНачисления = Перечисления.энргСпособНачислений.НачислениеПоСреднему Тогда
		
		Если ДанныеПоУслуге.ОбъемБезПрибораТарифныЗоны[ВыборкаОбъемМКД.ТарифнаяЗона] = Неопределено Тогда
			ДанныеПоУслуге.ОбъемБезПрибораТарифныЗоны.Вставить(ВыборкаОбъемМКД.ТарифнаяЗона, ВыборкаОбъемМКД.ОбъемУслуги * ?(ВыборкаОбъемМКД.ПлощадьМОПУказана , 1 , ВыборкаОбъемМКД.ВсегоПлощадьАбонентов));
		Иначе
			ДанныеПоУслуге.ОбъемБезПрибораТарифныЗоны[ВыборкаОбъемМКД.ТарифнаяЗона] = ДанныеПоУслуге.ОбъемБезПрибораТарифныЗоны[ВыборкаОбъемМКД.ТарифнаяЗона] +  ВыборкаОбъемМКД.ОбъемУслуги * ?(ВыборкаОбъемМКД.ПлощадьМОПУказана , 1 , ВыборкаОбъемМКД.ВсегоПлощадьАбонентов);
		КонецЕсли;
		
		ДанныеПоУслуге.ОбъемБезПрибора				= ДанныеПоУслуге.ОбъемБезПрибора + ВыборкаОбъемМКД.ОбъемУслуги * ?(ВыборкаОбъемМКД.ПлощадьМОПУказана , 1 , ВыборкаОбъемМКД.ВсегоПлощадьАбонентов) ;
		ДанныеПоУслуге.ОбъемПотребленныйБезПрибора 	= ДанныеПоУслуге.ОбъемПотребленныйБезПрибора + ВыборкаОбъемМКД.ОбъемУслугиПотребленный * ?(ВыборкаОбъемМКД.ПлощадьМОПУказана , 1 , ВыборкаОбъемМКД.ВсегоПлощадьАбонентов);
	Иначе
		
		Если ДанныеПоУслуге.ОбъемПоПриборуТарифныЗоны[ВыборкаОбъемМКД.ТарифнаяЗона] = Неопределено Тогда
			ДанныеПоУслуге.ОбъемПоПриборуТарифныЗоны.Вставить(ВыборкаОбъемМКД.ТарифнаяЗона, ВыборкаОбъемМКД.ОбъемУслуги);
		Иначе
			ДанныеПоУслуге.ОбъемПоПриборуТарифныЗоны[ВыборкаОбъемМКД.ТарифнаяЗона] = ДанныеПоУслуге.ОбъемПоПриборуТарифныЗоны[ВыборкаОбъемМКД.ТарифнаяЗона] +  ВыборкаОбъемМКД.ОбъемУслуги;
		КонецЕсли;
		
		ДанныеПоУслуге.ОбъемПоПрибору 				= ДанныеПоУслуге.ОбъемПоПрибору + ВыборкаОбъемМКД.ОбъемУслуги;
		ДанныеПоУслуге.ОбъемПотребленныйПоПрибору 	= ДанныеПоУслуге.ОбъемПотребленныйПоПрибору + ВыборкаОбъемМКД.ОбъемУслугиПотребленный;
	КонецЕсли;	
	
	ДанныеПоУслуге.ОбъемУслугиНорматив 					= ДанныеПоУслуге.ОбъемУслугиНорматив + ВыборкаОбъемМКД.ОбъемУслугиНорматив;	
	ДанныеПоУслуге.ПоказанияПредоставлены 				= ВыборкаОбъемМКД.ПоказанияПредоставлены;
	ДанныеПоУслуге.ПоказанияПредоставленыПотребленный 	= ВыборкаОбъемМКД.ПоказанияПредоставленыПотребленный;
КонецПроцедуры

Процедура ЗаполнитьПараметрыРасчетаНорматива(ДанныеПоУслуге, ПараметрыРасчетаНорматива, РассчитыватьНорматив, ТипыНачислений, Услуга, НачисленияПоУслугам) 
	СуммаРасходовПоУслуге  	= 0;
	
	Для Каждого СтрокаОбъема ИЗ ДанныеПоУслуге.ОбщийОбъемНачислений Цикл
		Если ДанныеПоУслуге.НеНачислятьУслугуАбонентам Тогда
			СуммаРасходовПоУслуге = СтрокаОбъема.ОбъемУслугиПотребленный + СуммаРасходовПоУслуге
		Иначе
			СуммаРасходовПоУслуге = СтрокаОбъема.ОбъемУслуги + СуммаРасходовПоУслуге
		КонецЕсли;;
	КонецЦикла;
	Для Каждого СтрокаОбъема ИЗ ДанныеПоУслуге.ОбщийОбъемНачисленийПомещений Цикл
		Если ДанныеПоУслуге.НеНачислятьУслугуАбонентам Тогда
			СуммаРасходовПоУслуге = СтрокаОбъема.ОбъемУслугиПотребленный + СуммаРасходовПоУслуге;
		Иначе
			СуммаРасходовПоУслуге = СтрокаОбъема.ОбъемУслуги + СуммаРасходовПоУслуге;
		КонецЕсли;
	КонецЦикла;
		
	ДанныеНачисленийПоУслуге 	= Новый Структура("НеНачислятьУслугуАбонентам, ПотреблениеАбонентов,ПотреблениеПомещений",ДанныеПоУслуге.НеНачислятьУслугуАбонентам, ДанныеПоУслуге.ОбщийОбъемНачислений,ДанныеПоУслуге.ОбщийОбъемНачисленийПомещений);
	НачисленияПоУслугам.Вставить(Услуга, ДанныеНачисленийПоУслуге);
	
	Если ПараметрыРасчетаНорматива[Услуга] = Неопределено Тогда
		ОписаниеРасхода			= Новый Соответствие;
		ОписаниеРасхода.Вставить(ТипыНачислений["СуммаРасходовВсехПомещенийПоУслуге"], СуммаРасходовПоУслуге);
		ПараметрыРасчетаНорматива.Вставить(Услуга,ОписаниеРасхода);
	Иначе
		ПараметрыРасчетаНорматива[Услуга].Вставить(ТипыНачислений["СуммаРасходовВсехПомещенийПоУслуге"], СуммаРасходовПоУслуге);
	КонецЕсли;
	
	Если ПараметрыРасчетаНорматива[Услуга] = Неопределено Тогда
		ОписаниеРасхода			= Новый Соответствие;
		ОписаниеРасхода.Вставить(ТипыНачислений["РасходМКДПоУслуге"], ДанныеПоУслуге.ОбъемПоПрибору + ДанныеПоУслуге.ОбъемБезПрибора);
		ПараметрыРасчетаНорматива.Вставить(Услуга,ОписаниеРасхода);
	Иначе
		ПараметрыРасчетаНорматива[Услуга].Вставить(ТипыНачислений["РасходМКДПоУслуге"], ДанныеПоУслуге.ОбъемПоПрибору + ДанныеПоУслуге.ОбъемБезПрибора);
	КонецЕсли;
	
	Если ПараметрыРасчетаНорматива[Услуга] = Неопределено Тогда
		ОписаниеРасхода			= Новый Соответствие;
		ОписаниеРасхода.Вставить(ТипыНачислений["ЗначениеНормативаПоУслуге"], ДанныеПоУслуге.ЗначениеНорматива);
		ПараметрыРасчетаНорматива.Вставить(Услуга,ОписаниеРасхода);
	Иначе
		ПараметрыРасчетаНорматива[Услуга].Вставить(ТипыНачислений["ЗначениеНормативаПоУслуге"], ДанныеПоУслуге.ЗначениеНорматива);
	КонецЕсли;
	
	Если НЕ ПустаяСтрока(ДанныеПоУслуге.ФормулаРасчетаНорматива) Тогда
		ФормулаРасчета 			= Новый Структура("Услуга, ФормулаРасчета, ЗависитОтУслуги", Услуга, ДанныеПоУслуге.ФормулаРасчетаНорматива, ДанныеПоУслуге.ЗависитОтУслуги);
		РассчитыватьНорматив.Добавить(ФормулаРасчета);
	КонецЕсли;
				
КонецПроцедуры

Процедура РассчитатьНормативПоФормуле(ПараметрыРасчетаНорматива, РассчитыватьНорматив, НачисленияПоУслугам, ЗначенияТарифов, ГраницыПериода,Отказ, НаборЗаписей, НаборЗаписейНП, НаборЗаписейПомещений)
	
	ВидНачисленияОДН 										= Перечисления.энргВидыНачислений.НачислениеОДН;
	
	Для Сч = 0 По РассчитыватьНорматив.ВГраница() Цикл
		ЗначениеНорматива  									= Неопределено;
		ФормулаРасчета  									= РассчитыватьНорматив[Сч].ФормулаРасчета;
		Услуга 												= РассчитыватьНорматив[Сч].Услуга;
		ЗависитОтУслуги 									= РассчитыватьНорматив[Сч].ЗависитОтУслуги;
		Для Каждого КлючЗначение ИЗ ПараметрыРасчетаНорматива Цикл
			УслугаВФормуле									= КлючЗначение.Ключ;
			КлючУслуги 										= XMLСтрока(УслугаВФормуле);
			Для Каждого ТипыНачислений Из КлючЗначение.Значение Цикл
				ДанныеРасхода 								= "[" + ЗначениеВСтрокуВнутр(Новый Структура("ТипРасхода, Услуга", ТипыНачислений.Ключ, КлючУслуги)) + "]";
				ФормулаРасчета 								= СтрЗаменить(ФормулаРасчета,ДанныеРасхода,XMLСтрока(ТипыНачислений.Значение));
			КонецЦикла;			
		КонецЦикла;
		ФормулаРасчета 										= СтрЗаменить(ФормулаРасчета,"[Результат]","ЗначениеНорматива");
		Попытка
			Выполнить ФормулаРасчета;
		Исключение
			Отказ 											= Истина;			   
		КонецПопытки;
		
		Если Отказ Тогда
			Возврат;
		КонецЕсли;		
		// Снимаем начисленные объемы потребления по услуге
		НачисленияПоУслуге	 								= НачисленияПоУслугам[Услуга].ПотреблениеАбонентов;
		Для Каждого СтрокаНачислений ИЗ НачисленияПоУслуге Цикл
			СтрокаСнимаем 									= НаборЗаписей.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаСнимаем, СтрокаНачислений);
			СтрокаСнимаем.Период 							= ГраницыПериода.ЗавершениеОП-1;
			СтрокаСнимаем.Распределение 					= Истина;
			СтрокаСнимаем.Сумма 							= -СтрокаСнимаем.Сумма;
			СтрокаСнимаем.ОбъемУслуги 						= -СтрокаСнимаем.ОбъемУслуги;
			СтрокаСнимаем.ОбъемУслугиПотребленный 			= -СтрокаСнимаем.ОбъемУслугиПотребленный;
			СтрокаСнимаем.СуммаПоПовышенномуКоэффициенту 	= -СтрокаСнимаем.СуммаПоПовышенномуКоэффициенту;
		КонецЦикла;
		
		НеНачислятьУслугуАбонентам 							= НачисленияПоУслугам[ЗависитОтУслуги].НеНачислятьУслугуАбонентам;
		НачисленияПоУслуге	 								= НачисленияПоУслугам[ЗависитОтУслуги].ПотреблениеАбонентов;
		Для Каждого СтрокаНачислений ИЗ НачисленияПоУслуге Цикл
			Если СтрокаНачислений.ВидНачисления  = ВидНачисленияОДН Тогда
				Продолжить;
			КонецЕсли;
			
			ХэшСтрокиТарифа 								= ХэшСтрокиТарифа(СтрокаНачислений.ТарифнаяГруппа,ЗависитОтУслуги,СтрокаНачислений.Поставщик,Справочники.энргТарифныеЗоны.БезРазбивки);
			ЗначениеТарифа 									= ?(ЗначенияТарифов[ХэшСтрокиТарифа] = Неопределено, Новый Структура("Значение", 0), ЗначенияТарифов[ХэшСтрокиТарифа]);
			
			СтрокаНачисляем									= НаборЗаписей.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаНачисляем, СтрокаНачислений);
			СтрокаНачисляем.Период 							= ГраницыПериода.ЗавершениеОП-1;
			СтрокаНачисляем.Распределение 					= Истина;
			СтрокаНачисляем.Услуга 							= Услуга;
			СтрокаНачисляем.НормаПотребления 				= ЗначениеНорматива;
			СтрокаНачисляем.ЗначениеТарифа 					= ?(ЗначениеТарифа.Значение = 0, СтрокаНачислений.ЗначениеТарифа, ЗначениеТарифа.Значение);
			Если НеНачислятьУслугуАбонентам Тогда
				СтрокаНачисляем.ОбъемУслуги 				= СтрокаНачислений.ОбъемУслугиПотребленный * СтрокаНачисляем.НормаПотребления;
			Иначе
				СтрокаНачисляем.ОбъемУслуги 				= СтрокаНачислений.ОбъемУслуги * СтрокаНачисляем.НормаПотребления;
			КонецЕсли;
			СтрокаНачисляем.ОбъемУслугиПотребленный 		= СтрокаНачислений.ОбъемУслугиПотребленный* СтрокаНачисляем.НормаПотребления;
			СтрокаНачисляем.СуммаПоПовышенномуКоэффициенту 	= 0;
			СтрокаНачисляем.Сумма 							= СтрокаНачисляем.ЗначениеТарифа * СтрокаНачисляем.ОбъемУслуги;			
		КонецЦикла;		
	КонецЦикла;
		
КонецПроцедуры

Функция ХэшСтрокиТарифа(ТарифнаяГруппа,Услуга,Поставщик,ТарифнаяЗона)
	
	СтрокаХэш 				= "";
	СтрокаХэш 				= СтрокаХэш + ТарифнаяГруппа.УникальныйИдентификатор();
	СтрокаХэш 				= СтрокаХэш + Услуга.УникальныйИдентификатор();
	СтрокаХэш 				= СтрокаХэш + Поставщик.УникальныйИдентификатор();
	СтрокаХэш 				= СтрокаХэш + ТарифнаяЗона.УникальныйИдентификатор();
	
	Хэш 					= Новый ХешированиеДанных(ХешФункция.CRC32);
	Хэш.Добавить(СтрокаХэш);
	
	Возврат Хэш.ХешСумма;	
	
КонецФункции

Функция ДанныеПоУслугиДляРаспределения(ВыборкаОбъемМКД, РазделенныеЛицевыеСчета)
	ДанныеПоУслуге  									= Новый Структура;
	ДанныеПоУслуге.Вставить("ОбъемПоПрибору",								0);
	ДанныеПоУслуге.Вставить("ОбъемБезПрибора", 								0);
	ДанныеПоУслуге.Вставить("ОбъемПотребленныйПоПрибору", 					0);
	ДанныеПоУслуге.Вставить("ОбъемПотребленныйБезПрибора", 					0);
	ДанныеПоУслуге.Вставить("ОбъемУслугиНорматив", 							0);	
	ДанныеПоУслуге.Вставить("ОбъемУслугиНормативПотребленный", 				0);	
	ДанныеПоУслуге.Вставить("РаспределятьПолностью", 						ВыборкаОбъемМКД.РаспределятьПолностью);
	ДанныеПоУслуге.Вставить("ЗначениеНорматива", 							ВыборкаОбъемМКД.ЗначениеНорматива);
	ДанныеПоУслуге.Вставить("ОбъемБезПрибораТарифныЗоны",					Новый Соответствие);
	ДанныеПоУслуге.Вставить("ОбъемПоПриборуТарифныЗоны",					Новый Соответствие);	
	ДанныеПоУслуге.Вставить("ОбъемБезПрибораТарифныЗоныПотребленный",		Новый Соответствие);
	ДанныеПоУслуге.Вставить("ОбъемПоПриборуТарифныЗоныПотребленный",		Новый Соответствие);	
	ДанныеПоУслуге.Вставить("РаспределениеПоУслугам",						Новый Соответствие);
	ДанныеПоУслуге.Вставить("РаспределениеПоУслугамПотребленный",			Новый Соответствие);
	ДанныеПоУслуге.Вставить("ПлощадиАбонентов",								Новый Соответствие);
	ДанныеПоУслуге.Вставить("ЗависитОтУслуги",								ВыборкаОбъемМКД.ЗависитОтУслуги);
	ДанныеПоУслуге.Вставить("ВидПлощади",									ВыборкаОбъемМКД.ВидПлощади);
	ДанныеПоУслуге.Вставить("РазделенныеЛицевыеСчета",						РазделенныеЛицевыеСчета);
	ДанныеПоУслуге.Вставить("АбонентыДляРаспределения", 					Новый Массив);
	ДанныеПоУслуге.Вставить("КорректироватьИндивидуальныйОбъемСУчетомОДПУ",	ВыборкаОбъемМКД.КорректироватьИндивидуальныйОбъемСУчетомОДПУ); 
	ДанныеПоУслуге.Вставить("ВсегоАбонентов", 								ВыборкаОбъемМКД.ВсегоАбонентов);
	ДанныеПоУслуге.Вставить("ВсегоСУстановелннымПриборомУчета", 			ВыборкаОбъемМКД.ВсегоСУстановелннымПриборомУчета);
	ДанныеПоУслуге.Вставить("ВсегоПлощадьАбонентов", 						ВыборкаОбъемМКД.ВсегоПлощадьАбонентов);
	ДанныеПоУслуге.Вставить("ВсегоПлощадьАбонентовПоПрибору", 				0);			
	ДанныеПоУслуге.Вставить("ВсегоПлощадьАбонентовПоПриборуПотребленный", 	0);			
	ДанныеПоУслуге.Вставить("ПлощадьМОП", 									ВыборкаОбъемМКД.ПлощадьМОП);
	ДанныеПоУслуге.Вставить("ВсегоПлощадьАбонентовСобственнаяПоставка", 	ВыборкаОбъемМКД.ВсегоПлощадьАбонентовСобственнаяПоставка);
	ДанныеПоУслуге.Вставить("ДанныеНачисленийАбонентов", 					энргНачисления.ОписаниеТаблицыОбъемов());
	ДанныеПоУслуге.Вставить("ДанныеНачисленийАбонентовПотребленный", 		энргНачисления.ОписаниеТаблицыОбъемов()); 	
	ДанныеПоУслуге.Вставить("ОбщийОбъемНачислений", 						энргНачисления.ОписаниеТаблицыОбъемов());
	ДанныеПоУслуге.Вставить("ОбщийОбъемНачисленийПотребленный", 			энргНачисления.ОписаниеТаблицыОбъемов());
	ДанныеПоУслуге.Вставить("ОбщийОбъемНачисленийПомещений", 				энргНачисления.ОписаниеТаблицыОбъемов());
	ДанныеПоУслуге.Вставить("ОбщийОбъемНачисленийПомещенийПотребленный", 	энргНачисления.ОписаниеТаблицыОбъемов());
	ДанныеПоУслуге.Вставить("НачисленияАбонентовБезПрибора", 				энргНачисления.ОписаниеТаблицыОбъемов());
	ДанныеПоУслуге.Вставить("НачисленияАбонентовБезПрибораПотребленный", 	энргНачисления.ОписаниеТаблицыОбъемов());
	ДанныеПоУслуге.Вставить("ОбъемПоПриборуКорректировать", 				энргНачисления.ОписаниеТаблицыОбъемов());
	ДанныеПоУслуге.Вставить("ОбъемПоПриборуКорректироватьПотребленный", 	энргНачисления.ОписаниеТаблицыОбъемов());
	ДанныеПоУслуге.Вставить("ДанныеНачисленийДоговоров", 					энргНачисления.ОписаниеТаблицыОбъемов("бестОбъемНачисленийНП"));
	ДанныеПоУслуге.Вставить("ДанныеНачисленийДоговоровПотребленный", 		энргНачисления.ОписаниеТаблицыОбъемов("бестОбъемНачисленийНП"));
	ДанныеПоУслуге.Вставить("НачисленияНПБезПрибора", 						энргНачисления.ОписаниеТаблицыОбъемов("бестОбъемНачисленийНП"));
	ДанныеПоУслуге.Вставить("НачисленияНПБезПрибораПотребленный", 			энргНачисления.ОписаниеТаблицыОбъемов("бестОбъемНачисленийНП"));
	ДанныеПоУслуге.Вставить("УВсехАбонентовПоПрибору", 						Истина);
	ДанныеПоУслуге.Вставить("УВсехАбонентовПоПриборуПотребленный", 			Истина);
	ДанныеПоУслуге.Вставить("ПотреблениеАбонентов", 						0);
	ДанныеПоУслуге.Вставить("ПотреблениеАбонентовПоПрибору", 				0);
	ДанныеПоУслуге.Вставить("ПотреблениеАбонентовПотребленный", 			0);
	ДанныеПоУслуге.Вставить("ПотреблениеАбонентовПоПриборуПотребленный", 	0);
	ДанныеПоУслуге.Вставить("НеРаспределятьСверхнорматив", 					ВыборкаОбъемМКД.НеРаспределятьСверхнорматив);
	ДанныеПоУслуге.Вставить("ФормулаРасчетаНорматива",	 					ВыборкаОбъемМКД.ФормулаРасчетаНорматива);
	ДанныеПоУслуге.Вставить("НеНачислятьУслугуАбонентам",	 				ВыборкаОбъемМКД.НеНачислятьУслугуАбонентам);
	ДанныеПоУслуге.Вставить("ОбъемПоПриборуНПКорректировать", 				энргНачисления.ОписаниеТаблицыОбъемов("бестОбъемНачисленийНП"));	
	ДанныеПоУслуге.Вставить("ОбъемПоПриборуНПКорректироватьПотребленный", 	энргНачисления.ОписаниеТаблицыОбъемов("бестОбъемНачисленийНП"));
	ДанныеПоУслуге.Вставить("ПоказанияПредоставлены", 						0);	
	ДанныеПоУслуге.Вставить("ПоказанияПредоставленыПотребленный", 			0);	
	
	
	
	Возврат ДанныеПоУслуге;
КонецФункции

Процедура РазбитьПоСоцНорме(яНабор,яНаборОбщий,НаборЗаписей,СтрокаНачисленийАбонента,ОбъемУслуги,СпособНачисленияОДН,ГраницыПериода,ДанныеПоУслуге,ЕстьСуммаНачислений,ЗначенияТарифов,Услуга,ПотреблениеАбонентов,СуммаПлощадейПомещения,СверхНорматива, ОбъемУслугиПотребленный)
	СтрокаНабора  								= яНабор.Добавить();
	ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийАбонента,,"ОбъемУслугиПотребленный");
	СтрокаНабора.Распределение 					= Истина;
	СтрокаНабора.СпособНачисления				= СпособНачисленияОДН;
	СтрокаНабора.СверхНорматива					= СверхНорматива;
	СтрокаНабора.ОбъемУслуги 					= ОбъемУслуги;
	//СтрокаНабора.ОбъемУслугиПотребленный 		= ОбъемУслугиПотребленный;
	СтрокаНабора.ОбъемУслугиПотребленный 		= 0;
	СтрокаНабора.Период 						= ГраницыПериода.ЗавершениеОП-1;			
	Если ЕстьСуммаНачислений Тогда
		СтрокаНабора.Сумма 						= СтрокаНабора.ОбъемУслуги * СтрокаНачисленийАбонента.ЗначениеТарифа;
	КонецЕсли;
	
	ЗаполнитьЗначенияСвойств(яНаборОбщий.Добавить(),СтрокаНабора,,"ОбъемУслугиПотребленный");
	
	РазделенныеЛицевыеСчета 					= ДанныеПоУслуге.РазделенныеЛицевыеСчета;
	
	Если НЕ РазделенныеЛицевыеСчета[СтрокаНачисленийАбонента.Помещение] = Неопределено Тогда
		ОсталосьВнутриПомещения 				= ОбъемУслуги;
		ПомещенияПотомки						= РазделенныеЛицевыеСчета[СтрокаНачисленийАбонента.Помещение];
		
		Для Каждого ПомещениеПотомок Из ПомещенияПотомки Цикл
			ДанныеПомещения  					= ПомещениеПотомок.Значение[Услуга];
			СуммаПлощадейПомещения 				= СуммаПлощадейПомещения + ДанныеПомещения.Значениеплощади; 
		КонецЦикла;		
		
		ПереасчитатьСтроки 						= Новый Массив;
		
		Для Каждого ПомещениеПотомок Из ПомещенияПотомки Цикл
			ДанныеПомещения  					= ПомещениеПотомок.Значение[Услуга];				                 		
			
			ХэшСтрокиТарифа 					= ХэшСтрокиТарифа(ДанныеПомещения.ТарифнаяГруппа,Услуга,ДанныеПомещения.Поставщик,Справочники.энргТарифныеЗоны.БезРазбивки); 
			ЗначениеТарифа 						= ?(ЗначенияТарифов[ХэшСтрокиТарифа] = Неопределено, Новый Структура("Значение", 0), ЗначенияТарифов[ХэшСтрокиТарифа]);
			СтрокаНабора  						= НаборЗаписей.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаНабора, СтрокаНачисленийАбонента,,"ОбъемУслугиПотребленный");
			СтрокаНабора.Распределение 			= Истина;
			СтрокаНабора.СпособНачисления		= СпособНачисленияОДН;
			СтрокаНабора.Период 				= ГраницыПериода.ЗавершениеОП-1;
			СтрокаНабора.Помещение				= ПомещениеПотомок.Ключ;
			СтрокаНабора.Абонент				= ДанныеПомещения.Абонент;						
			
			Если ДанныеПомещения.СпособРаспределенияОбъемаПомещения = Перечисления.энргСпособыРаспределенияОбъема.ФиксированныйОбъем Тогда
				СтрокаНабора.ОбъемУслуги 		= ДанныеПомещения.ФиксированныйОбъемПотребления;
				ОсталосьВнутриПомещения 		= ОсталосьВнутриПомещения - СтрокаНабора.ОбъемУслуги;
			ИначеЕсли ДанныеПомещения.СпособРаспределенияОбъемаПомещения = Перечисления.энргСпособыРаспределенияОбъема.ДолевоеРаспределение Тогда
				СтрокаНабора.ОбъемУслуги 		= ОбъемУслуги * ДанныеПомещения.ДоляПотребленияЧислитель / ДанныеПомещения.ДоляПотребленияЗнаменатель;
				ОсталосьВнутриПомещения 		= ОсталосьВнутриПомещения - СтрокаНабора.ОбъемУслуги;
			ИначеЕсли ДанныеПомещения.СпособРаспределенияОбъемаПомещения = Перечисления.энргСпособыРаспределенияОбъема.Остаток Тогда	
				ПереасчитатьСтроки.Добавить(НаборЗаписей.Индекс(СтрокаНабора));
			Иначе
				Если ЗначениеЗаполнено(ДанныеПоУслуге.ВидПлощади) Тогда
					СтрокаНабора.ОбъемУслуги	 = ?(НЕ СуммаПлощадейПомещения = 0, ОбъемУслуги * ДанныеПомещения.ЗначениеПлощади / СуммаПлощадейПомещения, 0);
				Иначе
					СтрокаНабора.ОбъемУслуги 	= ?(НЕ СтрокаНачисленийАбонента.КоличествоЖильцов = 0, ОбъемУслуги * ДанныеПомещения.КоличествоПроживающих / СтрокаНачисленийАбонента.КоличествоЖильцов, 0);
				КонецЕсли;
				ОсталосьВнутриПомещения 		= ОсталосьВнутриПомещения - СтрокаНабора.ОбъемУслуги;
			КонецЕсли;											
			
			СтрокаНабора.Сумма					= СтрокаНабора.ОбъемУслуги * ЗначениеТарифа.Значение;				
		КонецЦикла;
		
		Если ПереасчитатьСтроки.Количество() > 0 Тогда
			Для Сч = 0 По ПереасчитатьСтроки.ВГраница() Цикл
				СтрокаНабора 					= НаборЗаписей.Получить(ПереасчитатьСтроки[Сч]);
				СтрокаНабора.ОбъемУслуги 		= ОсталосьВнутриПомещения;
				СтрокаНабора.Сумма				= СтрокаНабора.ОбъемУслуги * ЗначениеТарифа.Значение;
			КонецЦикла;						
		КонецЕсли;					
	КонецЕсли;
КонецПроцедуры

Процедура ПрочитатьДокументыДляРаспределения(МВТ,Организация, ПериодНачисления, Район, МКД, ГраницаПериода)
	
	Запрос  						= Новый Запрос(ТекстЗапросаДокументыДляРаспределенияМКД());
	Запрос.УстановитьПараметр("ПериодНачисления", 	ПериодНачисления);
	Запрос.УстановитьПараметр("Организация", 		Организация);
	Запрос.УстановитьПараметр("Район", 				Район);
	Запрос.УстановитьПараметр("Строение", 			МКД); 	
	Запрос.УстановитьПараметр("ЗавершениеОП",		ГраницаПериода.ЗавершениеОП); 	
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	
	Если МКД = Неопределено Тогда
		Запрос.Текст 				= СтрЗаменить(Запрос.Текст,"И энргОтложенныеДвиженияДокументов.Строение = &Строение","");	
	КонецЕсли;
	
	Запрос.Выполнить();
	
КонецПроцедуры

Процедура ПрочитатьСозданныеДокументыИндивидуальныхНачислений(МВТ,Организация, ПериодНачисления, Район, МКД)

	Запрос  						= Новый Запрос(ТекстЗапросаСозданныеДокументыРаспределения());
	Запрос.УстановитьПараметр("ПериодНачисления", 	ПериодНачисления);
	Запрос.УстановитьПараметр("Организация", 		Организация);
	Запрос.УстановитьПараметр("Район", 				Район);
	Запрос.УстановитьПараметр("Строение", 			МКД);	
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	
	Если МКД = Неопределено Тогда
		Запрос.Текст 				= СтрЗаменить(Запрос.Текст,"И энргДокументыНачислений.МКД = &Строение","");
		Запрос.Текст 				= СтрЗаменить(Запрос.Текст,"И МКД = &Строение","");
	КонецЕсли;
	
	Запрос.Выполнить();
	
КонецПроцедуры

Процедура ПрочитатьОбъемыНачисленийМКДДляРаспределения(МВТ, Организация,ПериодНачисления,Район, МКД, ГраницыПериода)
	
	Запрос  						= Новый Запрос(ТекстЗапросаОбъемыНачисленийМКДДляРаспределения());
	Запрос.УстановитьПараметр("ПериодНачисления", 	ПериодНачисления);
	Запрос.УстановитьПараметр("Организация", 		Организация);
	Запрос.УстановитьПараметр("Район", 				Район);
	Запрос.УстановитьПараметр("Строение", 			МКД);
	Запрос.УстановитьПараметр("НачалоПериода",		ГраницыПериода.НачалоОП);
	Запрос.УстановитьПараметр("КонецПериода",		ГраницыПериода.ЗавершениеОП);
	Запрос.УстановитьПараметр("Период",				ГраницыПериода.ЗавершениеОП-1);
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	
	Если МКД = Неопределено Тогда
		Запрос.Текст 				= СтрЗаменить(Запрос.Текст,"И МКД = &Строение","");
		Запрос.Текст 				= СтрЗаменить(Запрос.Текст,"И (бестОбъектыРасчета.МКД = &Строение)","");		
	КонецЕсли;
	
	Запрос.Выполнить();
	
КонецПроцедуры

Процедура ПрочитатьНормативныеДанныеРаспределения(МВТ,Организация, ПериодНачисления, Район, ГраницыПериода)
	
	Запрос  						= Новый Запрос(ТекстЗапросаНормативныеДанныеРаспределения());
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Запрос.УстановитьПараметр("ПериодНачисления", 	ПериодНачисления);
	Запрос.УстановитьПараметр("Организация", 		Организация);
	Запрос.УстановитьПараметр("Район", 				Район);
	Запрос.УстановитьПараметр("Период",				ГраницыПериода.ЗавершениеОП-1);
	Запрос.Выполнить();
	
КонецПроцедуры

#КонецОбласти

#Область КорректировкаПотребленияСезонныхУслуг

Процедура ПрочитатьВспомогательныеДанныеДляКорректировкиПотребленияСезонныхУслуг(МВТ,ГраницыПериода,Организация,ПериодНачисления,Район,ГодоваяКорректировка,Строение,Помещение)
	
	Запрос 							= Новый Запрос();	
	Текст 							= ТекстЗапросаВспомогательныеДанныеДляКорректировкиПотребленияСезонныхУслуг();
	МесяцГодовойКорректировки	 	= РегистрыСведений.энргНастройкиВыполненияГодовойКорректировки.ПолучитьПоследнее(ПериодНачисления, Новый Структура("Организация,Район",Организация,Район)).Месяц;
	
	Если МесяцГодовойКорректировки = 0 Тогда
		МесяцГодовойКорректировки 	= 1;
	КонецЕсли;
	
	Если НЕ Помещение = Неопределено Тогда	
		ЧастныйСектор 				= НЕ ЗначениеЗаполнено(Строение);
		Запрос.УстановитьПараметр("ЧастныйСектор", 	ЧастныйСектор);
		Запрос.УстановитьПараметр("Строение",		Строение);
		Запрос.УстановитьПараметр("Помещение",		Помещение);
		Запрос.УстановитьПараметр("МКД",			?(ЧастныйСектор,Справочники.энргСтроения.ПустаяСсылка(),Строение));
	ИначеЕсли Не Строение = Неопределено И НЕ ЗначениеЗаполнено(Строение) Тогда
		ЧастныйСектор 				= Истина;
		Запрос.УстановитьПараметр("ЧастныйСектор", 	ЧастныйСектор);
		Запрос.УстановитьПараметр("МКД",			Справочники.энргСтроения.ПустаяСсылка());
		
		Текст 						= СтрЗаменить(Текст,"И (энргСтабильныеПериоды.Строение = &Строение)","");
		Текст 						= СтрЗаменить(Текст,"И энргСтабильныеПериоды.Строение = &Строение","");
		Текст 						= СтрЗаменить(Текст,"И Строение = &Строение","");
		
		Текст 						= СтрЗаменить(Текст,"И (энргСтабильныеПериоды.Помещение = &Помещение)","");
		Текст 						= СтрЗаменить(Текст,"И энргСтабильныеПериоды.Помещение = &Помещение","");
		Текст 						= СтрЗаменить(Текст,"И Помещение = &Помещение","");
	ИначеЕсли Не Строение = Неопределено Тогда
		ЧастныйСектор 				= Ложь;
		Запрос.УстановитьПараметр("ЧастныйСектор", 	ЧастныйСектор);
		Запрос.УстановитьПараметр("МКД",			Строение);
		Запрос.УстановитьПараметр("Строение",		Строение);
		
		Текст 						= СтрЗаменить(Текст,"И (энргСтабильныеПериоды.Помещение = &Помещение)","");
		Текст 						= СтрЗаменить(Текст,"И энргСтабильныеПериоды.Помещение = &Помещение","");
		Текст 						= СтрЗаменить(Текст,"И Помещение = &Помещение","");
	Иначе
		Текст 						= СтрЗаменить(Текст,"И (энргСтабильныеПериоды.ЧастныйСектор = &ЧастныйСектор)","");
		Текст 						= СтрЗаменить(Текст,"И энргСтабильныеПериоды.ЧастныйСектор = &ЧастныйСектор","");
		Текст 						= СтрЗаменить(Текст,"И ЧастныйСектор = &ЧастныйСектор","");
		
		Текст 						= СтрЗаменить(Текст,"И (энргСтабильныеПериоды.Строение = &Строение)","");
		Текст 						= СтрЗаменить(Текст,"И энргСтабильныеПериоды.Строение = &Строение","");
		Текст 						= СтрЗаменить(Текст,"И Строение = &Строение","");
		Текст 						= СтрЗаменить(Текст,"И энргДокументыНачислений.МКД = &МКД","");
		Текст 						= СтрЗаменить(Текст,"И МКД = &МКД","");
		
		Текст 						= СтрЗаменить(Текст,"И (энргСтабильныеПериоды.Помещение = &Помещение)","");
		Текст 						= СтрЗаменить(Текст,"И энргСтабильныеПериоды.Помещение = &Помещение","");
		Текст 						= СтрЗаменить(Текст,"И Помещение = &Помещение",""); 		
	КонецЕсли;
	Запрос.Текст 					= Текст; 	
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Запрос.УстановитьПараметр("Организация", 					Организация);
	Запрос.УстановитьПараметр("ПериодНачисления", 				ПериодНачисления);
	Запрос.УстановитьПараметр("НачалоГода", 					НачалоГода(ПериодНачисления));
	Запрос.УстановитьПараметр("ОкончаниеГода", 					КонецМесяца(ПериодНачисления));
	Запрос.УстановитьПараметр("Район", 							Район);
	Запрос.УстановитьПараметр("ЗавершениеОП", 					ГраницыПериода.ЗавершениеОП);
	Запрос.УстановитьПараметр("ВыполнятьГодовуюКорректировку", 	МесяцГодовойКорректировки = Месяц(ПериодНачисления));
	Запрос.Выполнить();
	
КонецПроцедуры

#КонецОбласти

#Область КорректировкаПотребленияСезонныхУслугМКД

Процедура ЗаписатьНаборыЗаписейНачислениеМКД(ДокументОбъект, Набор, НаборВыполненные, Ошибки)
	
	Попытка
		Если НЕ ДокументОбъект = Неопределено Тогда
			ДокументОбъект.ДополнительныеСвойства.Вставить("ПроведениеРазрешено",Истина);
			ДокументОбъект.записать(РежимЗаписиДокумента.Запись);
		КонецЕсли;														
		
		Если НЕ НаборВыполненные = Неопределено Тогда
			НаборВыполненные.Записать(НаборВыполненные.ДополнительныеСвойства.Замещать);
		КонецЕсли;
										
		Набор.Записать(Ложь);		
		
		ЗафиксироватьТранзакцию();
	Исключение						
		ОтменитьТранзакцию();
		ИнформацияОбОшибке  					= ИнформацияОбОшибке();
		Ошибки 									= Ошибки +
		Символы.ПС + ПодробноеПредставлениеОшибки(ИнформацияОбОшибке);
	КонецПопытки;

КонецПроцедуры

Процедура ПрочитатьВспомогательныеДанныеДляКорректировкиПотребленияСезонныхУслугМКД(МВТ,ГраницыПериода,Организация,ПериодНачисления,Район,ГодоваяКорректировка,МКД)
	
	Запрос 							= Новый Запрос();	
	Текст 							= ТекстЗапросаВспомогательныеДанныеДляКорректировкиПотребленияСезонныхУслугМКД();
	МесяцГодовойКорректировки	 	= РегистрыСведений.энргНастройкиВыполненияГодовойКорректировки.ПолучитьПоследнее(ПериодНачисления, Новый Структура("Организация,Район",Организация,Район)).Месяц;
	
	Если МесяцГодовойКорректировки = 0 Тогда
		МесяцГодовойКорректировки 	= 1;
	КонецЕсли;
		
	Если Не МКД = Неопределено Тогда
		Запрос.УстановитьПараметр("МКД",МКД);			
	Иначе
		Текст 						= СтрЗаменить(Текст,"И МКД = &МКД","");
		Текст 						= СтрЗаменить(Текст,"И (энргСтабильныеПериоды.МКД = &МКД)","");
		Текст 						= СтрЗаменить(Текст,"И энргСтабильныеПериоды.МКД = &МКД","");
		Текст 						= СтрЗаменить(Текст,"И энргДокументыНачислений.МКД = &МКД","");	
	КонецЕсли;
	Запрос.Текст 					= Текст; 	
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Запрос.УстановитьПараметр("Организация", 					Организация);
	Запрос.УстановитьПараметр("ПериодНачисления", 				ПериодНачисления);
	Запрос.УстановитьПараметр("НачалоГода", 					НачалоГода(ПериодНачисления));
	Запрос.УстановитьПараметр("ОкончаниеГода", 					КонецМесяца(ПериодНачисления));
	Запрос.УстановитьПараметр("Район", 							Район);
	Запрос.УстановитьПараметр("ЗавершениеОП", 					ГраницыПериода.ЗавершениеОП);
	Запрос.УстановитьПараметр("ВыполнятьГодовуюКорректировку", 	МесяцГодовойКорректировки = Месяц(ПериодНачисления));
	Запрос.Выполнить();
	
КонецПроцедуры

#КонецОбласти

#Область РаспределениеМКД_Перерасчет

Функция ТекстЗапросаНормативныеДанныеРаспределения_Перерасчет()
	
	Текст  = 
	"ВЫБРАТЬ
	|	&Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	&Район КАК Район,
	|	энргЗначенияНормативовПотребления.КлючНорматива КАК КлючНорматива,
	|	энргЗначенияНормативовПотребления.Услуга КАК Услуга,
	|	энргЗначенияНормативовПотребления.ЗначениеНорматива КАК ЗначениеНорматива
	|ПОМЕСТИТЬ ЗначенияТекущихНормПотребления
	|ИЗ
	|	(ВЫБРАТЬ
	|		ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|		энргЗначенияНормативовПотребления.КлючНорматива КАК КлючНорматива,
	|		энргЗначенияНормативовПотребления.Услуга КАК Услуга,
	|		МАКСИМУМ(энргЗначенияНормативовПотребления.Период) КАК Период
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначенияНормативовПотребления КАК энргЗначенияНормативовПотребления
	|			ПО ГраницыОтчетногоПериода.Организация = энргЗначенияНормативовПотребления.Организация
	|				И ГраницыОтчетногоПериода.ЗавершениеОП > энргЗначенияНормативовПотребления.Период
	|				И (энргЗначенияНормативовПотребления.Организация = &Организация)
	|				И (энргЗначенияНормативовПотребления.Район = &Район)
	|				И (энргЗначенияНормативовПотребления.ТипНачисления = ЗНАЧЕНИЕ(Перечисление.энргТипыНачислений.ОбщедомовыеНачисления))
	|				И (энргЗначенияНормативовПотребления.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление))
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ГраницыОтчетногоПериода.ПериодНачисления,
	|		энргЗначенияНормативовПотребления.КлючНорматива,
	|		энргЗначенияНормативовПотребления.Услуга) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначенияНормативовПотребления КАК энргЗначенияНормативовПотребления
	|		ПО ВложенныйЗапрос.КлючНорматива = энргЗначенияНормативовПотребления.КлючНорматива
	|			И ВложенныйЗапрос.Услуга = энргЗначенияНормативовПотребления.Услуга
	|			И ВложенныйЗапрос.Период = энргЗначенияНормативовПотребления.Период
	|			И (энргЗначенияНормативовПотребления.Организация = &Организация)
	|			И (энргЗначенияНормативовПотребления.Район = &Район)
	|			И (энргЗначенияНормативовПотребления.ТипНачисления = ЗНАЧЕНИЕ(Перечисление.энргТипыНачислений.ОбщедомовыеНачисления))
	|			И (энргЗначенияНормативовПотребления.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление))
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	&Организация,
	|	ВложенныйЗапрос.ПериодНачисления,
	|	&Район,
	|	энргЗначенияНормативовПотребления.КлючНорматива,
	|	энргЗначенияНормативовПотребления.Услуга,
	|	энргЗначенияНормативовПотребления.ЗначениеНорматива
	|ИЗ
	|	(ВЫБРАТЬ
	|		ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|		энргЗначенияНормативовПотребления.КлючНорматива КАК КлючНорматива,
	|		энргЗначенияНормативовПотребления.Услуга КАК Услуга,
	|		МАКСИМУМ(энргЗначенияНормативовПотребления.Период) КАК Период
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначенияНормативовПотребления КАК энргЗначенияНормативовПотребления
	|			ПО ГраницыОтчетногоПериода.Организация = энргЗначенияНормативовПотребления.Организация
	|				И ГраницыОтчетногоПериода.ЗавершениеОП > энргЗначенияНормативовПотребления.Период
	|				И (энргЗначенияНормативовПотребления.Организация = &Организация)
	|				И (энргЗначенияНормативовПотребления.Район = &Район)
	|				И (энргЗначенияНормативовПотребления.ТипНачисления = ЗНАЧЕНИЕ(Перечисление.энргТипыНачислений.ИндивидуальныеНачисления))
	|				И (энргЗначенияНормативовПотребления.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление))
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.энргВидыУслуг КАК энргВидыУслуг
	|			ПО (энргЗначенияНормативовПотребления.Услуга = энргВидыУслуг.Ссылка)
	|				И (энргВидыУслуг.НормативДляИндивидуальных)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ГраницыОтчетногоПериода.ПериодНачисления,
	|		энргЗначенияНормативовПотребления.КлючНорматива,
	|		энргЗначенияНормативовПотребления.Услуга) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначенияНормативовПотребления КАК энргЗначенияНормативовПотребления
	|		ПО ВложенныйЗапрос.КлючНорматива = энргЗначенияНормативовПотребления.КлючНорматива
	|			И ВложенныйЗапрос.Услуга = энргЗначенияНормативовПотребления.Услуга
	|			И ВложенныйЗапрос.Период = энргЗначенияНормативовПотребления.Период
	|			И (энргЗначенияНормативовПотребления.Организация = &Организация)
	|			И (энргЗначенияНормативовПотребления.Район = &Район)
	|			И (энргЗначенияНормативовПотребления.ТипНачисления = ЗНАЧЕНИЕ(Перечисление.энргТипыНачислений.ИндивидуальныеНачисления))
	|			И (энргЗначенияНормативовПотребления.НаправлениеИспользованияТУ = ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление))
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	&РАйон КАК Район,
	|	энргЗначенияТарифов.ГруппаПотребителей КАК ГруппаПотребителей,
	|	энргЗначенияТарифов.Услуга КАК Услуга,
	|	энргЗначенияТарифов.Поставщик КАК Поставщик,
	|	энргЗначенияТарифов.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргЗначенияТарифов.Значение КАК Значение,
	|	энргЗначенияТарифов.ЗначениеСверхНорматива КАК ЗначениеСверхНорматива,
	|	энргЗначенияТарифов.ЗначениеРЭК КАК ЗначениеТарифаРЭК,
	|	энргЗначенияТарифов.СтавкаНДС КАК СтавкаНДС,
	|	энргЗначенияТарифов.НДСВнутри КАК НДСВнутри
	|ПОМЕСТИТЬ ЗначенияТекущихТарифов
	|ИЗ
	|	(ВЫБРАТЬ
	|		ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|		энргЗначенияТарифов.ГруппаПотребителей КАК ГруппаПотребителей,
	|		энргЗначенияТарифов.Услуга КАК Услуга,
	|		энргЗначенияТарифов.Поставщик КАК Поставщик,
	|		энргЗначенияТарифов.ТарифнаяЗона КАК ТарифнаяЗона,
	|		МАКСИМУМ(энргЗначенияТарифов.Период) КАК Период
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначенияТарифов КАК энргЗначенияТарифов
	|			ПО ГраницыОтчетногоПериода.Организация = энргЗначенияТарифов.Организация
	|				И ГраницыОтчетногоПериода.ЗавершениеОП > энргЗначенияТарифов.Период
	|				И (энргЗначенияТарифов.Организация = &Организация)
	|				И (энргЗначенияТарифов.Район = &Район)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ГраницыОтчетногоПериода.ПериодНачисления,
	|		энргЗначенияТарифов.ГруппаПотребителей,
	|		энргЗначенияТарифов.Услуга,
	|		энргЗначенияТарифов.Поставщик,
	|		энргЗначенияТарифов.ТарифнаяЗона) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргЗначенияТарифов КАК энргЗначенияТарифов
	|		ПО ВложенныйЗапрос.ГруппаПотребителей = энргЗначенияТарифов.ГруппаПотребителей
	|			И ВложенныйЗапрос.Услуга = энргЗначенияТарифов.Услуга
	|			И ВложенныйЗапрос.Поставщик = энргЗначенияТарифов.Поставщик
	|			И ВложенныйЗапрос.ТарифнаяЗона = энргЗначенияТарифов.ТарифнаяЗона
	|			И ВложенныйЗапрос.Период = энргЗначенияТарифов.Период
	|			И (энргЗначенияТарифов.Организация = &Организация)
	|			И (энргЗначенияТарифов.Район = &Район)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	&Район КАК Район,
	|	&Строение КАК МКД,
	|	энргНастройкаНачисленияГВСМКД.Услуга КАК Услуга,
	|	энргНастройкаНачисленияГВСМКД.ТипСхемы КАК ТипСхемы,
	|	энргНастройкаНачисленияГВСМКД.ПринадлежностьКТепловомуПункту КАК ПринадлежностьКТепловомуПункту,
	|	энргНастройкаНачисленияГВСМКД.НеНачислять КАК НеНачислять
	|ПОМЕСТИТЬ МКДНеНачислятьТЭ
	|ИЗ
	|	(ВЫБРАТЬ
	|		ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|		энргНастройкаНачисленияГВСМКД.Услуга КАК Услуга,
	|		энргНастройкаНачисленияГВСМКД.ТипСхемы КАК ТипСхемы,
	|		энргНастройкаНачисленияГВСМКД.ПринадлежностьКТепловомуПункту КАК ПринадлежностьКТепловомуПункту,
	|		МАКСИМУМ(энргНастройкаНачисленияГВСМКД.Период) КАК Период
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргНастройкаНачисленияГВСМКД КАК энргНастройкаНачисленияГВСМКД
	|			ПО ГраницыОтчетногоПериода.Организация = энргНастройкаНачисленияГВСМКД.Организация
	|				И ГраницыОтчетногоПериода.ЗавершениеОП > энргНастройкаНачисленияГВСМКД.Период
	|				И (энргНастройкаНачисленияГВСМКД.Организация = &Организация)
	|				И (энргНастройкаНачисленияГВСМКД.Район = &Район)
	|				И (энргНастройкаНачисленияГВСМКД.МКД = &Строение)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ГраницыОтчетногоПериода.ПериодНачисления,
	|		энргНастройкаНачисленияГВСМКД.Услуга,
	|		энргНастройкаНачисленияГВСМКД.ТипСхемы,
	|		энргНастройкаНачисленияГВСМКД.ПринадлежностьКТепловомуПункту) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргНастройкаНачисленияГВСМКД КАК энргНастройкаНачисленияГВСМКД
	|		ПО ВложенныйЗапрос.Услуга = энргНастройкаНачисленияГВСМКД.Услуга
	|			И ВложенныйЗапрос.ТипСхемы = энргНастройкаНачисленияГВСМКД.ТипСхемы
	|			И ВложенныйЗапрос.ПринадлежностьКТепловомуПункту = энргНастройкаНачисленияГВСМКД.ПринадлежностьКТепловомуПункту
	|			И ВложенныйЗапрос.Период = энргНастройкаНачисленияГВСМКД.Период
	|			И (энргНастройкаНачисленияГВСМКД.Организация = &Организация)
	|			И (энргНастройкаНачисленияГВСМКД.Район = &Район)
	|			И (энргНастройкаНачисленияГВСМКД.МКД = &Строение)";
	
	Возврат Текст;

КонецФункции

Функция ТекстЗапросаДокументыДляРаспределенияМКД_Перерасчет() 
	
	Текст  = 
	"ВЫБРАТЬ
	|	&Организация КАК Организация,
	|	ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|	&Район КАК Район,
	|	&Строение КАК Строение,
	|	ГраницыОтчетногоПериода.ЗавершениеОП
	|ПОМЕСТИТЬ ДокументыДляРаспределения
	|ИЗ
	|	ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода";
	
	Возврат Текст
	
КонецФункции

Функция ТекстЗапросаСозданныеДокументыРаспределения_Перерасчет()
	
	Текст = 
	"ВЫБРАТЬ
	|	энргДокументыНачислений.ПериодНачисления КАК ПериодНачисления,
	|	энргДокументыНачислений.ДокументНачисления КАК ДокументНачисления
	|ПОМЕСТИТЬ ДокументыНачислений
	|ИЗ
	|	РегистрСведений.энргДокументыНачислений КАК энргДокументыНачислений
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДокументыДляРаспределения КАК ДокументыДляРаспределения
	|		ПО энргДокументыНачислений.Организация = ДокументыДляРаспределения.Организация
	|			И энргДокументыНачислений.ПериодНачисления = ДокументыДляРаспределения.ПериодНачисления
	|			И энргДокументыНачислений.Район = ДокументыДляРаспределения.Район
	|			И (энргДокументыНачислений.ВидОперацийНачисления = ЗНАЧЕНИЕ(Перечисление.энргВидыОперацийНачисления.Индивидуальные))
	|			И энргДокументыНачислений.МКД = ДокументыДляРаспределения.Строение
	|			И (энргДокументыНачислений.Организация = &Организация)
	|			И (энргДокументыНачислений.МКД = &Строение)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&Организация КАК Организация,
	|	ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|	&Район КАК Район,
	|	&Строение КАК МКД,
	|	ЗНАЧЕНИЕ(Документ.энргРаспределениеМКД.ПустаяСсылка) КАК ДокументНачисления
	|ПОМЕСТИТЬ ДокументыРаспределенияМКД
	|ИЗ
	|	ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&Организация КАК Организация,
	|	ВложенныйЗапрос.ПериодНачисления КАК ПериодНачисления,
	|	&Район КАК Район,
	|	&Строение КАК МКД,
	|	энргИсторияСоглашенийОРаспределенииСверхнормативногоОДН.Услуга КАК Услуга,
	|	энргИсторияСоглашенийОРаспределенииСверхнормативногоОДН.РаспределятьПолностью КАК РаспределятьПолностью
	|ПОМЕСТИТЬ ИсторияСоглашенийОРаспределенииСверхнормативногоОДН
	|ИЗ
	|	(ВЫБРАТЬ
	|		ГраницыОтчетногоПериода.ПериодНачисления КАК ПериодНачисления,
	|		энргИсторияСоглашенийОРаспределенииСверхнормативногоОДН.Услуга КАК Услуга,
	|		МАКСИМУМ(энргИсторияСоглашенийОРаспределенииСверхнормативногоОДН.Период) КАК Период
	|	ИЗ
	|		ГраницыОтчетногоПериода КАК ГраницыОтчетногоПериода
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргИсторияСоглашенийОРаспределенииСверхнормативногоОДН КАК энргИсторияСоглашенийОРаспределенииСверхнормативногоОДН
	|			ПО ГраницыОтчетногоПериода.Организация = энргИсторияСоглашенийОРаспределенииСверхнормативногоОДН.Организация
	|				И ГраницыОтчетногоПериода.ЗАвершениеОП > энргИсторияСоглашенийОРаспределенииСверхнормативногоОДН.Период
	|				И (энргИсторияСоглашенийОРаспределенииСверхнормативногоОДН.Организация = &Организация)
	|				И (энргИсторияСоглашенийОРаспределенииСверхнормативногоОДН.Район = &Район)
	|				И (энргИсторияСоглашенийОРаспределенииСверхнормативногоОДН.МКД = &Строение)
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ГраницыОтчетногоПериода.ПериодНачисления,
	|		энргИсторияСоглашенийОРаспределенииСверхнормативногоОДН.Услуга) КАК ВложенныйЗапрос
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.энргИсторияСоглашенийОРаспределенииСверхнормативногоОДН КАК энргИсторияСоглашенийОРаспределенииСверхнормативногоОДН
	|		ПО ВложенныйЗапрос.Услуга = энргИсторияСоглашенийОРаспределенииСверхнормативногоОДН.Услуга
	|			И ВложенныйЗапрос.Период = энргИсторияСоглашенийОРаспределенииСверхнормативногоОДН.Период
	|			И (энргИсторияСоглашенийОРаспределенииСверхнормативногоОДН.Организация = &Организация)
	|			И (энргИсторияСоглашенийОРаспределенииСверхнормативногоОДН.Район = &Район)
	|			И (энргИсторияСоглашенийОРаспределенииСверхнормативногоОДН.МКД = &Строение)";
	
	Возврат Текст;
	
КонецФункции

Функция ТекстЗапросаОбъемыНачисленийМКДДляРаспределения_Перерасчет()
	Текст  = 
	"ВЫБРАТЬ
	|	энргОбъемНачисленийМКДОбороты.ПериодНачисления КАК ПериодНачисления,
	|	энргОбъемНачисленийМКДОбороты.Организация КАК Организация,
	|	энргОбъемНачисленийМКДОбороты.Район КАК Район,
	|	энргОбъемНачисленийМКДОбороты.МКД КАК МКД,
	|	энргОбъемНачисленийМКДОбороты.Услуга КАК Услуга,
	|	энргОбъемНачисленийМКДОбороты.ОбъемУслугиНорматив КАК ОбъемУслугиНормативОборот,
	|	энргОбъемНачисленийМКДОбороты.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргОбъемНачисленийМКДОбороты.СпособНачисления КАК СпособНачисления,
	|	энргОбъемНачисленийМКДОбороты.ОбъемУслуги КАК ОбъемУслугиОборот,
	|	энргОбъемНачисленийМКДОбороты.ОбъемУслугиПотребленный КАК ОбъемУслугиПотребленныйОборот,
	|	энргОбъемНачисленийМКДОбороты.ПоказанияПредоставлены КАК ПоказанияПредоставленыОборот,
	|	ВЫБОР
	|		КОГДА энргОбъемНачисленийМКДОбороты.СпособНачисления = ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.ПоПриборам)
	|			ТОГДА 1
	|		КОГДА энргОбъемНачисленийМКДОбороты.СпособНачисления = ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.НачислениеПоСреднему)
	|			ТОГДА 1
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК ПоказанияПредоставленыПотребленныйОборот
	|ПОМЕСТИТЬ НачисленныйОбъемМКД
	|ИЗ
	|	&энргОбъемНачисленийМКД КАК энргОбъемНачисленийМКДОбороты
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НАЧАЛОПЕРИОДА(энргОбъемНачислений.Период, МЕСЯЦ) КАК ПериодНачисления,
	|	энргОбъемНачислений.Период КАК Период,
	|	энргОбъемНачислений.Регистратор КАК Регистратор,
	|	энргОбъемНачислений.НомерСтроки КАК НомерСтроки,
	|	энргОбъемНачислений.Активность КАК Активность,
	|	энргОбъемНачислений.Организация КАК Организация,
	|	энргОбъемНачислений.Район КАК Район,
	|	энргОбъемНачислений.Распределение КАК Распределение,
	|	энргОбъемНачислений.Строение КАК Строение,
	|	энргОбъемНачислений.Помещение КАК Помещение,
	|	энргОбъемНачислений.Абонент КАК Абонент,
	|	энргОбъемНачислений.Услуга КАК Услуга,
	|	энргОбъемНачислений.ТочкаУчета КАК ТочкаУчета,
	|	энргОбъемНачислений.ВидНачисления КАК ВидНачисления,
	|	энргОбъемНачислений.СпособНачисления КАК СпособНачисления,
	|	энргОбъемНачислений.НаправлениеИспользованияТУ КАК НаправлениеИспользованияТУ,
	|	энргОбъемНачислений.Измеритель КАК Измеритель,
	|	энргОбъемНачислений.ПриборУчета КАК ПриборУчета,
	|	энргОбъемНачислений.Шкала КАК Шкала,
	|	энргОбъемНачислений.ТарифнаяЗона КАК ТарифнаяЗона,
	|	энргОбъемНачислений.ЗначениеТарифа КАК ЗначениеТарифа,
	|	энргОбъемНачислений.Поставщик КАК Поставщик,
	|	энргОбъемНачислений.ПериодРасчета КАК ПериодРасчета,
	|	энргОбъемНачислений.ЧастныйСектор КАК ЧастныйСектор,
	|	энргОбъемНачислений.СверхНорматива КАК СверхНорматива,
	|	энргОбъемНачислений.Сумма КАК Сумма,
	|	энргОбъемНачислений.ОбъемУслуги КАК ОбъемУслуги,
	|	энргОбъемНачислений.ОбъемУслугиПотребленный КАК ОбъемУслугиПотребленный,
	|	энргОбъемНачислений.ОбъемУслугиСоцНорма КАК ОбъемУслугиСоцНорма,
	|	энргОбъемНачислений.НачалоПериода КАК НачалоПериода,
	|	энргОбъемНачислений.КонецПериода КАК КонецПериода,
	|	энргОбъемНачислений.НачальныеПоказания КАК НачальныеПоказания,
	|	энргОбъемНачислений.КонечныеПоказания КАК КонечныеПоказания,
	|	энргОбъемНачислений.КоличествоКомнат КАК КоличествоКомнат,
	|	энргОбъемНачислений.КоличествоПрописанных КАК КоличествоПрописанных,
	|	энргОбъемНачислений.ЗначениеПлощади КАК ЗначениеПлощади,
	|	энргОбъемНачислений.НормаПотребления КАК НормаПотребления,
	|	энргОбъемНачислений.КоэффициентПУ КАК КоэффициентПУ,
	|	энргОбъемНачислений.РасчетПоФормуле КАК РасчетПоФормуле,
	|	энргОбъемНачислений.ВидБлагоустройства КАК ВидБлагоустройства,
	|	энргОбъемНачислений.ТарифнаяГруппа КАК ТарифнаяГруппа,
	|	энргОбъемНачислений.ДатаПоверки КАК ДатаПоверки,
	|	энргОбъемНачислений.ОтключатьВНеполивнойСезон КАК ОтключатьВНеполивнойСезон,
	|	энргОбъемНачислений.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|	энргОбъемНачислений.КоэффициентФормула КАК КоэффициентФормула,
	|	энргОбъемНачислений.ВидДифференцированности КАК ВидДифференцированности,
	|	энргОбъемНачислений.ОснованиеПерерасчета КАК ОснованиеПерерасчета,
	|	энргОбъемНачислений.ОснованиеПерерасчетаДата КАК ОснованиеПерерасчетаДата,
	|	энргОбъемНачислений.ПриборЗависимой КАК ПриборЗависимой,
	|	энргОбъемНачислений.СписатьИзНормы КАК СписатьИзНормы,
	|	энргОбъемНачислений.ПовыщающийКоэффициент КАК ПовыщающийКоэффициент,
	|	энргОбъемНачислений.КоличествоСобственников КАК КоличествоСобственников,
	|	энргОбъемНачислений.КоличествоПроживающих КАК КоличествоПроживающих,
	|	энргОбъемНачислений.СниматьНачисленныйСредний КАК СниматьНачисленныйСредний,
	|	энргОбъемНачислений.ПлощадьМОП КАК ПлощадьМОП,
	|	энргОбъемНачислений.ПлощадьАбонентов КАК ПлощадьАбонентов,
	|	энргОбъемНачислений.ПлощадьСобственнаяПоставка КАК ПлощадьСобственнаяПоставка,
	|	энргОбъемНачислений.КоэффициентРаспределенияОстатка КАК КоэффициентРаспределенияОстатка,
	|	энргОбъемНачислений.ЗначениеСоциальнойНормы КАК ЗначениеСоциальнойНормы,
	|	энргОбъемНачислений.СоставнаяУслуга КАК СоставнаяУслуга,
	|	энргОбъемНачислений.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	энргОбъемНачислений.ПомещениеРодитель КАК ПомещениеРодитель
	|ПОМЕСТИТЬ ОбъемНачисленийПоПриборуУчетаКорректироватьИндивидуальныйОбъем
	|ИЗ
	|	РегистрНакопления.энргОбъемНачислений.Обороты(
	|			&НачалоПериодаПерерасчета,
	|			&КонецПериодаПерерасчета,
	|			Запись,
	|			Организация = &Организация
	|				И Район = &Район
	|				И НЕ Распределение
	|				И НЕ ЧастныйСектор
	|				И Строение = &Строение
	|				И ВидНачисления = ЗНАЧЕНИЕ(Перечисление.энргВидыНачислений.Начисление)
	|				И СпособНачисления В (ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.ПоПриборам), ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.НачислениеПоСреднему))
	|				И Услуга В
	|					(ВЫБРАТЬ
	|						энргВидыУслуг.Ссылка КАК Ссылка
	|					ИЗ
	|						Справочник.энргВидыУслуг КАК энргВидыУслуг
	|					ГДЕ
	|						энргВидыУслуг.КорректироватьИндивидуальныйОбъемСУчетомОДПУ)) КАК энргОбъемНачисленийОбороты
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.энргОбъемНачислений КАК энргОбъемНачислений
	|		ПО энргОбъемНачисленийОбороты.Период = энргОбъемНачислений.Период
	|			И энргОбъемНачисленийОбороты.Регистратор = энргОбъемНачислений.Регистратор
	|			И энргОбъемНачисленийОбороты.НомерСтроки = энргОбъемНачислений.НомерСтроки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НАЧАЛОПЕРИОДА(бестОбъемНачисленийНП.Период, МЕСЯЦ) КАК ПериодНачисления,
	|	бестОбъемНачисленийНП.Период КАК Период,
	|	бестОбъемНачисленийНП.Регистратор КАК Регистратор,
	|	бестОбъемНачисленийНП.НомерСтроки КАК НомерСтроки,
	|	бестОбъемНачисленийНП.Активность КАК Активность,
	|	бестОбъемНачисленийНП.Организация КАК Организация,
	|	бестОбъемНачисленийНП.Район КАК Район,
	|	бестОбъемНачисленийНП.Распределение КАК Распределение,
	|	бестОбъемНачисленийНП.Договор КАК Договор,
	|	бестОбъемНачисленийНП.МКД КАК МКД,
	|	бестОбъемНачисленийНП.ОбъектРасчета КАК ОбъектРасчета,
	|	бестОбъемНачисленийНП.Услуга КАК Услуга,
	|	бестОбъемНачисленийНП.ТочкаУчета КАК ТочкаУчета,
	|	бестОбъемНачисленийНП.ВидНачисления КАК ВидНачисления,
	|	бестОбъемНачисленийНП.СпособНачисления КАК СпособНачисления,
	|	бестОбъемНачисленийНП.ПриборУчета КАК ПриборУчета,
	|	бестОбъемНачисленийНП.Шкала КАК Шкала,
	|	бестОбъемНачисленийНП.ТарифнаяЗона КАК ТарифнаяЗона,
	|	бестОбъемНачисленийНП.Поставщик КАК Поставщик,
	|	бестОбъемНачисленийНП.ПериодРасчета КАК ПериодРасчета,
	|	бестОбъемНачисленийНП.ДолевоеРаспределение КАК ДолевоеРаспределение,
	|	бестОбъемНачисленийНП.ОбъемПоПрибору КАК ОбъемПоПрибору,
	|	бестОбъемНачисленийНП.ОбъемУслуги КАК ОбъемУслуги,
	|	бестОбъемНачисленийНП.ОбъемУслугиПотребленный КАК ОбъемУслугиПотребленный,
	|	бестОбъемНачисленийНП.КоличествоЧасовШтатнойРаботыПУ КАК КоличествоЧасовШтатнойРаботыПУ,
	|	бестОбъемНачисленийНП.ОбъемДосчитанный КАК ОбъемДосчитанный,
	|	бестОбъемНачисленийНП.НачалоПериода КАК НачалоПериода,
	|	бестОбъемНачисленийНП.КонецПериода КАК КонецПериода,
	|	бестОбъемНачисленийНП.НачальныеПоказания КАК НачальныеПоказания,
	|	бестОбъемНачисленийНП.КонечныеПоказания КАК КонечныеПоказания,
	|	бестОбъемНачисленийНП.ЗначениеПлощади КАК ЗначениеПлощади,
	|	бестОбъемНачисленийНП.НормаПотребления КАК НормаПотребления,
	|	бестОбъемНачисленийНП.РасчетПоФормуле КАК РасчетПоФормуле,
	|	бестОбъемНачисленийНП.ДатаПоверки КАК ДатаПоверки,
	|	бестОбъемНачисленийНП.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|	бестОбъемНачисленийНП.КоэффициентРасчета КАК КоэффициентФормула,
	|	бестОбъемНачисленийНП.ВидДифференцированности КАК ВидДифференцированности,
	|	бестОбъемНачисленийНП.СписатьИзНормы КАК СписатьИзНормы,
	|	бестОбъемНачисленийНП.ПовыщающийКоэффициент КАК ПовыщающийКоэффициент,
	|	бестОбъемНачисленийНП.СоставнаяУслуга КАК СоставнаяУслуга,
	|	бестОбъемНачисленийНП.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	бестОбъемНачисленийНП.ЗначениеНагрузки КАК ЗначениеНагрузки,
	|	бестОбъемНачисленийНП.ЗначениеНормативаЗаДень КАК ЗначениеНормативаЗаДень,
	|	бестОбъемНачисленийНП.ОбъектУчаствуетВРаспределенииМКД КАК ОбъектУчаствуетВРаспределенииМКД,
	|	бестОбъемНачисленийНП.СпособРасчетаНорматива КАК СпособРасчетаНорматива,
	|	бестОбъемНачисленийНП.ТемператураВнутриПомещения КАК ТемператураВнутриПомещения,
	|	бестОбъемНачисленийНП.ПлощадьМОП КАК ПлощадьМОП,
	|	бестОбъемНачисленийНП.ПлощадьАбонентов КАК ПлощадьАбонентов,
	|	бестОбъемНачисленийНП.ПлощадьСобственнаяПоставка КАК ПлощадьСобственнаяПоставка
	|ПОМЕСТИТЬ ОбъемНачисленийНППоПриборуУчетаКорректироватьИндивидуальныйОбъем
	|ИЗ
	|	РегистрНакопления.бестОбъемНачисленийНП.Обороты(
	|			&НачалоПериодаПерерасчета,
	|			&КонецПериодаПерерасчета,
	|			Запись,
	|			Организация = &Организация
	|				И Район = &Район
	|				И НЕ Распределение
	|				И МКД = &Строение
	|				И ВидНачисления = ЗНАЧЕНИЕ(Перечисление.энргВидыНачислений.Начисление)
	|				И СпособНачисления В (ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.ПоПриборам), ЗНАЧЕНИЕ(Перечисление.энргСпособНачислений.НачислениеПоСреднему))
	|				И Услуга В
	|					(ВЫБРАТЬ
	|						энргВидыУслуг.Ссылка КАК Ссылка
	|					ИЗ
	|						Справочник.энргВидыУслуг КАК энргВидыУслуг
	|					ГДЕ
	|						энргВидыУслуг.КорректироватьИндивидуальныйОбъемСУчетомОДПУ)) КАК бестОбъемНачисленийНПОбороты
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.бестОбъемНачисленийНП КАК бестОбъемНачисленийНП
	|		ПО бестОбъемНачисленийНПОбороты.Период = бестОбъемНачисленийНП.Период
	|			И бестОбъемНачисленийНПОбороты.Регистратор = бестОбъемНачисленийНП.Регистратор
	|			И бестОбъемНачисленийНПОбороты.НомерСтроки = бестОбъемНачисленийНП.НомерСтроки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	энргОбъемНачисленийОбороты.Район КАК Район,
	|	энргОбъемНачисленийОбороты.Организация КАК Организация,
	|	энргОбъемНачисленийОбороты.Распределение КАК Распределение,
	|	бестОбъектыРасчета.МКД КАК Строение,
	|	энргОбъемНачисленийОбороты.ОбъектРасчета КАК Абонент,
	|	энргОбъемНачисленийОбороты.ОбъектРасчета КАК Помещение,
	|	энргОбъемНачисленийОбороты.Услуга КАК Услуга,
	|	энргОбъемНачисленийОбороты.ТочкаУчета КАК ТочкаУчета,
	|	энргОбъемНачисленийОбороты.ВидНачисления КАК ВидНачисления,
	|	энргОбъемНачисленийОбороты.СпособНачисления КАК СпособНачисления,
	|	ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.ОсновноеНаправление) КАК НаправлениеИспользованияТУ,
	|	ЗНАЧЕНИЕ(Справочник.энргНаправлениеИспользованияТочекУчета.Пустаяссылка) КАК Измеритель,
	|	энргОбъемНачисленийОбороты.ПриборУчета КАК ПриборУчета,
	|	энргОбъемНачисленийОбороты.Шкала КАК Шкала,
	|	энргОбъемНачисленийОбороты.ТарифнаяЗона КАК ТарифнаяЗона,
	|	1 КАК ЗначениеТарифа,
	|	энргОбъемНачисленийОбороты.Поставщик КАК Поставщик,
	|	энргОбъемНачисленийОбороты.ПериодРасчета КАК ПериодРасчета,
	|	энргОбъемНачисленийОбороты.ПериодНачисления КАК ПериодНачисления,
	|	ЛОЖЬ КАК ЧастныйСектор,
	|	ЛОЖЬ КАК СверхНорматива,
	|	0 КАК Сумма,
	|	энргОбъемНачисленийОбороты.ОбъемУслуги КАК ОбъемУслуги,
	|	энргОбъемНачисленийОбороты.ОбъемУслугиПотребленный КАК ОбъемУслугиПотребленный,
	|	0 КАК СуммаПоПовышенномуКоэффициенту,
	|	энргОбъемНачисленийОбороты.НачалоПериода КАК НачалоПериода,
	|	энргОбъемНачисленийОбороты.КонецПериода КАК КонецПериода,
	|	энргОбъемНачисленийОбороты.НачальныеПоказания КАК НачальныеПоказания,
	|	энргОбъемНачисленийОбороты.КонечныеПоказания КАК КонечныеПоказания,
	|	0 КАК КоличествоКомнат,
	|	0 КАК КоличествоПрописанных,
	|	0 КАК КоличествоЖильцов,
	|	энргОбъемНачисленийОбороты.ЗначениеПлощади КАК ЗначениеПлощади,
	|	энргОбъемНачисленийОбороты.НормаПотребления КАК НормаПотребления,
	|	0 КАК КоэффициентПУ,
	|	энргОбъемНачисленийОбороты.РасчетПоФормуле КАК РасчетПоФормуле,
	|	ЗНАЧЕНИЕ(Справочник.энргВидыБлагоустройств.ПустаяСсылка) КАК ВидБлагоустройства,
	|	ЗНАЧЕНИЕ(Справочник.энргГруппыПотребителей.ПустаяСсылка) КАК ТарифнаяГруппа,
	|	энргОбъемНачисленийОбороты.ДатаПоверки КАК ДатаПоверки,
	|	ЛОЖЬ КАК ОтключатьВНеполивнойСезон,
	|	энргОбъемНачисленийОбороты.ЗависимаяТочкаУчета КАК ЗависимаяТочкаУчета,
	|	энргОбъемНачисленийОбороты.КоэффициентРасчета КАК КоэффициентФормула,
	|	энргОбъемНачисленийОбороты.ВидДифференцированности КАК ВидДифференцированности,
	|	"""" КАК ОснованиеПерерасчета,
	|	ДАТАВРЕМЯ(1, 1, 1) КАК ОснованиеПерерасчетаДата,
	|	ЗНАЧЕНИЕ(Справочник.энргПриборыУчетаАбонента.ПустаяСсылка) КАК ПриборЗависимой,
	|	ЛОЖЬ КАК СписатьИзНормы,
	|	энргОбъемНачисленийОбороты.ПовыщающийКоэффициент КАК ПовыщающийКоэффициент,
	|	0 КАК КоличествоСобственников,
	|	0 КАК КоличествоПроживающих,
	|	ЛОЖЬ КАК СниматьНачисленныйСредний,
	|	энргОбъемНачисленийОбороты.ПлощадьМОП КАК ПлощадьМОП,
	|	энргОбъемНачисленийОбороты.ПлощадьАбонентов КАК ПлощадьАбонентов,
	|	энргОбъемНачисленийОбороты.ПлощадьСобственнаяПоставка КАК ПлощадьСобственнаяПоставка,
	|	0 КАК КоэффициентРаспределенияОстатка,
	|	0 КАК ОбъемУслугиСоцНорма,
	|	энргОбъемНачисленийОбороты.СоставнаяУслуга КАК СоставнаяУслуга,
	|	энргОбъемНачисленийОбороты.НеПрименятьСезонность КАК НеПрименятьСезонность,
	|	ЗНАЧЕНИЕ(Справочник.энргПомещения.ПустаяСсылка) КАК ПомещениеРодитель,
	|	энргОбъемНачисленийОбороты.Договор КАК Договор
	|ПОМЕСТИТЬ ОбъемНачисленийНП
	|ИЗ
	|	РегистрНакопления.бестОбъемНачисленийНП КАК энргОбъемНачисленийОбороты
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.бестОбъектыРасчета КАК бестОбъектыРасчета
	|		ПО энргОбъемНачисленийОбороты.ОбъектРасчета = бестОбъектыРасчета.Ссылка
	|			И (бестОбъектыРасчета.МКД = &Строение)
	|			И (энргОбъемНачисленийОбороты.Период МЕЖДУ &НачалоПериодаПерерасчета И &КонецПериодаПерерасчета)
	|			И (энргОбъемНачисленийОбороты.Организация = &Организация)
	|			И (энргОбъемНачисленийОбороты.Район = &Район)
	|			И (НЕ энргОбъемНачисленийОбороты.Распределение)";
	
	Возврат Текст;
	
КонецФункции

#КонецОбласти

#Область ПересчитатьРаспредениеОбъемаПотребленногоМКД
	
Процедура ПрочитатьНормативныеДанныеРаспределения_Перерасчет(МВТ,Организация,ПериодНачисления,Район,Строение)
	
	Запрос  						= Новый Запрос(ТекстЗапросаНормативныеДанныеРаспределения_Перерасчет());
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Запрос.УстановитьПараметр("ПериодНачисления", 	ПериодНачисления);
	Запрос.УстановитьПараметр("Организация", 		Организация);
	Запрос.УстановитьПараметр("Район", 				Район);
	Запрос.УстановитьПараметр("Строение", 			Строение);
	Запрос.Выполнить();
	
КонецПроцедуры

Процедура ПрочитатьДокументыДляРаспределения_Перерасчет(МВТ,Организация,ПериодНачисления,Район,Строение)
	
	Запрос  						= Новый Запрос(ТекстЗапросаДокументыДляРаспределенияМКД_Перерасчет());
	Запрос.УстановитьПараметр("ПериодНачисления", 	ПериодНачисления);
	Запрос.УстановитьПараметр("Организация", 		Организация);
	Запрос.УстановитьПараметр("Район", 				Район);
	Запрос.УстановитьПараметр("Строение", 			Строение); 	
	Запрос.МенеджерВременныхТаблиц 	= МВТ;	
	Запрос.Выполнить();
	
КонецПроцедуры

Процедура ПрочитатьСозданныеДокументыИндивидуальныхНачислений_Перерасчет(МВТ,Организация,ПериодНачисления,Район,Строение)
	
	Запрос  						= Новый Запрос(ТекстЗапросаСозданныеДокументыРаспределения_Перерасчет());
	Запрос.УстановитьПараметр("ПериодНачисления", 	ПериодНачисления);
	Запрос.УстановитьПараметр("Организация", 		Организация);
	Запрос.УстановитьПараметр("Район", 				Район);
	Запрос.УстановитьПараметр("Строение", 			Строение);	
	Запрос.МенеджерВременныхТаблиц 	= МВТ;		
	Запрос.Выполнить();

КонецПроцедуры

Процедура ПрочитатьОбъемыНачисленийМКДДляРаспределения_Перерасчет(МВТ,Организация,ПериодНачисления,Район,Строение,ПараметрыПерерасчета)
	
	Запрос  						= Новый Запрос(ТекстЗапросаОбъемыНачисленийМКДДляРаспределения_Перерасчет());
	Запрос.УстановитьПараметр("ПериодНачисления", 				ПериодНачисления);
	Запрос.УстановитьПараметр("Организация", 					Организация);
	Запрос.УстановитьПараметр("Район", 							Район);
	Запрос.УстановитьПараметр("Строение", 						Строение);
	Запрос.УстановитьПараметр("энргОбъемНачисленийМКД", 		ПараметрыПерерасчета.ОбъемНачисленийМКД);
	Запрос.УстановитьПараметр("НачалоПериодаПерерасчета",		ПараметрыПерерасчета.НачалоПериодаРасчета);
	Запрос.УстановитьПараметр("КонецПериодаПерерасчета",		ПараметрыПерерасчета.КонецПериодаРасчета);
	Запрос.МенеджерВременныхТаблиц 	= МВТ;
	Запрос.Выполнить();

КонецПроцедуры

#КонецОбласти
